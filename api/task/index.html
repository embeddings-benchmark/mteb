
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../benchmark/">
      
      
        <link rel="next" href="../model/">
      
      
        
      
      
      <link rel="icon" href="../../images/logos/mteb_logo/dots-icon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Task - Massive Text Embedding Benchmark</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="light-blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#tasks" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Massive Text Embedding Benchmark" class="md-header__button md-logo" aria-label="Massive Text Embedding Benchmark" data-md-component="logo">
      
  <img src="../../images/logos/mteb_logo/dots-icon.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Massive Text Embedding Benchmark
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Task
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="light-blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="light-blue"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/embeddings-benchmark/mteb" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../.." class="md-tabs__link">
          
  
  
    
  
  Get Started

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../contributing/adding_a_model/" class="md-tabs__link">
          
  
  
    
  
  Contributing

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../overview/" class="md-tabs__link">
          
  
  
    
  
  Overview

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
  
    
  
  API

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="https://huggingface.co/spaces/mteb/leaderboard" class="md-tabs__link">
        
  
  
    
  
  Leaderboard

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Massive Text Embedding Benchmark" class="md-nav__button md-logo" aria-label="Massive Text Embedding Benchmark" data-md-component="logo">
      
  <img src="../../images/logos/mteb_logo/dots-icon.png" alt="logo">

    </a>
    Massive Text Embedding Benchmark
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/embeddings-benchmark/mteb" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../.." class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Get Started
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_1" id="__nav_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Get Started
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Installation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../whats_new/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    What's New
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_4" >
        
          
          <label class="md-nav__link" for="__nav_1_4" id="__nav_1_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Usage
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Usage
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../usage/get_started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Get Started
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../usage/defining_the_model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Defining the Model
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../usage/selecting_tasks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Selecting Tasks
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../usage/running_the_evaluation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Running the Evaluation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../usage/loading_results/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Loading Results
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../usage/cli/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Command Line Interface
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../usage/leaderboard/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Running the Leaderboard
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_5" >
        
          
          <label class="md-nav__link" for="__nav_1_5" id="__nav_1_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Advanced Usage
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Advanced Usage
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../advanced_usage/two_stage_reranking/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Two stage reranking
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../advanced_usage/cache_embeddings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Cache embeddings
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../advanced_usage/retrieval_backend/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Retrieval backend
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../advanced_usage/vllm_wrapper/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    vLLM Wrapper
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Contributing
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Contributing
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/adding_a_model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Adding a Model
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/adding_a_dataset/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Adding a Task
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/adding_a_benchmark/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Adding a Benchmark
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../CONTRIBUTING/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Contributing to mteb
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../overview/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Overview
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Benchmarks
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Benchmarks
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../overview/available_benchmarks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Available Benchmarks
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Tasks
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Tasks
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_3_1" id="__nav_3_3_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Available Tasks
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Available Tasks
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../overview/available_tasks/any2anymultilingualretrieval/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Any2AnyMultilingualRetrieval
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../overview/available_tasks/any2anyretrieval/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Any2AnyRetrieval
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../overview/available_tasks/audioclassification/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    AudioClassification
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../overview/available_tasks/audioclustering/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    AudioClustering
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../overview/available_tasks/audiomultilabelclassification/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    AudioMultilabelClassification
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../overview/available_tasks/audiopairclassification/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    AudioPairClassification
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../overview/available_tasks/audioreranking/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    AudioReranking
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../overview/available_tasks/audiozeroshotclassification/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    AudioZeroshotClassification
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../overview/available_tasks/bitextmining/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    BitextMining
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../overview/available_tasks/classification/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Classification
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../overview/available_tasks/clustering/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Clustering
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../overview/available_tasks/compositionality/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Compositionality
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../overview/available_tasks/documentunderstanding/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DocumentUnderstanding
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../overview/available_tasks/imageclassification/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ImageClassification
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../overview/available_tasks/imageclustering/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ImageClustering
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../overview/available_tasks/instructionreranking/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    InstructionReranking
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../overview/available_tasks/instructionretrieval/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    InstructionRetrieval
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../overview/available_tasks/multilabelclassification/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    MultilabelClassification
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../overview/available_tasks/pairclassification/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    PairClassification
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../overview/available_tasks/regression/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Regression
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../overview/available_tasks/reranking/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Reranking
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../overview/available_tasks/retrieval/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Retrieval
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../overview/available_tasks/sts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    STS
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../overview/available_tasks/summarization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Summarization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../overview/available_tasks/visioncentricqa/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    VisionCentricQA
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../overview/available_tasks/visualsts%28eng%29/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    VisualSTS(eng)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../overview/available_tasks/visualsts%28multi%29/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    VisualSTS(multi)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../overview/available_tasks/zeroshotclassification/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ZeroShotClassification
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Models
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Models
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4_1" >
        
          
          <label class="md-nav__link" for="__nav_3_4_1" id="__nav_3_4_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Available Models
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Available Models
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../overview/available_models/audio/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Audio Model
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../overview/available_models/audio_image_text/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Audio-image-text Model
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../overview/available_models/audio_text/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Audio-text Model
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../overview/available_models/image/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Image Model
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../overview/available_models/image_text/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Image-text Model
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../overview/available_models/text/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Text Model
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    API
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    API
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../evaluation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Evaluation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../benchmark/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Benchmark
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Task
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Task
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#utilities" class="md-nav__link">
    <span class="md-ellipsis">
      
        Utilities
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Utilities">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mteb.get_tasks" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_tasks
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mteb.get_task" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_task
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mteb.filter_tasks" class="md-nav__link">
    <span class="md-ellipsis">
      
        filter_tasks
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#metadata" class="md-nav__link">
    <span class="md-ellipsis">
      
        Metadata
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Metadata">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mteb.TaskMetadata" class="md-nav__link">
    <span class="md-ellipsis">
      
        TaskMetadata
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#metadata-types" class="md-nav__link">
    <span class="md-ellipsis">
      
        Metadata Types
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Metadata Types">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mteb.abstasks.task_metadata.AnnotatorType" class="md-nav__link">
    <span class="md-ellipsis">
      
        AnnotatorType
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mteb.abstasks.task_metadata.SampleCreationMethod" class="md-nav__link">
    <span class="md-ellipsis">
      
        SampleCreationMethod
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mteb.abstasks.task_metadata.TaskCategory" class="md-nav__link">
    <span class="md-ellipsis">
      
        TaskCategory
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mteb.abstasks.task_metadata.TaskDomain" class="md-nav__link">
    <span class="md-ellipsis">
      
        TaskDomain
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mteb.abstasks.task_metadata.TaskType" class="md-nav__link">
    <span class="md-ellipsis">
      
        TaskType
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mteb.abstasks.task_metadata.TaskSubtype" class="md-nav__link">
    <span class="md-ellipsis">
      
        TaskSubtype
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mteb.abstasks.task_metadata.PromptDict" class="md-nav__link">
    <span class="md-ellipsis">
      
        PromptDict
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-task-object" class="md-nav__link">
    <span class="md-ellipsis">
      
        The Task Object
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="The Task Object">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mteb.AbsTask" class="md-nav__link">
    <span class="md-ellipsis">
      
        AbsTask
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#multimodal-tasks" class="md-nav__link">
    <span class="md-ellipsis">
      
        Multimodal Tasks
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Multimodal Tasks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mteb.abstasks.retrieval.AbsTaskRetrieval" class="md-nav__link">
    <span class="md-ellipsis">
      
        AbsTaskRetrieval
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mteb.abstasks.retrieval_dataset_loaders.RetrievalSplitData" class="md-nav__link">
    <span class="md-ellipsis">
      
        RetrievalSplitData
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mteb.abstasks.classification.AbsTaskClassification" class="md-nav__link">
    <span class="md-ellipsis">
      
        AbsTaskClassification
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mteb.abstasks.multilabel_classification.AbsTaskMultilabelClassification" class="md-nav__link">
    <span class="md-ellipsis">
      
        AbsTaskMultilabelClassification
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mteb.abstasks.clustering.AbsTaskClustering" class="md-nav__link">
    <span class="md-ellipsis">
      
        AbsTaskClustering
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mteb.abstasks.sts.AbsTaskSTS" class="md-nav__link">
    <span class="md-ellipsis">
      
        AbsTaskSTS
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mteb.abstasks.zeroshot_classification.AbsTaskZeroShotClassification" class="md-nav__link">
    <span class="md-ellipsis">
      
        AbsTaskZeroShotClassification
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mteb.abstasks.regression.AbsTaskRegression" class="md-nav__link">
    <span class="md-ellipsis">
      
        AbsTaskRegression
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mteb.abstasks.clustering_legacy.AbsTaskClusteringLegacy" class="md-nav__link">
    <span class="md-ellipsis">
      
        AbsTaskClusteringLegacy
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#text-tasks" class="md-nav__link">
    <span class="md-ellipsis">
      
        Text Tasks
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Text Tasks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mteb.abstasks.text.bitext_mining.AbsTaskBitextMining" class="md-nav__link">
    <span class="md-ellipsis">
      
        AbsTaskBitextMining
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mteb.abstasks.pair_classification.AbsTaskPairClassification" class="md-nav__link">
    <span class="md-ellipsis">
      
        AbsTaskPairClassification
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mteb.abstasks.text.summarization.AbsTaskSummarization" class="md-nav__link">
    <span class="md-ellipsis">
      
        AbsTaskSummarization
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mteb.abstasks.text.reranking.AbsTaskReranking" class="md-nav__link">
    <span class="md-ellipsis">
      
        AbsTaskReranking
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#image-tasks" class="md-nav__link">
    <span class="md-ellipsis">
      
        Image Tasks
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Image Tasks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mteb.abstasks.image.image_text_pair_classification.AbsTaskImageTextPairClassification" class="md-nav__link">
    <span class="md-ellipsis">
      
        AbsTaskImageTextPairClassification
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Model
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../results/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Results
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../types/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Additional Types
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://huggingface.co/spaces/mteb/leaderboard" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Leaderboard
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#utilities" class="md-nav__link">
    <span class="md-ellipsis">
      
        Utilities
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Utilities">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mteb.get_tasks" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_tasks
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mteb.get_task" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_task
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mteb.filter_tasks" class="md-nav__link">
    <span class="md-ellipsis">
      
        filter_tasks
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#metadata" class="md-nav__link">
    <span class="md-ellipsis">
      
        Metadata
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Metadata">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mteb.TaskMetadata" class="md-nav__link">
    <span class="md-ellipsis">
      
        TaskMetadata
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#metadata-types" class="md-nav__link">
    <span class="md-ellipsis">
      
        Metadata Types
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Metadata Types">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mteb.abstasks.task_metadata.AnnotatorType" class="md-nav__link">
    <span class="md-ellipsis">
      
        AnnotatorType
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mteb.abstasks.task_metadata.SampleCreationMethod" class="md-nav__link">
    <span class="md-ellipsis">
      
        SampleCreationMethod
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mteb.abstasks.task_metadata.TaskCategory" class="md-nav__link">
    <span class="md-ellipsis">
      
        TaskCategory
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mteb.abstasks.task_metadata.TaskDomain" class="md-nav__link">
    <span class="md-ellipsis">
      
        TaskDomain
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mteb.abstasks.task_metadata.TaskType" class="md-nav__link">
    <span class="md-ellipsis">
      
        TaskType
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mteb.abstasks.task_metadata.TaskSubtype" class="md-nav__link">
    <span class="md-ellipsis">
      
        TaskSubtype
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mteb.abstasks.task_metadata.PromptDict" class="md-nav__link">
    <span class="md-ellipsis">
      
        PromptDict
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-task-object" class="md-nav__link">
    <span class="md-ellipsis">
      
        The Task Object
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="The Task Object">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mteb.AbsTask" class="md-nav__link">
    <span class="md-ellipsis">
      
        AbsTask
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#multimodal-tasks" class="md-nav__link">
    <span class="md-ellipsis">
      
        Multimodal Tasks
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Multimodal Tasks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mteb.abstasks.retrieval.AbsTaskRetrieval" class="md-nav__link">
    <span class="md-ellipsis">
      
        AbsTaskRetrieval
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mteb.abstasks.retrieval_dataset_loaders.RetrievalSplitData" class="md-nav__link">
    <span class="md-ellipsis">
      
        RetrievalSplitData
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mteb.abstasks.classification.AbsTaskClassification" class="md-nav__link">
    <span class="md-ellipsis">
      
        AbsTaskClassification
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mteb.abstasks.multilabel_classification.AbsTaskMultilabelClassification" class="md-nav__link">
    <span class="md-ellipsis">
      
        AbsTaskMultilabelClassification
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mteb.abstasks.clustering.AbsTaskClustering" class="md-nav__link">
    <span class="md-ellipsis">
      
        AbsTaskClustering
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mteb.abstasks.sts.AbsTaskSTS" class="md-nav__link">
    <span class="md-ellipsis">
      
        AbsTaskSTS
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mteb.abstasks.zeroshot_classification.AbsTaskZeroShotClassification" class="md-nav__link">
    <span class="md-ellipsis">
      
        AbsTaskZeroShotClassification
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mteb.abstasks.regression.AbsTaskRegression" class="md-nav__link">
    <span class="md-ellipsis">
      
        AbsTaskRegression
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mteb.abstasks.clustering_legacy.AbsTaskClusteringLegacy" class="md-nav__link">
    <span class="md-ellipsis">
      
        AbsTaskClusteringLegacy
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#text-tasks" class="md-nav__link">
    <span class="md-ellipsis">
      
        Text Tasks
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Text Tasks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mteb.abstasks.text.bitext_mining.AbsTaskBitextMining" class="md-nav__link">
    <span class="md-ellipsis">
      
        AbsTaskBitextMining
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mteb.abstasks.pair_classification.AbsTaskPairClassification" class="md-nav__link">
    <span class="md-ellipsis">
      
        AbsTaskPairClassification
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mteb.abstasks.text.summarization.AbsTaskSummarization" class="md-nav__link">
    <span class="md-ellipsis">
      
        AbsTaskSummarization
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mteb.abstasks.text.reranking.AbsTaskReranking" class="md-nav__link">
    <span class="md-ellipsis">
      
        AbsTaskReranking
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#image-tasks" class="md-nav__link">
    <span class="md-ellipsis">
      
        Image Tasks
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Image Tasks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mteb.abstasks.image.image_text_pair_classification.AbsTaskImageTextPairClassification" class="md-nav__link">
    <span class="md-ellipsis">
      
        AbsTaskImageTextPairClassification
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
    <a href="https://github.com/embeddings-benchmark/mteb/blob/main/docs/api/task.md" title="Edit this page" class="md-content__button md-icon" rel="edit">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
    </a>
  
  
    
      
    
    <a href="https://github.com/embeddings-benchmark/mteb/raw/main/docs/api/task.md" title="View source of this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"/></svg>
    </a>
  


<h1 id="tasks">Tasks<a class="headerlink" href="#tasks" title="Permanent link">&para;</a></h1>
<p>A task is an implementation of a dataset for evaluation. It could, for instance, be the MIRACL dataset consisting of queries, a corpus of documents
,and the correct documents to retrieve for a given query. In addition to the dataset, a task includes the specifications for how a model should be run on the dataset and how its output should be evaluated. Each task also comes with extensive metadata including the license, who annotated the data, etc.</p>
<figure>
    <img alt="" src="../../images/visualizations/task_explainer.png" width="80%" />
    <figcaption>An overview of the tasks within <code>mteb</code></figcaption>
</figure>
<h2 id="utilities">Utilities<a class="headerlink" href="#utilities" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-module">



<h3 id="mteb.get_tasks" class="doc doc-heading">
            <code>mteb.get_tasks</code>


<a href="#mteb.get_tasks" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents first">

        <p>This script contains functions that are used to get an overview of the MTEB benchmark.</p>










<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h4 id="mteb.get_tasks.MTEBTasks" class="doc doc-heading">
            <code>MTEBTasks</code>


<a href="#mteb.get_tasks.MTEBTasks" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="tuple">tuple</span>[<a class="autorefs autorefs-internal" title="&lt;code&gt;mteb.AbsTask&lt;/code&gt; (&lt;code&gt;mteb.abstasks.AbsTask&lt;/code&gt;)" href="#mteb.AbsTask">AbsTask</a>]</code></p>



        <p>A tuple of tasks with additional methods to get an overview of the tasks.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>mteb/get_tasks.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">MTEBTasks</span><span class="p">(</span><span class="nb">tuple</span><span class="p">[</span><span class="n">AbsTask</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A tuple of tasks with additional methods to get an overview of the tasks.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;MTEBTasks&quot;</span> <span class="o">+</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_property_from_task</span><span class="p">(</span><span class="n">task</span><span class="p">:</span> <span class="n">AbsTask</span><span class="p">,</span> <span class="nb">property</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span> <span class="nb">property</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span> <span class="nb">property</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">task</span><span class="p">,</span> <span class="nb">property</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">task</span><span class="p">,</span> <span class="nb">property</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;Property neither in Task attribute or in task metadata.&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">languages</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return all languages from tasks&quot;&quot;&quot;</span>
        <span class="n">langs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">lg</span> <span class="ow">in</span> <span class="n">task</span><span class="o">.</span><span class="n">languages</span><span class="p">:</span>
                <span class="n">langs</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">lg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">langs</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">count_languages</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Counter</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Summarize count of all languages from tasks</span>

<span class="sd">        Returns:</span>
<span class="sd">            Counter with language as key and count as value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">langs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">langs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">languages</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Counter</span><span class="p">(</span><span class="n">langs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_markdown</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">properties</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">_DEFAULT_PROPRIETIES</span><span class="p">,</span>
        <span class="n">limit_n_entries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate markdown table with tasks summary</span>

<span class="sd">        Args:</span>
<span class="sd">            properties: list of metadata to summarize from a Task class.</span>
<span class="sd">            limit_n_entries: Limit the number of entries for cell values, e.g. number of languages and domains. Will use &quot;...&quot; to indicate that</span>
<span class="sd">                there are more entries.</span>

<span class="sd">        Returns:</span>
<span class="sd">            string with a markdown table.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_limit_entries_in_cell_inner</span><span class="p">(</span><span class="n">cell</span><span class="p">:</span> <span class="n">Any</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">set</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_limit_entries_in_cell</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">limit_n_entries</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">cell</span>

        <span class="n">markdown_table</span> <span class="o">=</span> <span class="s2">&quot;| Task&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;| </span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2">  &quot;</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">properties</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;|</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">_head_sep</span> <span class="o">=</span> <span class="s2">&quot;| ---&quot;</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; |</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">markdown_table</span> <span class="o">+=</span> <span class="n">_head_sep</span>
        <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">markdown_table</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;| </span><span class="si">{</span><span class="n">task</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> &quot;</span>
            <span class="n">markdown_table</span> <span class="o">+=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="sa">f</span><span class="s2">&quot;| </span><span class="si">{</span><span class="n">_limit_entries_in_cell_inner</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_extract_property_from_task</span><span class="p">(</span><span class="n">task</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">))</span><span class="si">}</span><span class="s2"> &quot;</span>
                    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">properties</span>
                <span class="p">]</span>
            <span class="p">)</span>
            <span class="n">markdown_table</span> <span class="o">+=</span> <span class="s2">&quot; |</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">markdown_table</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_dataframe</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">properties</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">_DEFAULT_PROPRIETIES</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate pandas DataFrame with tasks summary</span>

<span class="sd">        Args:</span>
<span class="sd">            properties: list of metadata to summarize from a Task class.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pandas DataFrame.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">{</span><span class="n">p</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_property_from_task</span><span class="p">(</span><span class="n">task</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">properties</span><span class="p">}</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_limit_entries_in_cell</span><span class="p">(</span>
        <span class="n">cell</span><span class="p">:</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">set</span><span class="p">,</span> <span class="n">limit_n_entries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">limit_n_entries</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">limit_n_entries</span><span class="p">:</span>
            <span class="n">ending</span> <span class="o">=</span> <span class="s2">&quot;]&quot;</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;}&quot;</span>
            <span class="n">cell</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">cell</span><span class="p">[:</span><span class="n">limit_n_entries</span><span class="p">])[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;, ...&quot;</span> <span class="o">+</span> <span class="n">ending</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_latex</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">properties</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">_DEFAULT_PROPRIETIES</span><span class="p">,</span>
        <span class="n">group_indices</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">),</span>
        <span class="n">include_citation_in_name</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">limit_n_entries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate a LaTeX table of the tasks.</span>

<span class="sd">        Args:</span>
<span class="sd">            properties: list of metadata to summarize from a Task class.</span>
<span class="sd">            group_indices: list of properties to group the table by.</span>
<span class="sd">            include_citation_in_name: Whether to include the citation in the name.</span>
<span class="sd">            limit_n_entries: Limit the number of entries for cell values, e.g. number of languages and domains. Will use &quot;...&quot; to indicate that</span>
<span class="sd">                there are more entries.</span>

<span class="sd">        Returns:</span>
<span class="sd">            string with a LaTeX table.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">include_citation_in_name</span> <span class="ow">and</span> <span class="s2">&quot;name&quot;</span> <span class="ow">in</span> <span class="n">properties</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="s2">&quot;intext_citation&quot;</span><span class="p">,))</span>
            <span class="n">df</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;intext_citation&quot;</span><span class="p">]</span>  <span class="c1"># type: ignore[operator]</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;intext_citation&quot;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">limit_n_entries</span> <span class="ow">and</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>  <span class="c1"># ensure that there are entries</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="c1"># check if content is a list or set</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">set</span><span class="p">):</span>
                    <span class="n">_col</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]:</span>
                        <span class="n">str_col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_limit_entries_in_cell</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">limit_n_entries</span><span class="p">)</span>

                        <span class="c1"># escape } and { characters</span>
                        <span class="n">str_col</span> <span class="o">=</span> <span class="n">str_col</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;{&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">{&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;}&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">}&quot;</span><span class="p">)</span>
                        <span class="n">_col</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">str_col</span><span class="p">)</span>
                    <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">_col</span>

        <span class="k">if</span> <span class="n">group_indices</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">group_indices</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">to_latex</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h5 id="mteb.get_tasks.MTEBTasks.languages" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">languages</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#mteb.get_tasks.MTEBTasks.languages" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Return all languages from tasks</p>

    </div>

</div>




<div class="doc doc-object doc-function">


<h5 id="mteb.get_tasks.MTEBTasks.count_languages" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">count_languages</span><span class="p">()</span></code>

<a href="#mteb.get_tasks.MTEBTasks.count_languages" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Summarize count of all languages from tasks</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="collections.Counter">Counter</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Counter with language as key and count as value.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>mteb/get_tasks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">count_languages</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Counter</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Summarize count of all languages from tasks</span>

<span class="sd">    Returns:</span>
<span class="sd">        Counter with language as key and count as value.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">langs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
        <span class="n">langs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">languages</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Counter</span><span class="p">(</span><span class="n">langs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="mteb.get_tasks.MTEBTasks.to_dataframe" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_dataframe</span><span class="p">(</span><span class="n">properties</span><span class="o">=</span><span class="n">_DEFAULT_PROPRIETIES</span><span class="p">)</span></code>

<a href="#mteb.get_tasks.MTEBTasks.to_dataframe" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Generate pandas DataFrame with tasks summary</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>properties</code>
            </td>
            <td>
                  <code><span title="collections.abc.Sequence">Sequence</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of metadata to summarize from a Task class.</p>
              </div>
            </td>
            <td>
                  <code><span title="mteb.get_tasks._DEFAULT_PROPRIETIES">_DEFAULT_PROPRIETIES</span></code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pandas DataFrame.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>mteb/get_tasks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">to_dataframe</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">properties</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">_DEFAULT_PROPRIETIES</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate pandas DataFrame with tasks summary</span>

<span class="sd">    Args:</span>
<span class="sd">        properties: list of metadata to summarize from a Task class.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pandas DataFrame.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
        <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">{</span><span class="n">p</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_property_from_task</span><span class="p">(</span><span class="n">task</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">properties</span><span class="p">}</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="mteb.get_tasks.MTEBTasks.to_latex" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_latex</span><span class="p">(</span><span class="n">properties</span><span class="o">=</span><span class="n">_DEFAULT_PROPRIETIES</span><span class="p">,</span> <span class="n">group_indices</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">),</span> <span class="n">include_citation_in_name</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">limit_n_entries</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span></code>

<a href="#mteb.get_tasks.MTEBTasks.to_latex" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Generate a LaTeX table of the tasks.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>properties</code>
            </td>
            <td>
                  <code><span title="collections.abc.Sequence">Sequence</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of metadata to summarize from a Task class.</p>
              </div>
            </td>
            <td>
                  <code><span title="mteb.get_tasks._DEFAULT_PROPRIETIES">_DEFAULT_PROPRIETIES</span></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>group_indices</code>
            </td>
            <td>
                  <code><span title="collections.abc.Sequence">Sequence</span>[<span title="str">str</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of properties to group the table by.</p>
              </div>
            </td>
            <td>
                  <code>(&#39;type&#39;, &#39;name&#39;)</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>include_citation_in_name</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to include the citation in the name.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>limit_n_entries</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Limit the number of entries for cell values, e.g. number of languages and domains. Will use "..." to indicate that
there are more entries.</p>
              </div>
            </td>
            <td>
                  <code>3</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>string with a LaTeX table.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>mteb/get_tasks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">to_latex</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">properties</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">_DEFAULT_PROPRIETIES</span><span class="p">,</span>
    <span class="n">group_indices</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">),</span>
    <span class="n">include_citation_in_name</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">limit_n_entries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a LaTeX table of the tasks.</span>

<span class="sd">    Args:</span>
<span class="sd">        properties: list of metadata to summarize from a Task class.</span>
<span class="sd">        group_indices: list of properties to group the table by.</span>
<span class="sd">        include_citation_in_name: Whether to include the citation in the name.</span>
<span class="sd">        limit_n_entries: Limit the number of entries for cell values, e.g. number of languages and domains. Will use &quot;...&quot; to indicate that</span>
<span class="sd">            there are more entries.</span>

<span class="sd">    Returns:</span>
<span class="sd">        string with a LaTeX table.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">include_citation_in_name</span> <span class="ow">and</span> <span class="s2">&quot;name&quot;</span> <span class="ow">in</span> <span class="n">properties</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="s2">&quot;intext_citation&quot;</span><span class="p">,))</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;intext_citation&quot;</span><span class="p">]</span>  <span class="c1"># type: ignore[operator]</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;intext_citation&quot;</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">limit_n_entries</span> <span class="ow">and</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>  <span class="c1"># ensure that there are entries</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="c1"># check if content is a list or set</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">set</span><span class="p">):</span>
                <span class="n">_col</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]:</span>
                    <span class="n">str_col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_limit_entries_in_cell</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">limit_n_entries</span><span class="p">)</span>

                    <span class="c1"># escape } and { characters</span>
                    <span class="n">str_col</span> <span class="o">=</span> <span class="n">str_col</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;{&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">{&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;}&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">}&quot;</span><span class="p">)</span>
                    <span class="n">_col</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">str_col</span><span class="p">)</span>
                <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">_col</span>

    <span class="k">if</span> <span class="n">group_indices</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">group_indices</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">to_latex</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="mteb.get_tasks.MTEBTasks.to_markdown" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_markdown</span><span class="p">(</span><span class="n">properties</span><span class="o">=</span><span class="n">_DEFAULT_PROPRIETIES</span><span class="p">,</span> <span class="n">limit_n_entries</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span></code>

<a href="#mteb.get_tasks.MTEBTasks.to_markdown" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Generate markdown table with tasks summary</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>properties</code>
            </td>
            <td>
                  <code><span title="collections.abc.Sequence">Sequence</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of metadata to summarize from a Task class.</p>
              </div>
            </td>
            <td>
                  <code><span title="mteb.get_tasks._DEFAULT_PROPRIETIES">_DEFAULT_PROPRIETIES</span></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>limit_n_entries</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Limit the number of entries for cell values, e.g. number of languages and domains. Will use "..." to indicate that
there are more entries.</p>
              </div>
            </td>
            <td>
                  <code>3</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>string with a markdown table.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>mteb/get_tasks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">to_markdown</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">properties</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">_DEFAULT_PROPRIETIES</span><span class="p">,</span>
    <span class="n">limit_n_entries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate markdown table with tasks summary</span>

<span class="sd">    Args:</span>
<span class="sd">        properties: list of metadata to summarize from a Task class.</span>
<span class="sd">        limit_n_entries: Limit the number of entries for cell values, e.g. number of languages and domains. Will use &quot;...&quot; to indicate that</span>
<span class="sd">            there are more entries.</span>

<span class="sd">    Returns:</span>
<span class="sd">        string with a markdown table.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_limit_entries_in_cell_inner</span><span class="p">(</span><span class="n">cell</span><span class="p">:</span> <span class="n">Any</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">set</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_limit_entries_in_cell</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">limit_n_entries</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cell</span>

    <span class="n">markdown_table</span> <span class="o">=</span> <span class="s2">&quot;| Task&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;| </span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2">  &quot;</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">properties</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;|</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">_head_sep</span> <span class="o">=</span> <span class="s2">&quot;| ---&quot;</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; |</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">markdown_table</span> <span class="o">+=</span> <span class="n">_head_sep</span>
    <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
        <span class="n">markdown_table</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;| </span><span class="si">{</span><span class="n">task</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> &quot;</span>
        <span class="n">markdown_table</span> <span class="o">+=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="sa">f</span><span class="s2">&quot;| </span><span class="si">{</span><span class="n">_limit_entries_in_cell_inner</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_extract_property_from_task</span><span class="p">(</span><span class="n">task</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">))</span><span class="si">}</span><span class="s2"> &quot;</span>
                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">properties</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="n">markdown_table</span> <span class="o">+=</span> <span class="s2">&quot; |</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="k">return</span> <span class="n">markdown_table</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h4 id="mteb.get_tasks.get_task" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_task</span><span class="p">(</span><span class="n">task_name</span><span class="p">,</span> <span class="n">languages</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">script</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">eval_splits</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hf_subsets</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exclusive_language_filter</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#mteb.get_tasks.get_task" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Get a task by name.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>task_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the task to fetch.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>languages</code>
            </td>
            <td>
                  <code><span title="collections.abc.Sequence">Sequence</span>[<span title="str">str</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of languages either specified as 3 letter languages codes (ISO 639-3, e.g. "eng") or as script languages codes e.g.
"eng-Latn". For multilingual tasks this will also remove languages that are not in the specified list.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>script</code>
            </td>
            <td>
                  <code><span title="collections.abc.Sequence">Sequence</span>[<span title="str">str</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of script codes (ISO 15924 codes). If None, all scripts are included. For multilingual tasks this will also remove scripts</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>eval_splits</code>
            </td>
            <td>
                  <code><span title="collections.abc.Sequence">Sequence</span>[<span title="str">str</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of evaluation splits to include. If None, all splits are included.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>hf_subsets</code>
            </td>
            <td>
                  <code><span title="collections.abc.Sequence">Sequence</span>[<span title="str">str</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of Huggingface subsets to evaluate on.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>exclusive_language_filter</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Some datasets contains more than one language e.g. for STS22 the subset "de-en" contain eng and deu. If
exclusive_language_filter is set to False both of these will be kept, but if set to True only those that contains all the languages
specified will be kept.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="&lt;code&gt;mteb.AbsTask&lt;/code&gt; (&lt;code&gt;mteb.abstasks.AbsTask&lt;/code&gt;)" href="#mteb.AbsTask">AbsTask</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An initialized task object.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">get_task</span><span class="p">(</span><span class="s2">&quot;BornholmBitextMining&quot;</span><span class="p">)</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>mteb/get_tasks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_task</span><span class="p">(</span>
    <span class="n">task_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">languages</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">script</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">eval_splits</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">hf_subsets</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">exclusive_language_filter</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AbsTask</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get a task by name.</span>

<span class="sd">    Args:</span>
<span class="sd">        task_name: The name of the task to fetch.</span>
<span class="sd">        languages: A list of languages either specified as 3 letter languages codes (ISO 639-3, e.g. &quot;eng&quot;) or as script languages codes e.g.</span>
<span class="sd">            &quot;eng-Latn&quot;. For multilingual tasks this will also remove languages that are not in the specified list.</span>
<span class="sd">        script: A list of script codes (ISO 15924 codes). If None, all scripts are included. For multilingual tasks this will also remove scripts</span>
<span class="sd">        eval_splits: A list of evaluation splits to include. If None, all splits are included.</span>
<span class="sd">        hf_subsets: A list of Huggingface subsets to evaluate on.</span>
<span class="sd">        exclusive_language_filter: Some datasets contains more than one language e.g. for STS22 the subset &quot;de-en&quot; contain eng and deu. If</span>
<span class="sd">            exclusive_language_filter is set to False both of these will be kept, but if set to True only those that contains all the languages</span>
<span class="sd">            specified will be kept.</span>

<span class="sd">    Returns:</span>
<span class="sd">        An initialized task object.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; get_task(&quot;BornholmBitextMining&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">task_name</span> <span class="ow">in</span> <span class="n">_TASK_RENAMES</span><span class="p">:</span>
        <span class="n">_task_name</span> <span class="o">=</span> <span class="n">_TASK_RENAMES</span><span class="p">[</span><span class="n">task_name</span><span class="p">]</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;The task with the given name &#39;</span><span class="si">{</span><span class="n">task_name</span><span class="si">}</span><span class="s2">&#39; has been renamed to &#39;</span><span class="si">{</span><span class="n">_task_name</span><span class="si">}</span><span class="s2">&#39;. To prevent this warning use the new name.&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">task_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_TASKS_REGISTRY</span><span class="p">:</span>
        <span class="n">close_matches</span> <span class="o">=</span> <span class="n">difflib</span><span class="o">.</span><span class="n">get_close_matches</span><span class="p">(</span><span class="n">task_name</span><span class="p">,</span> <span class="n">_TASKS_REGISTRY</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">close_matches</span><span class="p">:</span>
            <span class="n">suggestion</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;KeyError: &#39;</span><span class="si">{</span><span class="n">task_name</span><span class="si">}</span><span class="s2">&#39; not found. Did you mean: &#39;</span><span class="si">{</span><span class="n">close_matches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;?&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">suggestion</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;KeyError: &#39;</span><span class="si">{</span><span class="n">task_name</span><span class="si">}</span><span class="s2">&#39; not found and no similar keys were found.&quot;</span>
            <span class="p">)</span>
        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">suggestion</span><span class="p">)</span>
    <span class="n">task</span> <span class="o">=</span> <span class="n">_TASKS_REGISTRY</span><span class="p">[</span><span class="n">task_name</span><span class="p">]()</span>
    <span class="k">if</span> <span class="n">eval_splits</span><span class="p">:</span>
        <span class="n">task</span><span class="o">.</span><span class="n">filter_eval_splits</span><span class="p">(</span><span class="n">eval_splits</span><span class="o">=</span><span class="n">eval_splits</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">task</span><span class="o">.</span><span class="n">filter_languages</span><span class="p">(</span>
        <span class="n">languages</span><span class="p">,</span>
        <span class="n">script</span><span class="p">,</span>
        <span class="n">hf_subsets</span><span class="o">=</span><span class="n">hf_subsets</span><span class="p">,</span>
        <span class="n">exclusive_language_filter</span><span class="o">=</span><span class="n">exclusive_language_filter</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="mteb.get_tasks.get_tasks" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_tasks</span><span class="p">(</span><span class="n">tasks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">languages</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">script</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">domains</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">task_types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">categories</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exclude_superseded</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">eval_splits</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exclusive_language_filter</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">modalities</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exclusive_modality_filter</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">exclude_aggregate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">exclude_private</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#mteb.get_tasks.get_tasks" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Get a list of tasks based on the specified filters.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>tasks</code>
            </td>
            <td>
                  <code><span title="collections.abc.Sequence">Sequence</span>[<span title="str">str</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of task names to include. If None, all tasks which pass the filters are included. If passed, other filters are ignored.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>languages</code>
            </td>
            <td>
                  <code><span title="collections.abc.Sequence">Sequence</span>[<span title="str">str</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of languages either specified as 3 letter languages codes (ISO 639-3, e.g. "eng") or as script languages codes e.g.
"eng-Latn". For multilingual tasks this will also remove languages that are not in the specified list.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>script</code>
            </td>
            <td>
                  <code><span title="collections.abc.Sequence">Sequence</span>[<span title="str">str</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of script codes (ISO 15924 codes, e.g. "Latn"). If None, all scripts are included. For multilingual tasks this will also remove scripts
that are not in the specified list.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>domains</code>
            </td>
            <td>
                  <code><span title="collections.abc.Sequence">Sequence</span>[<a class="autorefs autorefs-internal" title="&lt;code class=&quot;highlight language-python&quot;&gt;&lt;span class=&quot;n&quot;&gt;mteb&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;abstasks&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;task_metadata&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;TaskDomain&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Literal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;Academic&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Blog&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Constructed&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Encyclopaedic&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Engineering&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Fiction&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Government&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Legal&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Medical&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;News&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Non-fiction&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Poetry&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Religious&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Reviews&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Scene&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Social&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Spoken&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Subtitles&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Web&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Written&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Programming&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Chemistry&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Financial&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Entertainment&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;E-commerce&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;AudioScene&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Speech&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Spoken&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Music&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Bioacoustics&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;/code&gt;

  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;mteb.abstasks.task_metadata.TaskDomain&lt;/code&gt;)" href="#mteb.abstasks.task_metadata.TaskDomain">TaskDomain</a>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of task domains, e.g. "Legal", "Medical", "Fiction".</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>task_types</code>
            </td>
            <td>
                  <code><span title="collections.abc.Sequence">Sequence</span>[<a class="autorefs autorefs-internal" title="&lt;code class=&quot;highlight language-python&quot;&gt;&lt;span class=&quot;n&quot;&gt;mteb&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;abstasks&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;task_metadata&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;TaskType&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Literal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_TASK_TYPE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;/code&gt;

  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;mteb.abstasks.task_metadata.TaskType&lt;/code&gt;)" href="#mteb.abstasks.task_metadata.TaskType">TaskType</a>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A string specifying the type of task e.g. "Classification" or "Retrieval". If None, all tasks are included.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>categories</code>
            </td>
            <td>
                  <code><span title="collections.abc.Sequence">Sequence</span>[<a class="autorefs autorefs-internal" title="&lt;code class=&quot;highlight language-python&quot;&gt;&lt;span class=&quot;n&quot;&gt;mteb&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;abstasks&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;task_metadata&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;TaskCategory&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Literal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;t2t&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;t2c&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;i2i&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;i2c&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;i2t&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;t2i&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;it2t&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;it2i&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;i2it&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;t2it&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;it2it&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;a2a&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;a2c&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;a2t&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;t2a&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;at2t&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;at2a&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;a2at&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;t2at&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;at2at&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;/code&gt;

  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;mteb.abstasks.task_metadata.TaskCategory&lt;/code&gt;)" href="#mteb.abstasks.task_metadata.TaskCategory">TaskCategory</a>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of task categories these include "t2t" (text to text), "t2i" (text to image). See TaskMetadata for the full list.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>exclude_superseded</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A boolean flag to exclude datasets which are superseded by another.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>eval_splits</code>
            </td>
            <td>
                  <code><span title="collections.abc.Sequence">Sequence</span>[<span title="str">str</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of evaluation splits to include. If None, all splits are included.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>exclusive_language_filter</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Some datasets contains more than one language e.g. for STS22 the subset "de-en" contain eng and deu. If
exclusive_language_filter is set to False both of these will be kept, but if set to True only those that contains all the languages
specified will be kept.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>modalities</code>
            </td>
            <td>
                  <code><span title="collections.abc.Sequence">Sequence</span>[<a class="autorefs autorefs-internal" title="&lt;code class=&quot;highlight language-python&quot;&gt;&lt;span class=&quot;n&quot;&gt;Modalities&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Literal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;text&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;image&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;audio&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;/code&gt;

  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;mteb.types.Modalities&lt;/code&gt;)" href="../types/#mteb.types._metadata.Modalities">Modalities</a>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of modalities to include. If None, all modalities are included.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>exclusive_modality_filter</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, only keep tasks where <em>all</em> filter modalities are included in the
task's modalities and ALL task modalities are in filter modalities (exact match).
If False, keep tasks if <em>any</em> of the task's modalities match the filter modalities.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>exclude_aggregate</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, exclude aggregate tasks. If False, both aggregate and non-aggregate tasks are returned.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>exclude_private</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True (default), exclude private/closed datasets (is_public=False). If False, include both public and private datasets.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="&lt;code&gt;MTEBTasks&lt;/code&gt; (&lt;code&gt;mteb.get_tasks.MTEBTasks&lt;/code&gt;)" href="#mteb.get_tasks.MTEBTasks">MTEBTasks</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of all initialized tasks objects which pass all of the filters (AND operation).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">get_tasks</span><span class="p">(</span><span class="n">languages</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;eng&quot;</span><span class="p">,</span> <span class="s2">&quot;deu&quot;</span><span class="p">],</span> <span class="n">script</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Latn&quot;</span><span class="p">],</span> <span class="n">domains</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Legal&quot;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">get_tasks</span><span class="p">(</span><span class="n">languages</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;eng&quot;</span><span class="p">],</span> <span class="n">script</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Latn&quot;</span><span class="p">],</span> <span class="n">task_types</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Classification&quot;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">get_tasks</span><span class="p">(</span><span class="n">languages</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;eng&quot;</span><span class="p">],</span> <span class="n">script</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Latn&quot;</span><span class="p">],</span> <span class="n">task_types</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Clustering&quot;</span><span class="p">],</span> <span class="n">exclude_superseded</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">get_tasks</span><span class="p">(</span><span class="n">languages</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;eng&quot;</span><span class="p">],</span> <span class="n">tasks</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;WikipediaRetrievalMultilingual&quot;</span><span class="p">],</span> <span class="n">eval_splits</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;test&quot;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">get_tasks</span><span class="p">(</span><span class="n">tasks</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;STS22&quot;</span><span class="p">],</span> <span class="n">languages</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;eng&quot;</span><span class="p">],</span> <span class="n">exclusive_language_filter</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># don&#39;t include multilingual subsets containing English</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>mteb/get_tasks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_tasks</span><span class="p">(</span>
    <span class="n">tasks</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">languages</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">script</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">domains</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">TaskDomain</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">task_types</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">TaskType</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">categories</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">TaskCategory</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">exclude_superseded</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">eval_splits</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">exclusive_language_filter</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">modalities</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Modalities</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">exclusive_modality_filter</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">exclude_aggregate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">exclude_private</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MTEBTasks</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get a list of tasks based on the specified filters.</span>

<span class="sd">    Args:</span>
<span class="sd">        tasks: A list of task names to include. If None, all tasks which pass the filters are included. If passed, other filters are ignored.</span>
<span class="sd">        languages: A list of languages either specified as 3 letter languages codes (ISO 639-3, e.g. &quot;eng&quot;) or as script languages codes e.g.</span>
<span class="sd">            &quot;eng-Latn&quot;. For multilingual tasks this will also remove languages that are not in the specified list.</span>
<span class="sd">        script: A list of script codes (ISO 15924 codes, e.g. &quot;Latn&quot;). If None, all scripts are included. For multilingual tasks this will also remove scripts</span>
<span class="sd">            that are not in the specified list.</span>
<span class="sd">        domains: A list of task domains, e.g. &quot;Legal&quot;, &quot;Medical&quot;, &quot;Fiction&quot;.</span>
<span class="sd">        task_types: A string specifying the type of task e.g. &quot;Classification&quot; or &quot;Retrieval&quot;. If None, all tasks are included.</span>
<span class="sd">        categories: A list of task categories these include &quot;t2t&quot; (text to text), &quot;t2i&quot; (text to image). See TaskMetadata for the full list.</span>
<span class="sd">        exclude_superseded: A boolean flag to exclude datasets which are superseded by another.</span>
<span class="sd">        eval_splits: A list of evaluation splits to include. If None, all splits are included.</span>
<span class="sd">        exclusive_language_filter: Some datasets contains more than one language e.g. for STS22 the subset &quot;de-en&quot; contain eng and deu. If</span>
<span class="sd">            exclusive_language_filter is set to False both of these will be kept, but if set to True only those that contains all the languages</span>
<span class="sd">            specified will be kept.</span>
<span class="sd">        modalities: A list of modalities to include. If None, all modalities are included.</span>
<span class="sd">        exclusive_modality_filter: If True, only keep tasks where _all_ filter modalities are included in the</span>
<span class="sd">            task&#39;s modalities and ALL task modalities are in filter modalities (exact match).</span>
<span class="sd">            If False, keep tasks if _any_ of the task&#39;s modalities match the filter modalities.</span>
<span class="sd">        exclude_aggregate: If True, exclude aggregate tasks. If False, both aggregate and non-aggregate tasks are returned.</span>
<span class="sd">        exclude_private: If True (default), exclude private/closed datasets (is_public=False). If False, include both public and private datasets.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A list of all initialized tasks objects which pass all of the filters (AND operation).</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; get_tasks(languages=[&quot;eng&quot;, &quot;deu&quot;], script=[&quot;Latn&quot;], domains=[&quot;Legal&quot;])</span>
<span class="sd">        &gt;&gt;&gt; get_tasks(languages=[&quot;eng&quot;], script=[&quot;Latn&quot;], task_types=[&quot;Classification&quot;])</span>
<span class="sd">        &gt;&gt;&gt; get_tasks(languages=[&quot;eng&quot;], script=[&quot;Latn&quot;], task_types=[&quot;Clustering&quot;], exclude_superseded=False)</span>
<span class="sd">        &gt;&gt;&gt; get_tasks(languages=[&quot;eng&quot;], tasks=[&quot;WikipediaRetrievalMultilingual&quot;], eval_splits=[&quot;test&quot;])</span>
<span class="sd">        &gt;&gt;&gt; get_tasks(tasks=[&quot;STS22&quot;], languages=[&quot;eng&quot;], exclusive_language_filter=True) # don&#39;t include multilingual subsets containing English</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">tasks</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">domains</span> <span class="ow">or</span> <span class="n">task_types</span> <span class="ow">or</span> <span class="n">categories</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;When `tasks` is provided, other filters like domains, task_types, and categories are ignored. &quot;</span>
                <span class="o">+</span> <span class="s2">&quot;If you want to filter a list of tasks, please use `mteb.filter_tasks` instead.&quot;</span>
            <span class="p">)</span>
        <span class="n">_tasks</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">get_task</span><span class="p">(</span>
                <span class="n">task</span><span class="p">,</span>
                <span class="n">languages</span><span class="p">,</span>
                <span class="n">script</span><span class="p">,</span>
                <span class="n">eval_splits</span><span class="o">=</span><span class="n">eval_splits</span><span class="p">,</span>
                <span class="n">exclusive_language_filter</span><span class="o">=</span><span class="n">exclusive_language_filter</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">tasks</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="n">MTEBTasks</span><span class="p">(</span><span class="n">_tasks</span><span class="p">)</span>

    <span class="n">tasks_</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">type</span><span class="p">[</span><span class="n">AbsTask</span><span class="p">]]</span> <span class="o">=</span> <span class="n">filter_tasks</span><span class="p">(</span>
        <span class="n">TASK_LIST</span><span class="p">,</span>
        <span class="n">languages</span><span class="o">=</span><span class="n">languages</span><span class="p">,</span>
        <span class="n">script</span><span class="o">=</span><span class="n">script</span><span class="p">,</span>
        <span class="n">domains</span><span class="o">=</span><span class="n">domains</span><span class="p">,</span>
        <span class="n">task_types</span><span class="o">=</span><span class="n">task_types</span><span class="p">,</span>
        <span class="n">categories</span><span class="o">=</span><span class="n">categories</span><span class="p">,</span>
        <span class="n">modalities</span><span class="o">=</span><span class="n">modalities</span><span class="p">,</span>
        <span class="n">exclusive_modality_filter</span><span class="o">=</span><span class="n">exclusive_modality_filter</span><span class="p">,</span>
        <span class="n">exclude_superseded</span><span class="o">=</span><span class="n">exclude_superseded</span><span class="p">,</span>
        <span class="n">exclude_aggregate</span><span class="o">=</span><span class="n">exclude_aggregate</span><span class="p">,</span>
        <span class="n">exclude_private</span><span class="o">=</span><span class="n">exclude_private</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">MTEBTasks</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="bp">cls</span><span class="p">()</span><span class="o">.</span><span class="n">filter_languages</span><span class="p">(</span><span class="n">languages</span><span class="p">,</span> <span class="n">script</span><span class="p">)</span><span class="o">.</span><span class="n">filter_eval_splits</span><span class="p">(</span><span class="n">eval_splits</span><span class="p">)</span>
            <span class="k">for</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="n">tasks_</span>
        <span class="p">]</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="mteb.get_task" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">mteb</span><span class="o">.</span><span class="n">get_task</span><span class="p">(</span><span class="n">task_name</span><span class="p">,</span> <span class="n">languages</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">script</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">eval_splits</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hf_subsets</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exclusive_language_filter</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#mteb.get_task" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents first">

        <p>Get a task by name.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>task_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the task to fetch.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>languages</code>
            </td>
            <td>
                  <code><span title="collections.abc.Sequence">Sequence</span>[<span title="str">str</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of languages either specified as 3 letter languages codes (ISO 639-3, e.g. "eng") or as script languages codes e.g.
"eng-Latn". For multilingual tasks this will also remove languages that are not in the specified list.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>script</code>
            </td>
            <td>
                  <code><span title="collections.abc.Sequence">Sequence</span>[<span title="str">str</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of script codes (ISO 15924 codes). If None, all scripts are included. For multilingual tasks this will also remove scripts</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>eval_splits</code>
            </td>
            <td>
                  <code><span title="collections.abc.Sequence">Sequence</span>[<span title="str">str</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of evaluation splits to include. If None, all splits are included.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>hf_subsets</code>
            </td>
            <td>
                  <code><span title="collections.abc.Sequence">Sequence</span>[<span title="str">str</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of Huggingface subsets to evaluate on.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>exclusive_language_filter</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Some datasets contains more than one language e.g. for STS22 the subset "de-en" contain eng and deu. If
exclusive_language_filter is set to False both of these will be kept, but if set to True only those that contains all the languages
specified will be kept.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="&lt;code&gt;mteb.AbsTask&lt;/code&gt; (&lt;code&gt;mteb.abstasks.AbsTask&lt;/code&gt;)" href="#mteb.AbsTask">AbsTask</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An initialized task object.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">get_task</span><span class="p">(</span><span class="s2">&quot;BornholmBitextMining&quot;</span><span class="p">)</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>mteb/get_tasks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_task</span><span class="p">(</span>
    <span class="n">task_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">languages</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">script</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">eval_splits</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">hf_subsets</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">exclusive_language_filter</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AbsTask</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get a task by name.</span>

<span class="sd">    Args:</span>
<span class="sd">        task_name: The name of the task to fetch.</span>
<span class="sd">        languages: A list of languages either specified as 3 letter languages codes (ISO 639-3, e.g. &quot;eng&quot;) or as script languages codes e.g.</span>
<span class="sd">            &quot;eng-Latn&quot;. For multilingual tasks this will also remove languages that are not in the specified list.</span>
<span class="sd">        script: A list of script codes (ISO 15924 codes). If None, all scripts are included. For multilingual tasks this will also remove scripts</span>
<span class="sd">        eval_splits: A list of evaluation splits to include. If None, all splits are included.</span>
<span class="sd">        hf_subsets: A list of Huggingface subsets to evaluate on.</span>
<span class="sd">        exclusive_language_filter: Some datasets contains more than one language e.g. for STS22 the subset &quot;de-en&quot; contain eng and deu. If</span>
<span class="sd">            exclusive_language_filter is set to False both of these will be kept, but if set to True only those that contains all the languages</span>
<span class="sd">            specified will be kept.</span>

<span class="sd">    Returns:</span>
<span class="sd">        An initialized task object.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; get_task(&quot;BornholmBitextMining&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">task_name</span> <span class="ow">in</span> <span class="n">_TASK_RENAMES</span><span class="p">:</span>
        <span class="n">_task_name</span> <span class="o">=</span> <span class="n">_TASK_RENAMES</span><span class="p">[</span><span class="n">task_name</span><span class="p">]</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;The task with the given name &#39;</span><span class="si">{</span><span class="n">task_name</span><span class="si">}</span><span class="s2">&#39; has been renamed to &#39;</span><span class="si">{</span><span class="n">_task_name</span><span class="si">}</span><span class="s2">&#39;. To prevent this warning use the new name.&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">task_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_TASKS_REGISTRY</span><span class="p">:</span>
        <span class="n">close_matches</span> <span class="o">=</span> <span class="n">difflib</span><span class="o">.</span><span class="n">get_close_matches</span><span class="p">(</span><span class="n">task_name</span><span class="p">,</span> <span class="n">_TASKS_REGISTRY</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">close_matches</span><span class="p">:</span>
            <span class="n">suggestion</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;KeyError: &#39;</span><span class="si">{</span><span class="n">task_name</span><span class="si">}</span><span class="s2">&#39; not found. Did you mean: &#39;</span><span class="si">{</span><span class="n">close_matches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;?&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">suggestion</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;KeyError: &#39;</span><span class="si">{</span><span class="n">task_name</span><span class="si">}</span><span class="s2">&#39; not found and no similar keys were found.&quot;</span>
            <span class="p">)</span>
        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">suggestion</span><span class="p">)</span>
    <span class="n">task</span> <span class="o">=</span> <span class="n">_TASKS_REGISTRY</span><span class="p">[</span><span class="n">task_name</span><span class="p">]()</span>
    <span class="k">if</span> <span class="n">eval_splits</span><span class="p">:</span>
        <span class="n">task</span><span class="o">.</span><span class="n">filter_eval_splits</span><span class="p">(</span><span class="n">eval_splits</span><span class="o">=</span><span class="n">eval_splits</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">task</span><span class="o">.</span><span class="n">filter_languages</span><span class="p">(</span>
        <span class="n">languages</span><span class="p">,</span>
        <span class="n">script</span><span class="p">,</span>
        <span class="n">hf_subsets</span><span class="o">=</span><span class="n">hf_subsets</span><span class="p">,</span>
        <span class="n">exclusive_language_filter</span><span class="o">=</span><span class="n">exclusive_language_filter</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="mteb.filter_tasks" class="doc doc-heading">
            <code>mteb.filter_tasks</code>


<a href="#mteb.filter_tasks" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents first">

        <p>This script contains functions that are used to get an overview of the MTEB benchmark.</p>










<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="mteb.filter_tasks.filter_tasks" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">filter_tasks</span><span class="p">(</span><span class="n">tasks</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">languages</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">script</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">domains</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">task_types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">categories</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">modalities</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exclusive_modality_filter</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">exclude_superseded</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">exclude_aggregate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">exclude_private</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#mteb.filter_tasks.filter_tasks" class="headerlink" title="Permanent link">&para;</a></h4>
          <div class="doc-overloads">
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">filter_tasks</span><span class="p">(</span>
    <span class="n">tasks</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">AbsTask</span><span class="p">],</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">languages</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">script</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">domains</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">TaskDomain</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">task_types</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">TaskType</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">categories</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">TaskCategory</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">modalities</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Modalities</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">exclusive_modality_filter</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">exclude_superseded</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">exclude_aggregate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">exclude_private</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">AbsTask</span><span class="p">]</span>
</code></pre></div><div class="doc-signature highlight"><pre><span></span><code><span class="nf">filter_tasks</span><span class="p">(</span>
    <span class="n">tasks</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">type</span><span class="p">[</span><span class="n">AbsTask</span><span class="p">]],</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">languages</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">script</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">domains</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">TaskDomain</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">task_types</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">TaskType</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">categories</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">TaskCategory</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">modalities</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Modalities</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">exclusive_modality_filter</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">exclude_superseded</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">exclude_aggregate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">exclude_private</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">type</span><span class="p">[</span><span class="n">AbsTask</span><span class="p">]]</span>
</code></pre></div>          </div>


    <div class="doc doc-contents ">

        <p>Filter tasks based on the specified criteria.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>tasks</code>
            </td>
            <td>
                  <code><span title="collections.abc.Iterable">Iterable</span>[<a class="autorefs autorefs-internal" title="&lt;code&gt;mteb.AbsTask&lt;/code&gt; (&lt;code&gt;mteb.abstasks.AbsTask&lt;/code&gt;)" href="#mteb.AbsTask">AbsTask</a>] | <span title="collections.abc.Iterable">Iterable</span>[<span title="type">type</span>[<a class="autorefs autorefs-internal" title="&lt;code&gt;mteb.AbsTask&lt;/code&gt; (&lt;code&gt;mteb.abstasks.AbsTask&lt;/code&gt;)" href="#mteb.AbsTask">AbsTask</a>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of task names to include. If None, all tasks which pass the filters are included. If passed, other filters are ignored.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>languages</code>
            </td>
            <td>
                  <code><span title="collections.abc.Sequence">Sequence</span>[<span title="str">str</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of languages either specified as 3 letter languages codes (ISO 639-3, e.g. "eng") or as script languages codes e.g.
"eng-Latn". For multilingual tasks this will also remove languages that are not in the specified list.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>script</code>
            </td>
            <td>
                  <code><span title="collections.abc.Sequence">Sequence</span>[<span title="str">str</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of script codes (ISO 15924 codes, e.g. "Latn"). If None, all scripts are included. For multilingual tasks this will also remove scripts
that are not in the specified list.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>domains</code>
            </td>
            <td>
                  <code><span title="collections.abc.Iterable">Iterable</span>[<a class="autorefs autorefs-internal" title="&lt;code class=&quot;highlight language-python&quot;&gt;&lt;span class=&quot;n&quot;&gt;mteb&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;abstasks&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;task_metadata&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;TaskDomain&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Literal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;Academic&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Blog&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Constructed&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Encyclopaedic&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Engineering&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Fiction&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Government&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Legal&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Medical&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;News&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Non-fiction&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Poetry&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Religious&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Reviews&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Scene&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Social&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Spoken&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Subtitles&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Web&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Written&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Programming&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Chemistry&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Financial&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Entertainment&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;E-commerce&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;AudioScene&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Speech&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Spoken&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Music&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Bioacoustics&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;/code&gt;

  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;mteb.abstasks.task_metadata.TaskDomain&lt;/code&gt;)" href="#mteb.abstasks.task_metadata.TaskDomain">TaskDomain</a>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of task domains, e.g. "Legal", "Medical", "Fiction".</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>task_types</code>
            </td>
            <td>
                  <code><span title="collections.abc.Iterable">Iterable</span>[<a class="autorefs autorefs-internal" title="&lt;code class=&quot;highlight language-python&quot;&gt;&lt;span class=&quot;n&quot;&gt;mteb&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;abstasks&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;task_metadata&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;TaskType&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Literal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_TASK_TYPE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;/code&gt;

  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;mteb.abstasks.task_metadata.TaskType&lt;/code&gt;)" href="#mteb.abstasks.task_metadata.TaskType">TaskType</a>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A string specifying the type of task e.g. "Classification" or "Retrieval". If None, all tasks are included.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>categories</code>
            </td>
            <td>
                  <code><span title="collections.abc.Iterable">Iterable</span>[<a class="autorefs autorefs-internal" title="&lt;code class=&quot;highlight language-python&quot;&gt;&lt;span class=&quot;n&quot;&gt;mteb&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;abstasks&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;task_metadata&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;TaskCategory&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Literal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;t2t&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;t2c&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;i2i&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;i2c&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;i2t&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;t2i&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;it2t&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;it2i&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;i2it&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;t2it&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;it2it&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;a2a&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;a2c&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;a2t&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;t2a&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;at2t&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;at2a&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;a2at&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;t2at&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;at2at&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;/code&gt;

  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;mteb.abstasks.task_metadata.TaskCategory&lt;/code&gt;)" href="#mteb.abstasks.task_metadata.TaskCategory">TaskCategory</a>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of task categories these include "t2t" (text to text), "t2i" (text to image). See TaskMetadata for the full list.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>exclude_superseded</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A boolean flag to exclude datasets which are superseded by another.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>modalities</code>
            </td>
            <td>
                  <code><span title="collections.abc.Iterable">Iterable</span>[<a class="autorefs autorefs-internal" title="&lt;code class=&quot;highlight language-python&quot;&gt;&lt;span class=&quot;n&quot;&gt;Modalities&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Literal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;text&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;image&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;audio&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;/code&gt;

  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;mteb.types.Modalities&lt;/code&gt;)" href="../types/#mteb.types._metadata.Modalities">Modalities</a>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of modalities to include. If None, all modalities are included.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>exclusive_modality_filter</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, only keep tasks where <em>all</em> filter modalities are included in the
task's modalities and ALL task modalities are in filter modalities (exact match).
If False, keep tasks if <em>any</em> of the task's modalities match the filter modalities.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>exclude_aggregate</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, exclude aggregate tasks. If False, both aggregate and non-aggregate tasks are returned.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>exclude_private</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True (default), exclude private/closed datasets (is_public=False). If False, include both public and private datasets.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<a class="autorefs autorefs-internal" title="&lt;code&gt;mteb.AbsTask&lt;/code&gt; (&lt;code&gt;mteb.abstasks.AbsTask&lt;/code&gt;)" href="#mteb.AbsTask">AbsTask</a>] | <span title="list">list</span>[<span title="type">type</span>[<a class="autorefs autorefs-internal" title="&lt;code&gt;mteb.AbsTask&lt;/code&gt; (&lt;code&gt;mteb.abstasks.AbsTask&lt;/code&gt;)" href="#mteb.AbsTask">AbsTask</a>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of tasks objects which pass all of the filters.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">text_classification_tasks</span> <span class="o">=</span> <span class="n">filter_tasks</span><span class="p">(</span><span class="n">my_tasks</span><span class="p">,</span> <span class="n">task_types</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Classification&quot;</span><span class="p">],</span> <span class="n">modalities</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">medical_tasks</span> <span class="o">=</span> <span class="n">filter_tasks</span><span class="p">(</span><span class="n">my_tasks</span><span class="p">,</span> <span class="n">domains</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Medical&quot;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">english_tasks</span> <span class="o">=</span> <span class="n">filter_tasks</span><span class="p">(</span><span class="n">my_tasks</span><span class="p">,</span> <span class="n">languages</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;eng&quot;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">latin_script_tasks</span> <span class="o">=</span> <span class="n">filter_tasks</span><span class="p">(</span><span class="n">my_tasks</span><span class="p">,</span> <span class="n">script</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Latn&quot;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">text_image_tasks</span> <span class="o">=</span> <span class="n">filter_tasks</span><span class="p">(</span><span class="n">my_tasks</span><span class="p">,</span> <span class="n">modalities</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;image&quot;</span><span class="p">],</span> <span class="n">exclusive_modality_filter</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>mteb/filter_tasks.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">filter_tasks</span><span class="p">(</span>
    <span class="n">tasks</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">AbsTask</span><span class="p">]</span> <span class="o">|</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">type</span><span class="p">[</span><span class="n">AbsTask</span><span class="p">]],</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">languages</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">script</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">domains</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">TaskDomain</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">task_types</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">TaskType</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">categories</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">TaskCategory</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">modalities</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Modalities</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">exclusive_modality_filter</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">exclude_superseded</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">exclude_aggregate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">exclude_private</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">AbsTask</span><span class="p">]</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">type</span><span class="p">[</span><span class="n">AbsTask</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Filter tasks based on the specified criteria.</span>

<span class="sd">    Args:</span>
<span class="sd">        tasks: A list of task names to include. If None, all tasks which pass the filters are included. If passed, other filters are ignored.</span>
<span class="sd">        languages: A list of languages either specified as 3 letter languages codes (ISO 639-3, e.g. &quot;eng&quot;) or as script languages codes e.g.</span>
<span class="sd">            &quot;eng-Latn&quot;. For multilingual tasks this will also remove languages that are not in the specified list.</span>
<span class="sd">        script: A list of script codes (ISO 15924 codes, e.g. &quot;Latn&quot;). If None, all scripts are included. For multilingual tasks this will also remove scripts</span>
<span class="sd">            that are not in the specified list.</span>
<span class="sd">        domains: A list of task domains, e.g. &quot;Legal&quot;, &quot;Medical&quot;, &quot;Fiction&quot;.</span>
<span class="sd">        task_types: A string specifying the type of task e.g. &quot;Classification&quot; or &quot;Retrieval&quot;. If None, all tasks are included.</span>
<span class="sd">        categories: A list of task categories these include &quot;t2t&quot; (text to text), &quot;t2i&quot; (text to image). See TaskMetadata for the full list.</span>
<span class="sd">        exclude_superseded: A boolean flag to exclude datasets which are superseded by another.</span>
<span class="sd">        modalities: A list of modalities to include. If None, all modalities are included.</span>
<span class="sd">        exclusive_modality_filter: If True, only keep tasks where _all_ filter modalities are included in the</span>
<span class="sd">            task&#39;s modalities and ALL task modalities are in filter modalities (exact match).</span>
<span class="sd">            If False, keep tasks if _any_ of the task&#39;s modalities match the filter modalities.</span>
<span class="sd">        exclude_aggregate: If True, exclude aggregate tasks. If False, both aggregate and non-aggregate tasks are returned.</span>
<span class="sd">        exclude_private: If True (default), exclude private/closed datasets (is_public=False). If False, include both public and private datasets.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A list of tasks objects which pass all of the filters.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; text_classification_tasks = filter_tasks(my_tasks, task_types=[&quot;Classification&quot;], modalities=[&quot;text&quot;])</span>
<span class="sd">        &gt;&gt;&gt; medical_tasks = filter_tasks(my_tasks, domains=[&quot;Medical&quot;])</span>
<span class="sd">        &gt;&gt;&gt; english_tasks = filter_tasks(my_tasks, languages=[&quot;eng&quot;])</span>
<span class="sd">        &gt;&gt;&gt; latin_script_tasks = filter_tasks(my_tasks, script=[&quot;Latn&quot;])</span>
<span class="sd">        &gt;&gt;&gt; text_image_tasks = filter_tasks(my_tasks, modalities=[&quot;text&quot;, &quot;image&quot;], exclusive_modality_filter=True)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">langs_to_keep</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">languages</span><span class="p">:</span>
        <span class="p">[</span><span class="n">_check_is_valid_language</span><span class="p">(</span><span class="n">lang</span><span class="p">)</span> <span class="k">for</span> <span class="n">lang</span> <span class="ow">in</span> <span class="n">languages</span><span class="p">]</span>  <span class="c1"># type: ignore[func-returns-value]</span>
        <span class="n">langs_to_keep</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">languages</span><span class="p">)</span>

    <span class="n">script_to_keep</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">script</span><span class="p">:</span>
        <span class="p">[</span><span class="n">_check_is_valid_script</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">script</span><span class="p">]</span>  <span class="c1"># type: ignore[func-returns-value]</span>
        <span class="n">script_to_keep</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">script</span><span class="p">)</span>

    <span class="n">domains_to_keep</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">domains</span><span class="p">:</span>
        <span class="n">domains_to_keep</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">domains</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_convert_to_set</span><span class="p">(</span><span class="n">domain</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">TaskDomain</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span> <span class="k">if</span> <span class="n">domain</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">set</span><span class="p">()</span>

    <span class="n">task_types_to_keep</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">task_types</span><span class="p">:</span>
        <span class="n">task_types_to_keep</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">task_types</span><span class="p">)</span>

    <span class="n">categories_to_keep</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">categories</span><span class="p">:</span>
        <span class="n">categories_to_keep</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">categories</span><span class="p">)</span>

    <span class="n">modalities_to_keep</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">modalities</span><span class="p">:</span>
        <span class="n">modalities_to_keep</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">modalities</span><span class="p">)</span>

    <span class="n">_tasks</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tasks</span><span class="p">:</span>
        <span class="c1"># For metadata and superseded_by, we can access them directly</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">metadata</span>

        <span class="k">if</span> <span class="n">langs_to_keep</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">langs_to_keep</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">metadata</span><span class="o">.</span><span class="n">languages</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">script_to_keep</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">script_to_keep</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">metadata</span><span class="o">.</span><span class="n">scripts</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">domains_to_keep</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">domains_to_keep</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span>
            <span class="n">_convert_to_set</span><span class="p">(</span><span class="n">metadata</span><span class="o">.</span><span class="n">domains</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">task_types_to_keep</span> <span class="ow">and</span> <span class="n">metadata</span><span class="o">.</span><span class="n">type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">task_types_to_keep</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">categories_to_keep</span> <span class="ow">and</span> <span class="n">metadata</span><span class="o">.</span><span class="n">category</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">categories_to_keep</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">modalities_to_keep</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">exclusive_modality_filter</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">metadata</span><span class="o">.</span><span class="n">modalities</span><span class="p">)</span> <span class="o">!=</span> <span class="n">modalities_to_keep</span><span class="p">:</span>
                    <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">modalities_to_keep</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">metadata</span><span class="o">.</span><span class="n">modalities</span><span class="p">):</span>
                    <span class="k">continue</span>
        <span class="k">if</span> <span class="n">exclude_superseded</span> <span class="ow">and</span> <span class="n">metadata</span><span class="o">.</span><span class="n">superseded_by</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">is_aggregate</span> <span class="o">=</span> <span class="p">(</span>
            <span class="nb">issubclass</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">AbsTaskAggregate</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="nb">type</span><span class="p">)</span>
            <span class="k">else</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">AbsTaskAggregate</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">exclude_aggregate</span> <span class="ow">and</span> <span class="n">is_aggregate</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">exclude_private</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">metadata</span><span class="o">.</span><span class="n">is_public</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="n">_tasks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">_tasks</span>  <span class="c1"># type: ignore[return-value]  # type checker cannot infer the overload return type</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="metadata">Metadata<a class="headerlink" href="#metadata" title="Permanent link">&para;</a></h2>
<p>Each task also contains extensive metadata. We annotate this using the following object, which allows us to use <a href="https://docs.pydantic.dev/latest/">pydantic</a> to validate the metadata.</p>


<div class="doc doc-object doc-class">



<h3 id="mteb.TaskMetadata" class="doc doc-heading">
            <code>mteb.TaskMetadata</code>


<a href="#mteb.TaskMetadata" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>



        <p>Metadata for a task.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="mteb.TaskMetadata.dataset">dataset</span></code></td>
            <td>
                  <code><span title="mteb.abstasks.task_metadata.MetadataDatasetDict">MetadataDatasetDict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>All arguments to pass to <a href="https://huggingface.co/docs/datasets/v2.18.0/en/package_reference/loading_methods#datasets.load_dataset">datasets.load_dataset</a> to load the dataset for the task.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.TaskMetadata.name">name</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the task.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.TaskMetadata.description">description</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A description of the task.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.TaskMetadata.type">type</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;highlight language-python&quot;&gt;&lt;span class=&quot;n&quot;&gt;mteb&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;abstasks&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;task_metadata&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;TaskType&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Literal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_TASK_TYPE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;/code&gt;

  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;mteb.abstasks.task_metadata.TaskType&lt;/code&gt;)" href="#mteb.abstasks.task_metadata.TaskType">TaskType</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The type of the task. This includes "Classification", "Summarization", "STS", "Retrieval", "Reranking", "Clustering",
"PairClassification", "BitextMining". The type should match the abstask type.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.TaskMetadata.category">category</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;highlight language-python&quot;&gt;&lt;span class=&quot;n&quot;&gt;mteb&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;abstasks&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;task_metadata&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;TaskCategory&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Literal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;t2t&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;t2c&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;i2i&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;i2c&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;i2t&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;t2i&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;it2t&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;it2i&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;i2it&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;t2it&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;it2it&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;a2a&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;a2c&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;a2t&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;t2a&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;at2t&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;at2a&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;a2at&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;t2at&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;at2at&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;/code&gt;

  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;mteb.abstasks.task_metadata.TaskCategory&lt;/code&gt;)" href="#mteb.abstasks.task_metadata.TaskCategory">TaskCategory</a> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The category of the task. E.g. includes "t2t" (text to text), "t2i" (text to image).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.TaskMetadata.reference">reference</span></code></td>
            <td>
                  <code><span title="mteb.types.StrURL">StrURL</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A URL to the documentation of the task. E.g. a published paper.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.TaskMetadata.eval_splits">eval_splits</span></code></td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The splits of the dataset used for evaluation.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.TaskMetadata.eval_langs">eval_langs</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;highlight language-python&quot;&gt;&lt;span class=&quot;n&quot;&gt;Languages&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;list&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ISOLanguageScript&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Mapping&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;HFSubset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;list&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ISOLanguageScript&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]]&lt;/span&gt;&lt;/code&gt;

  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;mteb.types.Languages&lt;/code&gt;)" href="../types/#mteb.types._metadata.Languages">Languages</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The languages of the dataset used for evaluation. Languages follows a ETF BCP 47 standard consisting of "{language}-{script}"
tag (e.g. "eng-Latn"). Where language is specified as a list of ISO 639-3 language codes (e.g. "eng") followed by ISO 15924 script codes
(e.g. "Latn"). Can be either a list of languages or a dictionary mapping huggingface subsets to lists of languages (e.g. if a the
huggingface dataset contain different languages).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.TaskMetadata.main_score">main_score</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The main score used for evaluation.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.TaskMetadata.date">date</span></code></td>
            <td>
                  <code><span title="tuple">tuple</span>[<span title="mteb.types.StrDate">StrDate</span>, <span title="mteb.types.StrDate">StrDate</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The date when the data was collected. Specified as a tuple of two dates.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.TaskMetadata.domains">domains</span></code></td>
            <td>
                  <code><span title="list">list</span>[<a class="autorefs autorefs-internal" title="&lt;code class=&quot;highlight language-python&quot;&gt;&lt;span class=&quot;n&quot;&gt;mteb&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;abstasks&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;task_metadata&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;TaskDomain&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Literal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;Academic&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Blog&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Constructed&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Encyclopaedic&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Engineering&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Fiction&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Government&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Legal&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Medical&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;News&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Non-fiction&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Poetry&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Religious&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Reviews&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Scene&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Social&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Spoken&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Subtitles&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Web&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Written&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Programming&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Chemistry&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Financial&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Entertainment&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;E-commerce&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;AudioScene&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Speech&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Spoken&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Music&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Bioacoustics&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;/code&gt;

  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;mteb.abstasks.task_metadata.TaskDomain&lt;/code&gt;)" href="#mteb.abstasks.task_metadata.TaskDomain">TaskDomain</a>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The domains of the data. This includes "Non-fiction", "Social", "Fiction", "News", "Academic", "Blog", "Encyclopaedic",
"Government", "Legal", "Medical", "Poetry", "Religious", "Reviews", "Web", "Spoken", "Written". A dataset can belong to multiple domains.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.TaskMetadata.task_subtypes">task_subtypes</span></code></td>
            <td>
                  <code><span title="list">list</span>[<a class="autorefs autorefs-internal" title="&lt;code class=&quot;highlight language-python&quot;&gt;&lt;span class=&quot;n&quot;&gt;mteb&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;abstasks&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;task_metadata&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;TaskSubtype&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Literal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;Article retrieval&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Patent retrieval&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Conversational retrieval&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Dialect pairing&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Dialog Systems&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Discourse coherence&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Duplicate Image Retrieval&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Language identification&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Linguistic acceptability&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Political classification&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Question answering&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Sentiment/Hate speech&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Thematic clustering&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Scientific Reranking&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Claim verification&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Topic classification&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Code retrieval&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;False Friends&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Cross-Lingual Semantic Discrimination&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Textual Entailment&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Counterfactual Detection&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Emotion classification&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Reasoning as Retrieval&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Rendered Texts Understanding&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Image Text Retrieval&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Object recognition&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Scene recognition&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Caption Pairing&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Emotion recognition&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Textures recognition&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Activity recognition&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Tumor detection&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Duplicate Detection&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Rendered semantic textual similarity&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Intent classification&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Product Reranking&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Query-Product Relevance&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Accent identification&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Environment Sound Classification&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Gunshot Audio Classification&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Keyword Spotting&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Instrument Source Classification&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Music Genre Classification&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Music Instrument Recognition&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Spoken Language Identification&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Stroke Classification of Musical Instrument&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Tonic Classification of Musical Instrument&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Speaker Count Identification&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Species Classification&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Spoken Digit Classification&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Gender Clustering&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Vocal Sound Classification&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Music Clustering&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Accent Clustering&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Sentiment Clustering&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Emotion Clustering&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Sentiment Analysis&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Vehicle Clustering&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Environment Sound Clustering&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Environment Sound Reranking&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Emotion Reranking&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Music Genre Reranking&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Gender Classification&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Age Classification&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Song Lyrics Retrieval&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Natural Sound Retrieval&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Music Caption Retrieval&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Speech Transcription Retrieval&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Emotional Speech Retrieval&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Environment Sound Retrieval&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Speech Retrieval&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Question Answering Retrieval&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Reading Comprehension&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;Intent Classification&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;/code&gt;

  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;mteb.abstasks.task_metadata.TaskSubtype&lt;/code&gt;)" href="#mteb.abstasks.task_metadata.TaskSubtype">TaskSubtype</a>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The subtypes of the task. E.g. includes "Sentiment/Hate speech", "Thematic Clustering". Feel free to update the list as needed.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.TaskMetadata.license">license</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;highlight language-python&quot;&gt;&lt;span class=&quot;n&quot;&gt;Licenses&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Literal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;not specified&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;mit&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;cc-by-2.0&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;cc-by-3.0&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;cc-by-4.0&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;cc-by-sa-3.0&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;cc-by-sa-4.0&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;cc-by-nc-3.0&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;cc-by-nc-4.0&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;cc-by-nc-sa-3.0&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;cc-by-nc-sa-4.0&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;cc-by-nc-nd-4.0&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;cc-by-nd-4.0&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;openrail&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;openrail++&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;odc-by&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;afl-3.0&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;apache-2.0&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;cc-by-nd-2.1-jp&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;cc0-1.0&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;bsd-3-clause&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;gpl-3.0&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;lgpl&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;lgpl-3.0&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;cdla-sharing-1.0&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;mpl-2.0&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;msr-la-nc&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;multiple&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;gemma&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;/code&gt;

  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;mteb.types.Licenses&lt;/code&gt;)" href="../types/#mteb.types._metadata.Licenses">Licenses</a> | <span title="mteb.types.StrURL">StrURL</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The license of the data specified as lowercase, e.g. "cc-by-nc-4.0". If the license is not specified, use "not specified". For custom licenses a URL is used.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.TaskMetadata.annotations_creators">annotations_creators</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;highlight language-python&quot;&gt;&lt;span class=&quot;n&quot;&gt;mteb&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;abstasks&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;task_metadata&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;AnnotatorType&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Literal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;expert-annotated&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;human-annotated&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;derived&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;LM-generated&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;LM-generated and reviewed&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;automatic&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;automatic-and-reviewed&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;algorithmic&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;/code&gt;

  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;mteb.abstasks.task_metadata.AnnotatorType&lt;/code&gt;)" href="#mteb.abstasks.task_metadata.AnnotatorType">AnnotatorType</a> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The type of the annotators. Includes "expert-annotated" (annotated by experts), "human-annotated" (annotated e.g. by
mturkers), "derived" (derived from structure in the data).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.TaskMetadata.dialect">dialect</span></code></td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The dialect of the data, if applicable. Ideally specified as a BCP-47 language tag. Empty list if no dialects are present.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.TaskMetadata.sample_creation">sample_creation</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;highlight language-python&quot;&gt;&lt;span class=&quot;n&quot;&gt;mteb&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;abstasks&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;task_metadata&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SampleCreationMethod&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Literal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;found&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;created&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;created and machine-translated&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;human-translated and localized&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;human-translated&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;machine-translated&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;machine-translated and verified&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;machine-translated and localized&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;LM-generated and verified&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;machine-translated and LM verified&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;rendered&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;multiple&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;/code&gt;

  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;mteb.abstasks.task_metadata.SampleCreationMethod&lt;/code&gt;)" href="#mteb.abstasks.task_metadata.SampleCreationMethod">SampleCreationMethod</a> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The method of text creation. Includes "found", "created", "machine-translated", "machine-translated and verified", and
"machine-translated and localized".</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.TaskMetadata.prompt">prompt</span></code></td>
            <td>
                  <code><span title="str">str</span> | <a class="autorefs autorefs-internal" title="&lt;code class=&quot;highlight language-python&quot;&gt;&lt;span class=&quot;n&quot;&gt;mteb&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;abstasks&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;task_metadata&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;PromptDict&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TypedDict&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;PromptDict&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;prompt_type&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;str&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;prompt_type&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;PromptType&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;total&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;False&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/code&gt;

  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;mteb.abstasks.task_metadata.PromptDict&lt;/code&gt;)" href="#mteb.abstasks.task_metadata.PromptDict">PromptDict</a> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The prompt used for the task. Can be a string or a dictionary containing the query and passage prompts.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.TaskMetadata.bibtex_citation">bibtex_citation</span></code></td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The BibTeX citation for the dataset. Should be an empty string if no citation is available.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.TaskMetadata.adapted_from">adapted_from</span></code></td>
            <td>
                  <code><span title="collections.abc.Sequence">Sequence</span>[<span title="str">str</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Datasets adapted (translated, sampled from, etc.) from other datasets.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.TaskMetadata.is_public">is_public</span></code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the dataset is publicly available. If False (closed/private), a HuggingFace token is required to run the datasets.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.TaskMetadata.superseded_by">superseded_by</span></code></td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Denotes the task that this task is superseded by. Used to issue warning to users of outdated datasets, while maintaining
reproducibility of existing benchmarks.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>mteb/abstasks/task_metadata.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">TaskMetadata</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Metadata for a task.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        dataset: All arguments to pass to [datasets.load_dataset](https://huggingface.co/docs/datasets/v2.18.0/en/package_reference/loading_methods#datasets.load_dataset) to load the dataset for the task.</span>
<span class="sd">        name: The name of the task.</span>
<span class="sd">        description: A description of the task.</span>
<span class="sd">        type: The type of the task. This includes &quot;Classification&quot;, &quot;Summarization&quot;, &quot;STS&quot;, &quot;Retrieval&quot;, &quot;Reranking&quot;, &quot;Clustering&quot;,</span>
<span class="sd">            &quot;PairClassification&quot;, &quot;BitextMining&quot;. The type should match the abstask type.</span>
<span class="sd">        category: The category of the task. E.g. includes &quot;t2t&quot; (text to text), &quot;t2i&quot; (text to image).</span>
<span class="sd">        reference: A URL to the documentation of the task. E.g. a published paper.</span>
<span class="sd">        eval_splits: The splits of the dataset used for evaluation.</span>
<span class="sd">        eval_langs: The languages of the dataset used for evaluation. Languages follows a ETF BCP 47 standard consisting of &quot;{language}-{script}&quot;</span>
<span class="sd">            tag (e.g. &quot;eng-Latn&quot;). Where language is specified as a list of ISO 639-3 language codes (e.g. &quot;eng&quot;) followed by ISO 15924 script codes</span>
<span class="sd">            (e.g. &quot;Latn&quot;). Can be either a list of languages or a dictionary mapping huggingface subsets to lists of languages (e.g. if a the</span>
<span class="sd">            huggingface dataset contain different languages).</span>
<span class="sd">        main_score: The main score used for evaluation.</span>
<span class="sd">        date: The date when the data was collected. Specified as a tuple of two dates.</span>
<span class="sd">        domains: The domains of the data. This includes &quot;Non-fiction&quot;, &quot;Social&quot;, &quot;Fiction&quot;, &quot;News&quot;, &quot;Academic&quot;, &quot;Blog&quot;, &quot;Encyclopaedic&quot;,</span>
<span class="sd">            &quot;Government&quot;, &quot;Legal&quot;, &quot;Medical&quot;, &quot;Poetry&quot;, &quot;Religious&quot;, &quot;Reviews&quot;, &quot;Web&quot;, &quot;Spoken&quot;, &quot;Written&quot;. A dataset can belong to multiple domains.</span>
<span class="sd">        task_subtypes: The subtypes of the task. E.g. includes &quot;Sentiment/Hate speech&quot;, &quot;Thematic Clustering&quot;. Feel free to update the list as needed.</span>
<span class="sd">        license: The license of the data specified as lowercase, e.g. &quot;cc-by-nc-4.0&quot;. If the license is not specified, use &quot;not specified&quot;. For custom licenses a URL is used.</span>
<span class="sd">        annotations_creators: The type of the annotators. Includes &quot;expert-annotated&quot; (annotated by experts), &quot;human-annotated&quot; (annotated e.g. by</span>
<span class="sd">            mturkers), &quot;derived&quot; (derived from structure in the data).</span>
<span class="sd">        dialect: The dialect of the data, if applicable. Ideally specified as a BCP-47 language tag. Empty list if no dialects are present.</span>
<span class="sd">        sample_creation: The method of text creation. Includes &quot;found&quot;, &quot;created&quot;, &quot;machine-translated&quot;, &quot;machine-translated and verified&quot;, and</span>
<span class="sd">            &quot;machine-translated and localized&quot;.</span>
<span class="sd">        prompt: The prompt used for the task. Can be a string or a dictionary containing the query and passage prompts.</span>
<span class="sd">        bibtex_citation: The BibTeX citation for the dataset. Should be an empty string if no citation is available.</span>
<span class="sd">        adapted_from: Datasets adapted (translated, sampled from, etc.) from other datasets.</span>
<span class="sd">        is_public: Whether the dataset is publicly available. If False (closed/private), a HuggingFace token is required to run the datasets.</span>
<span class="sd">        superseded_by: Denotes the task that this task is superseded by. Used to issue warning to users of outdated datasets, while maintaining</span>
<span class="sd">            reproducibility of existing benchmarks.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">model_config</span> <span class="o">=</span> <span class="n">ConfigDict</span><span class="p">(</span><span class="n">extra</span><span class="o">=</span><span class="s2">&quot;forbid&quot;</span><span class="p">)</span>

    <span class="n">dataset</span><span class="p">:</span> <span class="n">MetadataDatasetDict</span>

    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">prompt</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">PromptDict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="nb">type</span><span class="p">:</span> <span class="n">TaskType</span>
    <span class="n">modalities</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Modalities</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span>
    <span class="n">category</span><span class="p">:</span> <span class="n">TaskCategory</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">reference</span><span class="p">:</span> <span class="n">StrURL</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">eval_splits</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;test&quot;</span><span class="p">]</span>
    <span class="n">eval_langs</span><span class="p">:</span> <span class="n">Languages</span>
    <span class="n">main_score</span><span class="p">:</span> <span class="nb">str</span>

    <span class="n">date</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">StrDate</span><span class="p">,</span> <span class="n">StrDate</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">domains</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">TaskDomain</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">task_subtypes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">TaskSubtype</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">license</span><span class="p">:</span> <span class="n">Licenses</span> <span class="o">|</span> <span class="n">StrURL</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">annotations_creators</span><span class="p">:</span> <span class="n">AnnotatorType</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">dialect</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">sample_creation</span><span class="p">:</span> <span class="n">SampleCreationMethod</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">bibtex_citation</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">adapted_from</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">is_public</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">superseded_by</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_eval_langs_are_valid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eval_langs</span><span class="p">)</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;prompt&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_check_prompt_is_valid</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">prompt</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">PromptDict</span> <span class="o">|</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">PromptDict</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">prompt</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">prompt</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">PromptType</span><span class="p">]:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s2">&quot;The prompt dictionary should only contain the keys &#39;query&#39; and &#39;passage&#39;.&quot;</span>
                    <span class="p">)</span>
        <span class="k">return</span> <span class="n">prompt</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_eval_langs_are_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eval_langs</span><span class="p">:</span> <span class="n">Languages</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;This method checks that the eval_langs are specified as a list of languages.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">eval_langs</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">langs</span> <span class="ow">in</span> <span class="n">eval_langs</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">langs</span><span class="p">:</span>
                    <span class="n">check_language_code</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">eval_langs</span><span class="p">:</span>
                <span class="n">check_language_code</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">bcp47_codes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">ISOLanguageScript</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the languages and script codes of the dataset formatting in accordance with the BCP-47 standard.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eval_langs</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span>
                <span class="p">{</span><span class="n">lang</span> <span class="k">for</span> <span class="n">langs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_langs</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">for</span> <span class="n">lang</span> <span class="ow">in</span> <span class="n">langs</span><span class="p">}</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eval_langs</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">languages</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the languages of the dataset as iso639-3 codes.&quot;&quot;&quot;</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">get_lang</span><span class="p">(</span><span class="n">lang</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">lang</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eval_langs</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span>
                <span class="p">{</span><span class="n">get_lang</span><span class="p">(</span><span class="n">lang</span><span class="p">)</span> <span class="k">for</span> <span class="n">langs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_langs</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">for</span> <span class="n">lang</span> <span class="ow">in</span> <span class="n">langs</span><span class="p">}</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">({</span><span class="n">get_lang</span><span class="p">(</span><span class="n">lang</span><span class="p">)</span> <span class="k">for</span> <span class="n">lang</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_langs</span><span class="p">})</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">scripts</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the scripts of the dataset as iso15924 codes.&quot;&quot;&quot;</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">get_script</span><span class="p">(</span><span class="n">lang</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">lang</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eval_langs</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="n">get_script</span><span class="p">(</span><span class="n">lang</span><span class="p">)</span> <span class="k">for</span> <span class="n">langs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_langs</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">for</span> <span class="n">lang</span> <span class="ow">in</span> <span class="n">langs</span>
            <span class="p">}</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">get_script</span><span class="p">(</span><span class="n">lang</span><span class="p">)</span> <span class="k">for</span> <span class="n">lang</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_langs</span><span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">is_filled</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if all the metadata fields are filled.</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if all the metadata fields are filled, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">all</span><span class="p">(</span>
            <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field_name</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">field_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_fields</span>
            <span class="k">if</span> <span class="n">field_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;prompt&quot;</span><span class="p">,</span> <span class="s2">&quot;adapted_from&quot;</span><span class="p">,</span> <span class="s2">&quot;superseded_by&quot;</span><span class="p">]</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">hf_subsets_to_langscripts</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">HFSubset</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">ISOLanguageScript</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a dictionary mapping huggingface subsets to languages.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eval_langs</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_langs</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;list[str]&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_langs</span><span class="p">)}</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">intext_citation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">include_cite</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create an in-text citation for the dataset.&quot;&quot;&quot;</span>
        <span class="n">cite</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bibtex_citation</span><span class="p">:</span>
            <span class="n">cite</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bibtex_citation</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;{&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="n">include_cite</span> <span class="ow">and</span> <span class="n">cite</span><span class="p">:</span>
            <span class="c1"># check for whitespace in the citation</span>
            <span class="k">if</span> <span class="s2">&quot; &quot;</span> <span class="ow">in</span> <span class="n">cite</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Citation contains whitespace. Please ensure that the citation is correctly formatted.&quot;</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">cite</span><span class="se">{{</span><span class="si">{</span><span class="n">cite</span><span class="si">}</span><span class="se">}}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">cite</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">descriptive_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">DescriptiveStatistics</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the descriptive statistics for the dataset.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">descriptive_stat_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">descriptive_stat_path</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">descriptive_stat_path</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the path to the descriptive statistics file.&quot;&quot;&quot;</span>
        <span class="n">descriptive_stat_base_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;descriptive_stats&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="n">MIEB_TASK_TYPE</span><span class="p">:</span>
            <span class="n">descriptive_stat_base_dir</span> <span class="o">=</span> <span class="n">descriptive_stat_base_dir</span> <span class="o">/</span> <span class="s2">&quot;Image&quot;</span>
        <span class="n">task_type_dir</span> <span class="o">=</span> <span class="n">descriptive_stat_base_dir</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">descriptive_stat_base_dir</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">descriptive_stat_base_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">task_type_dir</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">task_type_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">task_type_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">.json&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">n_samples</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the number of samples in the dataset&quot;&quot;&quot;</span>
        <span class="n">stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">descriptive_stats</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">stats</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">n_samples</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">subset</span><span class="p">,</span> <span class="n">subset_value</span> <span class="ow">in</span> <span class="n">stats</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">subset</span> <span class="o">==</span> <span class="s2">&quot;hf_subset_descriptive_stats&quot;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">n_samples</span><span class="p">[</span><span class="n">subset</span><span class="p">]</span> <span class="o">=</span> <span class="n">subset_value</span><span class="p">[</span><span class="s2">&quot;num_samples&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">n_samples</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">hf_subsets</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the huggingface subsets.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hf_subsets_to_langscripts</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_multilingual</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if the task is multilingual.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eval_langs</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_dump_json</span><span class="p">())</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">revision</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the dataset revision.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="s2">&quot;revision&quot;</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_modalities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prompt_type</span><span class="p">:</span> <span class="n">PromptType</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Modalities</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the modalities for the task based category if prompt_type provided.</span>

<span class="sd">        Args:</span>
<span class="sd">            prompt_type: The prompt type to get the modalities for.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A list of modalities for the task.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If the prompt type is not recognized.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">prompt_type</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">category</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">modalities</span>
        <span class="n">query_modalities</span><span class="p">,</span> <span class="n">doc_modalities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;2&quot;</span><span class="p">)</span>
        <span class="n">category_to_modality</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Modalities</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;t&quot;</span><span class="p">:</span> <span class="s2">&quot;text&quot;</span><span class="p">,</span>
            <span class="s2">&quot;i&quot;</span><span class="p">:</span> <span class="s2">&quot;image&quot;</span><span class="p">,</span>
            <span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="s2">&quot;audio&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">prompt_type</span> <span class="o">==</span> <span class="n">PromptType</span><span class="o">.</span><span class="n">query</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span>
                <span class="n">category_to_modality</span><span class="p">[</span><span class="n">query_modality</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">query_modality</span> <span class="ow">in</span> <span class="n">query_modalities</span>
            <span class="p">]</span>
        <span class="k">if</span> <span class="n">prompt_type</span> <span class="o">==</span> <span class="n">PromptType</span><span class="o">.</span><span class="n">document</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span>
                <span class="n">category_to_modality</span><span class="p">[</span><span class="n">doc_modality</span><span class="p">]</span> <span class="k">for</span> <span class="n">doc_modality</span> <span class="ow">in</span> <span class="n">doc_modalities</span>
            <span class="p">]</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown prompt type: </span><span class="si">{</span><span class="n">prompt_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_create_dataset_card_data</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">existing_dataset_card_data</span><span class="p">:</span> <span class="n">CardData</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">DatasetCardData</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a DatasetCardData object from the task metadata.</span>

<span class="sd">        Args:</span>
<span class="sd">            existing_dataset_card_data: The existing DatasetCardData object to update. If None, a new object will be created.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A DatasetCardData object with the metadata for the task with kwargs to card</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">existing_dataset_card_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">existing_dataset_card_data</span> <span class="o">=</span> <span class="n">DatasetCardData</span><span class="p">()</span>

        <span class="n">dataset_type</span> <span class="o">=</span> <span class="p">[</span>
            <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_hf_task_type</span><span class="p">(),</span>
            <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_hf_task_category</span><span class="p">(),</span>
        <span class="p">]</span>
        <span class="n">languages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hf_languages</span><span class="p">()</span>

        <span class="n">multilinguality</span> <span class="o">=</span> <span class="s2">&quot;monolingual&quot;</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">languages</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="s2">&quot;multilingual&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_creation</span> <span class="ow">and</span> <span class="s2">&quot;translated&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_creation</span><span class="p">:</span>
            <span class="n">multilinguality</span> <span class="o">=</span> <span class="s2">&quot;translated&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">adapted_from</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">source_datasets</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">task</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">mteb</span><span class="o">.</span><span class="n">get_tasks</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">adapted_from</span><span class="p">)</span>
            <span class="p">]</span>
            <span class="n">source_datasets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">source_datasets</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span> <span class="k">else</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">]]</span>

        <span class="n">tags</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;mteb&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">modalities</span>

        <span class="n">descriptive_stats</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">descriptive_stats</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">descriptive_stats_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">descriptive_stats</span>
            <span class="k">for</span> <span class="n">split</span><span class="p">,</span> <span class="n">split_stat</span> <span class="ow">in</span> <span class="n">descriptive_stats_</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">split_stat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;hf_subset_descriptive_stats&quot;</span><span class="p">,</span> <span class="p">{}))</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
                    <span class="n">split_stat</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;hf_subset_descriptive_stats&quot;</span><span class="p">,</span> <span class="p">{})</span>
            <span class="n">descriptive_stats</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">descriptive_stats_</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

        <span class="n">dataset_card_data_params</span> <span class="o">=</span> <span class="n">existing_dataset_card_data</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
        <span class="c1"># override the existing values</span>
        <span class="n">dataset_card_data_params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(</span>
                <span class="n">language</span><span class="o">=</span><span class="n">languages</span><span class="p">,</span>
                <span class="n">license</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_hf_license</span><span class="p">(),</span>
                <span class="n">annotations_creators</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">annotations_creators</span><span class="p">]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">annotations_creators</span>
                <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">multilinguality</span><span class="o">=</span><span class="n">multilinguality</span><span class="p">,</span>
                <span class="n">source_datasets</span><span class="o">=</span><span class="n">source_datasets</span><span class="p">,</span>
                <span class="n">task_categories</span><span class="o">=</span><span class="n">dataset_type</span><span class="p">,</span>
                <span class="n">task_ids</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_hf_subtypes</span><span class="p">(),</span>
                <span class="n">tags</span><span class="o">=</span><span class="n">tags</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="n">DatasetCardData</span><span class="p">(</span><span class="o">**</span><span class="n">dataset_card_data_params</span><span class="p">),</span>
            <span class="c1"># parameters for readme generation</span>
            <span class="nb">dict</span><span class="p">(</span>
                <span class="n">citation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bibtex_citation</span><span class="p">,</span>
                <span class="n">dataset_description</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="p">,</span>
                <span class="n">dataset_reference</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">reference</span><span class="p">,</span>
                <span class="n">descriptive_stats</span><span class="o">=</span><span class="n">descriptive_stats</span><span class="p">,</span>
                <span class="n">dataset_task_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="n">category</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">category</span><span class="p">,</span>
                <span class="n">domains</span><span class="o">=</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domains</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">domains</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate_dataset_card</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">existing_dataset_card</span><span class="p">:</span> <span class="n">DatasetCard</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DatasetCard</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generates a dataset card for the task.</span>

<span class="sd">        Args:</span>
<span class="sd">            existing_dataset_card: The existing dataset card to update. If None, a new dataset card will be created.</span>

<span class="sd">        Returns:</span>
<span class="sd">            DatasetCard: The dataset card for the task.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;dataset_card_template.md&quot;</span>
        <span class="n">existing_dataset_card_data</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">existing_dataset_card</span><span class="o">.</span><span class="n">data</span> <span class="k">if</span> <span class="n">existing_dataset_card</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="p">)</span>
        <span class="n">dataset_card_data</span><span class="p">,</span> <span class="n">template_kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_dataset_card_data</span><span class="p">(</span>
            <span class="n">existing_dataset_card_data</span>
        <span class="p">)</span>
        <span class="n">dataset_card</span> <span class="o">=</span> <span class="n">DatasetCard</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span>
            <span class="n">card_data</span><span class="o">=</span><span class="n">dataset_card_data</span><span class="p">,</span>
            <span class="n">template_path</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="p">),</span>
            <span class="o">**</span><span class="n">template_kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">dataset_card</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">push_dataset_card_to_hub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">repo_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Pushes the dataset card to the huggingface hub.</span>

<span class="sd">        Args:</span>
<span class="sd">            repo_name: The name of the repository to push the dataset card to.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dataset_card</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">repo_exists</span><span class="p">(</span>
            <span class="n">repo_name</span><span class="p">,</span> <span class="n">repo_type</span><span class="o">=</span><span class="n">constants</span><span class="o">.</span><span class="n">REPO_TYPE_DATASET</span>
        <span class="p">)</span> <span class="ow">and</span> <span class="n">file_exists</span><span class="p">(</span>
            <span class="n">repo_name</span><span class="p">,</span> <span class="n">constants</span><span class="o">.</span><span class="n">REPOCARD_NAME</span><span class="p">,</span> <span class="n">repo_type</span><span class="o">=</span><span class="n">constants</span><span class="o">.</span><span class="n">REPO_TYPE_DATASET</span>
        <span class="p">):</span>
            <span class="n">dataset_card</span> <span class="o">=</span> <span class="n">DatasetCard</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">repo_name</span><span class="p">)</span>
        <span class="n">dataset_card</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_dataset_card</span><span class="p">(</span><span class="n">dataset_card</span><span class="p">)</span>
        <span class="n">dataset_card</span><span class="o">.</span><span class="n">push_to_hub</span><span class="p">(</span><span class="n">repo_name</span><span class="p">,</span> <span class="n">commit_message</span><span class="o">=</span><span class="s2">&quot;Add dataset card&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_hf_subtypes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="c1"># to get full list of available task_ids execute</span>
        <span class="c1"># https://huggingface.co/api/datasets-tags-by-type?type=task_ids</span>
        <span class="c1"># ref https://huggingface-openapi.hf.space/#tag/datasets/GET/api/datasets-tags-by-type</span>
        <span class="n">mteb_to_hf_subtype</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Article retrieval&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;document-retrieval&quot;</span><span class="p">],</span>
            <span class="s2">&quot;Conversational retrieval&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;conversational&quot;</span><span class="p">,</span> <span class="s2">&quot;utterance-retrieval&quot;</span><span class="p">],</span>
            <span class="s2">&quot;Dialect pairing&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;Dialog Systems&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;dialogue-modeling&quot;</span><span class="p">,</span> <span class="s2">&quot;dialogue-generation&quot;</span><span class="p">],</span>
            <span class="s2">&quot;Discourse coherence&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;Duplicate Image Retrieval&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;Language identification&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;language-identification&quot;</span><span class="p">],</span>
            <span class="s2">&quot;Linguistic acceptability&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;acceptability-classification&quot;</span><span class="p">],</span>
            <span class="s2">&quot;Political classification&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;Question answering&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">&quot;multiple-choice-qa&quot;</span><span class="p">,</span>
                <span class="s2">&quot;question-answering&quot;</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="s2">&quot;Sentiment/Hate speech&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">&quot;sentiment-analysis&quot;</span><span class="p">,</span>
                <span class="s2">&quot;sentiment-scoring&quot;</span><span class="p">,</span>
                <span class="s2">&quot;sentiment-classification&quot;</span><span class="p">,</span>
                <span class="s2">&quot;hate-speech-detection&quot;</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="s2">&quot;Thematic clustering&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;Scientific Reranking&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;text-scoring&quot;</span><span class="p">],</span>
            <span class="s2">&quot;Claim verification&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;fact-checking&quot;</span><span class="p">,</span> <span class="s2">&quot;fact-checking-retrieval&quot;</span><span class="p">],</span>
            <span class="s2">&quot;Topic classification&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;topic-classification&quot;</span><span class="p">],</span>
            <span class="s2">&quot;Code retrieval&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;False Friends&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;Cross-Lingual Semantic Discrimination&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;Textual Entailment&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;natural-language-inference&quot;</span><span class="p">],</span>
            <span class="s2">&quot;Counterfactual Detection&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;Emotion classification&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;sentiment-classification&quot;</span><span class="p">],</span>
            <span class="s2">&quot;Reasoning as Retrieval&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;Rendered Texts Understanding&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;Image Text Retrieval&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;Object recognition&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;Scene recognition&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;Caption Pairing&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;image-captioning&quot;</span><span class="p">],</span>
            <span class="s2">&quot;Emotion recognition&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;sentiment-scoring&quot;</span><span class="p">],</span>
            <span class="s2">&quot;Textures recognition&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;Activity recognition&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;Tumor detection&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;Duplicate Detection&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;Rendered semantic textual similarity&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">&quot;semantic-similarity-scoring&quot;</span><span class="p">,</span>
                <span class="s2">&quot;semantic-similarity-classification&quot;</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="s2">&quot;Intent classification&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">&quot;intent-classification&quot;</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="s2">&quot;Accent identification&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;Environment Sound Classification&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;Gunshot Audio Classification&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;Keyword Spotting&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;Instrument Source Classification&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;Music Genre Classification&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;Music Instrument Recognition&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;Spoken Language Identification&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;Stroke Classification of Musical Instrument&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;Tonic Classification of Musical Instrument&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;Speaker Count Identification&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;Species Classification&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;Spoken Digit Classification&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;Gender Clustering&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;Vocal Sound Classification&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;Music Clustering&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;Accent Clustering&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;Sentiment Clustering&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;Emotion Clustering&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;audio-emotion-recognition&quot;</span><span class="p">],</span>
            <span class="s2">&quot;Sentiment Analysis&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;Vehicle Clustering&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;Environment Sound Clustering&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;Environment Sound Reranking&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;Emotion Reranking&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;audio-emotion-recognition&quot;</span><span class="p">],</span>
            <span class="s2">&quot;Music Genre Reranking&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;Gender Classification&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;Age Classification&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;Song Lyrics Retrieval&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;Natural Sound Retrieval&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;Music Caption Retrieval&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;Speech Transcription Retrieval&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;Emotional Speech Retrieval&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;audio-emotion-recognition&quot;</span><span class="p">],</span>
            <span class="s2">&quot;Environment Sound Retrieval&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;Speech Retrieval&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;Question Answering Retrieval&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;Reading Comprehension&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="p">}</span>
        <span class="n">subtypes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">task_subtypes</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">subtype</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">task_subtypes</span><span class="p">:</span>
                <span class="n">subtypes</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">mteb_to_hf_subtype</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">subtype</span><span class="p">,</span> <span class="p">[]))</span>
        <span class="k">return</span> <span class="n">subtypes</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_hf_task_type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="c1"># to get full list of task_types execute:</span>
        <span class="c1"># https://huggingface.co/api/datasets-tags-by-type?type=task_categories</span>
        <span class="c1"># ref https://huggingface-openapi.hf.space/#tag/datasets/GET/api/datasets-tags-by-type</span>
        <span class="n">mteb_task_type_to_datasets</span> <span class="o">=</span> <span class="p">{</span>
            <span class="c1"># Text</span>
            <span class="s2">&quot;BitextMining&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;translation&quot;</span><span class="p">],</span>
            <span class="s2">&quot;Classification&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;text-classification&quot;</span><span class="p">],</span>
            <span class="s2">&quot;MultilabelClassification&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;text-classification&quot;</span><span class="p">],</span>
            <span class="s2">&quot;Clustering&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;text-classification&quot;</span><span class="p">],</span>
            <span class="s2">&quot;PairClassification&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;text-classification&quot;</span><span class="p">],</span>
            <span class="s2">&quot;Reranking&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;text-ranking&quot;</span><span class="p">],</span>
            <span class="s2">&quot;Retrieval&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;text-retrieval&quot;</span><span class="p">],</span>
            <span class="s2">&quot;STS&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;sentence-similarity&quot;</span><span class="p">],</span>
            <span class="s2">&quot;Summarization&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;summarization&quot;</span><span class="p">],</span>
            <span class="s2">&quot;InstructionRetrieval&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;text-retrieval&quot;</span><span class="p">],</span>
            <span class="s2">&quot;InstructionReranking&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;text-ranking&quot;</span><span class="p">],</span>
            <span class="c1"># Image</span>
            <span class="s2">&quot;Any2AnyMultiChoice&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;visual-question-answering&quot;</span><span class="p">],</span>
            <span class="s2">&quot;Any2AnyMultilingualRetrieval&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;visual-document-retrieval&quot;</span><span class="p">],</span>
            <span class="s2">&quot;VisionCentricQA&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;visual-question-answering&quot;</span><span class="p">],</span>
            <span class="s2">&quot;ImageClustering&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;image-feature-extraction&quot;</span><span class="p">],</span>
            <span class="s2">&quot;ImageClassification&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;image-classification&quot;</span><span class="p">],</span>
            <span class="s2">&quot;ImageMultilabelClassification&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;image-classification&quot;</span><span class="p">],</span>
            <span class="s2">&quot;DocumentUnderstanding&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;visual-document-retrieval&quot;</span><span class="p">],</span>
            <span class="s2">&quot;VisualSTS(eng)&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;other&quot;</span><span class="p">],</span>
            <span class="s2">&quot;VisualSTS(multi)&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;other&quot;</span><span class="p">],</span>
            <span class="s2">&quot;ZeroShotClassification&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;zero-shot-classification&quot;</span><span class="p">],</span>
            <span class="s2">&quot;Compositionality&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;other&quot;</span><span class="p">],</span>
            <span class="c1"># audio</span>
            <span class="s2">&quot;AudioClustering&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;audio-classification&quot;</span><span class="p">],</span>
            <span class="s2">&quot;AudioMultilabelClassification&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;audio-classification&quot;</span><span class="p">],</span>
            <span class="s2">&quot;AudioReranking&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;other&quot;</span><span class="p">],</span>
            <span class="s2">&quot;AudioZeroshotClassification&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;other&quot;</span><span class="p">],</span>
            <span class="s2">&quot;AudioClassification&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;audio-classification&quot;</span><span class="p">],</span>
            <span class="s2">&quot;AudioCrossFoldClassification&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;audio-classification&quot;</span><span class="p">],</span>
            <span class="s2">&quot;AudioPairClassification&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;audio-classification&quot;</span><span class="p">],</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;ZeroShotClassification&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">modalities</span> <span class="o">==</span> <span class="p">[</span><span class="s2">&quot;image&quot;</span><span class="p">]:</span>
                <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;zero-shot-image-classification&quot;</span><span class="p">]</span>
            <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;zero-shot-classification&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;Any2AnyRetrieval&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">modalities</span> <span class="o">==</span> <span class="p">[</span><span class="s2">&quot;image&quot;</span><span class="p">]:</span>
                <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;visual-document-retrieval&quot;</span><span class="p">]</span>
            <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;other&quot;</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">mteb_task_type_to_datasets</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_hf_task_category</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="n">dataset_type</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">category</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;i2i&quot;</span><span class="p">,</span> <span class="s2">&quot;it2i&quot;</span><span class="p">,</span> <span class="s2">&quot;i2it&quot;</span><span class="p">,</span> <span class="s2">&quot;it2it&quot;</span><span class="p">]:</span>
            <span class="n">dataset_type</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;image-to-image&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">category</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;i2t&quot;</span><span class="p">,</span> <span class="s2">&quot;t2i&quot;</span><span class="p">,</span> <span class="s2">&quot;it2t&quot;</span><span class="p">,</span> <span class="s2">&quot;it2i&quot;</span><span class="p">,</span> <span class="s2">&quot;t2it&quot;</span><span class="p">,</span> <span class="s2">&quot;i2it&quot;</span><span class="p">,</span> <span class="s2">&quot;it2it&quot;</span><span class="p">]:</span>
            <span class="n">dataset_type</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;image-to-text&quot;</span><span class="p">,</span> <span class="s2">&quot;text-to-image&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">category</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;it2t&quot;</span><span class="p">,</span> <span class="s2">&quot;it2i&quot;</span><span class="p">,</span> <span class="s2">&quot;t2it&quot;</span><span class="p">,</span> <span class="s2">&quot;i2it&quot;</span><span class="p">,</span> <span class="s2">&quot;it2it&quot;</span><span class="p">]:</span>
            <span class="n">dataset_type</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;image-text-to-text&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">category</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;a2a&quot;</span><span class="p">,</span> <span class="s2">&quot;at2a&quot;</span><span class="p">,</span> <span class="s2">&quot;a2at&quot;</span><span class="p">,</span> <span class="s2">&quot;at2at&quot;</span><span class="p">]:</span>
            <span class="n">dataset_type</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;audio-to-audio&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">category</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;a2t&quot;</span><span class="p">,</span> <span class="s2">&quot;t2a&quot;</span><span class="p">,</span> <span class="s2">&quot;at2t&quot;</span><span class="p">,</span> <span class="s2">&quot;t2at&quot;</span><span class="p">,</span> <span class="s2">&quot;at2at&quot;</span><span class="p">,</span> <span class="s2">&quot;a2at&quot;</span><span class="p">]:</span>
            <span class="n">dataset_type</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;text-to-audio&quot;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">dataset_type</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_hf_languages</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="n">languages</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_multilingual</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eval_langs</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_langs</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">languages</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">languages</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;list[str]&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_langs</span><span class="p">)</span>
        <span class="c1"># value &quot;python&quot; is not valid. It must be an ISO 639-1, 639-2 or 639-3 code (two/three letters),</span>
        <span class="c1"># or a special value like &quot;code&quot;, &quot;multilingual&quot;.</span>
        <span class="n">readme_langs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">lang</span> <span class="ow">in</span> <span class="n">languages</span><span class="p">:</span>
            <span class="n">lang_name</span><span class="p">,</span> <span class="n">family</span> <span class="o">=</span> <span class="n">lang</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">family</span> <span class="o">==</span> <span class="s2">&quot;Code&quot;</span><span class="p">:</span>
                <span class="n">readme_langs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;code&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">readme_langs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lang_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">readme_langs</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_hf_license</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dataset_license</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">license</span>
        <span class="k">if</span> <span class="n">dataset_license</span><span class="p">:</span>
            <span class="n">license_mapping</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;not specified&quot;</span><span class="p">:</span> <span class="s2">&quot;unknown&quot;</span><span class="p">,</span>
                <span class="s2">&quot;msr-la-nc&quot;</span><span class="p">:</span> <span class="s2">&quot;other&quot;</span><span class="p">,</span>
                <span class="s2">&quot;cc-by-nd-2.1-jp&quot;</span><span class="p">:</span> <span class="s2">&quot;other&quot;</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">dataset_license</span> <span class="o">=</span> <span class="n">license_mapping</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="n">dataset_license</span><span class="p">,</span>
                <span class="s2">&quot;other&quot;</span> <span class="k">if</span> <span class="n">dataset_license</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;http&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="n">dataset_license</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">dataset_license</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h4 id="mteb.TaskMetadata.bcp47_codes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bcp47_codes</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#mteb.TaskMetadata.bcp47_codes" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Return the languages and script codes of the dataset formatting in accordance with the BCP-47 standard.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="mteb.TaskMetadata.descriptive_stat_path" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">descriptive_stat_path</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#mteb.TaskMetadata.descriptive_stat_path" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Return the path to the descriptive statistics file.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="mteb.TaskMetadata.descriptive_stats" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">descriptive_stats</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#mteb.TaskMetadata.descriptive_stats" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Return the descriptive statistics for the dataset.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="mteb.TaskMetadata.hf_subsets" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">hf_subsets</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#mteb.TaskMetadata.hf_subsets" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Return the huggingface subsets.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="mteb.TaskMetadata.hf_subsets_to_langscripts" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">hf_subsets_to_langscripts</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#mteb.TaskMetadata.hf_subsets_to_langscripts" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Return a dictionary mapping huggingface subsets to languages.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="mteb.TaskMetadata.intext_citation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">intext_citation</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#mteb.TaskMetadata.intext_citation" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Create an in-text citation for the dataset.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="mteb.TaskMetadata.is_multilingual" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_multilingual</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#mteb.TaskMetadata.is_multilingual" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Check if the task is multilingual.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="mteb.TaskMetadata.languages" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">languages</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#mteb.TaskMetadata.languages" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Return the languages of the dataset as iso639-3 codes.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="mteb.TaskMetadata.n_samples" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">n_samples</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#mteb.TaskMetadata.n_samples" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Returns the number of samples in the dataset</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="mteb.TaskMetadata.revision" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">revision</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#mteb.TaskMetadata.revision" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Return the dataset revision.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="mteb.TaskMetadata.scripts" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">scripts</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#mteb.TaskMetadata.scripts" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Return the scripts of the dataset as iso15924 codes.</p>

    </div>

</div>




<div class="doc doc-object doc-function">


<h4 id="mteb.TaskMetadata.generate_dataset_card" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_dataset_card</span><span class="p">(</span><span class="n">existing_dataset_card</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#mteb.TaskMetadata.generate_dataset_card" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Generates a dataset card for the task.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>existing_dataset_card</code>
            </td>
            <td>
                  <code><span title="huggingface_hub.DatasetCard">DatasetCard</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The existing dataset card to update. If None, a new dataset card will be created.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>DatasetCard</code></td>            <td>
                  <code><span title="huggingface_hub.DatasetCard">DatasetCard</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The dataset card for the task.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>mteb/abstasks/task_metadata.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">generate_dataset_card</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">existing_dataset_card</span><span class="p">:</span> <span class="n">DatasetCard</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DatasetCard</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generates a dataset card for the task.</span>

<span class="sd">    Args:</span>
<span class="sd">        existing_dataset_card: The existing dataset card to update. If None, a new dataset card will be created.</span>

<span class="sd">    Returns:</span>
<span class="sd">        DatasetCard: The dataset card for the task.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;dataset_card_template.md&quot;</span>
    <span class="n">existing_dataset_card_data</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">existing_dataset_card</span><span class="o">.</span><span class="n">data</span> <span class="k">if</span> <span class="n">existing_dataset_card</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="p">)</span>
    <span class="n">dataset_card_data</span><span class="p">,</span> <span class="n">template_kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_dataset_card_data</span><span class="p">(</span>
        <span class="n">existing_dataset_card_data</span>
    <span class="p">)</span>
    <span class="n">dataset_card</span> <span class="o">=</span> <span class="n">DatasetCard</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span>
        <span class="n">card_data</span><span class="o">=</span><span class="n">dataset_card_data</span><span class="p">,</span>
        <span class="n">template_path</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="p">),</span>
        <span class="o">**</span><span class="n">template_kwargs</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">dataset_card</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="mteb.TaskMetadata.get_modalities" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_modalities</span><span class="p">(</span><span class="n">prompt_type</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#mteb.TaskMetadata.get_modalities" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Get the modalities for the task based category if prompt_type provided.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>prompt_type</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="&lt;code&gt;PromptType&lt;/code&gt; (&lt;code&gt;mteb.types.PromptType&lt;/code&gt;)" href="../types/#mteb.types._encoder_io.PromptType">PromptType</a> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The prompt type to get the modalities for.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<a class="autorefs autorefs-internal" title="&lt;code class=&quot;highlight language-python&quot;&gt;&lt;span class=&quot;n&quot;&gt;Modalities&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Literal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;text&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;image&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;audio&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;/code&gt;

  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;mteb.types.Modalities&lt;/code&gt;)" href="../types/#mteb.types._metadata.Modalities">Modalities</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of modalities for the task.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the prompt type is not recognized.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>mteb/abstasks/task_metadata.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_modalities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prompt_type</span><span class="p">:</span> <span class="n">PromptType</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Modalities</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the modalities for the task based category if prompt_type provided.</span>

<span class="sd">    Args:</span>
<span class="sd">        prompt_type: The prompt type to get the modalities for.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A list of modalities for the task.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If the prompt type is not recognized.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">prompt_type</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">category</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">modalities</span>
    <span class="n">query_modalities</span><span class="p">,</span> <span class="n">doc_modalities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;2&quot;</span><span class="p">)</span>
    <span class="n">category_to_modality</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Modalities</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;t&quot;</span><span class="p">:</span> <span class="s2">&quot;text&quot;</span><span class="p">,</span>
        <span class="s2">&quot;i&quot;</span><span class="p">:</span> <span class="s2">&quot;image&quot;</span><span class="p">,</span>
        <span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="s2">&quot;audio&quot;</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="n">prompt_type</span> <span class="o">==</span> <span class="n">PromptType</span><span class="o">.</span><span class="n">query</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">category_to_modality</span><span class="p">[</span><span class="n">query_modality</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">query_modality</span> <span class="ow">in</span> <span class="n">query_modalities</span>
        <span class="p">]</span>
    <span class="k">if</span> <span class="n">prompt_type</span> <span class="o">==</span> <span class="n">PromptType</span><span class="o">.</span><span class="n">document</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">category_to_modality</span><span class="p">[</span><span class="n">doc_modality</span><span class="p">]</span> <span class="k">for</span> <span class="n">doc_modality</span> <span class="ow">in</span> <span class="n">doc_modalities</span>
        <span class="p">]</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown prompt type: </span><span class="si">{</span><span class="n">prompt_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="mteb.TaskMetadata.is_filled" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_filled</span><span class="p">()</span></code>

<a href="#mteb.TaskMetadata.is_filled" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Check if all the metadata fields are filled.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if all the metadata fields are filled, False otherwise.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>mteb/abstasks/task_metadata.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">is_filled</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if all the metadata fields are filled.</span>

<span class="sd">    Returns:</span>
<span class="sd">        True if all the metadata fields are filled, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">all</span><span class="p">(</span>
        <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field_name</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">field_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_fields</span>
        <span class="k">if</span> <span class="n">field_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;prompt&quot;</span><span class="p">,</span> <span class="s2">&quot;adapted_from&quot;</span><span class="p">,</span> <span class="s2">&quot;superseded_by&quot;</span><span class="p">]</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="mteb.TaskMetadata.push_dataset_card_to_hub" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">push_dataset_card_to_hub</span><span class="p">(</span><span class="n">repo_name</span><span class="p">)</span></code>

<a href="#mteb.TaskMetadata.push_dataset_card_to_hub" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Pushes the dataset card to the huggingface hub.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>repo_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the repository to push the dataset card to.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>mteb/abstasks/task_metadata.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">push_dataset_card_to_hub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">repo_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Pushes the dataset card to the huggingface hub.</span>

<span class="sd">    Args:</span>
<span class="sd">        repo_name: The name of the repository to push the dataset card to.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dataset_card</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">repo_exists</span><span class="p">(</span>
        <span class="n">repo_name</span><span class="p">,</span> <span class="n">repo_type</span><span class="o">=</span><span class="n">constants</span><span class="o">.</span><span class="n">REPO_TYPE_DATASET</span>
    <span class="p">)</span> <span class="ow">and</span> <span class="n">file_exists</span><span class="p">(</span>
        <span class="n">repo_name</span><span class="p">,</span> <span class="n">constants</span><span class="o">.</span><span class="n">REPOCARD_NAME</span><span class="p">,</span> <span class="n">repo_type</span><span class="o">=</span><span class="n">constants</span><span class="o">.</span><span class="n">REPO_TYPE_DATASET</span>
    <span class="p">):</span>
        <span class="n">dataset_card</span> <span class="o">=</span> <span class="n">DatasetCard</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">repo_name</span><span class="p">)</span>
    <span class="n">dataset_card</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_dataset_card</span><span class="p">(</span><span class="n">dataset_card</span><span class="p">)</span>
    <span class="n">dataset_card</span><span class="o">.</span><span class="n">push_to_hub</span><span class="p">(</span><span class="n">repo_name</span><span class="p">,</span> <span class="n">commit_message</span><span class="o">=</span><span class="s2">&quot;Add dataset card&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="metadata-types">Metadata Types<a class="headerlink" href="#metadata-types" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-attribute">



<h3 id="mteb.abstasks.task_metadata.AnnotatorType" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">mteb</span><span class="o">.</span><span class="n">abstasks</span><span class="o">.</span><span class="n">task_metadata</span><span class="o">.</span><span class="n">AnnotatorType</span> <span class="o">=</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;expert-annotated&#39;</span><span class="p">,</span> <span class="s1">&#39;human-annotated&#39;</span><span class="p">,</span> <span class="s1">&#39;derived&#39;</span><span class="p">,</span> <span class="s1">&#39;LM-generated&#39;</span><span class="p">,</span> <span class="s1">&#39;LM-generated and reviewed&#39;</span><span class="p">,</span> <span class="s1">&#39;automatic&#39;</span><span class="p">,</span> <span class="s1">&#39;automatic-and-reviewed&#39;</span><span class="p">,</span> <span class="s1">&#39;algorithmic&#39;</span><span class="p">]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

<a href="#mteb.abstasks.task_metadata.AnnotatorType" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents first">

        <p>The type of the annotators. Is often important for understanding the quality of a dataset.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="mteb.abstasks.task_metadata.SampleCreationMethod" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">mteb</span><span class="o">.</span><span class="n">abstasks</span><span class="o">.</span><span class="n">task_metadata</span><span class="o">.</span><span class="n">SampleCreationMethod</span> <span class="o">=</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;found&#39;</span><span class="p">,</span> <span class="s1">&#39;created&#39;</span><span class="p">,</span> <span class="s1">&#39;created and machine-translated&#39;</span><span class="p">,</span> <span class="s1">&#39;human-translated and localized&#39;</span><span class="p">,</span> <span class="s1">&#39;human-translated&#39;</span><span class="p">,</span> <span class="s1">&#39;machine-translated&#39;</span><span class="p">,</span> <span class="s1">&#39;machine-translated and verified&#39;</span><span class="p">,</span> <span class="s1">&#39;machine-translated and localized&#39;</span><span class="p">,</span> <span class="s1">&#39;LM-generated and verified&#39;</span><span class="p">,</span> <span class="s1">&#39;machine-translated and LM verified&#39;</span><span class="p">,</span> <span class="s1">&#39;rendered&#39;</span><span class="p">,</span> <span class="s1">&#39;multiple&#39;</span><span class="p">]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

<a href="#mteb.abstasks.task_metadata.SampleCreationMethod" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents first">

        <p>How the text was created. It can be an important factor for understanding the quality of a dataset. E.g. used to filter out machine-translated datasets.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="mteb.abstasks.task_metadata.TaskCategory" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">mteb</span><span class="o">.</span><span class="n">abstasks</span><span class="o">.</span><span class="n">task_metadata</span><span class="o">.</span><span class="n">TaskCategory</span> <span class="o">=</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;t2t&#39;</span><span class="p">,</span> <span class="s1">&#39;t2c&#39;</span><span class="p">,</span> <span class="s1">&#39;i2i&#39;</span><span class="p">,</span> <span class="s1">&#39;i2c&#39;</span><span class="p">,</span> <span class="s1">&#39;i2t&#39;</span><span class="p">,</span> <span class="s1">&#39;t2i&#39;</span><span class="p">,</span> <span class="s1">&#39;it2t&#39;</span><span class="p">,</span> <span class="s1">&#39;it2i&#39;</span><span class="p">,</span> <span class="s1">&#39;i2it&#39;</span><span class="p">,</span> <span class="s1">&#39;t2it&#39;</span><span class="p">,</span> <span class="s1">&#39;it2it&#39;</span><span class="p">,</span> <span class="s1">&#39;a2a&#39;</span><span class="p">,</span> <span class="s1">&#39;a2c&#39;</span><span class="p">,</span> <span class="s1">&#39;a2t&#39;</span><span class="p">,</span> <span class="s1">&#39;t2a&#39;</span><span class="p">,</span> <span class="s1">&#39;at2t&#39;</span><span class="p">,</span> <span class="s1">&#39;at2a&#39;</span><span class="p">,</span> <span class="s1">&#39;a2at&#39;</span><span class="p">,</span> <span class="s1">&#39;t2at&#39;</span><span class="p">,</span> <span class="s1">&#39;at2at&#39;</span><span class="p">]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

<a href="#mteb.abstasks.task_metadata.TaskCategory" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents first">

        <p>The category of the task.</p>
<ol>
<li>t2t: text to text</li>
<li>t2c: text to category</li>
<li>i2i: image to image</li>
<li>i2c: image to category</li>
<li>i2t: image to text</li>
<li>t2i: text to image</li>
<li>it2t: image+text to text</li>
<li>it2i: image+text to image</li>
<li>i2it: image to image+text</li>
<li>t2it: text to image+text</li>
<li>it2it: image+text to image+text</li>
<li>a2a: audio to audio</li>
<li>a2c: audio to category</li>
<li>a2t: audio to text</li>
<li>t2a: text to audio</li>
<li>at2t: audio+text to text</li>
<li>at2a: audio+text to audio</li>
<li>a2at: audio to audio+text</li>
<li>t2at: text to audio+text</li>
<li>at2at: audio+text to audio+text</li>
</ol>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="mteb.abstasks.task_metadata.TaskDomain" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">mteb</span><span class="o">.</span><span class="n">abstasks</span><span class="o">.</span><span class="n">task_metadata</span><span class="o">.</span><span class="n">TaskDomain</span> <span class="o">=</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;Academic&#39;</span><span class="p">,</span> <span class="s1">&#39;Blog&#39;</span><span class="p">,</span> <span class="s1">&#39;Constructed&#39;</span><span class="p">,</span> <span class="s1">&#39;Encyclopaedic&#39;</span><span class="p">,</span> <span class="s1">&#39;Engineering&#39;</span><span class="p">,</span> <span class="s1">&#39;Fiction&#39;</span><span class="p">,</span> <span class="s1">&#39;Government&#39;</span><span class="p">,</span> <span class="s1">&#39;Legal&#39;</span><span class="p">,</span> <span class="s1">&#39;Medical&#39;</span><span class="p">,</span> <span class="s1">&#39;News&#39;</span><span class="p">,</span> <span class="s1">&#39;Non-fiction&#39;</span><span class="p">,</span> <span class="s1">&#39;Poetry&#39;</span><span class="p">,</span> <span class="s1">&#39;Religious&#39;</span><span class="p">,</span> <span class="s1">&#39;Reviews&#39;</span><span class="p">,</span> <span class="s1">&#39;Scene&#39;</span><span class="p">,</span> <span class="s1">&#39;Social&#39;</span><span class="p">,</span> <span class="s1">&#39;Spoken&#39;</span><span class="p">,</span> <span class="s1">&#39;Subtitles&#39;</span><span class="p">,</span> <span class="s1">&#39;Web&#39;</span><span class="p">,</span> <span class="s1">&#39;Written&#39;</span><span class="p">,</span> <span class="s1">&#39;Programming&#39;</span><span class="p">,</span> <span class="s1">&#39;Chemistry&#39;</span><span class="p">,</span> <span class="s1">&#39;Financial&#39;</span><span class="p">,</span> <span class="s1">&#39;Entertainment&#39;</span><span class="p">,</span> <span class="s1">&#39;E-commerce&#39;</span><span class="p">,</span> <span class="s1">&#39;AudioScene&#39;</span><span class="p">,</span> <span class="s1">&#39;Speech&#39;</span><span class="p">,</span> <span class="s1">&#39;Spoken&#39;</span><span class="p">,</span> <span class="s1">&#39;Music&#39;</span><span class="p">,</span> <span class="s1">&#39;Bioacoustics&#39;</span><span class="p">]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

<a href="#mteb.abstasks.task_metadata.TaskDomain" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents first">

        <p>The domains follow the categories used in the <a href="https://universaldependencies.org">Universal Dependencies project</a>, though
 we updated them where deemed appropriate. These do not have to be mutually exclusive.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="mteb.abstasks.task_metadata.TaskType" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">mteb</span><span class="o">.</span><span class="n">abstasks</span><span class="o">.</span><span class="n">task_metadata</span><span class="o">.</span><span class="n">TaskType</span> <span class="o">=</span> <span class="n">Literal</span><span class="p">[</span><span class="n">_TASK_TYPE</span><span class="p">]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

<a href="#mteb.abstasks.task_metadata.TaskType" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents first">

        <p>The type of the task. E.g. includes "Classification", "Retrieval" and "Clustering".</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="mteb.abstasks.task_metadata.TaskSubtype" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">mteb</span><span class="o">.</span><span class="n">abstasks</span><span class="o">.</span><span class="n">task_metadata</span><span class="o">.</span><span class="n">TaskSubtype</span> <span class="o">=</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;Article retrieval&#39;</span><span class="p">,</span> <span class="s1">&#39;Patent retrieval&#39;</span><span class="p">,</span> <span class="s1">&#39;Conversational retrieval&#39;</span><span class="p">,</span> <span class="s1">&#39;Dialect pairing&#39;</span><span class="p">,</span> <span class="s1">&#39;Dialog Systems&#39;</span><span class="p">,</span> <span class="s1">&#39;Discourse coherence&#39;</span><span class="p">,</span> <span class="s1">&#39;Duplicate Image Retrieval&#39;</span><span class="p">,</span> <span class="s1">&#39;Language identification&#39;</span><span class="p">,</span> <span class="s1">&#39;Linguistic acceptability&#39;</span><span class="p">,</span> <span class="s1">&#39;Political classification&#39;</span><span class="p">,</span> <span class="s1">&#39;Question answering&#39;</span><span class="p">,</span> <span class="s1">&#39;Sentiment/Hate speech&#39;</span><span class="p">,</span> <span class="s1">&#39;Thematic clustering&#39;</span><span class="p">,</span> <span class="s1">&#39;Scientific Reranking&#39;</span><span class="p">,</span> <span class="s1">&#39;Claim verification&#39;</span><span class="p">,</span> <span class="s1">&#39;Topic classification&#39;</span><span class="p">,</span> <span class="s1">&#39;Code retrieval&#39;</span><span class="p">,</span> <span class="s1">&#39;False Friends&#39;</span><span class="p">,</span> <span class="s1">&#39;Cross-Lingual Semantic Discrimination&#39;</span><span class="p">,</span> <span class="s1">&#39;Textual Entailment&#39;</span><span class="p">,</span> <span class="s1">&#39;Counterfactual Detection&#39;</span><span class="p">,</span> <span class="s1">&#39;Emotion classification&#39;</span><span class="p">,</span> <span class="s1">&#39;Reasoning as Retrieval&#39;</span><span class="p">,</span> <span class="s1">&#39;Rendered Texts Understanding&#39;</span><span class="p">,</span> <span class="s1">&#39;Image Text Retrieval&#39;</span><span class="p">,</span> <span class="s1">&#39;Object recognition&#39;</span><span class="p">,</span> <span class="s1">&#39;Scene recognition&#39;</span><span class="p">,</span> <span class="s1">&#39;Caption Pairing&#39;</span><span class="p">,</span> <span class="s1">&#39;Emotion recognition&#39;</span><span class="p">,</span> <span class="s1">&#39;Textures recognition&#39;</span><span class="p">,</span> <span class="s1">&#39;Activity recognition&#39;</span><span class="p">,</span> <span class="s1">&#39;Tumor detection&#39;</span><span class="p">,</span> <span class="s1">&#39;Duplicate Detection&#39;</span><span class="p">,</span> <span class="s1">&#39;Rendered semantic textual similarity&#39;</span><span class="p">,</span> <span class="s1">&#39;Intent classification&#39;</span><span class="p">,</span> <span class="s1">&#39;Product Reranking&#39;</span><span class="p">,</span> <span class="s1">&#39;Query-Product Relevance&#39;</span><span class="p">,</span> <span class="s1">&#39;Accent identification&#39;</span><span class="p">,</span> <span class="s1">&#39;Environment Sound Classification&#39;</span><span class="p">,</span> <span class="s1">&#39;Gunshot Audio Classification&#39;</span><span class="p">,</span> <span class="s1">&#39;Keyword Spotting&#39;</span><span class="p">,</span> <span class="s1">&#39;Instrument Source Classification&#39;</span><span class="p">,</span> <span class="s1">&#39;Music Genre Classification&#39;</span><span class="p">,</span> <span class="s1">&#39;Music Instrument Recognition&#39;</span><span class="p">,</span> <span class="s1">&#39;Spoken Language Identification&#39;</span><span class="p">,</span> <span class="s1">&#39;Stroke Classification of Musical Instrument&#39;</span><span class="p">,</span> <span class="s1">&#39;Tonic Classification of Musical Instrument&#39;</span><span class="p">,</span> <span class="s1">&#39;Speaker Count Identification&#39;</span><span class="p">,</span> <span class="s1">&#39;Species Classification&#39;</span><span class="p">,</span> <span class="s1">&#39;Spoken Digit Classification&#39;</span><span class="p">,</span> <span class="s1">&#39;Gender Clustering&#39;</span><span class="p">,</span> <span class="s1">&#39;Vocal Sound Classification&#39;</span><span class="p">,</span> <span class="s1">&#39;Music Clustering&#39;</span><span class="p">,</span> <span class="s1">&#39;Accent Clustering&#39;</span><span class="p">,</span> <span class="s1">&#39;Sentiment Clustering&#39;</span><span class="p">,</span> <span class="s1">&#39;Emotion Clustering&#39;</span><span class="p">,</span> <span class="s1">&#39;Sentiment Analysis&#39;</span><span class="p">,</span> <span class="s1">&#39;Vehicle Clustering&#39;</span><span class="p">,</span> <span class="s1">&#39;Environment Sound Clustering&#39;</span><span class="p">,</span> <span class="s1">&#39;Environment Sound Reranking&#39;</span><span class="p">,</span> <span class="s1">&#39;Emotion Reranking&#39;</span><span class="p">,</span> <span class="s1">&#39;Music Genre Reranking&#39;</span><span class="p">,</span> <span class="s1">&#39;Gender Classification&#39;</span><span class="p">,</span> <span class="s1">&#39;Age Classification&#39;</span><span class="p">,</span> <span class="s1">&#39;Song Lyrics Retrieval&#39;</span><span class="p">,</span> <span class="s1">&#39;Natural Sound Retrieval&#39;</span><span class="p">,</span> <span class="s1">&#39;Music Caption Retrieval&#39;</span><span class="p">,</span> <span class="s1">&#39;Speech Transcription Retrieval&#39;</span><span class="p">,</span> <span class="s1">&#39;Emotional Speech Retrieval&#39;</span><span class="p">,</span> <span class="s1">&#39;Environment Sound Retrieval&#39;</span><span class="p">,</span> <span class="s1">&#39;Speech Retrieval&#39;</span><span class="p">,</span> <span class="s1">&#39;Question Answering Retrieval&#39;</span><span class="p">,</span> <span class="s1">&#39;Reading Comprehension&#39;</span><span class="p">,</span> <span class="s1">&#39;Intent Classification&#39;</span><span class="p">]</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

<a href="#mteb.abstasks.task_metadata.TaskSubtype" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents first">

        <p>The subtypes of the task. E.g. includes "Sentiment/Hate speech", "Thematic Clustering". This list can be updated as needed.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="mteb.abstasks.task_metadata.PromptDict" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">mteb</span><span class="o">.</span><span class="n">abstasks</span><span class="o">.</span><span class="n">task_metadata</span><span class="o">.</span><span class="n">PromptDict</span> <span class="o">=</span> <span class="n">TypedDict</span><span class="p">(</span><span class="s1">&#39;PromptDict&#39;</span><span class="p">,</span> <span class="p">{(</span><span class="n">prompt_type</span><span class="o">.</span><span class="n">value</span><span class="p">):</span> <span class="nb">str</span> <span class="k">for</span> <span class="n">prompt_type</span> <span class="ow">in</span> <span class="n">PromptType</span><span class="p">},</span> <span class="n">total</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

<a href="#mteb.abstasks.task_metadata.PromptDict" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents first">

        <p>A dictionary containing the prompt used for the task.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.task_metadata.PromptDict.query">query</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The prompt used for the queries in the task.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.task_metadata.PromptDict.document">document</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The prompt used for the passages in the task.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div><h2 id="the-task-object">The Task Object<a class="headerlink" href="#the-task-object" title="Permanent link">&para;</a></h2>
<p>All tasks in <code>mteb</code> inherits from the following abstract class.</p>


<div class="doc doc-object doc-class">



<h3 id="mteb.AbsTask" class="doc doc-heading">
            <code>mteb.AbsTask</code>


<a href="#mteb.AbsTask" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><span title="abc.ABC">ABC</span></code></p>



        <p>The abstract class for the tasks. All tasks in <code>mteb</code> inherit from this class.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="mteb.AbsTask.metadata">metadata</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="&lt;code&gt;mteb.TaskMetadata&lt;/code&gt; (&lt;code&gt;mteb.abstasks.task_metadata.TaskMetadata&lt;/code&gt;)" href="#mteb.TaskMetadata">TaskMetadata</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The metadata describing the task</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.AbsTask.dataset">dataset</span></code></td>
            <td>
                  <code><span title="dict">dict</span>[<a class="autorefs autorefs-internal" title="&lt;code class=&quot;highlight language-python&quot;&gt;&lt;span class=&quot;n&quot;&gt;HFSubset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;str&lt;/span&gt;&lt;/code&gt;

  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;mteb.types.HFSubset&lt;/code&gt;)" href="../types/#mteb.types._result.HFSubset">HFSubset</a>, <span title="datasets.DatasetDict">DatasetDict</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The dataset represented as a dictionary on the form {"hf subset": {"split": Dataset}} where "split" is the dataset split (e.g. "test")
and Dataset is a datasets.Dataset object. "hf subset" is the data subset on Huggingface typically used to denote the language e.g.
datasets.load_dataset("data", "en"). If the dataset does not have a subset this is simply "default".</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.AbsTask.seed">seed</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The random seed used for reproducibility.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.AbsTask.hf_subsets">hf_subsets</span></code></td>
            <td>
                  <code><span title="list">list</span>[<a class="autorefs autorefs-internal" title="&lt;code class=&quot;highlight language-python&quot;&gt;&lt;span class=&quot;n&quot;&gt;HFSubset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;str&lt;/span&gt;&lt;/code&gt;

  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;mteb.types.HFSubset&lt;/code&gt;)" href="../types/#mteb.types._result.HFSubset">HFSubset</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The list of Huggingface subsets to use.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.AbsTask.data_loaded">data_loaded</span></code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Denotes if the dataset is loaded or not. This is used to avoid loading the dataset multiple times.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.AbsTask.abstask_prompt">abstask_prompt</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Prompt to use for the task for instruction model if not prompt is provided in TaskMetadata.prompt.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.AbsTask.fast_loading">fast_loading</span></code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><strong>Deprecated</strong>. Denotes if the task should be loaded using the fast loading method.
This is only possible if the dataset have a "default" config. We don't recommend to use this method, and suggest to use different subsets for loading datasets.
This was used only for historical reasons and will be removed in the future.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>mteb/abstasks/abstask.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">AbsTask</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The abstract class for the tasks. All tasks in `mteb` inherit from this class.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        metadata: The metadata describing the task</span>
<span class="sd">        dataset: The dataset represented as a dictionary on the form {&quot;hf subset&quot;: {&quot;split&quot;: Dataset}} where &quot;split&quot; is the dataset split (e.g. &quot;test&quot;)</span>
<span class="sd">            and Dataset is a datasets.Dataset object. &quot;hf subset&quot; is the data subset on Huggingface typically used to denote the language e.g.</span>
<span class="sd">            datasets.load_dataset(&quot;data&quot;, &quot;en&quot;). If the dataset does not have a subset this is simply &quot;default&quot;.</span>
<span class="sd">        seed: The random seed used for reproducibility.</span>
<span class="sd">        hf_subsets: The list of Huggingface subsets to use.</span>
<span class="sd">        data_loaded: Denotes if the dataset is loaded or not. This is used to avoid loading the dataset multiple times.</span>
<span class="sd">        abstask_prompt: Prompt to use for the task for instruction model if not prompt is provided in TaskMetadata.prompt.</span>
<span class="sd">        fast_loading: **Deprecated**. Denotes if the task should be loaded using the fast loading method.</span>
<span class="sd">            This is only possible if the dataset have a &quot;default&quot; config. We don&#39;t recommend to use this method, and suggest to use different subsets for loading datasets.</span>
<span class="sd">            This was used only for historical reasons and will be removed in the future.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">metadata</span><span class="p">:</span> <span class="n">TaskMetadata</span>
    <span class="n">abstask_prompt</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">_eval_splits</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">dataset</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">HFSubset</span><span class="p">,</span> <span class="n">DatasetDict</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">data_loaded</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">hf_subsets</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">HFSubset</span><span class="p">]</span>
    <span class="n">fast_loading</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="n">_support_cross_encoder</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">_support_search</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">42</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The init function. This is called primarily to set the seed.</span>

<span class="sd">        Args:</span>
<span class="sd">            seed: An integer seed.</span>
<span class="sd">            kwargs: arguments passed to subclasses.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="o">=</span> <span class="n">seed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rng_state</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">np_rng</span> <span class="o">=</span> <span class="n">_set_seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hf_subsets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">hf_subsets</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">check_if_dataset_is_superseded</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if the dataset is superseded by a newer version.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">superseded_by</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Dataset &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; is superseded by &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">superseded_by</span><span class="si">}</span><span class="s2">&#39;. We recommend using the newer version of the dataset unless you are running a specific benchmark. See `get_task(&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">superseded_by</span><span class="si">}</span><span class="s2">&#39;).metadata.description` to get a description of the task and changes.&quot;</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">dataset_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_proc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A transform operations applied to the dataset after loading.</span>

<span class="sd">        This method is useful when the dataset from Huggingface is not in an `mteb` compatible format.</span>
<span class="sd">        Override this method if your dataset requires additional transformation.</span>

<span class="sd">        Args:</span>
<span class="sd">            num_proc: Number of processes to use for the transformation.</span>
<span class="sd">            kwargs: Additional keyword arguments passed to the load_dataset function. Keep for forward compatibility.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">evaluate</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">MTEBModels</span><span class="p">,</span>
        <span class="n">split</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;test&quot;</span><span class="p">,</span>
        <span class="n">subsets_to_run</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">HFSubset</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">encode_kwargs</span><span class="p">:</span> <span class="n">EncodeKwargs</span><span class="p">,</span>
        <span class="n">prediction_folder</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">num_proc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">HFSubset</span><span class="p">,</span> <span class="n">ScoresDict</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Evaluates an MTEB compatible model on the task.</span>

<span class="sd">        Args:</span>
<span class="sd">            model: MTEB compatible model. Implements a encode(sentences) method, that encodes sentences and returns an array of embeddings</span>
<span class="sd">            split: Which split (e.g. *&quot;test&quot;*) to be used.</span>
<span class="sd">            subsets_to_run: List of huggingface subsets (HFSubsets) to evaluate. If None, all subsets are evaluated.</span>
<span class="sd">            encode_kwargs: Additional keyword arguments that are passed to the model&#39;s `encode` method.</span>
<span class="sd">            prediction_folder: Folder to save model predictions</span>
<span class="sd">            num_proc: Number of processes to use for loading the dataset or processing.</span>
<span class="sd">            kwargs: Additional keyword arguments that are passed to the _evaluate_subset method.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A dictionary with the scores for each subset.</span>

<span class="sd">        Raises:</span>
<span class="sd">            TypeError: If the model is a CrossEncoder and the task does not support CrossEncoders.</span>
<span class="sd">            TypeError: If the model is a SearchProtocol and the task does not support Search.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">CrossEncoderProtocol</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_support_cross_encoder</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Model </span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s2"> is a CrossEncoder, but this task </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> does not support CrossEncoders. &quot;</span>
                <span class="s2">&quot;Please use a Encoder model instead.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># encoders might implement search protocols</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">SearchProtocol</span><span class="p">)</span>
            <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">EncoderProtocol</span><span class="p">)</span>
            <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_support_search</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Model </span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s2"> is a SearchProtocol, but this task </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> does not support Search. &quot;</span>
                <span class="s2">&quot;Please use a Encoder model instead.&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_loaded</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_data</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;dict[HFSubset, DatasetDict]&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">)</span>

        <span class="n">scores</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hf_subsets</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">hf_subsets</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">hf_subsets</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hf_subsets</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">subsets_to_run</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># allow overwrites of pre-filtering</span>
            <span class="n">hf_subsets</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">hf_subsets</span> <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">subsets_to_run</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">hf_subset</span> <span class="ow">in</span> <span class="n">hf_subsets</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Running task </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">split</span><span class="si">=}</span><span class="s2">, </span><span class="si">{</span><span class="n">hf_subset</span><span class="si">=}</span><span class="s2">)...&quot;</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">hf_subset</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span> <span class="ow">and</span> <span class="n">hf_subset</span> <span class="o">==</span> <span class="s2">&quot;default&quot;</span><span class="p">:</span>
                <span class="n">data_split</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">split</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">data_split</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">hf_subset</span><span class="p">][</span><span class="n">split</span><span class="p">]</span>
            <span class="n">scores</span><span class="p">[</span><span class="n">hf_subset</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_subset</span><span class="p">(</span>
                <span class="n">model</span><span class="p">,</span>
                <span class="n">data_split</span><span class="p">,</span>
                <span class="n">hf_split</span><span class="o">=</span><span class="n">split</span><span class="p">,</span>
                <span class="n">hf_subset</span><span class="o">=</span><span class="n">hf_subset</span><span class="p">,</span>
                <span class="n">encode_kwargs</span><span class="o">=</span><span class="n">encode_kwargs</span><span class="p">,</span>
                <span class="n">prediction_folder</span><span class="o">=</span><span class="n">prediction_folder</span><span class="p">,</span>
                <span class="n">num_proc</span><span class="o">=</span><span class="n">num_proc</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_main_score</span><span class="p">(</span><span class="n">scores</span><span class="p">[</span><span class="n">hf_subset</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">scores</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_evaluate_subset</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">MTEBModels</span><span class="p">,</span>
        <span class="n">data_split</span><span class="p">:</span> <span class="n">Dataset</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">hf_split</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">hf_subset</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">encode_kwargs</span><span class="p">:</span> <span class="n">EncodeKwargs</span><span class="p">,</span>
        <span class="n">prediction_folder</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">num_proc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ScoresDict</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="s2">&quot;If you are using the default evaluate method, you must implement _evaluate_subset method.&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_save_task_predictions</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">predictions</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">MTEBModels</span><span class="p">,</span>
        <span class="n">prediction_folder</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
        <span class="n">hf_split</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">hf_subset</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Saves the predictions of the model on the task to a json file.</span>

<span class="sd">        Args:</span>
<span class="sd">            predictions: Dictionary containing the predictions.</span>
<span class="sd">            model: The model used to generate the predictions.</span>
<span class="sd">            prediction_folder: The folder to save the predictions to.</span>
<span class="sd">            hf_split: The split of the dataset (e.g. &quot;test&quot;).</span>
<span class="sd">            hf_subset: The subset of the dataset (e.g. &quot;en&quot;).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">predictions_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_predictions_path</span><span class="p">(</span><span class="n">prediction_folder</span><span class="p">)</span>
        <span class="n">existing_results</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;mteb_model_meta&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;model_name&quot;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">mteb_model_meta</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="s2">&quot;revision&quot;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">mteb_model_meta</span><span class="o">.</span><span class="n">revision</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">predictions_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">with</span> <span class="n">predictions_path</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">predictions_file</span><span class="p">:</span>
                <span class="n">existing_results</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">predictions_file</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">hf_subset</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">existing_results</span><span class="p">:</span>
            <span class="n">existing_results</span><span class="p">[</span><span class="n">hf_subset</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">existing_results</span><span class="p">[</span><span class="n">hf_subset</span><span class="p">][</span><span class="n">hf_split</span><span class="p">]</span> <span class="o">=</span> <span class="n">predictions</span>
        <span class="k">with</span> <span class="n">predictions_path</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">predictions_file</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">existing_results</span><span class="p">,</span> <span class="n">predictions_file</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_predictions_path</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">output_folder</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">output_folder</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_folder</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">output_folder</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">output_folder</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">output_folder</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">prediction_file_name</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">prediction_file_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The name of the prediction file in format {task_name}_predictions.json&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_predictions.json&quot;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">stratified_subsampling</span><span class="p">(</span>
        <span class="n">dataset_dict</span><span class="p">:</span> <span class="n">DatasetDict</span><span class="p">,</span>
        <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">splits</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;test&quot;</span><span class="p">],</span>
        <span class="n">label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;label&quot;</span><span class="p">,</span>
        <span class="n">n_samples</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2048</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DatasetDict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Subsamples the dataset with stratification by the supplied label.</span>

<span class="sd">        Args:</span>
<span class="sd">            dataset_dict: the DatasetDict object.</span>
<span class="sd">            seed: the random seed.</span>
<span class="sd">            splits: the splits of the dataset.</span>
<span class="sd">            label: the label with which the stratified sampling is based on.</span>
<span class="sd">            n_samples: Optional, number of samples to subsample. Default is max_n_samples.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A subsampled DatasetDict object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Can only do this if the label column is of ClassLabel.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataset_dict</span><span class="p">[</span><span class="n">splits</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="n">label</span><span class="p">],</span> <span class="n">ClassLabel</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">dataset_dict</span> <span class="o">=</span> <span class="n">dataset_dict</span><span class="o">.</span><span class="n">class_encode_column</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataset_dict</span><span class="p">[</span><span class="n">splits</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">label</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">Sequence</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">_multilabel_subsampling</span><span class="p">(</span>
                        <span class="n">dataset_dict</span><span class="p">,</span> <span class="n">seed</span><span class="p">,</span> <span class="n">splits</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">n_samples</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">e</span>

        <span class="k">for</span> <span class="n">split</span> <span class="ow">in</span> <span class="n">splits</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">n_samples</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataset_dict</span><span class="p">[</span><span class="n">split</span><span class="p">]):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Subsampling not needed for split </span><span class="si">{</span><span class="n">split</span><span class="si">}</span><span class="s2">, as n_samples is equal or greater than the number of samples.&quot;</span>
                <span class="p">)</span>
                <span class="k">continue</span>
            <span class="n">dataset_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="n">split</span><span class="p">:</span> <span class="n">dataset_dict</span><span class="p">[</span><span class="n">split</span><span class="p">]</span><span class="o">.</span><span class="n">train_test_split</span><span class="p">(</span>
                        <span class="n">test_size</span><span class="o">=</span><span class="n">n_samples</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span> <span class="n">stratify_by_column</span><span class="o">=</span><span class="n">label</span>
                    <span class="p">)[</span><span class="s2">&quot;test&quot;</span><span class="p">]</span>
                <span class="p">}</span>
            <span class="p">)</span>  <span class="c1"># only take the specified test split.</span>
        <span class="k">return</span> <span class="n">dataset_dict</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">load_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_proc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Loads dataset from HuggingFace hub</span>

<span class="sd">        This is the main loading function for Task. Do not overwrite this, instead we recommend using `dataset_transform`, which is called after the</span>
<span class="sd">        dataset is loaded using `datasets.load_dataset`.</span>

<span class="sd">        Args:</span>
<span class="sd">            num_proc: Number of processes to use for loading the dataset.</span>
<span class="sd">            kwargs: Additional keyword arguments passed to the load_dataset function. Keep for forward compatibility.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_loaded</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">is_multilingual</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fast_loading</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fast_load</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">hf_subset</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hf_subsets</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">hf_subset</span><span class="p">]</span> <span class="o">=</span> <span class="n">load_dataset</span><span class="p">(</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">hf_subset</span><span class="p">,</span>
                        <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">dataset</span><span class="p">,</span>
                        <span class="n">num_proc</span><span class="o">=</span><span class="n">num_proc</span><span class="p">,</span>
                    <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># some of monolingual datasets explicitly adding the split name to the dataset name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span> <span class="o">=</span> <span class="n">load_dataset</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">dataset</span><span class="p">,</span> <span class="n">num_proc</span><span class="o">=</span><span class="n">num_proc</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataset_transform</span><span class="p">(</span><span class="n">num_proc</span><span class="o">=</span><span class="n">num_proc</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_loaded</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">fast_load</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;**Deprecated**. Load all subsets at once, then group by language. Using fast loading has two requirements:</span>

<span class="sd">        - Each row in the dataset should have a &#39;lang&#39; feature giving the corresponding language/language pair</span>
<span class="sd">        - The datasets must have a &#39;default&#39; config that loads all the subsets of the dataset (see more [here](https://huggingface.co/docs/datasets/en/repository_structure#configurations))</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">merged_dataset</span> <span class="o">=</span> <span class="n">load_dataset</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">dataset</span><span class="p">)</span>  <span class="c1"># load &quot;default&quot; subset</span>
        <span class="k">for</span> <span class="n">split</span> <span class="ow">in</span> <span class="n">merged_dataset</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">df_split</span> <span class="o">=</span> <span class="n">merged_dataset</span><span class="p">[</span><span class="n">split</span><span class="p">]</span><span class="o">.</span><span class="n">to_polars</span><span class="p">()</span>
            <span class="n">df_grouped</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">df_split</span><span class="o">.</span><span class="n">group_by</span><span class="p">([</span><span class="s2">&quot;lang&quot;</span><span class="p">]))</span>
            <span class="k">for</span> <span class="n">lang</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">df_split</span><span class="p">[</span><span class="s2">&quot;lang&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hf_subsets</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">lang</span><span class="p">,</span> <span class="p">{})</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">lang</span><span class="p">][</span><span class="n">split</span><span class="p">]</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">from_polars</span><span class="p">(</span>
                    <span class="n">df_grouped</span><span class="p">[(</span><span class="n">lang</span><span class="p">,)]</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;lang&quot;</span><span class="p">)</span>
                <span class="p">)</span>  <span class="c1"># Remove lang column and convert back to HF datasets, not strictly necessary but better for compatibility</span>
        <span class="k">for</span> <span class="n">lang</span><span class="p">,</span> <span class="n">subset</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">lang</span><span class="p">]</span> <span class="o">=</span> <span class="n">DatasetDict</span><span class="p">(</span><span class="n">subset</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">calculate_descriptive_statistics</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">overwrite_results</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">num_proc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">DescriptiveStatistics</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates descriptive statistics from the dataset.</span>

<span class="sd">        Args:</span>
<span class="sd">            overwrite_results: Whether to overwrite existing results. If False and results already exist, the existing results will be loaded from cache.</span>
<span class="sd">            num_proc: Number of processes to use for loading the dataset.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A dictionary containing descriptive statistics for each split.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">mteb.abstasks</span><span class="w"> </span><span class="kn">import</span> <span class="n">AbsTaskClassification</span>

        <span class="n">existing_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">descriptive_stats</span>

        <span class="k">if</span> <span class="n">existing_stats</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">overwrite_results</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Loading metadata descriptive statistics from cache.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">existing_stats</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_loaded</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_data</span><span class="p">(</span><span class="n">num_proc</span><span class="o">=</span><span class="n">num_proc</span><span class="p">)</span>

        <span class="n">descriptive_stats</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">DescriptiveStatistics</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">hf_subset_stat</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;hf_subset_descriptive_stats&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;hf_subset_descriptive_stats&quot;</span>
        <span class="p">)</span>
        <span class="n">eval_splits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">eval_splits</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">AbsTaskClassification</span><span class="p">):</span>
            <span class="n">eval_splits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_split</span><span class="p">)</span>

        <span class="n">pbar_split</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">eval_splits</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Processing Splits...&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">split</span> <span class="ow">in</span> <span class="n">pbar_split</span><span class="p">:</span>
            <span class="n">pbar_split</span><span class="o">.</span><span class="n">set_postfix_str</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Split: </span><span class="si">{</span><span class="n">split</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing metadata for split </span><span class="si">{</span><span class="n">split</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">is_multilingual</span><span class="p">:</span>
                <span class="n">descriptive_stats</span><span class="p">[</span><span class="n">split</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_descriptive_statistics_from_split</span><span class="p">(</span>  <span class="c1"># type: ignore[assignment]</span>
                        <span class="n">split</span><span class="p">,</span> <span class="n">compute_overall</span><span class="o">=</span><span class="kc">True</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="n">descriptive_stats</span><span class="p">[</span><span class="n">split</span><span class="p">][</span><span class="n">hf_subset_stat</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

                <span class="n">pbar_subsets</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">hf_subsets</span><span class="p">,</span>
                    <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Processing Languages...&quot;</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">hf_subset</span> <span class="ow">in</span> <span class="n">pbar_subsets</span><span class="p">:</span>
                    <span class="n">pbar_subsets</span><span class="o">.</span><span class="n">set_postfix_str</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Huggingface subset: </span><span class="si">{</span><span class="n">hf_subset</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing metadata for subset </span><span class="si">{</span><span class="n">hf_subset</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">split_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_descriptive_statistics_from_split</span><span class="p">(</span>
                        <span class="n">split</span><span class="p">,</span> <span class="n">hf_subset</span>
                    <span class="p">)</span>
                    <span class="n">descriptive_stats</span><span class="p">[</span><span class="n">split</span><span class="p">][</span><span class="n">hf_subset_stat</span><span class="p">][</span><span class="n">hf_subset</span><span class="p">]</span> <span class="o">=</span> <span class="n">split_details</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">split_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_descriptive_statistics_from_split</span><span class="p">(</span><span class="n">split</span><span class="p">)</span>
                <span class="n">descriptive_stats</span><span class="p">[</span><span class="n">split</span><span class="p">]</span> <span class="o">=</span> <span class="n">split_details</span>  <span class="c1"># type: ignore[assignment]</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">descriptive_stat_path</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">descriptive_stats</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">descriptive_stats</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">calculate_metadata_metrics</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">overwrite_results</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">DescriptiveStatistics</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Old name of `calculate_descriptive_statistics`, kept for backward compatibility.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_descriptive_statistics</span><span class="p">(</span>
            <span class="n">overwrite_results</span><span class="o">=</span><span class="n">overwrite_results</span>
        <span class="p">)</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_calculate_descriptive_statistics_from_split</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">split</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">hf_subset</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">compute_overall</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SplitDescriptiveStatistics</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">languages</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the languages of the task.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hf_subsets</span><span class="p">:</span>
            <span class="n">eval_langs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">hf_subsets_to_langscripts</span>
            <span class="n">languages</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">lang</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hf_subsets</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">langscript</span> <span class="ow">in</span> <span class="n">eval_langs</span><span class="p">[</span><span class="n">lang</span><span class="p">]:</span>
                    <span class="n">iso_lang</span><span class="p">,</span> <span class="n">script</span> <span class="o">=</span> <span class="n">langscript</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
                    <span class="n">languages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iso_lang</span><span class="p">)</span>

            <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">languages</span><span class="p">))</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">languages</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">filter_eval_splits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eval_splits</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Filter the evaluation splits of the task.</span>

<span class="sd">        Args:</span>
<span class="sd">            eval_splits: A list of evaluation splits to keep. If None, all splits are kept.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The filtered task</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_eval_splits</span> <span class="o">=</span> <span class="n">eval_splits</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">filter_languages</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">languages</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">script</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">hf_subsets</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">HFSubset</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">exclusive_language_filter</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Filter the languages of the task.</span>

<span class="sd">        Args:</span>
<span class="sd">            languages: list of languages to filter the task by can be either a 3-letter language code (e.g. &quot;eng&quot;) or also include the script</span>
<span class="sd">                (e.g. &quot;eng-Latn&quot;)</span>
<span class="sd">            script: A list of scripts to filter the task by. Will be ignored if language code specified the script. If None, all scripts are included.</span>
<span class="sd">                If the language code does not specify the script the intersection of the language and script will be used.</span>
<span class="sd">            hf_subsets: A list of huggingface subsets to filter on. This is useful if a dataset have multiple subsets containing the desired language,</span>
<span class="sd">                but you only want to test on one. An example is STS22 which e.g. have both &quot;en&quot; and &quot;de-en&quot; which both contains English.</span>
<span class="sd">            exclusive_language_filter: Some datasets contains more than one language e.g. for STS22 the subset &quot;de-en&quot; contain eng and deu. If</span>
<span class="sd">                exclusive_language_filter is set to False both of these will be kept, but if set to True only those that contains all the languages</span>
<span class="sd">                specified will be kept.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The filtered task</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">lang_scripts</span> <span class="o">=</span> <span class="n">LanguageScripts</span><span class="o">.</span><span class="n">from_languages_and_scripts</span><span class="p">(</span><span class="n">languages</span><span class="p">,</span> <span class="n">script</span><span class="p">)</span>

        <span class="n">subsets_to_keep</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">hf_subset</span><span class="p">,</span> <span class="n">langs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">hf_subsets_to_langscripts</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">hf_subsets</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">hf_subset</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">hf_subsets</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">exclusive_language_filter</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">langscript</span> <span class="ow">in</span> <span class="n">langs</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">lang_scripts</span><span class="o">.</span><span class="n">contains_language</span><span class="p">(</span>
                        <span class="n">langscript</span>
                    <span class="p">)</span> <span class="ow">or</span> <span class="n">lang_scripts</span><span class="o">.</span><span class="n">contains_script</span><span class="p">(</span><span class="n">langscript</span><span class="p">):</span>
                        <span class="n">subsets_to_keep</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hf_subset</span><span class="p">)</span>
                        <span class="k">break</span>

            <span class="k">if</span> <span class="n">exclusive_language_filter</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">languages</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">lang_scripts</span><span class="o">.</span><span class="n">contains_languages</span><span class="p">(</span><span class="n">langs</span><span class="p">):</span>
                    <span class="n">subsets_to_keep</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hf_subset</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">subsets_to_keep</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;No subsets were found for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> with filters: language code </span><span class="si">{</span><span class="n">languages</span><span class="si">}</span><span class="s2">, script </span><span class="si">{</span><span class="n">script</span><span class="si">}</span><span class="s2">, hf subsets </span><span class="si">{</span><span class="n">hf_subsets</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">hf_subsets</span> <span class="o">=</span> <span class="n">subsets_to_keep</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_add_main_score</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scores</span><span class="p">:</span> <span class="n">ScoresDict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">scores</span><span class="p">[</span><span class="s2">&quot;main_score&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scores</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">main_score</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_upload_dataset_to_hub</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">repo_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">fields</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
        <span class="n">num_proc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Dataset not loaded&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">is_multilingual</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">config</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">eval_langs</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Converting </span><span class="si">{</span><span class="n">config</span><span class="si">}</span><span class="s2"> of </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">sentences</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">split</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">config</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fields</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                        <span class="n">sentences</span><span class="p">[</span><span class="n">split</span><span class="p">]</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span>
                            <span class="p">{</span>
                                <span class="n">mapped_name</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">config</span><span class="p">][</span><span class="n">split</span><span class="p">][</span><span class="n">original_name</span><span class="p">]</span>
                                <span class="k">for</span> <span class="n">original_name</span><span class="p">,</span> <span class="n">mapped_name</span> <span class="ow">in</span> <span class="n">fields</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                            <span class="p">}</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">sentences</span><span class="p">[</span><span class="n">split</span><span class="p">]</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span>
                            <span class="p">{</span>
                                <span class="n">field</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">config</span><span class="p">][</span><span class="n">split</span><span class="p">][</span><span class="n">field</span><span class="p">]</span>
                                <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">fields</span>
                            <span class="p">}</span>
                        <span class="p">)</span>
                <span class="n">sentences</span> <span class="o">=</span> <span class="n">DatasetDict</span><span class="p">(</span><span class="n">sentences</span><span class="p">)</span>
                <span class="n">sentences</span><span class="o">.</span><span class="n">push_to_hub</span><span class="p">(</span>
                    <span class="n">repo_name</span><span class="p">,</span>
                    <span class="n">config</span><span class="p">,</span>
                    <span class="n">commit_message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Add </span><span class="si">{</span><span class="n">config</span><span class="si">}</span><span class="s2"> dataset&quot;</span><span class="p">,</span>
                    <span class="n">num_proc</span><span class="o">=</span><span class="n">num_proc</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sentences</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">split</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fields</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                    <span class="n">sentences</span><span class="p">[</span><span class="n">split</span><span class="p">]</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span>
                        <span class="p">{</span>
                            <span class="n">mapped_name</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">split</span><span class="p">][</span><span class="n">original_name</span><span class="p">]</span>
                            <span class="k">for</span> <span class="n">original_name</span><span class="p">,</span> <span class="n">mapped_name</span> <span class="ow">in</span> <span class="n">fields</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                        <span class="p">}</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">sentences</span><span class="p">[</span><span class="n">split</span><span class="p">]</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span>
                        <span class="p">{</span><span class="n">field</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">split</span><span class="p">][</span><span class="n">field</span><span class="p">]</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">}</span>
                    <span class="p">)</span>
            <span class="n">sentences</span> <span class="o">=</span> <span class="n">DatasetDict</span><span class="p">(</span><span class="n">sentences</span><span class="p">)</span>
            <span class="n">sentences</span><span class="o">.</span><span class="n">push_to_hub</span><span class="p">(</span>
                <span class="n">repo_name</span><span class="p">,</span> <span class="n">commit_message</span><span class="o">=</span><span class="s2">&quot;Add dataset&quot;</span><span class="p">,</span> <span class="n">num_proc</span><span class="o">=</span><span class="n">num_proc</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_push_dataset_to_hub</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">repo_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">num_proc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">push_dataset_to_hub</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">repo_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">num_proc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">push_eval</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Push the dataset to the HuggingFace Hub.</span>

<span class="sd">        Args:</span>
<span class="sd">            repo_name: The name of the repository to push the dataset to.</span>
<span class="sd">            num_proc: Number of processes to use for loading the dataset.</span>
<span class="sd">            push_eval: Whether to also push the eval.yaml file to the Hub</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; import mteb</span>
<span class="sd">            &gt;&gt;&gt; task = mteb.get_task(&quot;Caltech101&quot;)</span>
<span class="sd">            &gt;&gt;&gt; repo_name = f&quot;myorg/{task.metadata.name}&quot;</span>
<span class="sd">            &gt;&gt;&gt; # Push the dataset to the Hub</span>
<span class="sd">            &gt;&gt;&gt; task.push_dataset_to_hub(repo_name)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_loaded</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_data</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_push_dataset_to_hub</span><span class="p">(</span><span class="n">repo_name</span><span class="p">,</span> <span class="n">num_proc</span><span class="p">)</span>
        <span class="c1"># dataset repo not creating when pushing card</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">push_dataset_card_to_hub</span><span class="p">(</span><span class="n">repo_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">push_eval</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push_eval_to_hub</span><span class="p">(</span><span class="n">repo_name</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">push_eval_to_hub</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">repo_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">create_pr</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Push `eval.yaml` to the HuggingFace Hub</span>

<span class="sd">        Args:</span>
<span class="sd">            repo_name: repository name</span>
<span class="sd">            create_pr: Whether to create the PR</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">eval_file_name</span> <span class="o">=</span> <span class="s2">&quot;eval.yaml&quot;</span>

        <span class="n">existing_eval_path</span> <span class="o">=</span> <span class="n">_get_file_on_hub</span><span class="p">(</span>
            <span class="n">repo_id</span><span class="o">=</span><span class="n">repo_name</span><span class="p">,</span>
            <span class="n">file_name</span><span class="o">=</span><span class="n">eval_file_name</span><span class="p">,</span>
            <span class="n">repo_type</span><span class="o">=</span><span class="s2">&quot;dataset&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># handle multiple tasks in one repo (e.g. MIRACLRetrievalHardNegatives, MIRACLRetrievalHardNegativesV2)</span>
        <span class="n">existing_eval</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">existing_eval_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">Path</span><span class="p">(</span><span class="n">existing_eval_path</span><span class="p">)</span><span class="o">.</span><span class="n">open</span><span class="p">()</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">existing_eval_dict</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">existing_eval_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">existing_eval</span> <span class="o">=</span> <span class="n">HFEvalMeta</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">existing_eval_dict</span><span class="p">)</span>

        <span class="n">task_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_task_hf_config</span><span class="p">(</span><span class="n">existing_eval</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">tmp_file</span><span class="p">:</span>
            <span class="n">tmp_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">task_config</span><span class="o">.</span><span class="n">to_yaml</span><span class="p">())</span>
            <span class="n">tmp_file</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

            <span class="n">huggingface_hub</span><span class="o">.</span><span class="n">upload_file</span><span class="p">(</span>
                <span class="n">path_or_fileobj</span><span class="o">=</span><span class="n">tmp_file</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="n">path_in_repo</span><span class="o">=</span><span class="n">eval_file_name</span><span class="p">,</span>
                <span class="n">repo_id</span><span class="o">=</span><span class="n">repo_name</span><span class="p">,</span>
                <span class="n">repo_type</span><span class="o">=</span><span class="s2">&quot;dataset&quot;</span><span class="p">,</span>
                <span class="n">commit_message</span><span class="o">=</span><span class="s2">&quot;Add eval config&quot;</span><span class="p">,</span>
                <span class="n">create_pr</span><span class="o">=</span><span class="n">create_pr</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_create_task_hf_config</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">existing_eval</span><span class="p">:</span> <span class="n">HFEvalMeta</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">HFEvalMeta</span><span class="p">:</span>
        <span class="n">eval_task_config</span> <span class="o">=</span> <span class="p">[</span>
            <span class="c1"># scores across all subsets and splits</span>
            <span class="n">HFEvalTaskConfig</span><span class="p">(</span>
                <span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="n">split</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">]</span>

        <span class="k">for</span> <span class="n">subset</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">hf_subsets</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">split</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">eval_splits</span><span class="p">:</span>
                <span class="n">eval_task_config</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">HFEvalTaskConfig</span><span class="p">(</span>
                        <span class="nb">id</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">subset</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">split</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="n">config</span><span class="o">=</span><span class="n">subset</span><span class="p">,</span>
                        <span class="n">split</span><span class="o">=</span><span class="n">split</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>

        <span class="n">task_config</span> <span class="o">=</span> <span class="n">HFEvalMeta</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">description</span><span class="p">,</span>
            <span class="n">tasks</span><span class="o">=</span><span class="n">eval_task_config</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">existing_eval</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">task_config</span> <span class="o">=</span> <span class="n">task_config</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">existing_eval</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">task_config</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_aggregate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Whether the task is an aggregate of multiple tasks.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">eval_splits</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the evaluation splits of the task.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eval_splits</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eval_splits</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">eval_splits</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">modalities</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Modalities</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the modalities of the task.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">modalities</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="c1"># Format the representation of the task such that it appears as:</span>
        <span class="c1"># TaskObjectName(name=&#39;{name}&#39;, languages={lang1, lang2, ...})</span>

        <span class="n">langs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">languages</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">langs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">langs</span> <span class="o">=</span> <span class="n">langs</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">langs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;...&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">(name=&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;, languages=</span><span class="si">{</span><span class="n">langs</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">unload_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Unloads the dataset from memory&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_loaded</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_loaded</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unloaded dataset </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> from memory.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Dataset `</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">` is not loaded, cannot unload it.&quot;</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">superseded_by</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;If the dataset is superseded by another dataset, return the name of the new dataset.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">superseded_by</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h4 id="mteb.AbsTask.eval_splits" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">eval_splits</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#mteb.AbsTask.eval_splits" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Returns the evaluation splits of the task.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="mteb.AbsTask.is_aggregate" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_aggregate</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#mteb.AbsTask.is_aggregate" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Whether the task is an aggregate of multiple tasks.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="mteb.AbsTask.languages" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">languages</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#mteb.AbsTask.languages" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Returns the languages of the task.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="mteb.AbsTask.modalities" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">modalities</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#mteb.AbsTask.modalities" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Returns the modalities of the task.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="mteb.AbsTask.prediction_file_name" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">prediction_file_name</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#mteb.AbsTask.prediction_file_name" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>The name of the prediction file in format {task_name}_predictions.json</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="mteb.AbsTask.superseded_by" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">superseded_by</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#mteb.AbsTask.superseded_by" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>If the dataset is superseded by another dataset, return the name of the new dataset.</p>

    </div>

</div>




<div class="doc doc-object doc-function">


<h4 id="mteb.AbsTask.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

<a href="#mteb.AbsTask.__init__" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>The init function. This is called primarily to set the seed.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>seed</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An integer seed.</p>
              </div>
            </td>
            <td>
                  <code>42</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kwargs</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>arguments passed to subclasses.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>mteb/abstasks/abstask.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">42</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The init function. This is called primarily to set the seed.</span>

<span class="sd">    Args:</span>
<span class="sd">        seed: An integer seed.</span>
<span class="sd">        kwargs: arguments passed to subclasses.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="o">=</span> <span class="n">seed</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">rng_state</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">np_rng</span> <span class="o">=</span> <span class="n">_set_seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">hf_subsets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">hf_subsets</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="mteb.AbsTask.calculate_descriptive_statistics" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_descriptive_statistics</span><span class="p">(</span><span class="n">overwrite_results</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">num_proc</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#mteb.AbsTask.calculate_descriptive_statistics" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Calculates descriptive statistics from the dataset.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>overwrite_results</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to overwrite existing results. If False and results already exist, the existing results will be loaded from cache.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_proc</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of processes to use for loading the dataset.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <a class="autorefs autorefs-internal" title="&lt;code&gt;DescriptiveStatistics&lt;/code&gt; (&lt;code&gt;mteb.types.statistics.DescriptiveStatistics&lt;/code&gt;)" href="../types/#mteb.types.statistics.DescriptiveStatistics">DescriptiveStatistics</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary containing descriptive statistics for each split.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>mteb/abstasks/abstask.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_descriptive_statistics</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">overwrite_results</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">num_proc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">DescriptiveStatistics</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculates descriptive statistics from the dataset.</span>

<span class="sd">    Args:</span>
<span class="sd">        overwrite_results: Whether to overwrite existing results. If False and results already exist, the existing results will be loaded from cache.</span>
<span class="sd">        num_proc: Number of processes to use for loading the dataset.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A dictionary containing descriptive statistics for each split.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">mteb.abstasks</span><span class="w"> </span><span class="kn">import</span> <span class="n">AbsTaskClassification</span>

    <span class="n">existing_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">descriptive_stats</span>

    <span class="k">if</span> <span class="n">existing_stats</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">overwrite_results</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Loading metadata descriptive statistics from cache.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">existing_stats</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_loaded</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_data</span><span class="p">(</span><span class="n">num_proc</span><span class="o">=</span><span class="n">num_proc</span><span class="p">)</span>

    <span class="n">descriptive_stats</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">DescriptiveStatistics</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">hf_subset_stat</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;hf_subset_descriptive_stats&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;hf_subset_descriptive_stats&quot;</span>
    <span class="p">)</span>
    <span class="n">eval_splits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">eval_splits</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">AbsTaskClassification</span><span class="p">):</span>
        <span class="n">eval_splits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_split</span><span class="p">)</span>

    <span class="n">pbar_split</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">eval_splits</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Processing Splits...&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">split</span> <span class="ow">in</span> <span class="n">pbar_split</span><span class="p">:</span>
        <span class="n">pbar_split</span><span class="o">.</span><span class="n">set_postfix_str</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Split: </span><span class="si">{</span><span class="n">split</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing metadata for split </span><span class="si">{</span><span class="n">split</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">is_multilingual</span><span class="p">:</span>
            <span class="n">descriptive_stats</span><span class="p">[</span><span class="n">split</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_descriptive_statistics_from_split</span><span class="p">(</span>  <span class="c1"># type: ignore[assignment]</span>
                    <span class="n">split</span><span class="p">,</span> <span class="n">compute_overall</span><span class="o">=</span><span class="kc">True</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">descriptive_stats</span><span class="p">[</span><span class="n">split</span><span class="p">][</span><span class="n">hf_subset_stat</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="n">pbar_subsets</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">hf_subsets</span><span class="p">,</span>
                <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Processing Languages...&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">hf_subset</span> <span class="ow">in</span> <span class="n">pbar_subsets</span><span class="p">:</span>
                <span class="n">pbar_subsets</span><span class="o">.</span><span class="n">set_postfix_str</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Huggingface subset: </span><span class="si">{</span><span class="n">hf_subset</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing metadata for subset </span><span class="si">{</span><span class="n">hf_subset</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">split_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_descriptive_statistics_from_split</span><span class="p">(</span>
                    <span class="n">split</span><span class="p">,</span> <span class="n">hf_subset</span>
                <span class="p">)</span>
                <span class="n">descriptive_stats</span><span class="p">[</span><span class="n">split</span><span class="p">][</span><span class="n">hf_subset_stat</span><span class="p">][</span><span class="n">hf_subset</span><span class="p">]</span> <span class="o">=</span> <span class="n">split_details</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">split_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_descriptive_statistics_from_split</span><span class="p">(</span><span class="n">split</span><span class="p">)</span>
            <span class="n">descriptive_stats</span><span class="p">[</span><span class="n">split</span><span class="p">]</span> <span class="o">=</span> <span class="n">split_details</span>  <span class="c1"># type: ignore[assignment]</span>

    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">descriptive_stat_path</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">descriptive_stats</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">descriptive_stats</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="mteb.AbsTask.calculate_metadata_metrics" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_metadata_metrics</span><span class="p">(</span><span class="n">overwrite_results</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#mteb.AbsTask.calculate_metadata_metrics" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Old name of <code>calculate_descriptive_statistics</code>, kept for backward compatibility.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>mteb/abstasks/abstask.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_metadata_metrics</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">overwrite_results</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">DescriptiveStatistics</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Old name of `calculate_descriptive_statistics`, kept for backward compatibility.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_descriptive_statistics</span><span class="p">(</span>
        <span class="n">overwrite_results</span><span class="o">=</span><span class="n">overwrite_results</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="mteb.AbsTask.check_if_dataset_is_superseded" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_if_dataset_is_superseded</span><span class="p">()</span></code>

<a href="#mteb.AbsTask.check_if_dataset_is_superseded" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Check if the dataset is superseded by a newer version.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>mteb/abstasks/abstask.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">check_if_dataset_is_superseded</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if the dataset is superseded by a newer version.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">superseded_by</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Dataset &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; is superseded by &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">superseded_by</span><span class="si">}</span><span class="s2">&#39;. We recommend using the newer version of the dataset unless you are running a specific benchmark. See `get_task(&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">superseded_by</span><span class="si">}</span><span class="s2">&#39;).metadata.description` to get a description of the task and changes.&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="mteb.AbsTask.dataset_transform" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">dataset_transform</span><span class="p">(</span><span class="n">num_proc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

<a href="#mteb.AbsTask.dataset_transform" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>A transform operations applied to the dataset after loading.</p>
<p>This method is useful when the dataset from Huggingface is not in an <code>mteb</code> compatible format.
Override this method if your dataset requires additional transformation.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>num_proc</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of processes to use for the transformation.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kwargs</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional keyword arguments passed to the load_dataset function. Keep for forward compatibility.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>mteb/abstasks/abstask.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">dataset_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_proc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A transform operations applied to the dataset after loading.</span>

<span class="sd">    This method is useful when the dataset from Huggingface is not in an `mteb` compatible format.</span>
<span class="sd">    Override this method if your dataset requires additional transformation.</span>

<span class="sd">    Args:</span>
<span class="sd">        num_proc: Number of processes to use for the transformation.</span>
<span class="sd">        kwargs: Additional keyword arguments passed to the load_dataset function. Keep for forward compatibility.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="mteb.AbsTask.evaluate" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">evaluate</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="n">subsets_to_run</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">encode_kwargs</span><span class="p">,</span> <span class="n">prediction_folder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_proc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

<a href="#mteb.AbsTask.evaluate" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Evaluates an MTEB compatible model on the task.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;highlight language-python&quot;&gt;&lt;span class=&quot;n&quot;&gt;mteb&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;models&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;MTEBModels&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;EncoderProtocol&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CrossEncoderProtocol&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SearchProtocol&lt;/span&gt;&lt;/code&gt;

  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;mteb.models.MTEBModels&lt;/code&gt;)" href="../model/#mteb.models.MTEBModels">MTEBModels</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>MTEB compatible model. Implements a encode(sentences) method, that encodes sentences and returns an array of embeddings</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>split</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Which split (e.g. <em>"test"</em>) to be used.</p>
              </div>
            </td>
            <td>
                  <code>&#39;test&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>subsets_to_run</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<a class="autorefs autorefs-internal" title="&lt;code class=&quot;highlight language-python&quot;&gt;&lt;span class=&quot;n&quot;&gt;HFSubset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;str&lt;/span&gt;&lt;/code&gt;

  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;mteb.types.HFSubset&lt;/code&gt;)" href="../types/#mteb.types._result.HFSubset">HFSubset</a>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of huggingface subsets (HFSubsets) to evaluate. If None, all subsets are evaluated.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>encode_kwargs</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="&lt;code&gt;EncodeKwargs&lt;/code&gt; (&lt;code&gt;mteb.types.EncodeKwargs&lt;/code&gt;)" href="../types/#mteb.types._encoder_io.EncodeKwargs">EncodeKwargs</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional keyword arguments that are passed to the model's <code>encode</code> method.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>prediction_folder</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Folder to save model predictions</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_proc</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of processes to use for loading the dataset or processing.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kwargs</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional keyword arguments that are passed to the _evaluate_subset method.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="collections.abc.Mapping">Mapping</span>[<a class="autorefs autorefs-internal" title="&lt;code class=&quot;highlight language-python&quot;&gt;&lt;span class=&quot;n&quot;&gt;HFSubset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;str&lt;/span&gt;&lt;/code&gt;

  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;mteb.types.HFSubset&lt;/code&gt;)" href="../types/#mteb.types._result.HFSubset">HFSubset</a>, <a class="autorefs autorefs-internal" title="&lt;code class=&quot;highlight language-python&quot;&gt;&lt;span class=&quot;n&quot;&gt;ScoresDict&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Mapping&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;str&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Score&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;/code&gt;

  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;mteb.types.ScoresDict&lt;/code&gt;)" href="../types/#mteb.types._result.ScoresDict">ScoresDict</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary with the scores for each subset.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="TypeError">TypeError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the model is a CrossEncoder and the task does not support CrossEncoders.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="TypeError">TypeError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the model is a SearchProtocol and the task does not support Search.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>mteb/abstasks/abstask.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">evaluate</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">model</span><span class="p">:</span> <span class="n">MTEBModels</span><span class="p">,</span>
    <span class="n">split</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;test&quot;</span><span class="p">,</span>
    <span class="n">subsets_to_run</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">HFSubset</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">encode_kwargs</span><span class="p">:</span> <span class="n">EncodeKwargs</span><span class="p">,</span>
    <span class="n">prediction_folder</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">num_proc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">HFSubset</span><span class="p">,</span> <span class="n">ScoresDict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Evaluates an MTEB compatible model on the task.</span>

<span class="sd">    Args:</span>
<span class="sd">        model: MTEB compatible model. Implements a encode(sentences) method, that encodes sentences and returns an array of embeddings</span>
<span class="sd">        split: Which split (e.g. *&quot;test&quot;*) to be used.</span>
<span class="sd">        subsets_to_run: List of huggingface subsets (HFSubsets) to evaluate. If None, all subsets are evaluated.</span>
<span class="sd">        encode_kwargs: Additional keyword arguments that are passed to the model&#39;s `encode` method.</span>
<span class="sd">        prediction_folder: Folder to save model predictions</span>
<span class="sd">        num_proc: Number of processes to use for loading the dataset or processing.</span>
<span class="sd">        kwargs: Additional keyword arguments that are passed to the _evaluate_subset method.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A dictionary with the scores for each subset.</span>

<span class="sd">    Raises:</span>
<span class="sd">        TypeError: If the model is a CrossEncoder and the task does not support CrossEncoders.</span>
<span class="sd">        TypeError: If the model is a SearchProtocol and the task does not support Search.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">CrossEncoderProtocol</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_support_cross_encoder</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Model </span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s2"> is a CrossEncoder, but this task </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> does not support CrossEncoders. &quot;</span>
            <span class="s2">&quot;Please use a Encoder model instead.&quot;</span>
        <span class="p">)</span>

    <span class="c1"># encoders might implement search protocols</span>
    <span class="k">if</span> <span class="p">(</span>
        <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">SearchProtocol</span><span class="p">)</span>
        <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">EncoderProtocol</span><span class="p">)</span>
        <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_support_search</span>
    <span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Model </span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s2"> is a SearchProtocol, but this task </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> does not support Search. &quot;</span>
            <span class="s2">&quot;Please use a Encoder model instead.&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_loaded</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_data</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;dict[HFSubset, DatasetDict]&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">)</span>

    <span class="n">scores</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hf_subsets</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">hf_subsets</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">hf_subsets</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hf_subsets</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">subsets_to_run</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># allow overwrites of pre-filtering</span>
        <span class="n">hf_subsets</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">hf_subsets</span> <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">subsets_to_run</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">hf_subset</span> <span class="ow">in</span> <span class="n">hf_subsets</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Running task </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">split</span><span class="si">=}</span><span class="s2">, </span><span class="si">{</span><span class="n">hf_subset</span><span class="si">=}</span><span class="s2">)...&quot;</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">hf_subset</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span> <span class="ow">and</span> <span class="n">hf_subset</span> <span class="o">==</span> <span class="s2">&quot;default&quot;</span><span class="p">:</span>
            <span class="n">data_split</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">split</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data_split</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">hf_subset</span><span class="p">][</span><span class="n">split</span><span class="p">]</span>
        <span class="n">scores</span><span class="p">[</span><span class="n">hf_subset</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_subset</span><span class="p">(</span>
            <span class="n">model</span><span class="p">,</span>
            <span class="n">data_split</span><span class="p">,</span>
            <span class="n">hf_split</span><span class="o">=</span><span class="n">split</span><span class="p">,</span>
            <span class="n">hf_subset</span><span class="o">=</span><span class="n">hf_subset</span><span class="p">,</span>
            <span class="n">encode_kwargs</span><span class="o">=</span><span class="n">encode_kwargs</span><span class="p">,</span>
            <span class="n">prediction_folder</span><span class="o">=</span><span class="n">prediction_folder</span><span class="p">,</span>
            <span class="n">num_proc</span><span class="o">=</span><span class="n">num_proc</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_main_score</span><span class="p">(</span><span class="n">scores</span><span class="p">[</span><span class="n">hf_subset</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">scores</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="mteb.AbsTask.fast_load" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fast_load</span><span class="p">()</span></code>

<a href="#mteb.AbsTask.fast_load" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p><strong>Deprecated</strong>. Load all subsets at once, then group by language. Using fast loading has two requirements:</p>
<ul>
<li>Each row in the dataset should have a 'lang' feature giving the corresponding language/language pair</li>
<li>The datasets must have a 'default' config that loads all the subsets of the dataset (see more <a href="https://huggingface.co/docs/datasets/en/repository_structure#configurations">here</a>)</li>
</ul>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>mteb/abstasks/abstask.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fast_load</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;**Deprecated**. Load all subsets at once, then group by language. Using fast loading has two requirements:</span>

<span class="sd">    - Each row in the dataset should have a &#39;lang&#39; feature giving the corresponding language/language pair</span>
<span class="sd">    - The datasets must have a &#39;default&#39; config that loads all the subsets of the dataset (see more [here](https://huggingface.co/docs/datasets/en/repository_structure#configurations))</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">merged_dataset</span> <span class="o">=</span> <span class="n">load_dataset</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">dataset</span><span class="p">)</span>  <span class="c1"># load &quot;default&quot; subset</span>
    <span class="k">for</span> <span class="n">split</span> <span class="ow">in</span> <span class="n">merged_dataset</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">df_split</span> <span class="o">=</span> <span class="n">merged_dataset</span><span class="p">[</span><span class="n">split</span><span class="p">]</span><span class="o">.</span><span class="n">to_polars</span><span class="p">()</span>
        <span class="n">df_grouped</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">df_split</span><span class="o">.</span><span class="n">group_by</span><span class="p">([</span><span class="s2">&quot;lang&quot;</span><span class="p">]))</span>
        <span class="k">for</span> <span class="n">lang</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">df_split</span><span class="p">[</span><span class="s2">&quot;lang&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hf_subsets</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">lang</span><span class="p">,</span> <span class="p">{})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">lang</span><span class="p">][</span><span class="n">split</span><span class="p">]</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">from_polars</span><span class="p">(</span>
                <span class="n">df_grouped</span><span class="p">[(</span><span class="n">lang</span><span class="p">,)]</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;lang&quot;</span><span class="p">)</span>
            <span class="p">)</span>  <span class="c1"># Remove lang column and convert back to HF datasets, not strictly necessary but better for compatibility</span>
    <span class="k">for</span> <span class="n">lang</span><span class="p">,</span> <span class="n">subset</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">lang</span><span class="p">]</span> <span class="o">=</span> <span class="n">DatasetDict</span><span class="p">(</span><span class="n">subset</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="mteb.AbsTask.filter_eval_splits" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">filter_eval_splits</span><span class="p">(</span><span class="n">eval_splits</span><span class="p">)</span></code>

<a href="#mteb.AbsTask.filter_eval_splits" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Filter the evaluation splits of the task.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>eval_splits</code>
            </td>
            <td>
                  <code><span title="collections.abc.Sequence">Sequence</span>[<span title="str">str</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of evaluation splits to keep. If None, all splits are kept.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing_extensions.Self">Self</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The filtered task</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>mteb/abstasks/abstask.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">filter_eval_splits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eval_splits</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Filter the evaluation splits of the task.</span>

<span class="sd">    Args:</span>
<span class="sd">        eval_splits: A list of evaluation splits to keep. If None, all splits are kept.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The filtered task</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_eval_splits</span> <span class="o">=</span> <span class="n">eval_splits</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="mteb.AbsTask.filter_languages" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">filter_languages</span><span class="p">(</span><span class="n">languages</span><span class="p">,</span> <span class="n">script</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hf_subsets</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exclusive_language_filter</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#mteb.AbsTask.filter_languages" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Filter the languages of the task.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>languages</code>
            </td>
            <td>
                  <code><span title="collections.abc.Sequence">Sequence</span>[<span title="str">str</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of languages to filter the task by can be either a 3-letter language code (e.g. "eng") or also include the script
(e.g. "eng-Latn")</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>script</code>
            </td>
            <td>
                  <code><span title="collections.abc.Sequence">Sequence</span>[<span title="str">str</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of scripts to filter the task by. Will be ignored if language code specified the script. If None, all scripts are included.
If the language code does not specify the script the intersection of the language and script will be used.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>hf_subsets</code>
            </td>
            <td>
                  <code><span title="collections.abc.Sequence">Sequence</span>[<a class="autorefs autorefs-internal" title="&lt;code class=&quot;highlight language-python&quot;&gt;&lt;span class=&quot;n&quot;&gt;HFSubset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;str&lt;/span&gt;&lt;/code&gt;

  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;mteb.types.HFSubset&lt;/code&gt;)" href="../types/#mteb.types._result.HFSubset">HFSubset</a>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of huggingface subsets to filter on. This is useful if a dataset have multiple subsets containing the desired language,
but you only want to test on one. An example is STS22 which e.g. have both "en" and "de-en" which both contains English.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>exclusive_language_filter</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Some datasets contains more than one language e.g. for STS22 the subset "de-en" contain eng and deu. If
exclusive_language_filter is set to False both of these will be kept, but if set to True only those that contains all the languages
specified will be kept.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing_extensions.Self">Self</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The filtered task</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>mteb/abstasks/abstask.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">filter_languages</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">languages</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">script</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">hf_subsets</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">HFSubset</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">exclusive_language_filter</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Filter the languages of the task.</span>

<span class="sd">    Args:</span>
<span class="sd">        languages: list of languages to filter the task by can be either a 3-letter language code (e.g. &quot;eng&quot;) or also include the script</span>
<span class="sd">            (e.g. &quot;eng-Latn&quot;)</span>
<span class="sd">        script: A list of scripts to filter the task by. Will be ignored if language code specified the script. If None, all scripts are included.</span>
<span class="sd">            If the language code does not specify the script the intersection of the language and script will be used.</span>
<span class="sd">        hf_subsets: A list of huggingface subsets to filter on. This is useful if a dataset have multiple subsets containing the desired language,</span>
<span class="sd">            but you only want to test on one. An example is STS22 which e.g. have both &quot;en&quot; and &quot;de-en&quot; which both contains English.</span>
<span class="sd">        exclusive_language_filter: Some datasets contains more than one language e.g. for STS22 the subset &quot;de-en&quot; contain eng and deu. If</span>
<span class="sd">            exclusive_language_filter is set to False both of these will be kept, but if set to True only those that contains all the languages</span>
<span class="sd">            specified will be kept.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The filtered task</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lang_scripts</span> <span class="o">=</span> <span class="n">LanguageScripts</span><span class="o">.</span><span class="n">from_languages_and_scripts</span><span class="p">(</span><span class="n">languages</span><span class="p">,</span> <span class="n">script</span><span class="p">)</span>

    <span class="n">subsets_to_keep</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">hf_subset</span><span class="p">,</span> <span class="n">langs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">hf_subsets_to_langscripts</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">hf_subsets</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">hf_subset</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">hf_subsets</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">exclusive_language_filter</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">langscript</span> <span class="ow">in</span> <span class="n">langs</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">lang_scripts</span><span class="o">.</span><span class="n">contains_language</span><span class="p">(</span>
                    <span class="n">langscript</span>
                <span class="p">)</span> <span class="ow">or</span> <span class="n">lang_scripts</span><span class="o">.</span><span class="n">contains_script</span><span class="p">(</span><span class="n">langscript</span><span class="p">):</span>
                    <span class="n">subsets_to_keep</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hf_subset</span><span class="p">)</span>
                    <span class="k">break</span>

        <span class="k">if</span> <span class="n">exclusive_language_filter</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">languages</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">lang_scripts</span><span class="o">.</span><span class="n">contains_languages</span><span class="p">(</span><span class="n">langs</span><span class="p">):</span>
                <span class="n">subsets_to_keep</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hf_subset</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">subsets_to_keep</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;No subsets were found for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> with filters: language code </span><span class="si">{</span><span class="n">languages</span><span class="si">}</span><span class="s2">, script </span><span class="si">{</span><span class="n">script</span><span class="si">}</span><span class="s2">, hf subsets </span><span class="si">{</span><span class="n">hf_subsets</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">hf_subsets</span> <span class="o">=</span> <span class="n">subsets_to_keep</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="mteb.AbsTask.load_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_data</span><span class="p">(</span><span class="n">num_proc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

<a href="#mteb.AbsTask.load_data" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Loads dataset from HuggingFace hub</p>
<p>This is the main loading function for Task. Do not overwrite this, instead we recommend using <code>dataset_transform</code>, which is called after the
dataset is loaded using <code>datasets.load_dataset</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>num_proc</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of processes to use for loading the dataset.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kwargs</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional keyword arguments passed to the load_dataset function. Keep for forward compatibility.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>mteb/abstasks/abstask.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">load_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_proc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Loads dataset from HuggingFace hub</span>

<span class="sd">    This is the main loading function for Task. Do not overwrite this, instead we recommend using `dataset_transform`, which is called after the</span>
<span class="sd">    dataset is loaded using `datasets.load_dataset`.</span>

<span class="sd">    Args:</span>
<span class="sd">        num_proc: Number of processes to use for loading the dataset.</span>
<span class="sd">        kwargs: Additional keyword arguments passed to the load_dataset function. Keep for forward compatibility.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_loaded</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">is_multilingual</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fast_loading</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fast_load</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">hf_subset</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hf_subsets</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">hf_subset</span><span class="p">]</span> <span class="o">=</span> <span class="n">load_dataset</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="n">hf_subset</span><span class="p">,</span>
                    <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">dataset</span><span class="p">,</span>
                    <span class="n">num_proc</span><span class="o">=</span><span class="n">num_proc</span><span class="p">,</span>
                <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># some of monolingual datasets explicitly adding the split name to the dataset name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span> <span class="o">=</span> <span class="n">load_dataset</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">dataset</span><span class="p">,</span> <span class="n">num_proc</span><span class="o">=</span><span class="n">num_proc</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dataset_transform</span><span class="p">(</span><span class="n">num_proc</span><span class="o">=</span><span class="n">num_proc</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data_loaded</span> <span class="o">=</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="mteb.AbsTask.push_dataset_to_hub" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">push_dataset_to_hub</span><span class="p">(</span><span class="n">repo_name</span><span class="p">,</span> <span class="n">num_proc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">push_eval</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#mteb.AbsTask.push_dataset_to_hub" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Push the dataset to the HuggingFace Hub.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>repo_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the repository to push the dataset to.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_proc</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of processes to use for loading the dataset.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>push_eval</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to also push the eval.yaml file to the Hub</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">mteb</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">task</span> <span class="o">=</span> <span class="n">mteb</span><span class="o">.</span><span class="n">get_task</span><span class="p">(</span><span class="s2">&quot;Caltech101&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">repo_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;myorg/</span><span class="si">{</span><span class="n">task</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Push the dataset to the Hub</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">task</span><span class="o">.</span><span class="n">push_dataset_to_hub</span><span class="p">(</span><span class="n">repo_name</span><span class="p">)</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>mteb/abstasks/abstask.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">push_dataset_to_hub</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">repo_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">num_proc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">push_eval</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Push the dataset to the HuggingFace Hub.</span>

<span class="sd">    Args:</span>
<span class="sd">        repo_name: The name of the repository to push the dataset to.</span>
<span class="sd">        num_proc: Number of processes to use for loading the dataset.</span>
<span class="sd">        push_eval: Whether to also push the eval.yaml file to the Hub</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; import mteb</span>
<span class="sd">        &gt;&gt;&gt; task = mteb.get_task(&quot;Caltech101&quot;)</span>
<span class="sd">        &gt;&gt;&gt; repo_name = f&quot;myorg/{task.metadata.name}&quot;</span>
<span class="sd">        &gt;&gt;&gt; # Push the dataset to the Hub</span>
<span class="sd">        &gt;&gt;&gt; task.push_dataset_to_hub(repo_name)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_loaded</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_data</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_push_dataset_to_hub</span><span class="p">(</span><span class="n">repo_name</span><span class="p">,</span> <span class="n">num_proc</span><span class="p">)</span>
    <span class="c1"># dataset repo not creating when pushing card</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">push_dataset_card_to_hub</span><span class="p">(</span><span class="n">repo_name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">push_eval</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push_eval_to_hub</span><span class="p">(</span><span class="n">repo_name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="mteb.AbsTask.push_eval_to_hub" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">push_eval_to_hub</span><span class="p">(</span><span class="n">repo_name</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">create_pr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#mteb.AbsTask.push_eval_to_hub" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Push <code>eval.yaml</code> to the HuggingFace Hub</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>repo_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>repository name</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>create_pr</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to create the PR</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>mteb/abstasks/abstask.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">push_eval_to_hub</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">repo_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">create_pr</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Push `eval.yaml` to the HuggingFace Hub</span>

<span class="sd">    Args:</span>
<span class="sd">        repo_name: repository name</span>
<span class="sd">        create_pr: Whether to create the PR</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">eval_file_name</span> <span class="o">=</span> <span class="s2">&quot;eval.yaml&quot;</span>

    <span class="n">existing_eval_path</span> <span class="o">=</span> <span class="n">_get_file_on_hub</span><span class="p">(</span>
        <span class="n">repo_id</span><span class="o">=</span><span class="n">repo_name</span><span class="p">,</span>
        <span class="n">file_name</span><span class="o">=</span><span class="n">eval_file_name</span><span class="p">,</span>
        <span class="n">repo_type</span><span class="o">=</span><span class="s2">&quot;dataset&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># handle multiple tasks in one repo (e.g. MIRACLRetrievalHardNegatives, MIRACLRetrievalHardNegativesV2)</span>
    <span class="n">existing_eval</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">existing_eval_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">Path</span><span class="p">(</span><span class="n">existing_eval_path</span><span class="p">)</span><span class="o">.</span><span class="n">open</span><span class="p">()</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">existing_eval_dict</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">existing_eval_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">existing_eval</span> <span class="o">=</span> <span class="n">HFEvalMeta</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">existing_eval_dict</span><span class="p">)</span>

    <span class="n">task_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_task_hf_config</span><span class="p">(</span><span class="n">existing_eval</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">tmp_file</span><span class="p">:</span>
        <span class="n">tmp_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">task_config</span><span class="o">.</span><span class="n">to_yaml</span><span class="p">())</span>
        <span class="n">tmp_file</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

        <span class="n">huggingface_hub</span><span class="o">.</span><span class="n">upload_file</span><span class="p">(</span>
            <span class="n">path_or_fileobj</span><span class="o">=</span><span class="n">tmp_file</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">path_in_repo</span><span class="o">=</span><span class="n">eval_file_name</span><span class="p">,</span>
            <span class="n">repo_id</span><span class="o">=</span><span class="n">repo_name</span><span class="p">,</span>
            <span class="n">repo_type</span><span class="o">=</span><span class="s2">&quot;dataset&quot;</span><span class="p">,</span>
            <span class="n">commit_message</span><span class="o">=</span><span class="s2">&quot;Add eval config&quot;</span><span class="p">,</span>
            <span class="n">create_pr</span><span class="o">=</span><span class="n">create_pr</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="mteb.AbsTask.stratified_subsampling" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">stratified_subsampling</span><span class="p">(</span><span class="n">dataset_dict</span><span class="p">,</span> <span class="n">seed</span><span class="p">,</span> <span class="n">splits</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="n">n_samples</span><span class="o">=</span><span class="mi">2048</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#mteb.AbsTask.stratified_subsampling" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Subsamples the dataset with stratification by the supplied label.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>dataset_dict</code>
            </td>
            <td>
                  <code><span title="datasets.DatasetDict">DatasetDict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the DatasetDict object.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>seed</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the random seed.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>splits</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the splits of the dataset.</p>
              </div>
            </td>
            <td>
                  <code>[&#39;test&#39;]</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>label</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the label with which the stratified sampling is based on.</p>
              </div>
            </td>
            <td>
                  <code>&#39;label&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_samples</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional, number of samples to subsample. Default is max_n_samples.</p>
              </div>
            </td>
            <td>
                  <code>2048</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="datasets.DatasetDict">DatasetDict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A subsampled DatasetDict object.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>mteb/abstasks/abstask.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">stratified_subsampling</span><span class="p">(</span>
    <span class="n">dataset_dict</span><span class="p">:</span> <span class="n">DatasetDict</span><span class="p">,</span>
    <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">splits</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;test&quot;</span><span class="p">],</span>
    <span class="n">label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;label&quot;</span><span class="p">,</span>
    <span class="n">n_samples</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2048</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DatasetDict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Subsamples the dataset with stratification by the supplied label.</span>

<span class="sd">    Args:</span>
<span class="sd">        dataset_dict: the DatasetDict object.</span>
<span class="sd">        seed: the random seed.</span>
<span class="sd">        splits: the splits of the dataset.</span>
<span class="sd">        label: the label with which the stratified sampling is based on.</span>
<span class="sd">        n_samples: Optional, number of samples to subsample. Default is max_n_samples.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A subsampled DatasetDict object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Can only do this if the label column is of ClassLabel.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataset_dict</span><span class="p">[</span><span class="n">splits</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="n">label</span><span class="p">],</span> <span class="n">ClassLabel</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dataset_dict</span> <span class="o">=</span> <span class="n">dataset_dict</span><span class="o">.</span><span class="n">class_encode_column</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataset_dict</span><span class="p">[</span><span class="n">splits</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">label</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">Sequence</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">_multilabel_subsampling</span><span class="p">(</span>
                    <span class="n">dataset_dict</span><span class="p">,</span> <span class="n">seed</span><span class="p">,</span> <span class="n">splits</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">n_samples</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">e</span>

    <span class="k">for</span> <span class="n">split</span> <span class="ow">in</span> <span class="n">splits</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">n_samples</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataset_dict</span><span class="p">[</span><span class="n">split</span><span class="p">]):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Subsampling not needed for split </span><span class="si">{</span><span class="n">split</span><span class="si">}</span><span class="s2">, as n_samples is equal or greater than the number of samples.&quot;</span>
            <span class="p">)</span>
            <span class="k">continue</span>
        <span class="n">dataset_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="n">split</span><span class="p">:</span> <span class="n">dataset_dict</span><span class="p">[</span><span class="n">split</span><span class="p">]</span><span class="o">.</span><span class="n">train_test_split</span><span class="p">(</span>
                    <span class="n">test_size</span><span class="o">=</span><span class="n">n_samples</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span> <span class="n">stratify_by_column</span><span class="o">=</span><span class="n">label</span>
                <span class="p">)[</span><span class="s2">&quot;test&quot;</span><span class="p">]</span>
            <span class="p">}</span>
        <span class="p">)</span>  <span class="c1"># only take the specified test split.</span>
    <span class="k">return</span> <span class="n">dataset_dict</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="mteb.AbsTask.unload_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">unload_data</span><span class="p">()</span></code>

<a href="#mteb.AbsTask.unload_data" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Unloads the dataset from memory</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>mteb/abstasks/abstask.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">unload_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Unloads the dataset from memory&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_loaded</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_loaded</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unloaded dataset </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> from memory.&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Dataset `</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">` is not loaded, cannot unload it.&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="multimodal-tasks">Multimodal Tasks<a class="headerlink" href="#multimodal-tasks" title="Permanent link">&para;</a></h2>
<p>Tasks that support any modality (text, image, etc.) inherit from the following abstract class. Retrieval tasks support multimodal input (e.g. image + text queries and image corpus or vice versa).</p>


<div class="doc doc-object doc-class">



<h3 id="mteb.abstasks.retrieval.AbsTaskRetrieval" class="doc doc-heading">
            <code>mteb.abstasks.retrieval.AbsTaskRetrieval</code>


<a href="#mteb.abstasks.retrieval.AbsTaskRetrieval" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="&lt;code&gt;mteb.AbsTask&lt;/code&gt; (&lt;code&gt;mteb.abstasks.abstask.AbsTask&lt;/code&gt;)" href="#mteb.AbsTask">AbsTask</a></code></p>



        <p>The class which retrieval tasks inherit from.</p>
<p>A retrieval task consists of a corpus of documents, a set of queries, and a mapping of which documents are relevant for each query.
The task is to retrieve the relevant documents for each query. The evaluation is done by indexing the corpus and then searching for each query.
The retrieved documents are then compared to the relevant documents to calculate the evaluation scores.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.retrieval.AbsTaskRetrieval.dataset">dataset</span></code></td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="dict">dict</span>[<span title="str">str</span>, <a class="autorefs autorefs-internal" title="&lt;code&gt;mteb.abstasks.retrieval_dataset_loaders.RetrievalSplitData&lt;/code&gt;" href="#mteb.abstasks.retrieval_dataset_loaders.RetrievalSplitData">RetrievalSplitData</a>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A nested dictionary where the first key is the subset (language or "default"),
     the second key is the split (e.g., "train", "test"), and the value is a RetrievalSplitData object.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.retrieval.AbsTaskRetrieval.ignore_identical_ids">ignore_identical_ids</span></code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, identical IDs in queries and corpus are ignored during evaluation.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.retrieval.AbsTaskRetrieval.k_values">k_values</span></code></td>
            <td>
                  <code><span title="collections.abc.Sequence">Sequence</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A sequence of integers representing the k values for evaluation metrics.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.retrieval.AbsTaskRetrieval.skip_first_result">skip_first_result</span></code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, the first result is skipped during evaluation</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.retrieval.AbsTaskRetrieval.abstask_prompt">abstask_prompt</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Prompt to use for the task for instruction model if not prompt is provided in TaskMetadata.prompt.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>mteb/abstasks/retrieval.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">AbsTaskRetrieval</span><span class="p">(</span><span class="n">AbsTask</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The class which retrieval tasks inherit from.</span>

<span class="sd">    A retrieval task consists of a corpus of documents, a set of queries, and a mapping of which documents are relevant for each query.</span>
<span class="sd">    The task is to retrieve the relevant documents for each query. The evaluation is done by indexing the corpus and then searching for each query.</span>
<span class="sd">    The retrieved documents are then compared to the relevant documents to calculate the evaluation scores.</span>


<span class="sd">    Attributes:</span>
<span class="sd">        dataset: A nested dictionary where the first key is the subset (language or &quot;default&quot;),</span>
<span class="sd">                 the second key is the split (e.g., &quot;train&quot;, &quot;test&quot;), and the value is a RetrievalSplitData object.</span>
<span class="sd">        ignore_identical_ids: If True, identical IDs in queries and corpus are ignored during evaluation.</span>
<span class="sd">        k_values: A sequence of integers representing the k values for evaluation metrics.</span>
<span class="sd">        skip_first_result: If True, the first result is skipped during evaluation</span>
<span class="sd">        abstask_prompt: Prompt to use for the task for instruction model if not prompt is provided in TaskMetadata.prompt.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">ignore_identical_ids</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">abstask_prompt</span> <span class="o">=</span> <span class="s2">&quot;Retrieve text based on user query.&quot;</span>
    <span class="n">k_values</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
    <span class="n">_top_k</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">k_values</span><span class="p">)</span>
    <span class="n">dataset</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">RetrievalSplitData</span><span class="p">]]</span>
    <span class="n">_support_cross_encoder</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">_support_search</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">_previous_results_model_meta</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">skip_first_result</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">empty_dataset</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">from_dict</span><span class="p">({})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">(</span>
                <span class="k">lambda</span><span class="p">:</span> <span class="n">RetrievalSplitData</span><span class="p">(</span>
                    <span class="n">corpus</span><span class="o">=</span><span class="n">empty_dataset</span><span class="p">,</span>
                    <span class="n">queries</span><span class="o">=</span><span class="n">empty_dataset</span><span class="p">,</span>
                    <span class="n">relevant_docs</span><span class="o">=</span><span class="p">{},</span>
                    <span class="n">top_ranked</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">convert_v1_dataset_format_to_v2</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">num_proc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert dataset from v1 (from `self.queries`, `self.document`) format to v2 format (`self.dotaset`).&quot;&quot;&quot;</span>
        <span class="c1"># check if dataset is `v1` version</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;queries&quot;</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="n">empty_dataset</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">from_dict</span><span class="p">({})</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">(</span>
                <span class="k">lambda</span><span class="p">:</span> <span class="n">RetrievalSplitData</span><span class="p">(</span>
                    <span class="n">corpus</span><span class="o">=</span><span class="n">empty_dataset</span><span class="p">,</span>
                    <span class="n">queries</span><span class="o">=</span><span class="n">empty_dataset</span><span class="p">,</span>
                    <span class="n">relevant_docs</span><span class="o">=</span><span class="p">{},</span>
                    <span class="n">top_ranked</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_process_split</span><span class="p">(</span>
            <span class="n">ds_queries</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="n">Dataset</span><span class="p">,</span> <span class="n">ds_corpus</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="n">Dataset</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Dataset</span><span class="p">,</span> <span class="n">Dataset</span><span class="p">]:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ds_queries</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">queries</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span>
                    <span class="p">[{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">k</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">v</span><span class="p">}</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">ds_queries</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ds_queries</span><span class="p">,</span> <span class="n">Dataset</span><span class="p">):</span>
                <span class="n">queries</span> <span class="o">=</span> <span class="n">ds_queries</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Can&#39;t convert queries of type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">ds_queries</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ds_corpus</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">corpus</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">k</span><span class="p">,</span>
                            <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">v</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">v</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">],</span>
                            <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                        <span class="p">}</span>
                        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">ds_corpus</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                    <span class="p">]</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ds_corpus</span><span class="p">,</span> <span class="n">Dataset</span><span class="p">):</span>
                <span class="n">corpus</span> <span class="o">=</span> <span class="n">ds_corpus</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Can&#39;t convert corpus of type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">ds_corpus</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">queries</span><span class="p">,</span> <span class="n">corpus</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">is_multilingual</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">subset</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">queries</span><span class="p">:</span>  <span class="c1"># type: ignore[attr-defined]</span>
                <span class="k">for</span> <span class="n">split</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">queries</span><span class="p">[</span><span class="n">subset</span><span class="p">]:</span>  <span class="c1"># type: ignore[attr-defined]</span>
                    <span class="n">queries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">queries</span><span class="p">[</span><span class="n">subset</span><span class="p">][</span><span class="n">split</span><span class="p">]</span>  <span class="c1"># type: ignore[attr-defined]</span>
                    <span class="n">corpus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">corpus</span><span class="p">[</span><span class="n">subset</span><span class="p">][</span><span class="n">split</span><span class="p">]</span>  <span class="c1"># type: ignore[attr-defined]</span>

                    <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">subset</span><span class="p">][</span><span class="n">split</span><span class="p">][</span><span class="s2">&quot;queries&quot;</span><span class="p">],</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">subset</span><span class="p">][</span><span class="n">split</span><span class="p">][</span><span class="s2">&quot;corpus&quot;</span><span class="p">],</span>
                    <span class="p">)</span> <span class="o">=</span> <span class="n">_process_split</span><span class="p">(</span><span class="n">queries</span><span class="p">,</span> <span class="n">corpus</span><span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">subset</span><span class="p">][</span><span class="n">split</span><span class="p">][</span><span class="s2">&quot;relevant_docs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">relevant_docs</span><span class="p">[</span>  <span class="c1"># type: ignore[attr-defined]</span>
                        <span class="n">subset</span>
                    <span class="p">][</span><span class="n">split</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;instructions&quot;</span><span class="p">):</span>
                        <span class="n">instructions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">instructions</span><span class="p">[</span><span class="n">subset</span><span class="p">][</span><span class="n">split</span><span class="p">]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">subset</span><span class="p">][</span><span class="n">split</span><span class="p">][</span><span class="s2">&quot;queries&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="n">_combine_queries_with_instructions_datasets</span><span class="p">(</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">subset</span><span class="p">][</span><span class="n">split</span><span class="p">][</span><span class="s2">&quot;queries&quot;</span><span class="p">],</span>
                                <span class="n">instructions</span><span class="p">,</span>
                                <span class="n">num_proc</span><span class="p">,</span>
                            <span class="p">)</span>
                        <span class="p">)</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;top_ranked&quot;</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">subset</span><span class="p">][</span><span class="n">split</span><span class="p">][</span><span class="s2">&quot;top_ranked&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">top_ranked</span><span class="p">[</span>
                            <span class="n">subset</span>
                        <span class="p">][</span><span class="n">split</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">subset</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span>
            <span class="k">for</span> <span class="n">split</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">queries</span><span class="p">:</span>  <span class="c1"># type: ignore[attr-defined]</span>
                <span class="n">queries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">queries</span><span class="p">[</span><span class="n">split</span><span class="p">]</span>  <span class="c1"># type: ignore[attr-defined]</span>
                <span class="n">corpus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">corpus</span><span class="p">[</span><span class="n">split</span><span class="p">]</span>  <span class="c1"># type: ignore[attr-defined]</span>
                <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">subset</span><span class="p">][</span><span class="n">split</span><span class="p">][</span><span class="s2">&quot;queries&quot;</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">subset</span><span class="p">][</span><span class="n">split</span><span class="p">][</span><span class="s2">&quot;corpus&quot;</span><span class="p">],</span>
                <span class="p">)</span> <span class="o">=</span> <span class="n">_process_split</span><span class="p">(</span><span class="n">queries</span><span class="p">,</span> <span class="n">corpus</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">subset</span><span class="p">][</span><span class="n">split</span><span class="p">][</span><span class="s2">&quot;relevant_docs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">relevant_docs</span><span class="p">[</span>  <span class="c1"># type: ignore[attr-defined]</span>
                    <span class="n">split</span>
                <span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;instructions&quot;</span><span class="p">):</span>
                    <span class="n">instructions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">instructions</span><span class="p">[</span><span class="n">split</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">subset</span><span class="p">][</span><span class="n">split</span><span class="p">][</span><span class="s2">&quot;queries&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">_combine_queries_with_instructions_datasets</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">subset</span><span class="p">][</span><span class="n">split</span><span class="p">][</span><span class="s2">&quot;queries&quot;</span><span class="p">],</span>
                            <span class="n">instructions</span><span class="p">,</span>
                            <span class="n">num_proc</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;top_ranked&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">top_ranked</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">subset</span><span class="p">][</span><span class="n">split</span><span class="p">][</span><span class="s2">&quot;top_ranked&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">top_ranked</span><span class="p">[</span>
                        <span class="n">split</span>
                    <span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">queries</span>  <span class="c1"># type: ignore[attr-defined]</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">corpus</span>  <span class="c1"># type: ignore[attr-defined]</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">relevant_docs</span>  <span class="c1"># type: ignore[attr-defined]</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;instructions&quot;</span><span class="p">):</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">instructions</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;top_ranked&quot;</span><span class="p">):</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">top_ranked</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">load_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_proc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load the dataset for the retrieval task.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_loaded</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">dataset_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">]</span>
        <span class="n">eval_splits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_splits</span>
        <span class="n">trust_remote_code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;trust_remote_code&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">revision</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="s2">&quot;revision&quot;</span><span class="p">]</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_process_data</span><span class="p">(</span><span class="n">split</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">hf_subset</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Helper function to load and process data for a given split and language&quot;&quot;&quot;</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Loading </span><span class="si">{</span><span class="n">split</span><span class="si">}</span><span class="s2"> split for </span><span class="si">{</span><span class="n">hf_subset</span><span class="si">}</span><span class="s2"> subset of </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">hf_subset</span><span class="p">][</span><span class="n">split</span><span class="p">]</span> <span class="o">=</span> <span class="n">RetrievalDatasetLoader</span><span class="p">(</span>
                <span class="n">hf_repo</span><span class="o">=</span><span class="n">dataset_path</span><span class="p">,</span>
                <span class="n">revision</span><span class="o">=</span><span class="n">revision</span><span class="p">,</span>
                <span class="n">trust_remote_code</span><span class="o">=</span><span class="n">trust_remote_code</span><span class="p">,</span>
                <span class="n">split</span><span class="o">=</span><span class="n">split</span><span class="p">,</span>
                <span class="n">config</span><span class="o">=</span><span class="n">hf_subset</span><span class="p">,</span>
            <span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
                <span class="n">num_proc</span><span class="o">=</span><span class="n">num_proc</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">is_multilingual</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">lang</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hf_subsets</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">split</span> <span class="ow">in</span> <span class="n">eval_splits</span><span class="p">:</span>
                    <span class="n">_process_data</span><span class="p">(</span><span class="n">split</span><span class="p">,</span> <span class="n">lang</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">split</span> <span class="ow">in</span> <span class="n">eval_splits</span><span class="p">:</span>
                <span class="n">_process_data</span><span class="p">(</span><span class="n">split</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataset_transform</span><span class="p">(</span><span class="n">num_proc</span><span class="o">=</span><span class="n">num_proc</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_loaded</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">evaluate</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">MTEBModels</span><span class="p">,</span>
        <span class="n">split</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;test&quot;</span><span class="p">,</span>
        <span class="n">subsets_to_run</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">HFSubset</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">encode_kwargs</span><span class="p">:</span> <span class="n">EncodeKwargs</span><span class="p">,</span>
        <span class="n">prediction_folder</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">num_proc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">HFSubset</span><span class="p">,</span> <span class="n">ScoresDict</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Evaluate the model on the retrieval task.</span>

<span class="sd">        Args:</span>
<span class="sd">            model: Model to evaluate. Model should implement the [SearchProtocol][mteb.models.models_protocols.SearchProtocol]</span>
<span class="sd">                or be an [Encoder][mteb.models.models_protocols.EncoderProtocol] or [CrossEncoderProtocol][mteb.models.models_protocols.CrossEncoderProtocol].</span>
<span class="sd">            split: Split to evaluate on</span>
<span class="sd">            subsets_to_run: Optional list of subsets to evaluate on</span>
<span class="sd">            encode_kwargs: Keyword arguments passed to the encoder</span>
<span class="sd">            prediction_folder: Folder to save model predictions</span>
<span class="sd">            num_proc: Number of processes to use</span>
<span class="sd">            **kwargs: Additional keyword arguments passed to the evaluator</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dictionary mapping subsets to their evaluation scores</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_loaded</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_data</span><span class="p">(</span><span class="n">num_proc</span><span class="o">=</span><span class="n">num_proc</span><span class="p">)</span>
        <span class="c1"># TODO: convert all tasks directly https://github.com/embeddings-benchmark/mteb/issues/2030</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">convert_v1_dataset_format_to_v2</span><span class="p">(</span><span class="n">num_proc</span><span class="o">=</span><span class="n">num_proc</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span>
            <span class="n">model</span><span class="p">,</span>
            <span class="n">split</span><span class="p">,</span>
            <span class="n">subsets_to_run</span><span class="p">,</span>
            <span class="n">encode_kwargs</span><span class="o">=</span><span class="n">encode_kwargs</span><span class="p">,</span>
            <span class="n">prediction_folder</span><span class="o">=</span><span class="n">prediction_folder</span><span class="p">,</span>
            <span class="n">num_proc</span><span class="o">=</span><span class="n">num_proc</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_evaluate_subset</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">MTEBModels</span><span class="p">,</span>
        <span class="n">data_split</span><span class="p">:</span> <span class="n">RetrievalSplitData</span><span class="p">,</span>
        <span class="n">encode_kwargs</span><span class="p">:</span> <span class="n">EncodeKwargs</span><span class="p">,</span>
        <span class="n">hf_split</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">hf_subset</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">prediction_folder</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">num_proc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ScoresDict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Evaluate a model on a specific subset of the data.</span>

<span class="sd">        Args:</span>
<span class="sd">            model: Model to evaluate</span>
<span class="sd">            data_split: Data split to evaluate on</span>
<span class="sd">            encode_kwargs: Keyword arguments passed to the encoder</span>
<span class="sd">            hf_split: Split to evaluate on</span>
<span class="sd">            hf_subset: Subset to evaluate on</span>
<span class="sd">            prediction_folder: Folder with results prediction</span>
<span class="sd">            num_proc: Number of processes to use</span>
<span class="sd">            **kwargs: Additional keyword arguments passed to the evaluator</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dictionary of evaluation scores</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># ensure queries format (see #3030)</span>
        <span class="n">data_split</span><span class="p">[</span><span class="s2">&quot;relevant_docs&quot;</span><span class="p">],</span> <span class="n">data_split</span><span class="p">[</span><span class="s2">&quot;queries&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">_filter_queries_without_positives</span><span class="p">(</span>
                <span class="n">data_split</span><span class="p">[</span><span class="s2">&quot;relevant_docs&quot;</span><span class="p">],</span> <span class="n">data_split</span><span class="p">[</span><span class="s2">&quot;queries&quot;</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">retriever</span> <span class="o">=</span> <span class="n">RetrievalEvaluator</span><span class="p">(</span>
            <span class="n">corpus</span><span class="o">=</span><span class="n">data_split</span><span class="p">[</span><span class="s2">&quot;corpus&quot;</span><span class="p">],</span>
            <span class="n">queries</span><span class="o">=</span><span class="n">data_split</span><span class="p">[</span><span class="s2">&quot;queries&quot;</span><span class="p">],</span>
            <span class="n">task_metadata</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span>
            <span class="n">hf_split</span><span class="o">=</span><span class="n">hf_split</span><span class="p">,</span>
            <span class="n">hf_subset</span><span class="o">=</span><span class="n">hf_subset</span><span class="p">,</span>
            <span class="n">top_ranked</span><span class="o">=</span><span class="n">data_split</span><span class="p">[</span><span class="s2">&quot;top_ranked&quot;</span><span class="p">],</span>
            <span class="n">top_k</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_top_k</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">search_model</span><span class="p">:</span> <span class="n">SearchProtocol</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">EncoderProtocol</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">SearchProtocol</span><span class="p">):</span>
            <span class="n">search_model</span> <span class="o">=</span> <span class="n">SearchEncoderWrapper</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">CrossEncoderProtocol</span><span class="p">):</span>
            <span class="n">search_model</span> <span class="o">=</span> <span class="n">SearchCrossEncoderWrapper</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">SearchProtocol</span><span class="p">):</span>
            <span class="n">search_model</span> <span class="o">=</span> <span class="n">model</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;RetrievalEvaluator expects a SearchInterface, Encoder, or CrossEncoder, got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">model</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">retriever</span><span class="p">(</span>
            <span class="n">search_model</span><span class="p">,</span>
            <span class="n">encode_kwargs</span><span class="o">=</span><span class="n">encode_kwargs</span><span class="p">,</span>
            <span class="n">num_proc</span><span class="o">=</span><span class="n">num_proc</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Running retrieval task - Time taken to retrieve: </span><span class="si">{</span><span class="n">end_time</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> seconds&quot;</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">prediction_folder</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_save_task_predictions</span><span class="p">(</span>
                <span class="n">results</span><span class="p">,</span>
                <span class="n">model</span><span class="p">,</span>
                <span class="n">prediction_folder</span><span class="p">,</span>
                <span class="n">hf_subset</span><span class="o">=</span><span class="n">hf_subset</span><span class="p">,</span>
                <span class="n">hf_split</span><span class="o">=</span><span class="n">hf_split</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Running retrieval task - Evaluating retrieval scores...&quot;</span><span class="p">)</span>
        <span class="p">(</span>
            <span class="n">all_scores</span><span class="p">,</span>
            <span class="n">ndcg</span><span class="p">,</span>
            <span class="n">_map</span><span class="p">,</span>
            <span class="n">recall</span><span class="p">,</span>
            <span class="n">precision</span><span class="p">,</span>
            <span class="n">naucs</span><span class="p">,</span>
            <span class="n">mrr</span><span class="p">,</span>
            <span class="n">naucs_mrr</span><span class="p">,</span>
            <span class="n">hit_rate</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="n">retriever</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span>
            <span class="n">data_split</span><span class="p">[</span><span class="s2">&quot;relevant_docs&quot;</span><span class="p">],</span>
            <span class="n">results</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">k_values</span><span class="p">,</span>
            <span class="n">ignore_identical_ids</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ignore_identical_ids</span><span class="p">,</span>
            <span class="n">skip_first_result</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">skip_first_result</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">task_specific_scores</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">task_specific_scores</span><span class="p">(</span>
            <span class="n">all_scores</span><span class="p">,</span>
            <span class="n">data_split</span><span class="p">[</span><span class="s2">&quot;relevant_docs&quot;</span><span class="p">],</span>
            <span class="n">results</span><span class="p">,</span>
            <span class="n">hf_split</span><span class="o">=</span><span class="n">hf_split</span><span class="p">,</span>
            <span class="n">hf_subset</span><span class="o">=</span><span class="n">hf_subset</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Running retrieval task - Finished.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">make_score_dict</span><span class="p">(</span>
            <span class="n">ndcg</span><span class="p">,</span>
            <span class="n">_map</span><span class="p">,</span>
            <span class="n">recall</span><span class="p">,</span>
            <span class="n">precision</span><span class="p">,</span>
            <span class="n">mrr</span><span class="p">,</span>
            <span class="n">naucs</span><span class="p">,</span>
            <span class="n">naucs_mrr</span><span class="p">,</span>
            <span class="n">hit_rate</span><span class="p">,</span>
            <span class="n">task_specific_scores</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_previous_results_model_meta</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">task_specific_scores</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">scores</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]],</span>
        <span class="n">qrels</span><span class="p">:</span> <span class="n">RelevantDocumentsType</span><span class="p">,</span>
        <span class="n">results</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]],</span>
        <span class="n">hf_split</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">hf_subset</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate task specific scores. Override in subclass if needed.</span>

<span class="sd">        Args:</span>
<span class="sd">            scores: Dictionary of scores</span>
<span class="sd">            qrels: Relevant documents</span>
<span class="sd">            results: Retrieval results</span>
<span class="sd">            hf_split: Split to evaluate on</span>
<span class="sd">            hf_subset: Subset to evaluate on</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_calculate_descriptive_statistics_from_split</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">split</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">hf_subset</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">compute_overall</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">num_proc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RetrievalDescriptiveStatistics</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">convert_v1_dataset_format_to_v2</span><span class="p">(</span><span class="n">num_proc</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">hf_subset</span> <span class="ow">and</span> <span class="n">hf_subset</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">:</span>
            <span class="n">split_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">hf_subset</span><span class="p">][</span><span class="n">split</span><span class="p">]</span>
            <span class="n">queries</span> <span class="o">=</span> <span class="n">split_data</span><span class="p">[</span><span class="s2">&quot;queries&quot;</span><span class="p">]</span>
            <span class="n">corpus</span> <span class="o">=</span> <span class="n">split_data</span><span class="p">[</span><span class="s2">&quot;corpus&quot;</span><span class="p">]</span>
            <span class="n">relevant_docs</span> <span class="o">=</span> <span class="n">split_data</span><span class="p">[</span><span class="s2">&quot;relevant_docs&quot;</span><span class="p">]</span>
            <span class="n">top_ranked</span> <span class="o">=</span> <span class="n">split_data</span><span class="p">[</span><span class="s2">&quot;top_ranked&quot;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">compute_overall</span><span class="p">:</span>
            <span class="n">queries</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">corpus</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">relevant_docs</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">top_ranked</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">hf_subset</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">eval_langs</span><span class="p">:</span>
                <span class="n">split_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">hf_subset</span><span class="p">][</span><span class="n">split</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">queries</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">queries</span> <span class="o">=</span> <span class="n">split_data</span><span class="p">[</span><span class="s2">&quot;queries&quot;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">queries</span> <span class="o">=</span> <span class="n">concatenate_datasets</span><span class="p">([</span><span class="n">queries</span><span class="p">,</span> <span class="n">split_data</span><span class="p">[</span><span class="s2">&quot;queries&quot;</span><span class="p">]])</span>
                <span class="k">if</span> <span class="n">corpus</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">corpus</span> <span class="o">=</span> <span class="n">split_data</span><span class="p">[</span><span class="s2">&quot;corpus&quot;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">corpus</span> <span class="o">=</span> <span class="n">concatenate_datasets</span><span class="p">([</span><span class="n">corpus</span><span class="p">,</span> <span class="n">split_data</span><span class="p">[</span><span class="s2">&quot;corpus&quot;</span><span class="p">]])</span>

                <span class="n">relevant_docs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                    <span class="n">_process_relevant_docs</span><span class="p">(</span>
                        <span class="n">split_data</span><span class="p">[</span><span class="s2">&quot;relevant_docs&quot;</span><span class="p">],</span> <span class="n">hf_subset</span><span class="p">,</span> <span class="n">split</span>
                    <span class="p">)</span>
                <span class="p">)</span>

                <span class="k">if</span> <span class="s2">&quot;top_ranked&quot;</span> <span class="ow">in</span> <span class="n">split_data</span> <span class="ow">and</span> <span class="n">split_data</span><span class="p">[</span><span class="s2">&quot;top_ranked&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">top_ranked</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                        <span class="p">{</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">split</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">hf_subset</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="n">v</span>
                            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">split_data</span><span class="p">[</span><span class="s2">&quot;top_ranked&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                        <span class="p">}</span>
                    <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;default&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span> <span class="ow">and</span> <span class="n">split</span> <span class="o">!=</span> <span class="s2">&quot;default&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_descriptive_statistics_from_split</span><span class="p">(</span>
                    <span class="n">split</span><span class="o">=</span><span class="n">split</span><span class="p">,</span> <span class="n">hf_subset</span><span class="o">=</span><span class="s2">&quot;default&quot;</span>
                <span class="p">)</span>
            <span class="n">split_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">][</span><span class="n">split</span><span class="p">]</span>
            <span class="n">queries</span> <span class="o">=</span> <span class="n">split_data</span><span class="p">[</span><span class="s2">&quot;queries&quot;</span><span class="p">]</span>
            <span class="n">corpus</span> <span class="o">=</span> <span class="n">split_data</span><span class="p">[</span><span class="s2">&quot;corpus&quot;</span><span class="p">]</span>
            <span class="n">relevant_docs</span> <span class="o">=</span> <span class="n">split_data</span><span class="p">[</span><span class="s2">&quot;relevant_docs&quot;</span><span class="p">]</span>
            <span class="n">top_ranked</span> <span class="o">=</span> <span class="n">split_data</span><span class="p">[</span><span class="s2">&quot;top_ranked&quot;</span><span class="p">]</span>

        <span class="n">num_documents</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">corpus</span><span class="p">)</span>
        <span class="n">num_queries</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">queries</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">category</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">queries_modalities</span> <span class="o">=</span> <span class="s2">&quot;t&quot;</span>
            <span class="n">corpus_modalities</span> <span class="o">=</span> <span class="s2">&quot;t&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">queries_modalities</span><span class="p">,</span> <span class="n">corpus_modalities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;2&quot;</span><span class="p">)</span>

        <span class="n">number_of_characters</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">documents_text_statistics</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">documents_image_statistics</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">documents_audio_statistics</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">queries_text_statistics</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">queries_image_statistics</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">queries_audio_statistics</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="s2">&quot;t&quot;</span> <span class="ow">in</span> <span class="n">corpus_modalities</span><span class="p">:</span>
            <span class="n">corpus_texts</span> <span class="o">=</span> <span class="n">corpus</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">_corpus_to_dict</span><span class="p">)[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span>
            <span class="n">documents_text_statistics</span> <span class="o">=</span> <span class="n">calculate_text_statistics</span><span class="p">(</span><span class="n">corpus_texts</span><span class="p">)</span>
            <span class="n">number_of_characters</span> <span class="o">+=</span> <span class="n">documents_text_statistics</span><span class="p">[</span><span class="s2">&quot;total_text_length&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="s2">&quot;i&quot;</span> <span class="ow">in</span> <span class="n">corpus_modalities</span><span class="p">:</span>
            <span class="n">documents_image_statistics</span> <span class="o">=</span> <span class="n">calculate_image_statistics</span><span class="p">(</span><span class="n">corpus</span><span class="p">[</span><span class="s2">&quot;image&quot;</span><span class="p">])</span>

        <span class="k">if</span> <span class="s2">&quot;a&quot;</span> <span class="ow">in</span> <span class="n">corpus_modalities</span><span class="p">:</span>
            <span class="n">documents_audio_statistics</span> <span class="o">=</span> <span class="n">calculate_audio_statistics</span><span class="p">(</span><span class="n">corpus</span><span class="p">[</span><span class="s2">&quot;audio&quot;</span><span class="p">])</span>

        <span class="k">if</span> <span class="s2">&quot;t&quot;</span> <span class="ow">in</span> <span class="n">queries_modalities</span><span class="p">:</span>
            <span class="n">queries_</span> <span class="o">=</span> <span class="n">queries</span>
            <span class="k">if</span> <span class="s2">&quot;instruction&quot;</span> <span class="ow">in</span> <span class="n">queries_</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">queries_</span> <span class="o">=</span> <span class="n">queries_</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">_combine_queries_with_instruction_text</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">queries_</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="nb">dict</span> <span class="o">|</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">queries_</span> <span class="o">=</span> <span class="n">queries_</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">_convert_conv_history_to_query</span><span class="p">)</span>
            <span class="n">queries_text_statistics</span> <span class="o">=</span> <span class="n">calculate_text_statistics</span><span class="p">(</span><span class="n">queries_</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">])</span>

            <span class="n">number_of_characters</span> <span class="o">+=</span> <span class="n">queries_text_statistics</span><span class="p">[</span><span class="s2">&quot;total_text_length&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="s2">&quot;i&quot;</span> <span class="ow">in</span> <span class="n">queries_modalities</span><span class="p">:</span>
            <span class="n">queries_image_statistics</span> <span class="o">=</span> <span class="n">calculate_image_statistics</span><span class="p">(</span><span class="n">queries</span><span class="p">[</span><span class="s2">&quot;image&quot;</span><span class="p">])</span>

        <span class="k">if</span> <span class="s2">&quot;a&quot;</span> <span class="ow">in</span> <span class="n">queries_modalities</span><span class="p">:</span>
            <span class="n">queries_audio_statistics</span> <span class="o">=</span> <span class="n">calculate_audio_statistics</span><span class="p">(</span><span class="n">queries</span><span class="p">[</span><span class="s2">&quot;audio&quot;</span><span class="p">])</span>

        <span class="n">relevant_docs_statistics</span> <span class="o">=</span> <span class="n">calculate_relevant_docs_statistics</span><span class="p">(</span><span class="n">relevant_docs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">top_ranked</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">num_queries</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">top_ranked</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">top_ranked_statistics</span> <span class="o">=</span> <span class="n">calculate_top_ranked_statistics</span><span class="p">(</span>
                <span class="n">top_ranked</span><span class="p">,</span> <span class="n">num_queries</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">top_ranked_statistics</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">RetrievalDescriptiveStatistics</span><span class="p">(</span>
            <span class="n">num_samples</span><span class="o">=</span><span class="n">num_documents</span> <span class="o">+</span> <span class="n">num_queries</span><span class="p">,</span>
            <span class="n">number_of_characters</span><span class="o">=</span><span class="n">number_of_characters</span><span class="p">,</span>
            <span class="n">documents_text_statistics</span><span class="o">=</span><span class="n">documents_text_statistics</span><span class="p">,</span>
            <span class="n">documents_image_statistics</span><span class="o">=</span><span class="n">documents_image_statistics</span><span class="p">,</span>
            <span class="n">documents_audio_statistics</span><span class="o">=</span><span class="n">documents_audio_statistics</span><span class="p">,</span>
            <span class="n">queries_text_statistics</span><span class="o">=</span><span class="n">queries_text_statistics</span><span class="p">,</span>
            <span class="n">queries_image_statistics</span><span class="o">=</span><span class="n">queries_image_statistics</span><span class="p">,</span>
            <span class="n">queries_audio_statistics</span><span class="o">=</span><span class="n">queries_audio_statistics</span><span class="p">,</span>
            <span class="n">relevant_docs_statistics</span><span class="o">=</span><span class="n">relevant_docs_statistics</span><span class="p">,</span>
            <span class="n">top_ranked_statistics</span><span class="o">=</span><span class="n">top_ranked_statistics</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_push_dataset_to_hub</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">repo_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">num_proc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">convert_v1_dataset_format_to_v2</span><span class="p">(</span><span class="n">num_proc</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_push_section</span><span class="p">(</span>
            <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">RetrievalSplitData</span><span class="p">],</span>
            <span class="n">subset_item</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;corpus&quot;</span><span class="p">,</span> <span class="s2">&quot;queries&quot;</span><span class="p">,</span> <span class="s2">&quot;relevant_docs&quot;</span><span class="p">,</span> <span class="s2">&quot;top_ranked&quot;</span><span class="p">],</span>
            <span class="n">hf_subset_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
            <span class="n">converter</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Helper function to push dataset</span>

<span class="sd">            Args:</span>
<span class="sd">                data: Dataset with all items</span>
<span class="sd">                subset_item: Select which part to take. E. g. corpus, queries etc</span>
<span class="sd">                hf_subset_name: Name of the current item on HF</span>
<span class="sd">                converter: Function to convert dict to datasets format</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">sections</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">split</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="c1"># skip empty instructions and top ranked</span>
                <span class="k">if</span> <span class="n">subset_item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="n">split</span><span class="p">]</span> <span class="ow">or</span> <span class="n">data</span><span class="p">[</span><span class="n">split</span><span class="p">][</span><span class="n">subset_item</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">split</span><span class="p">][</span><span class="n">subset_item</span><span class="p">],</span> <span class="n">Dataset</span><span class="p">):</span>
                    <span class="n">sections</span><span class="p">[</span><span class="n">split</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">split</span><span class="p">][</span><span class="n">subset_item</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">converter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">subset_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">split</span><span class="p">][</span><span class="n">subset_item</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">subset_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">continue</span>

                    <span class="n">sections</span><span class="p">[</span><span class="n">split</span><span class="p">]</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span>
                        <span class="p">[</span><span class="n">converter</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">subset_data</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Unexpected subset item type </span><span class="si">{</span><span class="n">subset_item</span><span class="si">}</span><span class="s2"> without converter&quot;</span>
                    <span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sections</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">DatasetDict</span><span class="p">(</span><span class="n">sections</span><span class="p">)</span><span class="o">.</span><span class="n">push_to_hub</span><span class="p">(</span>
                    <span class="n">repo_name</span><span class="p">,</span>
                    <span class="n">hf_subset_name</span><span class="p">,</span>
                    <span class="n">commit_message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Add </span><span class="si">{</span><span class="n">hf_subset_name</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">subset_item</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">num_proc</span><span class="o">=</span><span class="n">num_proc</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="k">for</span> <span class="n">subset</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Converting </span><span class="si">{</span><span class="n">subset</span><span class="si">}</span><span class="s2"> of </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">_push_section</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">subset</span><span class="p">],</span>
                <span class="s2">&quot;queries&quot;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">subset</span><span class="si">}</span><span class="s2">-queries&quot;</span> <span class="k">if</span> <span class="n">subset</span> <span class="o">!=</span> <span class="s2">&quot;default&quot;</span> <span class="k">else</span> <span class="s2">&quot;queries&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">_push_section</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">subset</span><span class="p">],</span>
                <span class="s2">&quot;corpus&quot;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">subset</span><span class="si">}</span><span class="s2">-corpus&quot;</span> <span class="k">if</span> <span class="n">subset</span> <span class="o">!=</span> <span class="s2">&quot;default&quot;</span> <span class="k">else</span> <span class="s2">&quot;corpus&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="c1"># Handle relevant_docs separately since one entry expands to multiple records.</span>
            <span class="n">relevant_sections</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">split</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">subset</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">relevant_docs</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;relevant_docs&quot;</span><span class="p">]</span>
                <span class="n">entries</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">query_id</span><span class="p">,</span> <span class="n">docs</span> <span class="ow">in</span> <span class="n">relevant_docs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">for</span> <span class="n">doc_id</span><span class="p">,</span> <span class="n">score</span> <span class="ow">in</span> <span class="n">docs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="n">entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="p">{</span>
                                <span class="s2">&quot;query-id&quot;</span><span class="p">:</span> <span class="n">query_id</span><span class="p">,</span>
                                <span class="s2">&quot;corpus-id&quot;</span><span class="p">:</span> <span class="n">doc_id</span><span class="p">,</span>
                                <span class="s2">&quot;score&quot;</span><span class="p">:</span> <span class="n">score</span><span class="p">,</span>
                            <span class="p">}</span>
                        <span class="p">)</span>
                <span class="n">relevant_sections</span><span class="p">[</span><span class="n">split</span><span class="p">]</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span>
            <span class="n">DatasetDict</span><span class="p">(</span><span class="n">relevant_sections</span><span class="p">)</span><span class="o">.</span><span class="n">push_to_hub</span><span class="p">(</span>
                <span class="n">repo_name</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">subset</span><span class="si">}</span><span class="s2">-qrels&quot;</span> <span class="k">if</span> <span class="n">subset</span> <span class="o">!=</span> <span class="s2">&quot;default&quot;</span> <span class="k">else</span> <span class="s2">&quot;qrels&quot;</span><span class="p">,</span>
                <span class="n">commit_message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Add </span><span class="si">{</span><span class="n">subset</span><span class="si">}</span><span class="s2">-qrels&quot;</span><span class="p">,</span>
                <span class="n">num_proc</span><span class="o">=</span><span class="n">num_proc</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">_push_section</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">subset</span><span class="p">],</span>
                <span class="s2">&quot;top_ranked&quot;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">subset</span><span class="si">}</span><span class="s2">-top_ranked&quot;</span> <span class="k">if</span> <span class="n">subset</span> <span class="o">!=</span> <span class="s2">&quot;default&quot;</span> <span class="k">else</span> <span class="s2">&quot;top_ranked&quot;</span><span class="p">,</span>
                <span class="k">lambda</span> <span class="n">idx</span><span class="p">,</span> <span class="n">docs</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;query-id&quot;</span><span class="p">:</span> <span class="n">idx</span><span class="p">,</span> <span class="s2">&quot;corpus-ids&quot;</span><span class="p">:</span> <span class="n">docs</span><span class="p">},</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">convert_to_reranking</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">top_ranked_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">,</span>
        <span class="n">top_k</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Converts a reranking task to re-ranking by loading predictions from previous model run where the `prediction_folder` was specified.</span>

<span class="sd">        Args:</span>
<span class="sd">            top_ranked_path: Path to file or folder with the top ranked predictions.</span>
<span class="sd">            top_k: Number of results to load.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The current task reformulated as a reranking task</span>

<span class="sd">        Raises:</span>
<span class="sd">            FileNotFoundError: If the specified path does not exist.</span>
<span class="sd">            ValueError: If the loaded top ranked results are not in the expected format.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_top_k</span> <span class="o">=</span> <span class="n">top_k</span>

        <span class="n">top_ranked_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">top_ranked_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">top_ranked_path</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
            <span class="n">top_ranked_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_predictions_path</span><span class="p">(</span><span class="n">top_ranked_path</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">top_ranked_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Can&#39;t find previous results for this task. File </span><span class="si">{</span><span class="n">top_ranked_path</span><span class="si">}</span><span class="s2"> does not exist.&quot;</span>
            <span class="p">)</span>

        <span class="k">with</span> <span class="n">top_ranked_path</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">previous_results_file</span><span class="p">:</span>
            <span class="n">previous_results</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">previous_results_file</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_loaded</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_data</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_previous_results_model_meta</span> <span class="o">=</span> <span class="n">previous_results</span><span class="p">[</span><span class="s2">&quot;mteb_model_meta&quot;</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">subset</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">split</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">subset</span><span class="p">]:</span>
                <span class="n">top_ranked</span><span class="p">:</span> <span class="n">RetrievalOutputType</span> <span class="o">=</span> <span class="n">previous_results</span><span class="p">[</span><span class="n">subset</span><span class="p">][</span><span class="n">split</span><span class="p">]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">top_ranked</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Previous top ranked results is not a dictionary.&quot;</span><span class="p">)</span>

                <span class="n">top_k_sorted</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">query_id</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">top_ranked</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">sorted_keys</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">k</span><span class="p">:</span> <span class="n">values</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">top_k_sorted</span><span class="p">[</span><span class="n">query_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">sorted_keys</span><span class="p">[:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_top_k</span><span class="p">]</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">subset</span><span class="p">][</span><span class="n">split</span><span class="p">][</span><span class="s2">&quot;top_ranked&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">top_k_sorted</span>
        <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="mteb.abstasks.retrieval.AbsTaskRetrieval.convert_to_reranking" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">convert_to_reranking</span><span class="p">(</span><span class="n">top_ranked_path</span><span class="p">,</span> <span class="n">top_k</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span></code>

<a href="#mteb.abstasks.retrieval.AbsTaskRetrieval.convert_to_reranking" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Converts a reranking task to re-ranking by loading predictions from previous model run where the <code>prediction_folder</code> was specified.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>top_ranked_path</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to file or folder with the top ranked predictions.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>top_k</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of results to load.</p>
              </div>
            </td>
            <td>
                  <code>10</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing_extensions.Self">Self</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The current task reformulated as a reranking task</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="FileNotFoundError">FileNotFoundError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the specified path does not exist.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the loaded top ranked results are not in the expected format.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>mteb/abstasks/retrieval.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">convert_to_reranking</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">top_ranked_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">top_k</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts a reranking task to re-ranking by loading predictions from previous model run where the `prediction_folder` was specified.</span>

<span class="sd">    Args:</span>
<span class="sd">        top_ranked_path: Path to file or folder with the top ranked predictions.</span>
<span class="sd">        top_k: Number of results to load.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The current task reformulated as a reranking task</span>

<span class="sd">    Raises:</span>
<span class="sd">        FileNotFoundError: If the specified path does not exist.</span>
<span class="sd">        ValueError: If the loaded top ranked results are not in the expected format.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_top_k</span> <span class="o">=</span> <span class="n">top_k</span>

    <span class="n">top_ranked_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">top_ranked_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">top_ranked_path</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
        <span class="n">top_ranked_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_predictions_path</span><span class="p">(</span><span class="n">top_ranked_path</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">top_ranked_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Can&#39;t find previous results for this task. File </span><span class="si">{</span><span class="n">top_ranked_path</span><span class="si">}</span><span class="s2"> does not exist.&quot;</span>
        <span class="p">)</span>

    <span class="k">with</span> <span class="n">top_ranked_path</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">previous_results_file</span><span class="p">:</span>
        <span class="n">previous_results</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">previous_results_file</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_loaded</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_data</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_previous_results_model_meta</span> <span class="o">=</span> <span class="n">previous_results</span><span class="p">[</span><span class="s2">&quot;mteb_model_meta&quot;</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">subset</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">split</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">subset</span><span class="p">]:</span>
            <span class="n">top_ranked</span><span class="p">:</span> <span class="n">RetrievalOutputType</span> <span class="o">=</span> <span class="n">previous_results</span><span class="p">[</span><span class="n">subset</span><span class="p">][</span><span class="n">split</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">top_ranked</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Previous top ranked results is not a dictionary.&quot;</span><span class="p">)</span>

            <span class="n">top_k_sorted</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">query_id</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">top_ranked</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">sorted_keys</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">k</span><span class="p">:</span> <span class="n">values</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">top_k_sorted</span><span class="p">[</span><span class="n">query_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">sorted_keys</span><span class="p">[:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_top_k</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">subset</span><span class="p">][</span><span class="n">split</span><span class="p">][</span><span class="s2">&quot;top_ranked&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">top_k_sorted</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="mteb.abstasks.retrieval.AbsTaskRetrieval.convert_v1_dataset_format_to_v2" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">convert_v1_dataset_format_to_v2</span><span class="p">(</span><span class="n">num_proc</span><span class="p">)</span></code>

<a href="#mteb.abstasks.retrieval.AbsTaskRetrieval.convert_v1_dataset_format_to_v2" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Convert dataset from v1 (from <code>self.queries</code>, <code>self.document</code>) format to v2 format (<code>self.dotaset</code>).</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>mteb/abstasks/retrieval.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">convert_v1_dataset_format_to_v2</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">num_proc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert dataset from v1 (from `self.queries`, `self.document`) format to v2 format (`self.dotaset`).&quot;&quot;&quot;</span>
    <span class="c1"># check if dataset is `v1` version</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;queries&quot;</span><span class="p">):</span>
        <span class="k">return</span>
    <span class="n">empty_dataset</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">from_dict</span><span class="p">({})</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span>
        <span class="k">lambda</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">(</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="n">RetrievalSplitData</span><span class="p">(</span>
                <span class="n">corpus</span><span class="o">=</span><span class="n">empty_dataset</span><span class="p">,</span>
                <span class="n">queries</span><span class="o">=</span><span class="n">empty_dataset</span><span class="p">,</span>
                <span class="n">relevant_docs</span><span class="o">=</span><span class="p">{},</span>
                <span class="n">top_ranked</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_process_split</span><span class="p">(</span>
        <span class="n">ds_queries</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="n">Dataset</span><span class="p">,</span> <span class="n">ds_corpus</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="n">Dataset</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Dataset</span><span class="p">,</span> <span class="n">Dataset</span><span class="p">]:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ds_queries</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">queries</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span>
                <span class="p">[{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">k</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">v</span><span class="p">}</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">ds_queries</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ds_queries</span><span class="p">,</span> <span class="n">Dataset</span><span class="p">):</span>
            <span class="n">queries</span> <span class="o">=</span> <span class="n">ds_queries</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Can&#39;t convert queries of type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">ds_queries</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ds_corpus</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">corpus</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">k</span><span class="p">,</span>
                        <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">v</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">v</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">],</span>
                        <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                    <span class="p">}</span>
                    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">ds_corpus</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="p">]</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ds_corpus</span><span class="p">,</span> <span class="n">Dataset</span><span class="p">):</span>
            <span class="n">corpus</span> <span class="o">=</span> <span class="n">ds_corpus</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Can&#39;t convert corpus of type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">ds_corpus</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">queries</span><span class="p">,</span> <span class="n">corpus</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">is_multilingual</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">subset</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">queries</span><span class="p">:</span>  <span class="c1"># type: ignore[attr-defined]</span>
            <span class="k">for</span> <span class="n">split</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">queries</span><span class="p">[</span><span class="n">subset</span><span class="p">]:</span>  <span class="c1"># type: ignore[attr-defined]</span>
                <span class="n">queries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">queries</span><span class="p">[</span><span class="n">subset</span><span class="p">][</span><span class="n">split</span><span class="p">]</span>  <span class="c1"># type: ignore[attr-defined]</span>
                <span class="n">corpus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">corpus</span><span class="p">[</span><span class="n">subset</span><span class="p">][</span><span class="n">split</span><span class="p">]</span>  <span class="c1"># type: ignore[attr-defined]</span>

                <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">subset</span><span class="p">][</span><span class="n">split</span><span class="p">][</span><span class="s2">&quot;queries&quot;</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">subset</span><span class="p">][</span><span class="n">split</span><span class="p">][</span><span class="s2">&quot;corpus&quot;</span><span class="p">],</span>
                <span class="p">)</span> <span class="o">=</span> <span class="n">_process_split</span><span class="p">(</span><span class="n">queries</span><span class="p">,</span> <span class="n">corpus</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">subset</span><span class="p">][</span><span class="n">split</span><span class="p">][</span><span class="s2">&quot;relevant_docs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">relevant_docs</span><span class="p">[</span>  <span class="c1"># type: ignore[attr-defined]</span>
                    <span class="n">subset</span>
                <span class="p">][</span><span class="n">split</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;instructions&quot;</span><span class="p">):</span>
                    <span class="n">instructions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">instructions</span><span class="p">[</span><span class="n">subset</span><span class="p">][</span><span class="n">split</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">subset</span><span class="p">][</span><span class="n">split</span><span class="p">][</span><span class="s2">&quot;queries&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">_combine_queries_with_instructions_datasets</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">subset</span><span class="p">][</span><span class="n">split</span><span class="p">][</span><span class="s2">&quot;queries&quot;</span><span class="p">],</span>
                            <span class="n">instructions</span><span class="p">,</span>
                            <span class="n">num_proc</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;top_ranked&quot;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">subset</span><span class="p">][</span><span class="n">split</span><span class="p">][</span><span class="s2">&quot;top_ranked&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">top_ranked</span><span class="p">[</span>
                        <span class="n">subset</span>
                    <span class="p">][</span><span class="n">split</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">subset</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span>
        <span class="k">for</span> <span class="n">split</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">queries</span><span class="p">:</span>  <span class="c1"># type: ignore[attr-defined]</span>
            <span class="n">queries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">queries</span><span class="p">[</span><span class="n">split</span><span class="p">]</span>  <span class="c1"># type: ignore[attr-defined]</span>
            <span class="n">corpus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">corpus</span><span class="p">[</span><span class="n">split</span><span class="p">]</span>  <span class="c1"># type: ignore[attr-defined]</span>
            <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">subset</span><span class="p">][</span><span class="n">split</span><span class="p">][</span><span class="s2">&quot;queries&quot;</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">subset</span><span class="p">][</span><span class="n">split</span><span class="p">][</span><span class="s2">&quot;corpus&quot;</span><span class="p">],</span>
            <span class="p">)</span> <span class="o">=</span> <span class="n">_process_split</span><span class="p">(</span><span class="n">queries</span><span class="p">,</span> <span class="n">corpus</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">subset</span><span class="p">][</span><span class="n">split</span><span class="p">][</span><span class="s2">&quot;relevant_docs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">relevant_docs</span><span class="p">[</span>  <span class="c1"># type: ignore[attr-defined]</span>
                <span class="n">split</span>
            <span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;instructions&quot;</span><span class="p">):</span>
                <span class="n">instructions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">instructions</span><span class="p">[</span><span class="n">split</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">subset</span><span class="p">][</span><span class="n">split</span><span class="p">][</span><span class="s2">&quot;queries&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">_combine_queries_with_instructions_datasets</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">subset</span><span class="p">][</span><span class="n">split</span><span class="p">][</span><span class="s2">&quot;queries&quot;</span><span class="p">],</span>
                        <span class="n">instructions</span><span class="p">,</span>
                        <span class="n">num_proc</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;top_ranked&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">top_ranked</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">subset</span><span class="p">][</span><span class="n">split</span><span class="p">][</span><span class="s2">&quot;top_ranked&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">top_ranked</span><span class="p">[</span>
                    <span class="n">split</span>
                <span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">queries</span>  <span class="c1"># type: ignore[attr-defined]</span>
    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">corpus</span>  <span class="c1"># type: ignore[attr-defined]</span>
    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">relevant_docs</span>  <span class="c1"># type: ignore[attr-defined]</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;instructions&quot;</span><span class="p">):</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">instructions</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;top_ranked&quot;</span><span class="p">):</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">top_ranked</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="mteb.abstasks.retrieval.AbsTaskRetrieval.evaluate" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">evaluate</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="n">subsets_to_run</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">encode_kwargs</span><span class="p">,</span> <span class="n">prediction_folder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_proc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

<a href="#mteb.abstasks.retrieval.AbsTaskRetrieval.evaluate" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Evaluate the model on the retrieval task.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;highlight language-python&quot;&gt;&lt;span class=&quot;n&quot;&gt;mteb&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;models&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;MTEBModels&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;EncoderProtocol&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CrossEncoderProtocol&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SearchProtocol&lt;/span&gt;&lt;/code&gt;

  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;mteb.models.MTEBModels&lt;/code&gt;)" href="../model/#mteb.models.MTEBModels">MTEBModels</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Model to evaluate. Model should implement the <a class="autorefs autorefs-internal" title="&lt;code&gt;mteb.models.SearchProtocol&lt;/code&gt;" href="../model/#mteb.models.SearchProtocol">SearchProtocol</a>
or be an <a class="autorefs autorefs-internal" title="&lt;code&gt;mteb.models.EncoderProtocol&lt;/code&gt;" href="../model/#mteb.models.EncoderProtocol">Encoder</a> or <a class="autorefs autorefs-internal" title="&lt;code&gt;mteb.models.CrossEncoderProtocol&lt;/code&gt;" href="../model/#mteb.models.CrossEncoderProtocol">CrossEncoderProtocol</a>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>split</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Split to evaluate on</p>
              </div>
            </td>
            <td>
                  <code>&#39;test&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>subsets_to_run</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<a class="autorefs autorefs-internal" title="&lt;code class=&quot;highlight language-python&quot;&gt;&lt;span class=&quot;n&quot;&gt;HFSubset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;str&lt;/span&gt;&lt;/code&gt;

  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;mteb.types.HFSubset&lt;/code&gt;)" href="../types/#mteb.types._result.HFSubset">HFSubset</a>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional list of subsets to evaluate on</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>encode_kwargs</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="&lt;code&gt;EncodeKwargs&lt;/code&gt; (&lt;code&gt;mteb.types.EncodeKwargs&lt;/code&gt;)" href="../types/#mteb.types._encoder_io.EncodeKwargs">EncodeKwargs</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Keyword arguments passed to the encoder</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>prediction_folder</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Folder to save model predictions</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_proc</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of processes to use</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional keyword arguments passed to the evaluator</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="collections.abc.Mapping">Mapping</span>[<a class="autorefs autorefs-internal" title="&lt;code class=&quot;highlight language-python&quot;&gt;&lt;span class=&quot;n&quot;&gt;HFSubset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;str&lt;/span&gt;&lt;/code&gt;

  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;mteb.types.HFSubset&lt;/code&gt;)" href="../types/#mteb.types._result.HFSubset">HFSubset</a>, <a class="autorefs autorefs-internal" title="&lt;code class=&quot;highlight language-python&quot;&gt;&lt;span class=&quot;n&quot;&gt;ScoresDict&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Mapping&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;str&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Score&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;/code&gt;

  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;mteb.types.ScoresDict&lt;/code&gt;)" href="../types/#mteb.types._result.ScoresDict">ScoresDict</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary mapping subsets to their evaluation scores</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>mteb/abstasks/retrieval.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">evaluate</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">model</span><span class="p">:</span> <span class="n">MTEBModels</span><span class="p">,</span>
    <span class="n">split</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;test&quot;</span><span class="p">,</span>
    <span class="n">subsets_to_run</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">HFSubset</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">encode_kwargs</span><span class="p">:</span> <span class="n">EncodeKwargs</span><span class="p">,</span>
    <span class="n">prediction_folder</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">num_proc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">HFSubset</span><span class="p">,</span> <span class="n">ScoresDict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Evaluate the model on the retrieval task.</span>

<span class="sd">    Args:</span>
<span class="sd">        model: Model to evaluate. Model should implement the [SearchProtocol][mteb.models.models_protocols.SearchProtocol]</span>
<span class="sd">            or be an [Encoder][mteb.models.models_protocols.EncoderProtocol] or [CrossEncoderProtocol][mteb.models.models_protocols.CrossEncoderProtocol].</span>
<span class="sd">        split: Split to evaluate on</span>
<span class="sd">        subsets_to_run: Optional list of subsets to evaluate on</span>
<span class="sd">        encode_kwargs: Keyword arguments passed to the encoder</span>
<span class="sd">        prediction_folder: Folder to save model predictions</span>
<span class="sd">        num_proc: Number of processes to use</span>
<span class="sd">        **kwargs: Additional keyword arguments passed to the evaluator</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dictionary mapping subsets to their evaluation scores</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_loaded</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_data</span><span class="p">(</span><span class="n">num_proc</span><span class="o">=</span><span class="n">num_proc</span><span class="p">)</span>
    <span class="c1"># TODO: convert all tasks directly https://github.com/embeddings-benchmark/mteb/issues/2030</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">convert_v1_dataset_format_to_v2</span><span class="p">(</span><span class="n">num_proc</span><span class="o">=</span><span class="n">num_proc</span><span class="p">)</span>

    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span>
        <span class="n">model</span><span class="p">,</span>
        <span class="n">split</span><span class="p">,</span>
        <span class="n">subsets_to_run</span><span class="p">,</span>
        <span class="n">encode_kwargs</span><span class="o">=</span><span class="n">encode_kwargs</span><span class="p">,</span>
        <span class="n">prediction_folder</span><span class="o">=</span><span class="n">prediction_folder</span><span class="p">,</span>
        <span class="n">num_proc</span><span class="o">=</span><span class="n">num_proc</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="mteb.abstasks.retrieval.AbsTaskRetrieval.load_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_data</span><span class="p">(</span><span class="n">num_proc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

<a href="#mteb.abstasks.retrieval.AbsTaskRetrieval.load_data" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Load the dataset for the retrieval task.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>mteb/abstasks/retrieval.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">load_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_proc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load the dataset for the retrieval task.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_loaded</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="n">dataset_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">]</span>
    <span class="n">eval_splits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_splits</span>
    <span class="n">trust_remote_code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;trust_remote_code&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">revision</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="s2">&quot;revision&quot;</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_process_data</span><span class="p">(</span><span class="n">split</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">hf_subset</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Helper function to load and process data for a given split and language&quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Loading </span><span class="si">{</span><span class="n">split</span><span class="si">}</span><span class="s2"> split for </span><span class="si">{</span><span class="n">hf_subset</span><span class="si">}</span><span class="s2"> subset of </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">hf_subset</span><span class="p">][</span><span class="n">split</span><span class="p">]</span> <span class="o">=</span> <span class="n">RetrievalDatasetLoader</span><span class="p">(</span>
            <span class="n">hf_repo</span><span class="o">=</span><span class="n">dataset_path</span><span class="p">,</span>
            <span class="n">revision</span><span class="o">=</span><span class="n">revision</span><span class="p">,</span>
            <span class="n">trust_remote_code</span><span class="o">=</span><span class="n">trust_remote_code</span><span class="p">,</span>
            <span class="n">split</span><span class="o">=</span><span class="n">split</span><span class="p">,</span>
            <span class="n">config</span><span class="o">=</span><span class="n">hf_subset</span><span class="p">,</span>
        <span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
            <span class="n">num_proc</span><span class="o">=</span><span class="n">num_proc</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">is_multilingual</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">lang</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hf_subsets</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">split</span> <span class="ow">in</span> <span class="n">eval_splits</span><span class="p">:</span>
                <span class="n">_process_data</span><span class="p">(</span><span class="n">split</span><span class="p">,</span> <span class="n">lang</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">split</span> <span class="ow">in</span> <span class="n">eval_splits</span><span class="p">:</span>
            <span class="n">_process_data</span><span class="p">(</span><span class="n">split</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dataset_transform</span><span class="p">(</span><span class="n">num_proc</span><span class="o">=</span><span class="n">num_proc</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data_loaded</span> <span class="o">=</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="mteb.abstasks.retrieval.AbsTaskRetrieval.task_specific_scores" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">task_specific_scores</span><span class="p">(</span><span class="n">scores</span><span class="p">,</span> <span class="n">qrels</span><span class="p">,</span> <span class="n">results</span><span class="p">,</span> <span class="n">hf_split</span><span class="p">,</span> <span class="n">hf_subset</span><span class="p">)</span></code>

<a href="#mteb.abstasks.retrieval.AbsTaskRetrieval.task_specific_scores" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Calculate task specific scores. Override in subclass if needed.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>scores</code>
            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="dict">dict</span>[<span title="str">str</span>, <span title="float">float</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary of scores</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>qrels</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;highlight language-python&quot;&gt;&lt;span class=&quot;n&quot;&gt;RelevantDocumentsType&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Mapping&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;str&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Mapping&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;str&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]]&lt;/span&gt;&lt;/code&gt;

  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;mteb.types.RelevantDocumentsType&lt;/code&gt;)" href="../types/#mteb.types._encoder_io.RelevantDocumentsType">RelevantDocumentsType</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Relevant documents</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>results</code>
            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="dict">dict</span>[<span title="str">str</span>, <span title="float">float</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Retrieval results</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>hf_split</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Split to evaluate on</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>hf_subset</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Subset to evaluate on</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>mteb/abstasks/retrieval.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">task_specific_scores</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">scores</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]],</span>
    <span class="n">qrels</span><span class="p">:</span> <span class="n">RelevantDocumentsType</span><span class="p">,</span>
    <span class="n">results</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]],</span>
    <span class="n">hf_split</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">hf_subset</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate task specific scores. Override in subclass if needed.</span>

<span class="sd">    Args:</span>
<span class="sd">        scores: Dictionary of scores</span>
<span class="sd">        qrels: Relevant documents</span>
<span class="sd">        results: Retrieval results</span>
<span class="sd">        hf_split: Split to evaluate on</span>
<span class="sd">        hf_subset: Subset to evaluate on</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">{}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="mteb.abstasks.retrieval_dataset_loaders.RetrievalSplitData" class="doc doc-heading">
            <code>mteb.abstasks.retrieval_dataset_loaders.RetrievalSplitData</code>


<a href="#mteb.abstasks.retrieval_dataset_loaders.RetrievalSplitData" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><span title="typing.TypedDict">TypedDict</span></code></p>



        <p>A dictionary containing the corpus, queries, relevant documents, instructions, and top-ranked documents for a retrieval task.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.retrieval_dataset_loaders.RetrievalSplitData.corpus">corpus</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;highlight language-python&quot;&gt;&lt;span class=&quot;n&quot;&gt;CorpusDatasetType&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Dataset&lt;/span&gt;&lt;/code&gt;

  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;mteb.types.CorpusDatasetType&lt;/code&gt;)" href="../types/#mteb.types._encoder_io.CorpusDatasetType">CorpusDatasetType</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The corpus dataset containing documents. Should have columns <code>id</code>, <code>title</code>, <code>text</code> or <code>image</code>.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.retrieval_dataset_loaders.RetrievalSplitData.queries">queries</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;highlight language-python&quot;&gt;&lt;span class=&quot;n&quot;&gt;QueryDatasetType&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Dataset&lt;/span&gt;&lt;/code&gt;

  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;mteb.types.QueryDatasetType&lt;/code&gt;)" href="../types/#mteb.types._encoder_io.QueryDatasetType">QueryDatasetType</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The queries dataset containing queries. Should have columns <code>id</code>, <code>text</code>, <code>instruction</code> (for instruction retrieval/reranking) or <code>image</code>.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.retrieval_dataset_loaders.RetrievalSplitData.relevant_docs">relevant_docs</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;highlight language-python&quot;&gt;&lt;span class=&quot;n&quot;&gt;RelevantDocumentsType&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Mapping&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;str&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Mapping&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;str&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]]&lt;/span&gt;&lt;/code&gt;

  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;mteb.types.RelevantDocumentsType&lt;/code&gt;)" href="../types/#mteb.types._encoder_io.RelevantDocumentsType">RelevantDocumentsType</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A mapping of query IDs to relevant document IDs and their relevance scores. Should have columns <code>query-id</code>, <code>corpus-id</code>, <code>score</code>.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.retrieval_dataset_loaders.RetrievalSplitData.top_ranked">top_ranked</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;highlight language-python&quot;&gt;&lt;span class=&quot;n&quot;&gt;TopRankedDocumentsType&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Mapping&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;str&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;list&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;str&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]]&lt;/span&gt;&lt;/code&gt;

  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;mteb.types.TopRankedDocumentsType&lt;/code&gt;)" href="../types/#mteb.types._encoder_io.TopRankedDocumentsType">TopRankedDocumentsType</a> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A mapping of query IDs to a list of top-ranked document IDs. Should have columns <code>query-id</code>, <code>corpus-ids</code> (list[str]). This is optional and used for reranking tasks.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>mteb/abstasks/retrieval_dataset_loaders.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">RetrievalSplitData</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A dictionary containing the corpus, queries, relevant documents, instructions, and top-ranked documents for a retrieval task.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        corpus: The corpus dataset containing documents. Should have columns `id`, `title`, `text` or `image`.</span>
<span class="sd">        queries: The queries dataset containing queries. Should have columns `id`, `text`, `instruction` (for instruction retrieval/reranking) or `image`.</span>
<span class="sd">        relevant_docs: A mapping of query IDs to relevant document IDs and their relevance scores. Should have columns `query-id`, `corpus-id`, `score`.</span>
<span class="sd">        top_ranked: A mapping of query IDs to a list of top-ranked document IDs. Should have columns `query-id`, `corpus-ids` (list[str]). This is optional and used for reranking tasks.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">corpus</span><span class="p">:</span> <span class="n">CorpusDatasetType</span>
    <span class="n">queries</span><span class="p">:</span> <span class="n">QueryDatasetType</span>
    <span class="n">relevant_docs</span><span class="p">:</span> <span class="n">RelevantDocumentsType</span>
    <span class="n">top_ranked</span><span class="p">:</span> <span class="n">TopRankedDocumentsType</span> <span class="o">|</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="mteb.abstasks.classification.AbsTaskClassification" class="doc doc-heading">
            <code>mteb.abstasks.classification.AbsTaskClassification</code>


<a href="#mteb.abstasks.classification.AbsTaskClassification" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="&lt;code&gt;mteb.AbsTask&lt;/code&gt; (&lt;code&gt;mteb.abstasks.abstask.AbsTask&lt;/code&gt;)" href="#mteb.AbsTask">AbsTask</a></code></p>



        <p>The class which classification tasks inherit from.</p>
<p>A classification task consists of a dataset with input data and corresponding labels. The task is to predict the label for each input.
The task works by training a sklearn compatible model on samples drawn from the training split of the dataset,
where the input data is encoded using the provided model.
The trained model is then evaluated on the evaluation split of the dataset. This process is repeated for <code>n_experiments</code> times, and both average and
individual scores for each experiment are reported.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.classification.AbsTaskClassification.dataset">dataset</span></code></td>
            <td>
                  <code><span title="dict">dict</span>[<a class="autorefs autorefs-internal" title="&lt;code class=&quot;highlight language-python&quot;&gt;&lt;span class=&quot;n&quot;&gt;HFSubset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;str&lt;/span&gt;&lt;/code&gt;

  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;mteb.types.HFSubset&lt;/code&gt;)" href="../types/#mteb.types._result.HFSubset">HFSubset</a>, <span title="datasets.DatasetDict">DatasetDict</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Hugging Face dataset containing the data for the task. Should have train split (split name can be changed by train_split. Must contain the following columns:
text: str (for text) or PIL.Image (for image). Column name can be changed via <code>input_column_name</code> attribute.
label: int. Column name can be changed via <code>label_column_name</code> attribute.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.classification.AbsTaskClassification.evaluator_model">evaluator_model</span></code></td>
            <td>
                  <code><span title="mteb._evaluators.sklearn_evaluator.SklearnModelProtocol">SklearnModelProtocol</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The model to use for evaluation. Can be any sklearn compatible model. Default is <code>LogisticRegression</code>.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.classification.AbsTaskClassification.samples_per_label">samples_per_label</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of samples per label to use for training the evaluator model. Default is 8.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.classification.AbsTaskClassification.n_experiments">n_experiments</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of experiments to run. Default is 10.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.classification.AbsTaskClassification.train_split">train_split</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the split to use for training the evaluator model. Default is "train".</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.classification.AbsTaskClassification.label_column_name">label_column_name</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the column containing the labels. Default is "label".</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.classification.AbsTaskClassification.input_column_name">input_column_name</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the column containing the input data. Default is "text".</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.classification.AbsTaskClassification.abstask_prompt">abstask_prompt</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Prompt to use for the task for instruction model if not prompt is provided in TaskMetadata.prompt.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.classification.AbsTaskClassification.is_cross_validation">is_cross_validation</span></code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Is task cross validation</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.classification.AbsTaskClassification.n_splits">n_splits</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of splits for cross-validation</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>mteb/abstasks/classification.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">AbsTaskClassification</span><span class="p">(</span><span class="n">AbsTask</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The class which classification tasks inherit from.</span>

<span class="sd">    A classification task consists of a dataset with input data and corresponding labels. The task is to predict the label for each input.</span>
<span class="sd">    The task works by training a sklearn compatible model on samples drawn from the training split of the dataset,</span>
<span class="sd">    where the input data is encoded using the provided model.</span>
<span class="sd">    The trained model is then evaluated on the evaluation split of the dataset. This process is repeated for `n_experiments` times, and both average and</span>
<span class="sd">    individual scores for each experiment are reported.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        dataset: Hugging Face dataset containing the data for the task. Should have train split (split name can be changed by train_split. Must contain the following columns:</span>
<span class="sd">            text: str (for text) or PIL.Image (for image). Column name can be changed via `input_column_name` attribute.</span>
<span class="sd">            label: int. Column name can be changed via `label_column_name` attribute.</span>
<span class="sd">        evaluator_model: The model to use for evaluation. Can be any sklearn compatible model. Default is `LogisticRegression`.</span>
<span class="sd">        samples_per_label: Number of samples per label to use for training the evaluator model. Default is 8.</span>
<span class="sd">        n_experiments: Number of experiments to run. Default is 10.</span>
<span class="sd">        train_split: Name of the split to use for training the evaluator model. Default is &quot;train&quot;.</span>
<span class="sd">        label_column_name: Name of the column containing the labels. Default is &quot;label&quot;.</span>
<span class="sd">        input_column_name: Name of the column containing the input data. Default is &quot;text&quot;.</span>
<span class="sd">        abstask_prompt: Prompt to use for the task for instruction model if not prompt is provided in TaskMetadata.prompt.</span>
<span class="sd">        is_cross_validation: Is task cross validation</span>
<span class="sd">        n_splits: Number of splits for cross-validation</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">evaluator</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">SklearnEvaluator</span><span class="p">]</span> <span class="o">=</span> <span class="n">SklearnEvaluator</span>
    <span class="n">evaluator_model</span><span class="p">:</span> <span class="n">SklearnModelProtocol</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">(</span>
        <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">max_iter</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">samples_per_label</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">8</span>
    <span class="n">n_experiments</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">train_split</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;train&quot;</span>
    <span class="n">label_column_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;label&quot;</span>
    <span class="n">input_column_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;text&quot;</span>
    <span class="n">abstask_prompt</span> <span class="o">=</span> <span class="s2">&quot;Classify user passages.&quot;</span>
    <span class="n">is_cross_validation</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">n_splits</span> <span class="o">=</span> <span class="mi">5</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">evaluate</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">MTEBModels</span><span class="p">,</span>
        <span class="n">split</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;test&quot;</span><span class="p">,</span>
        <span class="n">subsets_to_run</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">HFSubset</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">encode_kwargs</span><span class="p">:</span> <span class="n">EncodeKwargs</span><span class="p">,</span>
        <span class="n">prediction_folder</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">num_proc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">HFSubset</span><span class="p">,</span> <span class="n">ScoresDict</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Evaluate a model on the classification task.</span>

<span class="sd">        Differs from other tasks as it requires train split.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">EncoderProtocol</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Model </span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s2"> is a SearchProtocol, but this task </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> does not support Search. &quot;</span>
                <span class="s2">&quot;Please use a Encoder model instead.&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_loaded</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_data</span><span class="p">(</span><span class="n">num_proc</span><span class="o">=</span><span class="n">num_proc</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Dataset not loaded.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;random_state&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluator_model</span><span class="o">.</span><span class="n">get_params</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">evaluator_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluator_model</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span>
                <span class="n">random_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span>
            <span class="p">)</span>
        <span class="n">scores</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">hf_subsets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hf_subsets</span>
        <span class="k">if</span> <span class="n">subsets_to_run</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">hf_subsets</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">hf_subsets</span> <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">subsets_to_run</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">hf_subset</span> <span class="ow">in</span> <span class="n">hf_subsets</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Task: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, split: </span><span class="si">{</span><span class="n">split</span><span class="si">}</span><span class="s2">, subset: </span><span class="si">{</span><span class="n">hf_subset</span><span class="si">}</span><span class="s2">. Running...&quot;</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">hf_subset</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span> <span class="ow">and</span> <span class="n">hf_subset</span> <span class="o">==</span> <span class="s2">&quot;default&quot;</span><span class="p">:</span>
                <span class="n">ds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">hf_subset</span><span class="p">]</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">Dataset</span> <span class="o">|</span> <span class="n">DatasetDict</span><span class="p">):</span>
                <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">select_columns</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">label_column_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_column_name</span><span class="p">])</span>
            <span class="n">eval_function</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_subset</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_cross_validation</span>
                <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_subset_cross_validation</span>
            <span class="p">)</span>
            <span class="n">scores</span><span class="p">[</span><span class="n">hf_subset</span><span class="p">]</span> <span class="o">=</span> <span class="n">eval_function</span><span class="p">(</span>
                <span class="n">model</span><span class="p">,</span>
                <span class="n">ds</span><span class="p">,</span>
                <span class="n">hf_split</span><span class="o">=</span><span class="n">split</span><span class="p">,</span>
                <span class="n">hf_subset</span><span class="o">=</span><span class="n">hf_subset</span><span class="p">,</span>
                <span class="n">encode_kwargs</span><span class="o">=</span><span class="n">encode_kwargs</span><span class="p">,</span>
                <span class="n">prediction_folder</span><span class="o">=</span><span class="n">prediction_folder</span><span class="p">,</span>
                <span class="n">num_proc</span><span class="o">=</span><span class="n">num_proc</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_main_score</span><span class="p">(</span><span class="n">scores</span><span class="p">[</span><span class="n">hf_subset</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">scores</span>  <span class="c1"># type: ignore[return-value]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_evaluate_subset</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">MTEBModels</span><span class="p">,</span>
        <span class="n">data_split</span><span class="p">:</span> <span class="n">DatasetDict</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">encode_kwargs</span><span class="p">:</span> <span class="n">EncodeKwargs</span><span class="p">,</span>
        <span class="n">hf_split</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">hf_subset</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">prediction_folder</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">num_proc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FullClassificationMetrics</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">EncoderProtocol</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Expected model to be an instance of EncoderProtocol&quot;</span><span class="p">)</span>

        <span class="n">train_split</span> <span class="o">=</span> <span class="n">data_split</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">train_split</span><span class="p">]</span>
        <span class="n">eval_split</span> <span class="o">=</span> <span class="n">data_split</span><span class="p">[</span><span class="n">hf_split</span><span class="p">]</span>

        <span class="n">scores</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># we store idxs to make the shuffling reproducible</span>
        <span class="n">test_cache</span><span class="p">,</span> <span class="n">idxs</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

        <span class="n">all_predictions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_experiments</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Running experiment (</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">n_experiments</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
            <span class="n">scores_exp</span><span class="p">,</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">idxs</span><span class="p">,</span> <span class="n">test_cache</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_experiment</span><span class="p">(</span>
                <span class="n">model</span><span class="p">,</span>
                <span class="n">train_split</span><span class="p">,</span>
                <span class="n">eval_split</span><span class="p">,</span>
                <span class="n">experiment_num</span><span class="o">=</span><span class="n">i</span><span class="p">,</span>
                <span class="n">idxs</span><span class="o">=</span><span class="n">idxs</span><span class="p">,</span>
                <span class="n">test_cache</span><span class="o">=</span><span class="n">test_cache</span><span class="p">,</span>
                <span class="n">encode_kwargs</span><span class="o">=</span><span class="n">encode_kwargs</span><span class="p">,</span>
                <span class="n">hf_split</span><span class="o">=</span><span class="n">hf_split</span><span class="p">,</span>
                <span class="n">hf_subset</span><span class="o">=</span><span class="n">hf_subset</span><span class="p">,</span>
                <span class="n">num_proc</span><span class="o">=</span><span class="n">num_proc</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">prediction_folder</span><span class="p">:</span>
                <span class="n">all_predictions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">predictions</span><span class="p">)</span>
            <span class="n">scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scores_exp</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">prediction_folder</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_save_task_predictions</span><span class="p">(</span>
                <span class="n">all_predictions</span><span class="p">,</span>
                <span class="n">model</span><span class="p">,</span>
                <span class="n">prediction_folder</span><span class="p">,</span>
                <span class="n">hf_subset</span><span class="o">=</span><span class="n">hf_subset</span><span class="p">,</span>
                <span class="n">hf_split</span><span class="o">=</span><span class="n">hf_split</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_avg_scores</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_evaluate_subset_cross_validation</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">EncoderProtocol</span><span class="p">,</span>
        <span class="n">data_split</span><span class="p">:</span> <span class="n">DatasetDict</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">encode_kwargs</span><span class="p">:</span> <span class="n">EncodeKwargs</span><span class="p">,</span>
        <span class="n">hf_split</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">hf_subset</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">prediction_folder</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">num_proc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FullClassificationMetrics</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_split</span> <span class="o">!=</span> <span class="n">hf_split</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Performing </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">n_splits</span><span class="si">}</span><span class="s2">-fold cross validation, but the dataset has a train (`</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">train_split</span><span class="si">}</span><span class="s2">`) and test split (`</span><span class="si">{</span><span class="n">hf_split</span><span class="si">}</span><span class="s2">`)! Set `is_cross_validation` to False, and retry.&quot;</span>
            <span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Performing </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">n_splits</span><span class="si">}</span><span class="s2">-fold cross-validation on the entire dataset!&quot;</span>
        <span class="p">)</span>

        <span class="n">ds</span> <span class="o">=</span> <span class="n">data_split</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">train_split</span><span class="p">]</span>
        <span class="n">num_samples</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>

        <span class="n">scores</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">idxs</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">cross_validation_splitter</span> <span class="o">=</span> <span class="n">KFold</span><span class="p">(</span>
            <span class="n">n_splits</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_splits</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span>
        <span class="p">)</span>
        <span class="n">all_predictions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">dataloader_train</span> <span class="o">=</span> <span class="n">create_dataloader</span><span class="p">(</span>
            <span class="n">ds</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span>
            <span class="n">input_column</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">input_column_name</span><span class="p">,</span>
            <span class="n">num_proc</span><span class="o">=</span><span class="n">num_proc</span><span class="p">,</span>
            <span class="o">**</span><span class="n">encode_kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Running cross-validation - Encoding samples...&quot;</span><span class="p">)</span>
        <span class="c1"># precompute all embeddings for cross-validation to not recomupute them in different k-folds</span>
        <span class="n">dataset_embeddings</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
            <span class="n">dataloader_train</span><span class="p">,</span>
            <span class="n">task_metadata</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span>
            <span class="n">hf_split</span><span class="o">=</span><span class="n">hf_split</span><span class="p">,</span>
            <span class="n">hf_subset</span><span class="o">=</span><span class="n">hf_subset</span><span class="p">,</span>
            <span class="o">**</span><span class="n">encode_kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">train_idx</span><span class="p">,</span> <span class="n">val_idx</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
            <span class="n">cross_validation_splitter</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">num_samples</span><span class="p">))</span>
        <span class="p">):</span>
            <span class="n">train_split</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">train_idx</span><span class="p">)</span>
            <span class="n">eval_split</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">val_idx</span><span class="p">)</span>
            <span class="n">train_cache</span> <span class="o">=</span> <span class="n">dataset_embeddings</span><span class="p">[</span><span class="n">train_idx</span><span class="p">]</span>
            <span class="n">test_cache</span> <span class="o">=</span> <span class="n">dataset_embeddings</span><span class="p">[</span><span class="n">val_idx</span><span class="p">]</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Running experiment (</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">n_experiments</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
            <span class="n">scores_exp</span><span class="p">,</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">idxs</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_experiment</span><span class="p">(</span>
                <span class="n">model</span><span class="p">,</span>
                <span class="n">train_split</span><span class="p">,</span>
                <span class="n">eval_split</span><span class="p">,</span>
                <span class="n">experiment_num</span><span class="o">=</span><span class="n">i</span><span class="p">,</span>
                <span class="n">idxs</span><span class="o">=</span><span class="n">idxs</span><span class="p">,</span>
                <span class="n">encode_kwargs</span><span class="o">=</span><span class="n">encode_kwargs</span><span class="p">,</span>
                <span class="n">hf_split</span><span class="o">=</span><span class="n">hf_split</span><span class="p">,</span>
                <span class="n">hf_subset</span><span class="o">=</span><span class="n">hf_subset</span><span class="p">,</span>
                <span class="n">test_cache</span><span class="o">=</span><span class="n">test_cache</span><span class="p">,</span>
                <span class="n">train_cache</span><span class="o">=</span><span class="n">train_cache</span><span class="p">,</span>
                <span class="n">num_proc</span><span class="o">=</span><span class="n">num_proc</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">prediction_folder</span><span class="p">:</span>
                <span class="n">all_predictions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">predictions</span><span class="p">)</span>
            <span class="n">scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scores_exp</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">prediction_folder</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_save_task_predictions</span><span class="p">(</span>
                <span class="n">all_predictions</span><span class="p">,</span>
                <span class="n">model</span><span class="p">,</span>
                <span class="n">prediction_folder</span><span class="p">,</span>
                <span class="n">hf_subset</span><span class="o">=</span><span class="n">hf_subset</span><span class="p">,</span>
                <span class="n">hf_split</span><span class="o">=</span><span class="n">hf_split</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_avg_scores</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_run_experiment</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">EncoderProtocol</span><span class="p">,</span>
        <span class="n">train_split</span><span class="p">:</span> <span class="n">Dataset</span><span class="p">,</span>
        <span class="n">eval_split</span><span class="p">:</span> <span class="n">Dataset</span><span class="p">,</span>
        <span class="n">experiment_num</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">idxs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">test_cache</span><span class="p">:</span> <span class="n">Array</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">encode_kwargs</span><span class="p">:</span> <span class="n">EncodeKwargs</span><span class="p">,</span>
        <span class="n">hf_split</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">hf_subset</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">train_cache</span><span class="p">:</span> <span class="n">Array</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">num_proc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">ClassificationMetrics</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">Array</span><span class="p">]:</span>
        <span class="n">train_dataset</span><span class="p">,</span> <span class="n">idxs</span><span class="p">,</span> <span class="n">selected_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_undersample_data</span><span class="p">(</span>
            <span class="n">train_split</span><span class="p">,</span>
            <span class="n">experiment_num</span><span class="p">,</span>
            <span class="n">idxs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">sub_train_cache</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">train_cache</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sub_train_cache</span> <span class="o">=</span> <span class="n">train_cache</span><span class="p">[</span><span class="n">selected_idx</span><span class="p">]</span>

        <span class="n">evaluator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluator</span><span class="p">(</span>
            <span class="n">train_dataset</span><span class="p">,</span>
            <span class="n">eval_split</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input_column_name</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">label_column_name</span><span class="p">,</span>
            <span class="n">task_metadata</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span>
            <span class="n">hf_split</span><span class="o">=</span><span class="n">hf_split</span><span class="p">,</span>
            <span class="n">hf_subset</span><span class="o">=</span><span class="n">hf_subset</span><span class="p">,</span>
            <span class="n">evaluator_model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">evaluator_model</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">y_pred</span><span class="p">,</span> <span class="n">test_cache</span> <span class="o">=</span> <span class="n">evaluator</span><span class="p">(</span>
            <span class="n">model</span><span class="p">,</span>
            <span class="n">encode_kwargs</span><span class="o">=</span><span class="n">encode_kwargs</span><span class="p">,</span>
            <span class="n">test_cache</span><span class="o">=</span><span class="n">test_cache</span><span class="p">,</span>
            <span class="n">train_cache</span><span class="o">=</span><span class="n">sub_train_cache</span><span class="p">,</span>
            <span class="n">num_proc</span><span class="o">=</span><span class="n">num_proc</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">y_test</span> <span class="o">=</span> <span class="n">eval_split</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">label_column_name</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_scores</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">),</span> <span class="n">y_pred</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">idxs</span><span class="p">,</span> <span class="n">test_cache</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_calculate_avg_scores</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">scores</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ClassificationMetrics</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FullClassificationMetrics</span><span class="p">:</span>
        <span class="n">avg_scores</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="c1"># ap will be none for non binary classification tasks</span>
            <span class="n">k</span><span class="p">:</span> <span class="p">(</span>
                <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">values</span><span class="p">))</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">values</span> <span class="o">:=</span> <span class="p">[</span><span class="n">s</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">scores</span> <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">])</span>  <span class="c1"># type: ignore[literal-required]</span>
                <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">scores</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Running </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> - Finished.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">FullClassificationMetrics</span><span class="p">(</span>
            <span class="n">scores_per_experiment</span><span class="o">=</span><span class="n">scores</span><span class="p">,</span>
            <span class="o">**</span><span class="n">avg_scores</span><span class="p">,</span>  <span class="c1"># type: ignore[typeddict-item]</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_calculate_scores</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">y_test</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">]</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
        <span class="n">y_pred</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">integer</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ClassificationMetrics</span><span class="p">:</span>
        <span class="n">scores</span> <span class="o">=</span> <span class="n">ClassificationMetrics</span><span class="p">(</span>
            <span class="n">accuracy</span><span class="o">=</span><span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">),</span>
            <span class="n">f1</span><span class="o">=</span><span class="n">f1_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s2">&quot;macro&quot;</span><span class="p">),</span>
            <span class="n">f1_weighted</span><span class="o">=</span><span class="n">f1_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s2">&quot;weighted&quot;</span><span class="p">),</span>
            <span class="n">precision</span><span class="o">=</span><span class="n">precision_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s2">&quot;macro&quot;</span><span class="p">),</span>
            <span class="n">precision_weighted</span><span class="o">=</span><span class="n">precision_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s2">&quot;weighted&quot;</span><span class="p">),</span>
            <span class="n">recall</span><span class="o">=</span><span class="n">recall_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s2">&quot;macro&quot;</span><span class="p">),</span>
            <span class="n">recall_weighted</span><span class="o">=</span><span class="n">recall_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s2">&quot;weighted&quot;</span><span class="p">),</span>
            <span class="n">ap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">ap_weighted</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># if binary classification</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">y_test</span><span class="p">))</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">scores</span><span class="p">[</span><span class="s2">&quot;ap&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">average_precision_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s2">&quot;macro&quot;</span><span class="p">)</span>
            <span class="n">scores</span><span class="p">[</span><span class="s2">&quot;ap_weighted&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">average_precision_score</span><span class="p">(</span>
                <span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s2">&quot;weighted&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">scores</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_undersample_data</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">dataset</span><span class="p">:</span> <span class="n">Dataset</span><span class="p">,</span> <span class="n">experiment_num</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">idxs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Dataset</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Undersample data to have `samples_per_label` samples of each label.</span>

<span class="sd">        Args:</span>
<span class="sd">            dataset: Hugging Face `datasets.Dataset` containing &quot;text&quot; and &quot;label&quot;.</span>
<span class="sd">            experiment_num: Experiment number, used to set the random seed.</span>
<span class="sd">            idxs: Optional indices to shuffle and sample from.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple of:</span>
<span class="sd">            - A new Dataset containing undersampled examples.</span>
<span class="sd">            - The shuffled indices used for sampling.</span>
<span class="sd">            - Selected indexes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">idxs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">idxs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="p">)))</span>

        <span class="c1"># using RandomState for backward compatibility with `v1`</span>
        <span class="n">rng_state</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>
        <span class="n">rng_state</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">idxs</span><span class="p">)</span>

        <span class="n">label_counter</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">sampled_idxs</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idxs</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">label_column_name</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">label_counter</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">samples_per_label</span><span class="p">:</span>
                <span class="n">sampled_idxs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="n">label_counter</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="n">dataset</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">sampled_idxs</span><span class="p">),</span> <span class="n">idxs</span><span class="p">,</span> <span class="n">sampled_idxs</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_calculate_descriptive_statistics_from_split</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">split</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">hf_subset</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">compute_overall</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ClassificationDescriptiveStatistics</span><span class="p">:</span>
        <span class="n">train_text</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">hf_subset</span><span class="p">:</span>
            <span class="n">inputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">hf_subset</span><span class="p">][</span><span class="n">split</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">input_column_name</span><span class="p">]</span>
            <span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">hf_subset</span><span class="p">][</span><span class="n">split</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">label_column_name</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">split</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_split</span><span class="p">:</span>
                <span class="n">train_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">hf_subset</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">train_split</span><span class="p">][</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">input_column_name</span>
                <span class="p">]</span>
        <span class="k">elif</span> <span class="n">compute_overall</span><span class="p">:</span>
            <span class="n">inputs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">label</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">hf_subset</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">eval_langs</span><span class="p">:</span>
                <span class="n">inputs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">hf_subset</span><span class="p">][</span><span class="n">split</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">input_column_name</span><span class="p">])</span>
                <span class="n">label</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">hf_subset</span><span class="p">][</span><span class="n">split</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">label_column_name</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">split</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_split</span><span class="p">:</span>
                    <span class="n">train_text</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">hf_subset</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">train_split</span><span class="p">][</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">input_column_name</span>
                        <span class="p">]</span>
                    <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">inputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">split</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">input_column_name</span><span class="p">]</span>
            <span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">split</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">label_column_name</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">split</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_split</span><span class="p">:</span>
                <span class="n">train_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">train_split</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">input_column_name</span><span class="p">]</span>

        <span class="n">image_statistics</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">text_statistics</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">audio_statistics</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">num_texts_in_train</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="s2">&quot;image&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">modalities</span><span class="p">:</span>
            <span class="n">image_statistics</span> <span class="o">=</span> <span class="n">calculate_image_statistics</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;text&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">modalities</span><span class="p">:</span>
            <span class="n">text_statistics</span> <span class="o">=</span> <span class="n">calculate_text_statistics</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
            <span class="n">num_texts_in_train</span> <span class="o">=</span> <span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">train_text</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">split</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_split</span>
                <span class="k">else</span> <span class="kc">None</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;audio&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">modalities</span><span class="p">:</span>
            <span class="n">audio_statistics</span> <span class="o">=</span> <span class="n">calculate_audio_statistics</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>

        <span class="n">label_statistics</span> <span class="o">=</span> <span class="n">calculate_label_statistics</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ClassificationDescriptiveStatistics</span><span class="p">(</span>
            <span class="n">num_samples</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">inputs</span><span class="p">),</span>
            <span class="n">number_texts_intersect_with_train</span><span class="o">=</span><span class="n">num_texts_in_train</span><span class="p">,</span>
            <span class="n">text_statistics</span><span class="o">=</span><span class="n">text_statistics</span><span class="p">,</span>
            <span class="n">image_statistics</span><span class="o">=</span><span class="n">image_statistics</span><span class="p">,</span>
            <span class="n">audio_statistics</span><span class="o">=</span><span class="n">audio_statistics</span><span class="p">,</span>
            <span class="n">label_statistics</span><span class="o">=</span><span class="n">label_statistics</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_push_dataset_to_hub</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">repo_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">num_proc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_upload_dataset_to_hub</span><span class="p">(</span>
            <span class="n">repo_name</span><span class="p">,</span>
            <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">input_column_name</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">label_column_name</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="n">num_proc</span><span class="o">=</span><span class="n">num_proc</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="mteb.abstasks.classification.AbsTaskClassification.evaluate" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">evaluate</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="n">subsets_to_run</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">encode_kwargs</span><span class="p">,</span> <span class="n">prediction_folder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_proc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

<a href="#mteb.abstasks.classification.AbsTaskClassification.evaluate" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Evaluate a model on the classification task.</p>
<p>Differs from other tasks as it requires train split.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>mteb/abstasks/classification.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">evaluate</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">model</span><span class="p">:</span> <span class="n">MTEBModels</span><span class="p">,</span>
    <span class="n">split</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;test&quot;</span><span class="p">,</span>
    <span class="n">subsets_to_run</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">HFSubset</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">encode_kwargs</span><span class="p">:</span> <span class="n">EncodeKwargs</span><span class="p">,</span>
    <span class="n">prediction_folder</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">num_proc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">HFSubset</span><span class="p">,</span> <span class="n">ScoresDict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Evaluate a model on the classification task.</span>

<span class="sd">    Differs from other tasks as it requires train split.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">EncoderProtocol</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Model </span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s2"> is a SearchProtocol, but this task </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> does not support Search. &quot;</span>
            <span class="s2">&quot;Please use a Encoder model instead.&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_loaded</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_data</span><span class="p">(</span><span class="n">num_proc</span><span class="o">=</span><span class="n">num_proc</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Dataset not loaded.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;random_state&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluator_model</span><span class="o">.</span><span class="n">get_params</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evaluator_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluator_model</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span>
            <span class="n">random_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span>
        <span class="p">)</span>
    <span class="n">scores</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">hf_subsets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hf_subsets</span>
    <span class="k">if</span> <span class="n">subsets_to_run</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">hf_subsets</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">hf_subsets</span> <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">subsets_to_run</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">hf_subset</span> <span class="ow">in</span> <span class="n">hf_subsets</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Task: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, split: </span><span class="si">{</span><span class="n">split</span><span class="si">}</span><span class="s2">, subset: </span><span class="si">{</span><span class="n">hf_subset</span><span class="si">}</span><span class="s2">. Running...&quot;</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">hf_subset</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span> <span class="ow">and</span> <span class="n">hf_subset</span> <span class="o">==</span> <span class="s2">&quot;default&quot;</span><span class="p">:</span>
            <span class="n">ds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">hf_subset</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">Dataset</span> <span class="o">|</span> <span class="n">DatasetDict</span><span class="p">):</span>
            <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">select_columns</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">label_column_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_column_name</span><span class="p">])</span>
        <span class="n">eval_function</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_subset</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_cross_validation</span>
            <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_subset_cross_validation</span>
        <span class="p">)</span>
        <span class="n">scores</span><span class="p">[</span><span class="n">hf_subset</span><span class="p">]</span> <span class="o">=</span> <span class="n">eval_function</span><span class="p">(</span>
            <span class="n">model</span><span class="p">,</span>
            <span class="n">ds</span><span class="p">,</span>
            <span class="n">hf_split</span><span class="o">=</span><span class="n">split</span><span class="p">,</span>
            <span class="n">hf_subset</span><span class="o">=</span><span class="n">hf_subset</span><span class="p">,</span>
            <span class="n">encode_kwargs</span><span class="o">=</span><span class="n">encode_kwargs</span><span class="p">,</span>
            <span class="n">prediction_folder</span><span class="o">=</span><span class="n">prediction_folder</span><span class="p">,</span>
            <span class="n">num_proc</span><span class="o">=</span><span class="n">num_proc</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_main_score</span><span class="p">(</span><span class="n">scores</span><span class="p">[</span><span class="n">hf_subset</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">scores</span>  <span class="c1"># type: ignore[return-value]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="mteb.abstasks.multilabel_classification.AbsTaskMultilabelClassification" class="doc doc-heading">
            <code>mteb.abstasks.multilabel_classification.AbsTaskMultilabelClassification</code>


<a href="#mteb.abstasks.multilabel_classification.AbsTaskMultilabelClassification" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="&lt;code&gt;mteb.abstasks.classification.AbsTaskClassification&lt;/code&gt;" href="#mteb.abstasks.classification.AbsTaskClassification">AbsTaskClassification</a></code></p>



        <p>Abstract class for multioutput classification tasks</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.multilabel_classification.AbsTaskMultilabelClassification.dataset">dataset</span></code></td>
            <td>
                  <code><span title="dict">dict</span>[<a class="autorefs autorefs-internal" title="&lt;code class=&quot;highlight language-python&quot;&gt;&lt;span class=&quot;n&quot;&gt;HFSubset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;str&lt;/span&gt;&lt;/code&gt;

  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;mteb.types.HFSubset&lt;/code&gt;)" href="../types/#mteb.types._result.HFSubset">HFSubset</a>, <span title="datasets.DatasetDict">DatasetDict</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Huggingface dataset containing the data for the task. Dataset must contain columns specified by input_column_name and label_column_name.
Input column must contain the text or image to be classified, and label column must contain a list of labels for each example.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.multilabel_classification.AbsTaskMultilabelClassification.input_column_name">input_column_name</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the column containing the input text.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.multilabel_classification.AbsTaskMultilabelClassification.label_column_name">label_column_name</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the column containing the labels.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.multilabel_classification.AbsTaskMultilabelClassification.samples_per_label">samples_per_label</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of samples to use pr. label. These samples are embedded and a classifier is fit using the labels and samples.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.multilabel_classification.AbsTaskMultilabelClassification.evaluator_model">evaluator_model</span></code></td>
            <td>
                  <code><span title="mteb._evaluators.sklearn_evaluator.SklearnModelProtocol">SklearnModelProtocol</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Classifier to use for evaluation. Must implement the SklearnModelProtocol.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>mteb/abstasks/multilabel_classification.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">AbsTaskMultilabelClassification</span><span class="p">(</span><span class="n">AbsTaskClassification</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Abstract class for multioutput classification tasks</span>

<span class="sd">    Attributes:</span>
<span class="sd">        dataset: Huggingface dataset containing the data for the task. Dataset must contain columns specified by input_column_name and label_column_name.</span>
<span class="sd">            Input column must contain the text or image to be classified, and label column must contain a list of labels for each example.</span>
<span class="sd">        input_column_name: Name of the column containing the input text.</span>
<span class="sd">        label_column_name: Name of the column containing the labels.</span>
<span class="sd">        samples_per_label: Number of samples to use pr. label. These samples are embedded and a classifier is fit using the labels and samples.</span>
<span class="sd">        evaluator_model: Classifier to use for evaluation. Must implement the SklearnModelProtocol.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">evaluator_model</span><span class="p">:</span> <span class="n">SklearnModelProtocol</span> <span class="o">=</span> <span class="n">KNeighborsClassifier</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">input_column_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;text&quot;</span>
    <span class="n">label_column_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;label&quot;</span>

    <span class="nd">@override</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_evaluate_subset</span><span class="p">(</span>  <span class="c1"># type: ignore[override]</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">MTEBModels</span><span class="p">,</span>
        <span class="n">data_split</span><span class="p">:</span> <span class="n">DatasetDict</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">encode_kwargs</span><span class="p">:</span> <span class="n">EncodeKwargs</span><span class="p">,</span>
        <span class="n">hf_split</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">hf_subset</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">prediction_folder</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">num_proc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FullMultilabelClassificationMetrics</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">EncoderProtocol</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Expected model to be an instance of EncoderProtocol&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data_split</span><span class="p">,</span> <span class="n">DatasetDict</span><span class="p">):</span>
            <span class="n">data_split</span> <span class="o">=</span> <span class="n">data_split</span><span class="o">.</span><span class="n">select_columns</span><span class="p">(</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">input_column_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_column_name</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="n">train_split</span> <span class="o">=</span> <span class="n">data_split</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">train_split</span><span class="p">]</span>
        <span class="n">eval_split</span> <span class="o">=</span> <span class="n">data_split</span><span class="p">[</span><span class="n">hf_split</span><span class="p">]</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;Running multilabel classification task - Sampling training data...&quot;</span>
        <span class="p">)</span>
        <span class="n">scores</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Bootstrap sample indices from training set for each experiment</span>
        <span class="n">train_samples</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_experiments</span><span class="p">):</span>
            <span class="n">sample_indices</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_undersample_data_indices</span><span class="p">(</span>
                <span class="n">train_split</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">label_column_name</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">samples_per_label</span><span class="p">,</span> <span class="kc">None</span>
            <span class="p">)</span>
            <span class="n">train_samples</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sample_indices</span><span class="p">)</span>
        <span class="c1"># Encode all unique sentences at the indices</span>
        <span class="n">unique_train_indices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span><span class="n">train_samples</span><span class="p">)))</span>
        <span class="n">unique_train_dataset</span> <span class="o">=</span> <span class="n">train_split</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">unique_train_indices</span><span class="p">)</span><span class="o">.</span><span class="n">select_columns</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input_column_name</span>
        <span class="p">)</span>
        <span class="n">dataloader_train</span> <span class="o">=</span> <span class="n">create_dataloader</span><span class="p">(</span>
            <span class="n">unique_train_dataset</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span>
            <span class="n">input_column</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">input_column_name</span><span class="p">,</span>
            <span class="n">num_proc</span><span class="o">=</span><span class="n">num_proc</span><span class="p">,</span>
            <span class="o">**</span><span class="n">encode_kwargs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Running multilabel classification - Encoding training set...&quot;</span><span class="p">)</span>
        <span class="n">_unique_train_embeddings</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
            <span class="n">dataloader_train</span><span class="p">,</span>
            <span class="n">task_metadata</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span>
            <span class="n">hf_split</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">train_split</span><span class="p">,</span>
            <span class="n">hf_subset</span><span class="o">=</span><span class="n">hf_subset</span><span class="p">,</span>
            <span class="o">**</span><span class="n">encode_kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">unique_train_embeddings</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="nb">zip</span><span class="p">(</span><span class="n">unique_train_indices</span><span class="p">,</span> <span class="n">_unique_train_embeddings</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="c1"># Stratified subsampling of test set to 2000 examples.</span>
        <span class="n">test_dataset</span> <span class="o">=</span> <span class="n">eval_split</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">test_dataset</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2000</span><span class="p">:</span>
                <span class="n">split_dataset</span> <span class="o">=</span> <span class="n">eval_split</span><span class="o">.</span><span class="n">train_test_split</span><span class="p">(</span>
                    <span class="n">test_size</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">stratify_by_column</span><span class="o">=</span><span class="s2">&quot;label&quot;</span>
                <span class="p">)</span>
                <span class="n">test_dataset</span> <span class="o">=</span> <span class="n">split_dataset</span><span class="p">[</span><span class="s2">&quot;test&quot;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Couldn&#39;t subsample, continuing with the entire test set.&quot;</span><span class="p">)</span>

        <span class="n">dataloader_test</span> <span class="o">=</span> <span class="n">create_dataloader</span><span class="p">(</span>
            <span class="n">test_dataset</span><span class="o">.</span><span class="n">select_columns</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_column_name</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span>
            <span class="n">input_column</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">input_column_name</span><span class="p">,</span>
            <span class="o">**</span><span class="n">encode_kwargs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Running multilabel classification - Encoding test set...&quot;</span><span class="p">)</span>
        <span class="n">X_test</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
            <span class="n">dataloader_test</span><span class="p">,</span>
            <span class="n">task_metadata</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span>
            <span class="n">hf_split</span><span class="o">=</span><span class="n">hf_split</span><span class="p">,</span>
            <span class="n">hf_subset</span><span class="o">=</span><span class="n">hf_subset</span><span class="p">,</span>
            <span class="o">**</span><span class="n">encode_kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">binarizer</span> <span class="o">=</span> <span class="n">MultiLabelBinarizer</span><span class="p">()</span>
        <span class="n">y_test</span> <span class="o">=</span> <span class="n">binarizer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">test_dataset</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">label_column_name</span><span class="p">])</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Running multilabel classification - Evaluating classifiers...&quot;</span><span class="p">)</span>
        <span class="n">all_predictions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">sample_indices</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">train_samples</span><span class="p">):</span>
            <span class="n">X_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">unique_train_embeddings</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">sample_indices</span><span class="p">])</span>
            <span class="n">y_train</span> <span class="o">=</span> <span class="n">train_split</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">sample_indices</span><span class="p">)[</span><span class="bp">self</span><span class="o">.</span><span class="n">label_column_name</span><span class="p">]</span>
            <span class="n">y_train</span> <span class="o">=</span> <span class="n">binarizer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">y_train</span><span class="p">)</span>
            <span class="n">y_pred</span><span class="p">,</span> <span class="n">current_classifier</span> <span class="o">=</span> <span class="n">_evaluate_classifier</span><span class="p">(</span>
                <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluator_model</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">prediction_folder</span><span class="p">:</span>
                <span class="n">all_predictions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y_pred</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

            <span class="n">scores_exp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_scores</span><span class="p">(</span>
                <span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">current_classifier</span>
            <span class="p">)</span>
            <span class="n">scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scores_exp</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">prediction_folder</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_save_task_predictions</span><span class="p">(</span>
                <span class="n">all_predictions</span><span class="p">,</span>
                <span class="n">model</span><span class="p">,</span>
                <span class="n">prediction_folder</span><span class="p">,</span>
                <span class="n">hf_subset</span><span class="o">=</span><span class="n">hf_subset</span><span class="p">,</span>
                <span class="n">hf_split</span><span class="o">=</span><span class="n">hf_split</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="n">avg_scores</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">k</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">s</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">scores</span><span class="p">])</span>  <span class="c1"># type: ignore[literal-required]</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">scores</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Running multilabel classification - Finished.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">FullMultilabelClassificationMetrics</span><span class="p">(</span>
            <span class="n">scores_per_experiment</span><span class="o">=</span><span class="n">scores</span><span class="p">,</span>
            <span class="o">**</span><span class="n">avg_scores</span><span class="p">,</span>  <span class="c1"># type: ignore[typeddict-item]</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_calculate_scores</span><span class="p">(</span>  <span class="c1"># type: ignore[override]</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">y_test</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">],</span>
        <span class="n">y_pred</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">integer</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">],</span>
        <span class="n">x_test_embedding</span><span class="p">:</span> <span class="n">Array</span><span class="p">,</span>
        <span class="n">current_classifier</span><span class="p">:</span> <span class="n">SklearnModelProtocol</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MultilabelClassificationMetrics</span><span class="p">:</span>
        <span class="n">accuracy</span> <span class="o">=</span> <span class="n">current_classifier</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">x_test_embedding</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">current_classifier</span><span class="p">,</span> <span class="n">MultiOutputClassifier</span><span class="p">):</span>
            <span class="n">predictions</span> <span class="o">=</span> <span class="n">current_classifier</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">x_test_embedding</span><span class="p">)</span>
            <span class="n">all_probs</span> <span class="o">=</span> <span class="p">[</span><span class="n">emb</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">emb</span> <span class="ow">in</span> <span class="n">predictions</span><span class="p">]</span>

            <span class="n">y_score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">all_probs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># shape: (n_samples, n_labels)</span>
            <span class="n">lrap</span> <span class="o">=</span> <span class="n">label_ranking_average_precision_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_score</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lrap</span> <span class="o">=</span> <span class="n">label_ranking_average_precision_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
        <span class="n">f1</span> <span class="o">=</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s2">&quot;macro&quot;</span><span class="p">)</span>
        <span class="n">hamming</span> <span class="o">=</span> <span class="n">hamming_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">MultilabelClassificationMetrics</span><span class="p">(</span>
            <span class="n">accuracy</span><span class="o">=</span><span class="n">accuracy</span><span class="p">,</span>
            <span class="n">lrap</span><span class="o">=</span><span class="n">lrap</span><span class="p">,</span>
            <span class="n">f1</span><span class="o">=</span><span class="n">f1</span><span class="p">,</span>
            <span class="n">hamming</span><span class="o">=</span><span class="n">hamming</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_undersample_data_indices</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]],</span> <span class="n">samples_per_label</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">idxs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Undersample data to have samples_per_label samples of each label.</span>

<span class="sd">        Currently ensures that each label has at least samples_per_label samples.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A tuple containing:</span>
<span class="sd">                - List of sampled indices.</span>
<span class="sd">                - List of all indices after shuffling.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sample_indices</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">idxs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">idxs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">np_rng</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">idxs</span><span class="p">)</span>
        <span class="n">label_counter</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idxs</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">((</span><span class="n">label_counter</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">samples_per_label</span><span class="p">)</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
                <span class="n">sample_indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                    <span class="n">label_counter</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">sample_indices</span><span class="p">,</span> <span class="n">idxs</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="mteb.abstasks.clustering.AbsTaskClustering" class="doc doc-heading">
            <code>mteb.abstasks.clustering.AbsTaskClustering</code>


<a href="#mteb.abstasks.clustering.AbsTaskClustering" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="&lt;code&gt;mteb.AbsTask&lt;/code&gt; (&lt;code&gt;mteb.abstasks.abstask.AbsTask&lt;/code&gt;)" href="#mteb.AbsTask">AbsTask</a></code></p>



        <p>The abstract class for clustering tasks.</p>
<p>A clustering task consists of a dataset with input data and corresponding cluster labels. The task is to cluster the input data points and compare
the cluster assignments with the true cluster labels using V-measure.
This class embeds the corpus sentences then samples N samples from the corpus and clusters them. The similarity then is calculated using multiple
measures, including a V-measure. This approach is then repeated K times.</p>
<p>If the clustering is hierarchical and more than one label is specified in order for each observation, we compute the metrics as outlined
for each level separately.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.clustering.AbsTaskClustering.dataset">dataset</span></code></td>
            <td>
                  <code><span title="dict">dict</span>[<a class="autorefs autorefs-internal" title="&lt;code class=&quot;highlight language-python&quot;&gt;&lt;span class=&quot;n&quot;&gt;HFSubset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;str&lt;/span&gt;&lt;/code&gt;

  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;mteb.types.HFSubset&lt;/code&gt;)" href="../types/#mteb.types._result.HFSubset">HFSubset</a>, <span title="datasets.DatasetDict">DatasetDict</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A HuggingFace Dataset containing the data for the clustering task. Must contain the following columns <code>sentences</code> that contains
inputs (texts or images) and labels columns.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.clustering.AbsTaskClustering.max_fraction_of_documents_to_embed">max_fraction_of_documents_to_embed</span></code></td>
            <td>
                  <code><span title="float">float</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Fraction of documents to embed for clustering. Cannot be set at the same time as <code>max_document_to_embed</code>.
If both are set to None, the entire dataset will be embedded for clustering.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.clustering.AbsTaskClustering.max_document_to_embed">max_document_to_embed</span></code></td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of documents to embed for clustering. Cannot be set at the same time as <code>max_fraction_of_documents_to_embed</code>.
If both are set to None, the entire dataset will be embedded for clustering.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.clustering.AbsTaskClustering.max_documents_per_cluster">max_documents_per_cluster</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of documents to sample for each clustering experiment.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.clustering.AbsTaskClustering.n_clusters">n_clusters</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of clustering experiments to run.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.clustering.AbsTaskClustering.k_mean_batch_size">k_mean_batch_size</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Batch size to use for k-means clustering.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.clustering.AbsTaskClustering.max_depth">max_depth</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum depth to evaluate clustering. If None, evaluates all levels.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.clustering.AbsTaskClustering.input_column_name">input_column_name</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the column containing the input sentences or data points.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.clustering.AbsTaskClustering.label_column_name">label_column_name</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the column containing the true cluster labels.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.clustering.AbsTaskClustering.abstask_prompt">abstask_prompt</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Prompt to use for the task for instruction model if not prompt is provided in TaskMetadata.prompt.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>mteb/abstasks/clustering.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">AbsTaskClustering</span><span class="p">(</span><span class="n">AbsTask</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The abstract class for clustering tasks.</span>

<span class="sd">    A clustering task consists of a dataset with input data and corresponding cluster labels. The task is to cluster the input data points and compare</span>
<span class="sd">    the cluster assignments with the true cluster labels using V-measure.</span>
<span class="sd">    This class embeds the corpus sentences then samples N samples from the corpus and clusters them. The similarity then is calculated using multiple</span>
<span class="sd">    measures, including a V-measure. This approach is then repeated K times.</span>

<span class="sd">    If the clustering is hierarchical and more than one label is specified in order for each observation, we compute the metrics as outlined</span>
<span class="sd">    for each level separately.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        dataset: A HuggingFace Dataset containing the data for the clustering task. Must contain the following columns `sentences` that contains</span>
<span class="sd">            inputs (texts or images) and labels columns.</span>
<span class="sd">        max_fraction_of_documents_to_embed: Fraction of documents to embed for clustering. Cannot be set at the same time as `max_document_to_embed`.</span>
<span class="sd">            If both are set to None, the entire dataset will be embedded for clustering.</span>
<span class="sd">        max_document_to_embed: Maximum number of documents to embed for clustering. Cannot be set at the same time as `max_fraction_of_documents_to_embed`.</span>
<span class="sd">            If both are set to None, the entire dataset will be embedded for clustering.</span>
<span class="sd">        max_documents_per_cluster: Number of documents to sample for each clustering experiment.</span>
<span class="sd">        n_clusters: Number of clustering experiments to run.</span>
<span class="sd">        k_mean_batch_size: Batch size to use for k-means clustering.</span>
<span class="sd">        max_depth: Maximum depth to evaluate clustering. If None, evaluates all levels.</span>
<span class="sd">        input_column_name: Name of the column containing the input sentences or data points.</span>
<span class="sd">        label_column_name: Name of the column containing the true cluster labels.</span>
<span class="sd">        abstask_prompt: Prompt to use for the task for instruction model if not prompt is provided in TaskMetadata.prompt.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">max_fraction_of_documents_to_embed</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="mf">0.04</span>
    <span class="n">max_document_to_embed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">max_documents_per_cluster</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">16_384</span>
    <span class="n">n_clusters</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">k_mean_batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">512</span>
    <span class="n">max_depth</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">abstask_prompt</span> <span class="o">=</span> <span class="s2">&quot;Identify categories in user passages.&quot;</span>
    <span class="n">input_column_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;sentences&quot;</span>
    <span class="n">label_column_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;labels&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_evaluate_subset</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">MTEBModels</span><span class="p">,</span>
        <span class="n">data_split</span><span class="p">:</span> <span class="n">Dataset</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">encode_kwargs</span><span class="p">:</span> <span class="n">EncodeKwargs</span><span class="p">,</span>
        <span class="n">hf_split</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">hf_subset</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">prediction_folder</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">num_proc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ScoresDict</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">EncoderProtocol</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;Expected encoder model to be an instance of EncoderProtocol.&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_document_to_embed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_fraction_of_documents_to_embed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;Both max_document_to_embed and max_fraction_of_documents_to_embed are set. Please only set one.&quot;</span>
            <span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Running clustering - Preparing data...&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_document_to_embed</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_fraction_of_documents_to_embed</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="p">):</span>
            <span class="n">downsampled_dataset</span> <span class="o">=</span> <span class="n">data_split</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_fraction_of_documents_to_embed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">max_documents_to_embed</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">max_fraction_of_documents_to_embed</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_split</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">max_documents_to_embed</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_document_to_embed</span><span class="p">)</span>

            <span class="n">max_documents_to_embed</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data_split</span><span class="p">),</span> <span class="n">max_documents_to_embed</span><span class="p">)</span>
            <span class="n">example_indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng_state</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span>
                <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data_split</span><span class="p">)),</span> <span class="n">k</span><span class="o">=</span><span class="n">max_documents_to_embed</span>
            <span class="p">)</span>
            <span class="n">downsampled_dataset</span> <span class="o">=</span> <span class="n">data_split</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">example_indices</span><span class="p">)</span>

        <span class="n">downsampled_dataset</span> <span class="o">=</span> <span class="n">downsampled_dataset</span><span class="o">.</span><span class="n">select_columns</span><span class="p">(</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">input_column_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_column_name</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Running clustering - Encoding samples...&quot;</span><span class="p">)</span>
        <span class="n">embeddings</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
            <span class="n">create_dataloader</span><span class="p">(</span>
                <span class="n">downsampled_dataset</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span>
                <span class="n">input_column</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">input_column_name</span><span class="p">,</span>
                <span class="n">num_proc</span><span class="o">=</span><span class="n">num_proc</span><span class="p">,</span>
                <span class="o">**</span><span class="n">encode_kwargs</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">task_metadata</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span>
            <span class="n">hf_subset</span><span class="o">=</span><span class="n">hf_subset</span><span class="p">,</span>
            <span class="n">hf_split</span><span class="o">=</span><span class="n">hf_split</span><span class="p">,</span>
            <span class="o">**</span><span class="n">encode_kwargs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Running clustering - Evaluating clustering...&quot;</span><span class="p">)</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">downsampled_dataset</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">label_column_name</span><span class="p">]:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">label</span> <span class="o">=</span> <span class="p">[</span><span class="n">label</span><span class="p">]</span>
            <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>

        <span class="n">all_v_scores</span><span class="p">,</span> <span class="n">all_assignments</span> <span class="o">=</span> <span class="n">_evaluate_clustering_bootstrapped</span><span class="p">(</span>
            <span class="n">embeddings</span><span class="p">,</span>
            <span class="n">labels</span><span class="p">,</span>
            <span class="n">n_clusters</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_clusters</span><span class="p">,</span>
            <span class="n">cluster_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_documents_per_cluster</span><span class="p">,</span>
            <span class="n">kmean_batch_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">k_mean_batch_size</span><span class="p">,</span>
            <span class="n">max_depth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_depth</span><span class="p">,</span>
            <span class="n">rng_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rng_state</span><span class="p">,</span>
            <span class="n">seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">prediction_folder</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_save_task_predictions</span><span class="p">(</span>
                <span class="n">all_assignments</span><span class="p">,</span>
                <span class="n">model</span><span class="p">,</span>
                <span class="n">prediction_folder</span><span class="p">,</span>
                <span class="n">hf_subset</span><span class="o">=</span><span class="n">hf_subset</span><span class="p">,</span>
                <span class="n">hf_split</span><span class="o">=</span><span class="n">hf_split</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="n">v_measures</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span><span class="n">all_v_scores</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Running clustering - Finished.&quot;</span><span class="p">)</span>
        <span class="n">mean_v_measure</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">v_measures</span><span class="p">)</span>
        <span class="n">v_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">v_measures</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;v_measures&quot;</span><span class="p">:</span> <span class="n">all_v_scores</span><span class="p">,</span>
            <span class="s2">&quot;v_measure&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">mean_v_measure</span><span class="p">),</span>
            <span class="s2">&quot;v_measure_std&quot;</span><span class="p">:</span> <span class="n">v_std</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_calculate_descriptive_statistics_from_split</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">split</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">hf_subset</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">compute_overall</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ClusteringFastDescriptiveStatistics</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">hf_subset</span><span class="p">:</span>
            <span class="n">inputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">hf_subset</span><span class="p">][</span><span class="n">split</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">input_column_name</span><span class="p">]</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">hf_subset</span><span class="p">][</span><span class="n">split</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">label_column_name</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">compute_overall</span><span class="p">:</span>
            <span class="n">inputs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">hf_subset</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">eval_langs</span><span class="p">:</span>
                <span class="n">inputs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">hf_subset</span><span class="p">][</span><span class="n">split</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">input_column_name</span><span class="p">])</span>
                <span class="n">labels</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">hf_subset</span><span class="p">][</span><span class="n">split</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">label_column_name</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">inputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">split</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">input_column_name</span><span class="p">]</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">split</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">label_column_name</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">inputs</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">inputs</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">labels</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">labels</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">]</span>

        <span class="n">text_statistics</span><span class="p">,</span> <span class="n">image_statistics</span><span class="p">,</span> <span class="n">audio_statistics</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="s2">&quot;image&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">modalities</span><span class="p">:</span>
            <span class="n">image_statistics</span> <span class="o">=</span> <span class="n">calculate_image_statistics</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;text&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">modalities</span><span class="p">:</span>
            <span class="n">text_statistics</span> <span class="o">=</span> <span class="n">calculate_text_statistics</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;audio&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">modalities</span><span class="p">:</span>
            <span class="n">audio_statistics</span> <span class="o">=</span> <span class="n">calculate_audio_statistics</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>

        <span class="n">label_statistics</span> <span class="o">=</span> <span class="n">calculate_label_statistics</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ClusteringFastDescriptiveStatistics</span><span class="p">(</span>
            <span class="n">num_samples</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">inputs</span><span class="p">),</span>
            <span class="n">text_statistics</span><span class="o">=</span><span class="n">text_statistics</span><span class="p">,</span>
            <span class="n">image_statistics</span><span class="o">=</span><span class="n">image_statistics</span><span class="p">,</span>
            <span class="n">audio_statistics</span><span class="o">=</span><span class="n">audio_statistics</span><span class="p">,</span>
            <span class="n">labels_statistics</span><span class="o">=</span><span class="n">label_statistics</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_push_dataset_to_hub</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">repo_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">num_proc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_upload_dataset_to_hub</span><span class="p">(</span>
            <span class="n">repo_name</span><span class="p">,</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">input_column_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_column_name</span><span class="p">],</span>
            <span class="n">num_proc</span><span class="o">=</span><span class="n">num_proc</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="mteb.abstasks.sts.AbsTaskSTS" class="doc doc-heading">
            <code>mteb.abstasks.sts.AbsTaskSTS</code>


<a href="#mteb.abstasks.sts.AbsTaskSTS" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="&lt;code&gt;mteb.AbsTask&lt;/code&gt; (&lt;code&gt;mteb.abstasks.abstask.AbsTask&lt;/code&gt;)" href="#mteb.AbsTask">AbsTask</a></code></p>



        <p>The class which semantic textual similarity (STS) tasks inherit from.</p>
<p>A semantic textual similarity (STS) task consists of a dataset with pairs of sentences and corresponding similarity scores.
The task is to predict the similarity score for each pair of sentences.</p>
<p>The task works by encoding the sentences using the provided model and then calculating similarity scores using both the model-defined similarity
function (if available) and generic similarity functions, including cosine similarity, Manhattan distance, and Euclidean distance.
The predicted similarity scores are then compared to the true similarity scores using Pearson and Spearman correlation coefficients.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.sts.AbsTaskSTS.dataset">dataset</span></code></td>
            <td>
                  <code><span title="dict">dict</span>[<a class="autorefs autorefs-internal" title="&lt;code class=&quot;highlight language-python&quot;&gt;&lt;span class=&quot;n&quot;&gt;HFSubset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;str&lt;/span&gt;&lt;/code&gt;

  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;mteb.types.HFSubset&lt;/code&gt;)" href="../types/#mteb.types._result.HFSubset">HFSubset</a>, <span title="datasets.DatasetDict">DatasetDict</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dataset or dict of Datasets for different subsets (e.g., languages). Dataset must contain columns specified in column_names and a 'score' column.
Columns in column_names should contain the text or image data to be compared.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.sts.AbsTaskSTS.column_names">column_names</span></code></td>
            <td>
                  <code><span title="tuple">tuple</span>[<span title="str">str</span>, <span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple containing the names of the two columns to compare.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.sts.AbsTaskSTS.min_score">min_score</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum possible score in the dataset.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.sts.AbsTaskSTS.max_score">max_score</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum possible score in the dataset.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.sts.AbsTaskSTS.abstask_prompt">abstask_prompt</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Prompt to use for the task for instruction model if not prompt is provided in TaskMetadata.prompt.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.sts.AbsTaskSTS.input1_prompt_type">input1_prompt_type</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="&lt;code&gt;PromptType&lt;/code&gt; (&lt;code&gt;mteb.types.PromptType&lt;/code&gt;)" href="../types/#mteb.types._encoder_io.PromptType">PromptType</a> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type of prompt of first input. Used for asymmetric tasks.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.sts.AbsTaskSTS.input2_prompt_type">input2_prompt_type</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="&lt;code&gt;PromptType&lt;/code&gt; (&lt;code&gt;mteb.types.PromptType&lt;/code&gt;)" href="../types/#mteb.types._encoder_io.PromptType">PromptType</a> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type of prompt of second input. Used for asymmetric tasks.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>mteb/abstasks/sts.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">AbsTaskSTS</span><span class="p">(</span><span class="n">AbsTask</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The class which semantic textual similarity (STS) tasks inherit from.</span>

<span class="sd">    A semantic textual similarity (STS) task consists of a dataset with pairs of sentences and corresponding similarity scores.</span>
<span class="sd">    The task is to predict the similarity score for each pair of sentences.</span>

<span class="sd">    The task works by encoding the sentences using the provided model and then calculating similarity scores using both the model-defined similarity</span>
<span class="sd">    function (if available) and generic similarity functions, including cosine similarity, Manhattan distance, and Euclidean distance.</span>
<span class="sd">    The predicted similarity scores are then compared to the true similarity scores using Pearson and Spearman correlation coefficients.</span>


<span class="sd">    Attributes:</span>
<span class="sd">        dataset: Dataset or dict of Datasets for different subsets (e.g., languages). Dataset must contain columns specified in column_names and a &#39;score&#39; column.</span>
<span class="sd">            Columns in column_names should contain the text or image data to be compared.</span>
<span class="sd">        column_names: Tuple containing the names of the two columns to compare.</span>
<span class="sd">        min_score: Minimum possible score in the dataset.</span>
<span class="sd">        max_score: Maximum possible score in the dataset.</span>
<span class="sd">        abstask_prompt: Prompt to use for the task for instruction model if not prompt is provided in TaskMetadata.prompt.</span>
<span class="sd">        input1_prompt_type: Type of prompt of first input. Used for asymmetric tasks.</span>
<span class="sd">        input2_prompt_type: Type of prompt of second input. Used for asymmetric tasks.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">abstask_prompt</span> <span class="o">=</span> <span class="s2">&quot;Retrieve semantically similar text.&quot;</span>
    <span class="n">column_names</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;sentence1&quot;</span><span class="p">,</span> <span class="s2">&quot;sentence2&quot;</span><span class="p">)</span>
    <span class="n">min_score</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">max_score</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">input1_prompt_type</span><span class="p">:</span> <span class="n">PromptType</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">input2_prompt_type</span><span class="p">:</span> <span class="n">PromptType</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_evaluate_subset</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">MTEBModels</span><span class="p">,</span>
        <span class="n">data_split</span><span class="p">:</span> <span class="n">Dataset</span><span class="p">,</span>
        <span class="n">encode_kwargs</span><span class="p">:</span> <span class="n">EncodeKwargs</span><span class="p">,</span>
        <span class="n">hf_split</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">hf_subset</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">prediction_folder</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">num_proc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">STSMetrics</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">EncoderProtocol</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Expected model to be an instance of EncoderProtocol&quot;</span><span class="p">)</span>

        <span class="n">normalized_scores</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_normalize</span><span class="p">,</span> <span class="n">data_split</span><span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">]))</span>
        <span class="n">data_split</span> <span class="o">=</span> <span class="n">data_split</span><span class="o">.</span><span class="n">select_columns</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">column_names</span><span class="p">))</span>

        <span class="n">evaluator</span> <span class="o">=</span> <span class="n">AnySTSEvaluator</span><span class="p">(</span>
            <span class="n">data_split</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">column_names</span><span class="p">,</span>
            <span class="n">task_metadata</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span>
            <span class="n">hf_split</span><span class="o">=</span><span class="n">hf_split</span><span class="p">,</span>
            <span class="n">hf_subset</span><span class="o">=</span><span class="n">hf_subset</span><span class="p">,</span>
            <span class="n">input1_prompt_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">input1_prompt_type</span><span class="p">,</span>
            <span class="n">input2_prompt_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">input2_prompt_type</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">scores</span> <span class="o">=</span> <span class="n">evaluator</span><span class="p">(</span>
            <span class="n">model</span><span class="p">,</span>
            <span class="n">encode_kwargs</span><span class="o">=</span><span class="n">encode_kwargs</span><span class="p">,</span>
            <span class="n">num_proc</span><span class="o">=</span><span class="n">num_proc</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">prediction_folder</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_save_task_predictions</span><span class="p">(</span>
                <span class="n">scores</span><span class="p">,</span>
                <span class="n">model</span><span class="p">,</span>
                <span class="n">prediction_folder</span><span class="p">,</span>
                <span class="n">hf_subset</span><span class="o">=</span><span class="n">hf_subset</span><span class="p">,</span>
                <span class="n">hf_split</span><span class="o">=</span><span class="n">hf_split</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_scores</span><span class="p">(</span><span class="n">scores</span><span class="p">,</span> <span class="n">normalized_scores</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_calculate_scores</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">scores</span><span class="p">:</span> <span class="n">STSEvaluatorScores</span><span class="p">,</span> <span class="n">normalized_scores</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">STSMetrics</span><span class="p">:</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">compute_corr</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="n">y</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Return (pearson, spearman) correlations between x and y.&quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">pearsonr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">spearmanr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">cosine_pearson</span><span class="p">,</span> <span class="n">cosine_spearman</span> <span class="o">=</span> <span class="n">compute_corr</span><span class="p">(</span>
            <span class="n">normalized_scores</span><span class="p">,</span> <span class="n">scores</span><span class="p">[</span><span class="s2">&quot;cosine_scores&quot;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">manhattan_pearson</span><span class="p">,</span> <span class="n">manhattan_spearman</span> <span class="o">=</span> <span class="n">compute_corr</span><span class="p">(</span>
            <span class="n">normalized_scores</span><span class="p">,</span> <span class="n">scores</span><span class="p">[</span><span class="s2">&quot;manhattan_distances&quot;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">euclidean_pearson</span><span class="p">,</span> <span class="n">euclidean_spearman</span> <span class="o">=</span> <span class="n">compute_corr</span><span class="p">(</span>
            <span class="n">normalized_scores</span><span class="p">,</span> <span class="n">scores</span><span class="p">[</span><span class="s2">&quot;euclidean_distances&quot;</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">scores</span><span class="p">[</span><span class="s2">&quot;similarity_scores&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pearson</span><span class="p">,</span> <span class="n">spearman</span> <span class="o">=</span> <span class="n">compute_corr</span><span class="p">(</span>
                <span class="n">normalized_scores</span><span class="p">,</span> <span class="n">scores</span><span class="p">[</span><span class="s2">&quot;similarity_scores&quot;</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># if model does not have a similarity function, assume cosine similarity</span>
            <span class="n">pearson</span><span class="p">,</span> <span class="n">spearman</span> <span class="o">=</span> <span class="n">cosine_pearson</span><span class="p">,</span> <span class="n">cosine_spearman</span>

        <span class="k">return</span> <span class="n">STSMetrics</span><span class="p">(</span>
            <span class="c1"># using the models own similarity score</span>
            <span class="n">pearson</span><span class="o">=</span><span class="n">pearson</span><span class="p">,</span>
            <span class="n">spearman</span><span class="o">=</span><span class="n">spearman</span><span class="p">,</span>
            <span class="c1"># generic similarity scores</span>
            <span class="n">cosine_pearson</span><span class="o">=</span><span class="n">cosine_pearson</span><span class="p">,</span>
            <span class="n">cosine_spearman</span><span class="o">=</span><span class="n">cosine_spearman</span><span class="p">,</span>
            <span class="n">manhattan_pearson</span><span class="o">=</span><span class="n">manhattan_pearson</span><span class="p">,</span>
            <span class="n">manhattan_spearman</span><span class="o">=</span><span class="n">manhattan_spearman</span><span class="p">,</span>
            <span class="n">euclidean_pearson</span><span class="o">=</span><span class="n">euclidean_pearson</span><span class="p">,</span>
            <span class="n">euclidean_spearman</span><span class="o">=</span><span class="n">euclidean_spearman</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_calculate_descriptive_statistics_from_split</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">split</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">hf_subset</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">compute_overall</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AnySTSDescriptiveStatistics</span><span class="p">:</span>
        <span class="n">first_column</span><span class="p">,</span> <span class="n">second_column</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">column_names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;dict[str, dict[str, Dataset]]&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">hf_subset</span><span class="p">:</span>
            <span class="n">sentence1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">hf_subset</span><span class="p">][</span><span class="n">split</span><span class="p">][</span><span class="n">first_column</span><span class="p">]</span>
            <span class="n">sentence2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">hf_subset</span><span class="p">][</span><span class="n">split</span><span class="p">][</span><span class="n">second_column</span><span class="p">]</span>
            <span class="n">score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">hf_subset</span><span class="p">][</span><span class="n">split</span><span class="p">][</span><span class="s2">&quot;score&quot;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">compute_overall</span><span class="p">:</span>
            <span class="n">sentence1</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">sentence2</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">score</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">hf_subset</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">eval_langs</span><span class="p">:</span>
                <span class="n">sentence1</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">hf_subset</span><span class="p">][</span><span class="n">split</span><span class="p">][</span><span class="n">first_column</span><span class="p">])</span>
                <span class="n">sentence2</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">hf_subset</span><span class="p">][</span><span class="n">split</span><span class="p">][</span><span class="n">second_column</span><span class="p">])</span>
                <span class="n">score</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">hf_subset</span><span class="p">][</span><span class="n">split</span><span class="p">][</span><span class="s2">&quot;score&quot;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sentence1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">split</span><span class="p">][</span><span class="n">first_column</span><span class="p">]</span>
            <span class="n">sentence2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">split</span><span class="p">][</span><span class="n">second_column</span><span class="p">]</span>
            <span class="n">score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">split</span><span class="p">][</span><span class="s2">&quot;score&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="s2">&quot;text&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">modalities</span><span class="p">:</span>
            <span class="n">text1_statistics</span> <span class="o">=</span> <span class="n">calculate_text_statistics</span><span class="p">(</span><span class="n">sentence1</span><span class="p">)</span>
            <span class="n">text2_statistics</span> <span class="o">=</span> <span class="n">calculate_text_statistics</span><span class="p">(</span><span class="n">sentence2</span><span class="p">)</span>

            <span class="n">unique_pairs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">sentence1</span><span class="p">,</span> <span class="n">sentence2</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">text1_statistics</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">text2_statistics</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">unique_pairs</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="s2">&quot;image&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">modalities</span><span class="p">:</span>
            <span class="n">image1_statistics</span> <span class="o">=</span> <span class="n">calculate_image_statistics</span><span class="p">(</span><span class="n">sentence1</span><span class="p">)</span>
            <span class="n">image2_statistics</span> <span class="o">=</span> <span class="n">calculate_image_statistics</span><span class="p">(</span><span class="n">sentence2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">image1_statistics</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">image2_statistics</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="s2">&quot;audio&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">modalities</span><span class="p">:</span>
            <span class="n">audio1_statistics</span> <span class="o">=</span> <span class="n">calculate_audio_statistics</span><span class="p">(</span><span class="n">sentence1</span><span class="p">)</span>
            <span class="n">audio2_statistics</span> <span class="o">=</span> <span class="n">calculate_audio_statistics</span><span class="p">(</span><span class="n">sentence2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">audio1_statistics</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">audio2_statistics</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">labels_statistics</span> <span class="o">=</span> <span class="n">calculate_score_statistics</span><span class="p">(</span><span class="n">score</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">AnySTSDescriptiveStatistics</span><span class="p">(</span>
            <span class="n">num_samples</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">sentence1</span><span class="p">),</span>
            <span class="n">number_of_characters</span><span class="o">=</span><span class="p">(</span>
                <span class="n">text1_statistics</span><span class="p">[</span><span class="s2">&quot;total_text_length&quot;</span><span class="p">]</span>
                <span class="o">+</span> <span class="n">text2_statistics</span><span class="p">[</span><span class="s2">&quot;total_text_length&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">text1_statistics</span>
                <span class="k">else</span> <span class="kc">None</span>
            <span class="p">),</span>
            <span class="n">unique_pairs</span><span class="o">=</span><span class="n">unique_pairs</span><span class="p">,</span>
            <span class="n">text1_statistics</span><span class="o">=</span><span class="n">text1_statistics</span><span class="p">,</span>
            <span class="n">text2_statistics</span><span class="o">=</span><span class="n">text2_statistics</span><span class="p">,</span>
            <span class="n">image1_statistics</span><span class="o">=</span><span class="n">image1_statistics</span><span class="p">,</span>
            <span class="n">image2_statistics</span><span class="o">=</span><span class="n">image2_statistics</span><span class="p">,</span>
            <span class="n">audio1_statistics</span><span class="o">=</span><span class="n">audio1_statistics</span><span class="p">,</span>
            <span class="n">audio2_statistics</span><span class="o">=</span><span class="n">audio2_statistics</span><span class="p">,</span>
            <span class="n">label_statistics</span><span class="o">=</span><span class="n">labels_statistics</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_push_dataset_to_hub</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">repo_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">num_proc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_upload_dataset_to_hub</span><span class="p">(</span>
            <span class="n">repo_name</span><span class="p">,</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">column_names</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">column_names</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;score&quot;</span><span class="p">],</span>
            <span class="n">num_proc</span><span class="o">=</span><span class="n">num_proc</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_normalize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_score</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_score</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_score</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="mteb.abstasks.zeroshot_classification.AbsTaskZeroShotClassification" class="doc doc-heading">
            <code>mteb.abstasks.zeroshot_classification.AbsTaskZeroShotClassification</code>


<a href="#mteb.abstasks.zeroshot_classification.AbsTaskZeroShotClassification" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="&lt;code&gt;mteb.AbsTask&lt;/code&gt; (&lt;code&gt;mteb.abstasks.abstask.AbsTask&lt;/code&gt;)" href="#mteb.AbsTask">AbsTask</a></code></p>



        <p>Abstract class for ZeroShot Classification tasks for any modality.</p>
<p>The similarity between an input (can be image or text) and candidate text prompts, such as this is a dog/this is a cat.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.zeroshot_classification.AbsTaskZeroShotClassification.dataset">dataset</span></code></td>
            <td>
                  <code><span title="dict">dict</span>[<a class="autorefs autorefs-internal" title="&lt;code class=&quot;highlight language-python&quot;&gt;&lt;span class=&quot;n&quot;&gt;HFSubset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;str&lt;/span&gt;&lt;/code&gt;

  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;mteb.types.HFSubset&lt;/code&gt;)" href="../types/#mteb.types._result.HFSubset">HFSubset</a>, <span title="datasets.DatasetDict">DatasetDict</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Huggingface dataset containing the data for the task. Dataset must contain columns specified by self.input_column_name and self.label_column_name.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.zeroshot_classification.AbsTaskZeroShotClassification.input_column_name">input_column_name</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the column containing the inputs (image or text).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.zeroshot_classification.AbsTaskZeroShotClassification.label_column_name">label_column_name</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the column containing the labels (str).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>mteb/abstasks/zeroshot_classification.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">AbsTaskZeroShotClassification</span><span class="p">(</span><span class="n">AbsTask</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Abstract class for ZeroShot Classification tasks for any modality.</span>

<span class="sd">    The similarity between an input (can be image or text) and candidate text prompts, such as this is a dog/this is a cat.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        dataset: Huggingface dataset containing the data for the task. Dataset must contain columns specified by self.input_column_name and self.label_column_name.</span>
<span class="sd">        input_column_name: Name of the column containing the inputs (image or text).</span>
<span class="sd">        label_column_name: Name of the column containing the labels (str).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">input_column_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;image&quot;</span>
    <span class="n">label_column_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;label&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">dataset_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_proc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Keep only eval splits. Zero-shot tasks don&#39;t need train splits.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">splits_to_keep</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">eval_splits</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">split</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">split</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">splits_to_keep</span><span class="p">:</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">split</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_calculate_descriptive_statistics_from_split</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">split</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">hf_subset</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">compute_overall</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ZeroShotClassificationDescriptiveStatistics</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">hf_subset</span><span class="p">:</span>
            <span class="n">inputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">hf_subset</span><span class="p">][</span><span class="n">split</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">input_column_name</span><span class="p">]</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">hf_subset</span><span class="p">][</span><span class="n">split</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">label_column_name</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">compute_overall</span><span class="p">:</span>
            <span class="n">inputs</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">hf_subset</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">eval_langs</span><span class="p">:</span>
                <span class="n">inputs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">hf_subset</span><span class="p">][</span><span class="n">split</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">input_column_name</span><span class="p">])</span>
                <span class="n">labels</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">hf_subset</span><span class="p">][</span><span class="n">split</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">label_column_name</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">inputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">split</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">input_column_name</span><span class="p">]</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">split</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">label_column_name</span><span class="p">]</span>

        <span class="n">num_samples</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>

        <span class="n">image_statistics</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">text_statistics</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">audio_statistics</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="s2">&quot;image&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">modalities</span><span class="p">:</span>
            <span class="n">image_statistics</span> <span class="o">=</span> <span class="n">calculate_image_statistics</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">modalities</span> <span class="o">==</span> <span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]:</span>
            <span class="n">text_statistics</span> <span class="o">=</span> <span class="n">calculate_text_statistics</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;audio&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">modalities</span><span class="p">:</span>
            <span class="n">audio_statistics</span> <span class="o">=</span> <span class="n">calculate_audio_statistics</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>

        <span class="n">label_statistics</span> <span class="o">=</span> <span class="n">calculate_label_statistics</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
        <span class="n">candidate_lens</span> <span class="o">=</span> <span class="n">calculate_text_statistics</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_candidate_labels</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">ZeroShotClassificationDescriptiveStatistics</span><span class="p">(</span>
            <span class="n">num_samples</span><span class="o">=</span><span class="n">num_samples</span><span class="p">,</span>
            <span class="n">number_of_characters</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">text_statistics</span><span class="o">=</span><span class="n">text_statistics</span><span class="p">,</span>
            <span class="n">image_statistics</span><span class="o">=</span><span class="n">image_statistics</span><span class="p">,</span>
            <span class="n">audio_statistics</span><span class="o">=</span><span class="n">audio_statistics</span><span class="p">,</span>
            <span class="n">label_statistics</span><span class="o">=</span><span class="n">label_statistics</span><span class="p">,</span>
            <span class="n">candidates_labels_text_statistics</span><span class="o">=</span><span class="n">candidate_lens</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_evaluate_subset</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">MTEBModels</span><span class="p">,</span>
        <span class="n">data_split</span><span class="p">:</span> <span class="n">Dataset</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">hf_split</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">hf_subset</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">encode_kwargs</span><span class="p">:</span> <span class="n">EncodeKwargs</span><span class="p">,</span>
        <span class="n">prediction_folder</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">num_proc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ZeroShotClassificationMetrics</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">EncoderProtocol</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Expected model to be an instance of EncoderProtocol&quot;</span><span class="p">)</span>

        <span class="n">candidate_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_candidate_labels</span><span class="p">()</span>
        <span class="n">data_split</span> <span class="o">=</span> <span class="n">data_split</span><span class="o">.</span><span class="n">select_columns</span><span class="p">(</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">input_column_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_column_name</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">evaluator</span> <span class="o">=</span> <span class="n">ZeroShotClassificationEvaluator</span><span class="p">(</span>
            <span class="n">data_split</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input_column_name</span><span class="p">,</span>
            <span class="n">candidate_labels</span><span class="p">,</span>
            <span class="n">task_metadata</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span>
            <span class="n">hf_split</span><span class="o">=</span><span class="n">hf_split</span><span class="p">,</span>
            <span class="n">hf_subset</span><span class="o">=</span><span class="n">hf_subset</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">probs</span> <span class="o">=</span> <span class="n">evaluator</span><span class="p">(</span>
            <span class="n">model</span><span class="p">,</span>
            <span class="n">encode_kwargs</span><span class="o">=</span><span class="n">encode_kwargs</span><span class="p">,</span>
            <span class="n">num_proc</span><span class="o">=</span><span class="n">num_proc</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">prediction_folder</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_save_task_predictions</span><span class="p">(</span>
                <span class="n">probs</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                <span class="n">model</span><span class="p">,</span>
                <span class="n">prediction_folder</span><span class="p">,</span>
                <span class="n">hf_subset</span><span class="o">=</span><span class="n">hf_subset</span><span class="p">,</span>
                <span class="n">hf_split</span><span class="o">=</span><span class="n">hf_split</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_scores</span><span class="p">(</span>
            <span class="n">data_split</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">label_column_name</span><span class="p">],</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">probs</span><span class="p">)</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_calculate_scores</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">labels</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
        <span class="n">predictions</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ZeroShotClassificationMetrics</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ZeroShotClassificationMetrics</span><span class="p">(</span>
            <span class="n">accuracy</span><span class="o">=</span><span class="n">metrics</span><span class="o">.</span><span class="n">accuracy_score</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">predictions</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_push_dataset_to_hub</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">repo_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">num_proc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_upload_dataset_to_hub</span><span class="p">(</span>
            <span class="n">repo_name</span><span class="p">,</span>
            <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">input_column_name</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">label_column_name</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="n">num_proc</span><span class="o">=</span><span class="n">num_proc</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">labels_dataset</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">from_dict</span><span class="p">({</span><span class="s2">&quot;labels&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_candidate_labels</span><span class="p">()})</span>
        <span class="n">labels_dataset</span><span class="o">.</span><span class="n">push_to_hub</span><span class="p">(</span><span class="n">repo_name</span><span class="p">,</span> <span class="n">config_name</span><span class="o">=</span><span class="s2">&quot;labels&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_candidate_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the text candidates for zeroshot classification&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;This method should be overridden by subclasses&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="mteb.abstasks.zeroshot_classification.AbsTaskZeroShotClassification.dataset_transform" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">dataset_transform</span><span class="p">(</span><span class="n">num_proc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

<a href="#mteb.abstasks.zeroshot_classification.AbsTaskZeroShotClassification.dataset_transform" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Keep only eval splits. Zero-shot tasks don't need train splits.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>mteb/abstasks/zeroshot_classification.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">dataset_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_proc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Keep only eval splits. Zero-shot tasks don&#39;t need train splits.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">splits_to_keep</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">eval_splits</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">split</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="k">if</span> <span class="n">split</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">splits_to_keep</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">split</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="mteb.abstasks.zeroshot_classification.AbsTaskZeroShotClassification.get_candidate_labels" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_candidate_labels</span><span class="p">()</span></code>

<a href="#mteb.abstasks.zeroshot_classification.AbsTaskZeroShotClassification.get_candidate_labels" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Return the text candidates for zeroshot classification</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>mteb/abstasks/zeroshot_classification.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_candidate_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the text candidates for zeroshot classification&quot;&quot;&quot;</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;This method should be overridden by subclasses&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="mteb.abstasks.regression.AbsTaskRegression" class="doc doc-heading">
            <code>mteb.abstasks.regression.AbsTaskRegression</code>


<a href="#mteb.abstasks.regression.AbsTaskRegression" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="&lt;code&gt;mteb.abstasks.classification.AbsTaskClassification&lt;/code&gt;" href="#mteb.abstasks.classification.AbsTaskClassification">AbsTaskClassification</a></code></p>



        <p>Abstract class for regression tasks</p>
<p>self.load_data() must generate a huggingface dataset with a split matching self.metadata.eval_splits, and assign it to self.dataset. It
must contain the following columns:
    text: str
    value: float</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.regression.AbsTaskRegression.dataset">dataset</span></code></td>
            <td>
                  <code><span title="dict">dict</span>[<a class="autorefs autorefs-internal" title="&lt;code class=&quot;highlight language-python&quot;&gt;&lt;span class=&quot;n&quot;&gt;HFSubset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;str&lt;/span&gt;&lt;/code&gt;

  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;mteb.types.HFSubset&lt;/code&gt;)" href="../types/#mteb.types._result.HFSubset">HFSubset</a>, <span title="datasets.DatasetDict">DatasetDict</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A HuggingFace Dataset containing the data for the regression task. It must contain the following columns: input_column_name and label_column_name.
Input can be any text or images, and label must be a continuous value.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.regression.AbsTaskRegression.input_column_name">input_column_name</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the column containing the text inputs.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.regression.AbsTaskRegression.label_column_name">label_column_name</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the column containing the continuous values.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.regression.AbsTaskRegression.train_split">train_split</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the training split in the dataset.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.regression.AbsTaskRegression.n_experiments">n_experiments</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of experiments to run with different random seeds.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.regression.AbsTaskRegression.n_samples">n_samples</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of samples to use for training the regression model. If the dataset has fewer samples than n_samples, all samples are used.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.regression.AbsTaskRegression.abstask_prompt">abstask_prompt</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Prompt to use for the task for instruction model if not prompt is provided in TaskMetadata.prompt.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.regression.AbsTaskRegression.evaluator_model">evaluator_model</span></code></td>
            <td>
                  <code><span title="mteb._evaluators.sklearn_evaluator.SklearnModelProtocol">SklearnModelProtocol</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The model to use for evaluation. Can be any sklearn compatible model. Default is <code>LinearRegression</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>mteb/abstasks/regression.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">AbsTaskRegression</span><span class="p">(</span><span class="n">AbsTaskClassification</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Abstract class for regression tasks</span>

<span class="sd">    self.load_data() must generate a huggingface dataset with a split matching self.metadata.eval_splits, and assign it to self.dataset. It</span>
<span class="sd">    must contain the following columns:</span>
<span class="sd">        text: str</span>
<span class="sd">        value: float</span>

<span class="sd">    Attributes:</span>
<span class="sd">        dataset: A HuggingFace Dataset containing the data for the regression task. It must contain the following columns: input_column_name and label_column_name.</span>
<span class="sd">            Input can be any text or images, and label must be a continuous value.</span>
<span class="sd">        input_column_name: Name of the column containing the text inputs.</span>
<span class="sd">        label_column_name: Name of the column containing the continuous values.</span>
<span class="sd">        train_split: Name of the training split in the dataset.</span>
<span class="sd">        n_experiments: Number of experiments to run with different random seeds.</span>
<span class="sd">        n_samples: Number of samples to use for training the regression model. If the dataset has fewer samples than n_samples, all samples are used.</span>
<span class="sd">        abstask_prompt: Prompt to use for the task for instruction model if not prompt is provided in TaskMetadata.prompt.</span>
<span class="sd">        evaluator_model: The model to use for evaluation. Can be any sklearn compatible model. Default is `LinearRegression`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">evaluator</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">SklearnEvaluator</span><span class="p">]</span> <span class="o">=</span> <span class="n">SklearnEvaluator</span>
    <span class="n">evaluator_model</span><span class="p">:</span> <span class="n">SklearnModelProtocol</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">train_split</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;train&quot;</span>
    <span class="n">label_column_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;value&quot;</span>
    <span class="n">input_column_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;text&quot;</span>
    <span class="n">abstask_prompt</span> <span class="o">=</span> <span class="s2">&quot;Predict the value of the user passage.&quot;</span>

    <span class="n">n_experiments</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">n_samples</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2048</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_undersample_data</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">dataset</span><span class="p">:</span> <span class="n">Dataset</span><span class="p">,</span> <span class="n">experiment_num</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">idxs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Dataset</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_samples</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="p">):</span>
            <span class="n">train_split_sampled</span> <span class="o">=</span> <span class="n">dataset</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">train_split_sampled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stratified_subsampling</span><span class="p">(</span>
                <span class="n">datasets</span><span class="o">.</span><span class="n">DatasetDict</span><span class="p">({</span><span class="s2">&quot;train&quot;</span><span class="p">:</span> <span class="n">dataset</span><span class="p">}),</span>
                <span class="n">seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="o">+</span> <span class="n">experiment_num</span><span class="p">,</span>
                <span class="n">splits</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;train&quot;</span><span class="p">],</span>
                <span class="n">label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">label_column_name</span><span class="p">,</span>
                <span class="n">n_samples</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_samples</span><span class="p">,</span>
            <span class="p">)[</span><span class="s2">&quot;train&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">train_split_sampled</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_calculate_scores</span><span class="p">(</span>  <span class="c1"># type: ignore[override]</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">y_test</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
        <span class="n">y_pred</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">]</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RegressionMetrics</span><span class="p">:</span>
        <span class="n">mse</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">RegressionMetrics</span><span class="p">(</span>
            <span class="n">mse</span><span class="o">=</span><span class="n">mse</span><span class="p">,</span>
            <span class="n">mae</span><span class="o">=</span><span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">),</span>
            <span class="n">r2</span><span class="o">=</span><span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">),</span>
            <span class="n">kendalltau</span><span class="o">=</span><span class="n">kendalltau</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span><span class="o">.</span><span class="n">statistic</span><span class="p">,</span>
            <span class="n">rmse</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mse</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">stratified_subsampling</span><span class="p">(</span>
        <span class="n">dataset_dict</span><span class="p">:</span> <span class="n">datasets</span><span class="o">.</span><span class="n">DatasetDict</span><span class="p">,</span>
        <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">splits</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;test&quot;</span><span class="p">],</span>
        <span class="n">label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;value&quot;</span><span class="p">,</span>
        <span class="n">n_samples</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2048</span><span class="p">,</span>
        <span class="n">n_bins</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">datasets</span><span class="o">.</span><span class="n">DatasetDict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Subsamples the dataset with stratification by the supplied label, which is assumed to be a continuous value.</span>

<span class="sd">        The continuous values are bucketized into `n_bins` bins based on quantiles.</span>

<span class="sd">        Args:</span>
<span class="sd">            dataset_dict: the DatasetDict object.</span>
<span class="sd">            seed: the random seed.</span>
<span class="sd">            splits: the splits of the dataset.</span>
<span class="sd">            label: the label with which the stratified sampling is based on.</span>
<span class="sd">            n_samples: Optional, number of samples to subsample.</span>
<span class="sd">            n_bins: Optional, number of bins to bucketize the continuous label.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A subsampled DatasetDict object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">stratify_col_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2">_binned_for_stratification&quot;</span>

        <span class="k">for</span> <span class="n">split</span> <span class="ow">in</span> <span class="n">splits</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">n_samples</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataset_dict</span><span class="p">[</span><span class="n">split</span><span class="p">]):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                    <span class="s2">&quot;Subsampling not needed for split </span><span class="si">%s</span><span class="s2">, as n_samples is equal or greater than the number of samples.&quot;</span><span class="p">,</span>
                    <span class="n">split</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">continue</span>

            <span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset_dict</span><span class="p">[</span><span class="n">split</span><span class="p">]</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="n">label</span><span class="p">]</span>

            <span class="n">binned_labels</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">qcut</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="n">n_bins</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">duplicates</span><span class="o">=</span><span class="s2">&quot;drop&quot;</span><span class="p">)</span>
            <span class="n">dataset_with_bins</span><span class="p">:</span> <span class="n">datasets</span><span class="o">.</span><span class="n">Dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="n">stratify_col_name</span><span class="p">,</span>
                <span class="n">column</span><span class="o">=</span><span class="n">binned_labels</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
            <span class="p">)</span>
            <span class="n">dataset_with_bins</span> <span class="o">=</span> <span class="n">dataset_with_bins</span><span class="o">.</span><span class="n">cast_column</span><span class="p">(</span>
                <span class="n">stratify_col_name</span><span class="p">,</span>
                <span class="n">datasets</span><span class="o">.</span><span class="n">ClassLabel</span><span class="p">(</span><span class="n">names</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">binned_labels</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()),</span>
            <span class="p">)</span>

            <span class="n">subsampled_dataset</span> <span class="o">=</span> <span class="n">dataset_with_bins</span><span class="o">.</span><span class="n">train_test_split</span><span class="p">(</span>
                <span class="n">test_size</span><span class="o">=</span><span class="n">n_samples</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span> <span class="n">stratify_by_column</span><span class="o">=</span><span class="n">stratify_col_name</span>
            <span class="p">)[</span><span class="s2">&quot;test&quot;</span><span class="p">]</span>

            <span class="n">subsampled_dataset</span> <span class="o">=</span> <span class="n">subsampled_dataset</span><span class="o">.</span><span class="n">remove_columns</span><span class="p">([</span><span class="n">stratify_col_name</span><span class="p">])</span>
            <span class="n">dataset_dict</span><span class="p">[</span><span class="n">split</span><span class="p">]</span> <span class="o">=</span> <span class="n">subsampled_dataset</span>

        <span class="k">return</span> <span class="n">dataset_dict</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_calculate_descriptive_statistics_from_split</span><span class="p">(</span>  <span class="c1"># type: ignore[override]</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">split</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">hf_subset</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">compute_overall</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RegressionDescriptiveStatistics</span><span class="p">:</span>
        <span class="n">train_text</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">hf_subset</span><span class="p">:</span>
            <span class="n">inputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">hf_subset</span><span class="p">][</span><span class="n">split</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">input_column_name</span><span class="p">]</span>
            <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">hf_subset</span><span class="p">][</span><span class="n">split</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">label_column_name</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">split</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_split</span><span class="p">:</span>
                <span class="n">train_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">hf_subset</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">train_split</span><span class="p">][</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">input_column_name</span>
                <span class="p">]</span>
        <span class="k">elif</span> <span class="n">compute_overall</span><span class="p">:</span>
            <span class="n">inputs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">values</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">lang_subset</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">eval_langs</span><span class="p">:</span>
                <span class="n">inputs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">lang_subset</span><span class="p">][</span><span class="n">split</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">input_column_name</span><span class="p">])</span>
                <span class="n">values</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">lang_subset</span><span class="p">][</span><span class="n">split</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">label_column_name</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">split</span> <span class="o">!=</span> <span class="s2">&quot;train&quot;</span><span class="p">:</span>
                    <span class="n">train_text</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">lang_subset</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">train_split</span><span class="p">][</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">input_column_name</span>
                        <span class="p">]</span>
                    <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">inputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">split</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">input_column_name</span><span class="p">]</span>
            <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">split</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">label_column_name</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">split</span> <span class="o">!=</span> <span class="s2">&quot;train&quot;</span><span class="p">:</span>
                <span class="n">train_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">train_split</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">input_column_name</span><span class="p">]</span>

        <span class="n">text_statistics</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">image_statistics</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">audio_statistics</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">num_texts_in_train</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">modalities</span> <span class="o">==</span> <span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]:</span>
            <span class="n">text_statistics</span> <span class="o">=</span> <span class="n">calculate_text_statistics</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
            <span class="n">num_texts_in_train</span> <span class="o">=</span> <span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">train_text</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">split</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_split</span>
                <span class="k">else</span> <span class="kc">None</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">modalities</span> <span class="o">==</span> <span class="p">[</span><span class="s2">&quot;image&quot;</span><span class="p">]:</span>
            <span class="n">image_statistics</span> <span class="o">=</span> <span class="n">calculate_image_statistics</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">modalities</span> <span class="o">==</span> <span class="p">[</span><span class="s2">&quot;audio&quot;</span><span class="p">]:</span>
            <span class="n">audio_statistics</span> <span class="o">=</span> <span class="n">calculate_audio_statistics</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">RegressionDescriptiveStatistics</span><span class="p">(</span>
            <span class="n">num_samples</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">inputs</span><span class="p">),</span>
            <span class="n">num_texts_in_train</span><span class="o">=</span><span class="n">num_texts_in_train</span><span class="p">,</span>
            <span class="n">text_statistics</span><span class="o">=</span><span class="n">text_statistics</span><span class="p">,</span>
            <span class="n">image_statistics</span><span class="o">=</span><span class="n">image_statistics</span><span class="p">,</span>
            <span class="n">audio_statistics</span><span class="o">=</span><span class="n">audio_statistics</span><span class="p">,</span>
            <span class="n">values_statistics</span><span class="o">=</span><span class="n">calculate_score_statistics</span><span class="p">(</span><span class="n">values</span><span class="p">),</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="mteb.abstasks.regression.AbsTaskRegression.stratified_subsampling" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">stratified_subsampling</span><span class="p">(</span><span class="n">dataset_dict</span><span class="p">,</span> <span class="n">seed</span><span class="p">,</span> <span class="n">splits</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="n">n_samples</span><span class="o">=</span><span class="mi">2048</span><span class="p">,</span> <span class="n">n_bins</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#mteb.abstasks.regression.AbsTaskRegression.stratified_subsampling" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Subsamples the dataset with stratification by the supplied label, which is assumed to be a continuous value.</p>
<p>The continuous values are bucketized into <code>n_bins</code> bins based on quantiles.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>dataset_dict</code>
            </td>
            <td>
                  <code><span title="datasets.DatasetDict">DatasetDict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the DatasetDict object.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>seed</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the random seed.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>splits</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the splits of the dataset.</p>
              </div>
            </td>
            <td>
                  <code>[&#39;test&#39;]</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>label</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the label with which the stratified sampling is based on.</p>
              </div>
            </td>
            <td>
                  <code>&#39;value&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_samples</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional, number of samples to subsample.</p>
              </div>
            </td>
            <td>
                  <code>2048</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_bins</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional, number of bins to bucketize the continuous label.</p>
              </div>
            </td>
            <td>
                  <code>10</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="datasets.DatasetDict">DatasetDict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A subsampled DatasetDict object.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>mteb/abstasks/regression.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">stratified_subsampling</span><span class="p">(</span>
    <span class="n">dataset_dict</span><span class="p">:</span> <span class="n">datasets</span><span class="o">.</span><span class="n">DatasetDict</span><span class="p">,</span>
    <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">splits</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;test&quot;</span><span class="p">],</span>
    <span class="n">label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;value&quot;</span><span class="p">,</span>
    <span class="n">n_samples</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2048</span><span class="p">,</span>
    <span class="n">n_bins</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">datasets</span><span class="o">.</span><span class="n">DatasetDict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Subsamples the dataset with stratification by the supplied label, which is assumed to be a continuous value.</span>

<span class="sd">    The continuous values are bucketized into `n_bins` bins based on quantiles.</span>

<span class="sd">    Args:</span>
<span class="sd">        dataset_dict: the DatasetDict object.</span>
<span class="sd">        seed: the random seed.</span>
<span class="sd">        splits: the splits of the dataset.</span>
<span class="sd">        label: the label with which the stratified sampling is based on.</span>
<span class="sd">        n_samples: Optional, number of samples to subsample.</span>
<span class="sd">        n_bins: Optional, number of bins to bucketize the continuous label.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A subsampled DatasetDict object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">stratify_col_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2">_binned_for_stratification&quot;</span>

    <span class="k">for</span> <span class="n">split</span> <span class="ow">in</span> <span class="n">splits</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">n_samples</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataset_dict</span><span class="p">[</span><span class="n">split</span><span class="p">]):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="s2">&quot;Subsampling not needed for split </span><span class="si">%s</span><span class="s2">, as n_samples is equal or greater than the number of samples.&quot;</span><span class="p">,</span>
                <span class="n">split</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">continue</span>

        <span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset_dict</span><span class="p">[</span><span class="n">split</span><span class="p">]</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="n">label</span><span class="p">]</span>

        <span class="n">binned_labels</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">qcut</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="n">n_bins</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">duplicates</span><span class="o">=</span><span class="s2">&quot;drop&quot;</span><span class="p">)</span>
        <span class="n">dataset_with_bins</span><span class="p">:</span> <span class="n">datasets</span><span class="o">.</span><span class="n">Dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">stratify_col_name</span><span class="p">,</span>
            <span class="n">column</span><span class="o">=</span><span class="n">binned_labels</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
        <span class="p">)</span>
        <span class="n">dataset_with_bins</span> <span class="o">=</span> <span class="n">dataset_with_bins</span><span class="o">.</span><span class="n">cast_column</span><span class="p">(</span>
            <span class="n">stratify_col_name</span><span class="p">,</span>
            <span class="n">datasets</span><span class="o">.</span><span class="n">ClassLabel</span><span class="p">(</span><span class="n">names</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">binned_labels</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()),</span>
        <span class="p">)</span>

        <span class="n">subsampled_dataset</span> <span class="o">=</span> <span class="n">dataset_with_bins</span><span class="o">.</span><span class="n">train_test_split</span><span class="p">(</span>
            <span class="n">test_size</span><span class="o">=</span><span class="n">n_samples</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span> <span class="n">stratify_by_column</span><span class="o">=</span><span class="n">stratify_col_name</span>
        <span class="p">)[</span><span class="s2">&quot;test&quot;</span><span class="p">]</span>

        <span class="n">subsampled_dataset</span> <span class="o">=</span> <span class="n">subsampled_dataset</span><span class="o">.</span><span class="n">remove_columns</span><span class="p">([</span><span class="n">stratify_col_name</span><span class="p">])</span>
        <span class="n">dataset_dict</span><span class="p">[</span><span class="n">split</span><span class="p">]</span> <span class="o">=</span> <span class="n">subsampled_dataset</span>

    <span class="k">return</span> <span class="n">dataset_dict</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="mteb.abstasks.clustering_legacy.AbsTaskClusteringLegacy" class="doc doc-heading">
            <code>mteb.abstasks.clustering_legacy.AbsTaskClusteringLegacy</code>


<a href="#mteb.abstasks.clustering_legacy.AbsTaskClusteringLegacy" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="&lt;code&gt;mteb.AbsTask&lt;/code&gt; (&lt;code&gt;mteb.abstasks.abstask.AbsTask&lt;/code&gt;)" href="#mteb.AbsTask">AbsTask</a></code></p>



        <p>Legacy abstract task for clustering. For new tasks, we recommend using AbsTaskClustering because it is faster, more sample-efficient, and produces more robust statistical estimates.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.clustering_legacy.AbsTaskClusteringLegacy.dataset">dataset</span></code></td>
            <td>
                  <code><span title="dict">dict</span>[<a class="autorefs autorefs-internal" title="&lt;code class=&quot;highlight language-python&quot;&gt;&lt;span class=&quot;n&quot;&gt;HFSubset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;str&lt;/span&gt;&lt;/code&gt;

  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;mteb.types.HFSubset&lt;/code&gt;)" href="../types/#mteb.types._result.HFSubset">HFSubset</a>, <span title="datasets.DatasetDict">DatasetDict</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A HuggingFace Dataset containing the data for the clustering task. It must contain the following columns:
sentences: List of inputs to be clustered. Can be text, images, etc. Name can be changed via <code>input_column_name</code>.
labels: List of integer labels representing the true cluster assignments. Name can be changed via <code>label_column_name</code>.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.clustering_legacy.AbsTaskClusteringLegacy.input_column_name">input_column_name</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the column in the dataset that contains the input sentences or data points.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.clustering_legacy.AbsTaskClusteringLegacy.label_column_name">label_column_name</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the column in the dataset that contains the true cluster labels.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.clustering_legacy.AbsTaskClusteringLegacy.abstask_prompt">abstask_prompt</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Prompt to use for the task for instruction model if not prompt is provided in TaskMetadata.prompt.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>mteb/abstasks/clustering_legacy.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">AbsTaskClusteringLegacy</span><span class="p">(</span><span class="n">AbsTask</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Legacy abstract task for clustering. For new tasks, we recommend using AbsTaskClustering because it is faster, more sample-efficient, and produces more robust statistical estimates.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        dataset: A HuggingFace Dataset containing the data for the clustering task. It must contain the following columns:</span>
<span class="sd">            sentences: List of inputs to be clustered. Can be text, images, etc. Name can be changed via `input_column_name`.</span>
<span class="sd">            labels: List of integer labels representing the true cluster assignments. Name can be changed via `label_column_name`.</span>
<span class="sd">        input_column_name: The name of the column in the dataset that contains the input sentences or data points.</span>
<span class="sd">        label_column_name: The name of the column in the dataset that contains the true cluster labels.</span>
<span class="sd">        abstask_prompt: Prompt to use for the task for instruction model if not prompt is provided in TaskMetadata.prompt.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">abstask_prompt</span> <span class="o">=</span> <span class="s2">&quot;Identify categories in user passages.&quot;</span>
    <span class="n">evaluator</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">ClusteringEvaluator</span><span class="p">]</span> <span class="o">=</span> <span class="n">ClusteringEvaluator</span>
    <span class="n">input_column_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;sentences&quot;</span>
    <span class="n">label_column_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;labels&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_evaluate_subset</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">MTEBModels</span><span class="p">,</span>
        <span class="n">data_split</span><span class="p">:</span> <span class="n">Dataset</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">encode_kwargs</span><span class="p">:</span> <span class="n">EncodeKwargs</span><span class="p">,</span>
        <span class="n">hf_split</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">hf_subset</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">prediction_folder</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">num_proc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ScoresDict</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">EncoderProtocol</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Expected model to be an instance of EncoderProtocol&quot;</span><span class="p">)</span>

        <span class="n">data_split</span> <span class="o">=</span> <span class="n">data_split</span><span class="o">.</span><span class="n">select_columns</span><span class="p">(</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">input_column_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_column_name</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="c1"># MTEB text clustering requires renaming and eval per subset.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">modalities</span> <span class="o">==</span> <span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]:</span>
            <span class="n">all_metrics</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">clusters</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">cluster_set</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data_split</span><span class="p">):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Running clustering on cluster (</span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">data_split</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span>
                <span class="p">)</span>
                <span class="n">clustering_dataset</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">cluster_set</span><span class="p">)</span><span class="o">.</span><span class="n">select_columns</span><span class="p">(</span>
                    <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">input_column_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_column_name</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="n">evaluator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluator</span><span class="p">(</span>
                    <span class="n">clustering_dataset</span><span class="p">,</span>
                    <span class="n">input_column_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">input_column_name</span><span class="p">,</span>
                    <span class="n">label_column_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">label_column_name</span><span class="p">,</span>
                    <span class="n">task_metadata</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span>
                    <span class="n">hf_split</span><span class="o">=</span><span class="n">hf_split</span><span class="p">,</span>
                    <span class="n">hf_subset</span><span class="o">=</span><span class="n">hf_subset</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">clusters_assignment</span> <span class="o">=</span> <span class="n">evaluator</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">encode_kwargs</span><span class="o">=</span><span class="n">encode_kwargs</span><span class="p">)</span>
                <span class="n">clusters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">clusters_assignment</span><span class="p">)</span>
                <span class="n">set_metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_metrics</span><span class="p">(</span>
                    <span class="n">clustering_dataset</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">label_column_name</span><span class="p">],</span>
                    <span class="n">clusters_assignment</span><span class="p">,</span>
                    <span class="n">v_measure_only</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">all_metrics</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">set_metrics</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">prediction_folder</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_save_task_predictions</span><span class="p">(</span>
                    <span class="n">clusters</span><span class="p">,</span>
                    <span class="n">model</span><span class="p">,</span>
                    <span class="n">prediction_folder</span><span class="p">,</span>
                    <span class="n">hf_subset</span><span class="o">=</span><span class="n">hf_subset</span><span class="p">,</span>
                    <span class="n">hf_split</span><span class="o">=</span><span class="n">hf_split</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="n">v_measures</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span><span class="p">[</span><span class="s2">&quot;v_measure&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">all_metrics</span><span class="p">]</span>
            <span class="n">v_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">v_measures</span><span class="p">)</span>
            <span class="n">v_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">v_measures</span><span class="p">)</span>
            <span class="n">scores</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;v_measure&quot;</span><span class="p">:</span> <span class="n">v_mean</span><span class="p">,</span>
                <span class="s2">&quot;v_measure_std&quot;</span><span class="p">:</span> <span class="n">v_std</span><span class="p">,</span>
                <span class="s2">&quot;v_measures&quot;</span><span class="p">:</span> <span class="n">v_measures</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="n">scores</span>

        <span class="n">evaluator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluator</span><span class="p">(</span>
            <span class="n">data_split</span><span class="p">,</span>
            <span class="n">input_column_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">input_column_name</span><span class="p">,</span>
            <span class="n">label_column_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">label_column_name</span><span class="p">,</span>
            <span class="n">task_metadata</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span>
            <span class="n">hf_split</span><span class="o">=</span><span class="n">hf_split</span><span class="p">,</span>
            <span class="n">hf_subset</span><span class="o">=</span><span class="n">hf_subset</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">evaluate_clusters</span> <span class="o">=</span> <span class="n">evaluator</span><span class="p">(</span>
            <span class="n">model</span><span class="p">,</span>
            <span class="n">encode_kwargs</span><span class="o">=</span><span class="n">encode_kwargs</span><span class="p">,</span>
            <span class="n">num_proc</span><span class="o">=</span><span class="n">num_proc</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">prediction_folder</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_save_task_predictions</span><span class="p">(</span>
                <span class="n">evaluate_clusters</span><span class="p">,</span>
                <span class="n">model</span><span class="p">,</span>
                <span class="n">prediction_folder</span><span class="p">,</span>
                <span class="n">hf_subset</span><span class="o">=</span><span class="n">hf_subset</span><span class="p">,</span>
                <span class="n">hf_split</span><span class="o">=</span><span class="n">hf_split</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_metrics</span><span class="p">(</span>
            <span class="n">data_split</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">label_column_name</span><span class="p">],</span>
            <span class="n">evaluate_clusters</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_compute_metrics</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">labels</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
        <span class="n">cluster_assignment</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
        <span class="n">v_measure_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ClusteringMetrics</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Running clustering - Evaluating clustering...&quot;</span><span class="p">)</span>
        <span class="n">v_measure</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">cluster</span><span class="o">.</span><span class="n">v_measure_score</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">cluster_assignment</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">v_measure_only</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ClusteringMetrics</span><span class="p">(</span>
                <span class="n">v_measure</span><span class="o">=</span><span class="n">v_measure</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">nmi</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">cluster</span><span class="o">.</span><span class="n">normalized_mutual_info_score</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">cluster_assignment</span><span class="p">)</span>
        <span class="n">ari</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">cluster</span><span class="o">.</span><span class="n">adjusted_rand_score</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">cluster_assignment</span><span class="p">)</span>

        <span class="n">matrix</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">cluster_assignment</span><span class="p">)</span>
        <span class="c1"># get linear sum assignment</span>
        <span class="n">row_ind</span><span class="p">,</span> <span class="n">col_ind</span> <span class="o">=</span> <span class="n">linear_sum_assignment</span><span class="p">(</span><span class="n">matrix</span><span class="p">,</span> <span class="n">maximize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">total_correct</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">[</span><span class="n">row_ind</span><span class="p">,</span> <span class="n">col_ind</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">clustering_accuracy</span> <span class="o">=</span> <span class="n">total_correct</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ClusteringMetrics</span><span class="p">(</span>
            <span class="n">v_measure</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">v_measure</span><span class="p">),</span>
            <span class="n">nmi</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">nmi</span><span class="p">),</span>
            <span class="n">ari</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">ari</span><span class="p">),</span>
            <span class="n">cluster_accuracy</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">clustering_accuracy</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_calculate_descriptive_statistics_from_split</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">split</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">hf_subset</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">compute_overall</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ClusteringDescriptiveStatistics</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">hf_subset</span><span class="p">:</span>
            <span class="n">inputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">hf_subset</span><span class="p">][</span><span class="n">split</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">input_column_name</span><span class="p">]</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">hf_subset</span><span class="p">][</span><span class="n">split</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">label_column_name</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">compute_overall</span><span class="p">:</span>
            <span class="n">inputs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">hf_subset</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">eval_langs</span><span class="p">:</span>
                <span class="n">inputs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">hf_subset</span><span class="p">][</span><span class="n">split</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">input_column_name</span><span class="p">])</span>
                <span class="n">labels</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">hf_subset</span><span class="p">][</span><span class="n">split</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">label_column_name</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">inputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">split</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">input_column_name</span><span class="p">]</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">split</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">label_column_name</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">inputs</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">inputs</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">labels</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">labels</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">]</span>

        <span class="n">text_statistics</span><span class="p">,</span> <span class="n">image_statistics</span><span class="p">,</span> <span class="n">audio_statistics</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="s2">&quot;image&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">modalities</span><span class="p">:</span>
            <span class="n">image_statistics</span> <span class="o">=</span> <span class="n">calculate_image_statistics</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;text&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">modalities</span><span class="p">:</span>
            <span class="n">text_statistics</span> <span class="o">=</span> <span class="n">calculate_text_statistics</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;audio&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">modalities</span><span class="p">:</span>
            <span class="n">audio_statistics</span> <span class="o">=</span> <span class="n">calculate_audio_statistics</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>

        <span class="n">label_statistics</span> <span class="o">=</span> <span class="n">calculate_label_statistics</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ClusteringDescriptiveStatistics</span><span class="p">(</span>
            <span class="n">num_samples</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">inputs</span><span class="p">),</span>
            <span class="n">text_statistics</span><span class="o">=</span><span class="n">text_statistics</span><span class="p">,</span>
            <span class="n">image_statistics</span><span class="o">=</span><span class="n">image_statistics</span><span class="p">,</span>
            <span class="n">audio_statistics</span><span class="o">=</span><span class="n">audio_statistics</span><span class="p">,</span>
            <span class="n">label_statistics</span><span class="o">=</span><span class="n">label_statistics</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_push_dataset_to_hub</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">repo_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">num_proc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_upload_dataset_to_hub</span><span class="p">(</span>
            <span class="n">repo_name</span><span class="p">,</span>
            <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">input_column_name</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">label_column_name</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="n">num_proc</span><span class="o">=</span><span class="n">num_proc</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">












  </div>

    </div>

</div><h2 id="text-tasks">Text Tasks<a class="headerlink" href="#text-tasks" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-class">



<h3 id="mteb.abstasks.text.bitext_mining.AbsTaskBitextMining" class="doc doc-heading">
            <code>mteb.abstasks.text.bitext_mining.AbsTaskBitextMining</code>


<a href="#mteb.abstasks.text.bitext_mining.AbsTaskBitextMining" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="&lt;code&gt;mteb.AbsTask&lt;/code&gt; (&lt;code&gt;mteb.abstasks.abstask.AbsTask&lt;/code&gt;)" href="#mteb.AbsTask">AbsTask</a></code></p>



        <p>Abstract class for BitextMining tasks</p>
<p>The similarity is computed between pairs and the results are ranked.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.text.bitext_mining.AbsTaskBitextMining.dataset">dataset</span></code></td>
            <td>
                  <code><span title="dict">dict</span>[<a class="autorefs autorefs-internal" title="&lt;code class=&quot;highlight language-python&quot;&gt;&lt;span class=&quot;n&quot;&gt;HFSubset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;str&lt;/span&gt;&lt;/code&gt;

  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;mteb.types.HFSubset&lt;/code&gt;)" href="../types/#mteb.types._result.HFSubset">HFSubset</a>, <span title="datasets.DatasetDict">DatasetDict</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A HuggingFace dataset containing the data for the task. It must contain the following columns sentence1 and sentence2 for the two texts to be compared.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.text.bitext_mining.AbsTaskBitextMining.parallel_subsets">parallel_subsets</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If true task language pairs should be in one split as column names, otherwise each language pair should be a subset.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.text.bitext_mining.AbsTaskBitextMining.abstask_prompt">abstask_prompt</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Prompt to use for the task for instruction model if not prompt is provided in TaskMetadata.prompt.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>mteb/abstasks/text/bitext_mining.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">AbsTaskBitextMining</span><span class="p">(</span><span class="n">AbsTask</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Abstract class for BitextMining tasks</span>

<span class="sd">    The similarity is computed between pairs and the results are ranked.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        dataset: A HuggingFace dataset containing the data for the task. It must contain the following columns sentence1 and sentence2 for the two texts to be compared.</span>
<span class="sd">        parallel_subsets: If true task language pairs should be in one split as column names, otherwise each language pair should be a subset.</span>
<span class="sd">        abstask_prompt: Prompt to use for the task for instruction model if not prompt is provided in TaskMetadata.prompt.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">parallel_subsets</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">abstask_prompt</span> <span class="o">=</span> <span class="s2">&quot;Retrieve parallel sentences.&quot;</span>
    <span class="n">_DEFAULT_PAIR</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;sentence1&quot;</span><span class="p">,</span> <span class="s2">&quot;sentence2&quot;</span><span class="p">)]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">evaluate</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">MTEBModels</span><span class="p">,</span>
        <span class="n">split</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;test&quot;</span><span class="p">,</span>
        <span class="n">subsets_to_run</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">HFSubset</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">encode_kwargs</span><span class="p">:</span> <span class="n">EncodeKwargs</span><span class="p">,</span>
        <span class="n">prediction_folder</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">num_proc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">HFSubset</span><span class="p">,</span> <span class="n">ScoresDict</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Added load for &quot;parallel&quot; datasets&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">EncoderProtocol</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Expected model to be an instance of EncoderProtocol&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_loaded</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_data</span><span class="p">(</span><span class="n">num_proc</span><span class="o">=</span><span class="n">num_proc</span><span class="p">)</span>

        <span class="n">hf_subsets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hf_subsets</span>

        <span class="c1"># If subsets_to_run is specified, filter the hf_subsets accordingly</span>
        <span class="k">if</span> <span class="n">subsets_to_run</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">hf_subsets</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">hf_subsets</span> <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">subsets_to_run</span><span class="p">]</span>

        <span class="n">encoder_model</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;EncoderProtocol&quot;</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Dataset is not loaded.&quot;</span><span class="p">)</span>

        <span class="n">scores</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">BitextMiningMetrics</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parallel_subsets</span><span class="p">:</span>
            <span class="n">scores</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_subset</span><span class="p">(</span>  <span class="c1"># type: ignore[assignment]</span>
                <span class="n">encoder_model</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">split</span><span class="p">],</span>
                <span class="n">parallel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">hf_split</span><span class="o">=</span><span class="n">split</span><span class="p">,</span>
                <span class="n">hf_subset</span><span class="o">=</span><span class="s2">&quot;parallel&quot;</span><span class="p">,</span>
                <span class="n">encode_kwargs</span><span class="o">=</span><span class="n">encode_kwargs</span><span class="p">,</span>
                <span class="n">prediction_folder</span><span class="o">=</span><span class="n">prediction_folder</span><span class="p">,</span>
                <span class="n">num_proc</span><span class="o">=</span><span class="n">num_proc</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">hf_subset</span> <span class="ow">in</span> <span class="n">hf_subsets</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Task: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, split: </span><span class="si">{</span><span class="n">split</span><span class="si">}</span><span class="s2">, subset: </span><span class="si">{</span><span class="n">hf_subset</span><span class="si">}</span><span class="s2">. Running...&quot;</span>
                <span class="p">)</span>

                <span class="k">if</span> <span class="n">hf_subset</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span> <span class="ow">and</span> <span class="n">hf_subset</span> <span class="o">==</span> <span class="s2">&quot;default&quot;</span><span class="p">:</span>
                    <span class="n">data_split</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">split</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">data_split</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">hf_subset</span><span class="p">][</span><span class="n">split</span><span class="p">]</span>
                <span class="n">scores</span><span class="p">[</span><span class="n">hf_subset</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_subset</span><span class="p">(</span>  <span class="c1"># type: ignore[assignment]</span>
                    <span class="n">encoder_model</span><span class="p">,</span>
                    <span class="n">data_split</span><span class="p">,</span>
                    <span class="n">hf_split</span><span class="o">=</span><span class="n">split</span><span class="p">,</span>
                    <span class="n">hf_subset</span><span class="o">=</span><span class="n">hf_subset</span><span class="p">,</span>
                    <span class="n">encode_kwargs</span><span class="o">=</span><span class="n">encode_kwargs</span><span class="p">,</span>
                    <span class="n">prediction_folder</span><span class="o">=</span><span class="n">prediction_folder</span><span class="p">,</span>
                    <span class="n">num_proc</span><span class="o">=</span><span class="n">num_proc</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;dict[HFSubset, ScoresDict]&quot;</span><span class="p">,</span> <span class="n">scores</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_pairs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parallel</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
        <span class="n">pairs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_DEFAULT_PAIR</span>
        <span class="k">if</span> <span class="n">parallel</span><span class="p">:</span>
            <span class="n">pairs</span> <span class="o">=</span> <span class="p">[</span><span class="n">langpair</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">langpair</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hf_subsets</span><span class="p">]</span>  <span class="c1"># type: ignore[misc]</span>
        <span class="k">return</span> <span class="n">pairs</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_evaluate_subset</span><span class="p">(</span>  <span class="c1"># type: ignore[override]</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">EncoderProtocol</span><span class="p">,</span>
        <span class="n">data_split</span><span class="p">:</span> <span class="n">Dataset</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">hf_split</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">hf_subset</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">encode_kwargs</span><span class="p">:</span> <span class="n">EncodeKwargs</span><span class="p">,</span>
        <span class="n">prediction_folder</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">parallel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">num_proc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BitextMiningMetrics</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">BitextMiningMetrics</span><span class="p">]:</span>
        <span class="n">pairs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_pairs</span><span class="p">(</span><span class="n">parallel</span><span class="p">)</span>

        <span class="n">evaluator</span> <span class="o">=</span> <span class="n">BitextMiningEvaluator</span><span class="p">(</span>
            <span class="n">data_split</span><span class="p">,</span>
            <span class="n">task_metadata</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span>
            <span class="n">pair_columns</span><span class="o">=</span><span class="n">pairs</span><span class="p">,</span>
            <span class="n">hf_split</span><span class="o">=</span><span class="n">hf_split</span><span class="p">,</span>
            <span class="n">hf_subset</span><span class="o">=</span><span class="n">hf_subset</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># NOTE: used only by BUCC</span>
        <span class="n">gold</span> <span class="o">=</span> <span class="p">(</span>
            <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data_split</span><span class="p">)),</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data_split</span><span class="p">))))</span>
            <span class="k">if</span> <span class="s2">&quot;gold&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data_split</span>
            <span class="k">else</span> <span class="n">data_split</span><span class="p">[</span><span class="s2">&quot;gold&quot;</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="n">neighbours</span> <span class="o">=</span> <span class="n">evaluator</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">encode_kwargs</span><span class="o">=</span><span class="n">encode_kwargs</span><span class="p">,</span> <span class="n">num_proc</span><span class="o">=</span><span class="n">num_proc</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">prediction_folder</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_save_task_predictions</span><span class="p">(</span>
                <span class="n">neighbours</span><span class="p">,</span>
                <span class="n">model</span><span class="p">,</span>
                <span class="n">prediction_folder</span><span class="p">,</span>
                <span class="n">hf_subset</span><span class="o">=</span><span class="n">hf_subset</span><span class="p">,</span>
                <span class="n">hf_split</span><span class="o">=</span><span class="n">hf_split</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">parallel</span><span class="p">:</span>
            <span class="n">parallel_metrics</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">keys</span><span class="p">,</span> <span class="n">nearest_neighbors</span> <span class="ow">in</span> <span class="n">neighbours</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">parallel_metrics</span><span class="p">[</span><span class="n">keys</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_metrics</span><span class="p">(</span><span class="n">nearest_neighbors</span><span class="p">,</span> <span class="n">gold</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">parallel_metrics</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_add_main_score</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">parallel_metrics</span>
        <span class="n">def_pair_str</span> <span class="o">=</span> <span class="s2">&quot;-&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_DEFAULT_PAIR</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_metrics</span><span class="p">(</span><span class="n">neighbours</span><span class="p">[</span><span class="n">def_pair_str</span><span class="p">],</span> <span class="n">gold</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_main_score</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">metrics</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_compute_metrics</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">nearest_neighbors</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]],</span>
        <span class="n">gold</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BitextMiningMetrics</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Computing metrics...&quot;</span><span class="p">)</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">predictions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">nearest_neighbors</span><span class="p">):</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;corpus_id&quot;</span><span class="p">]</span>
            <span class="n">predictions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
            <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gold</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">BitextMiningMetrics</span><span class="p">(</span>
            <span class="n">precision</span><span class="o">=</span><span class="n">precision_score</span><span class="p">(</span>
                <span class="n">labels</span><span class="p">,</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">zero_division</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s2">&quot;weighted&quot;</span>
            <span class="p">),</span>
            <span class="n">recall</span><span class="o">=</span><span class="n">recall_score</span><span class="p">(</span>
                <span class="n">labels</span><span class="p">,</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">zero_division</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s2">&quot;weighted&quot;</span>
            <span class="p">),</span>
            <span class="n">f1</span><span class="o">=</span><span class="n">f1_score</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">zero_division</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s2">&quot;weighted&quot;</span><span class="p">),</span>
            <span class="n">accuracy</span><span class="o">=</span><span class="n">accuracy_score</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">predictions</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_calculate_descriptive_statistics_from_split</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">split</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">hf_subset</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">compute_overall</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BitextDescriptiveStatistics</span><span class="p">:</span>
        <span class="n">pairs_cols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_pairs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parallel_subsets</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">hf_subset</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parallel_subsets</span><span class="p">:</span>
                <span class="n">sent_1</span><span class="p">,</span> <span class="n">sent_2</span> <span class="o">=</span> <span class="n">hf_subset</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
                <span class="n">sentence1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">split</span><span class="p">][</span><span class="n">sent_1</span><span class="p">]</span>
                <span class="n">sentence2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">split</span><span class="p">][</span><span class="n">sent_2</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sent_1</span><span class="p">,</span> <span class="n">sent_2</span> <span class="o">=</span> <span class="n">pairs_cols</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">sentence1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">hf_subset</span><span class="p">][</span><span class="n">split</span><span class="p">][</span><span class="n">sent_1</span><span class="p">]</span>
                <span class="n">sentence2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">hf_subset</span><span class="p">][</span><span class="n">split</span><span class="p">][</span><span class="n">sent_2</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">compute_overall</span><span class="p">:</span>
            <span class="n">sentence1</span><span class="p">,</span> <span class="n">sentence2</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parallel_subsets</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">hf_subset</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">eval_langs</span><span class="p">:</span>
                    <span class="n">sent_1</span><span class="p">,</span> <span class="n">sent_2</span> <span class="o">=</span> <span class="n">hf_subset</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
                    <span class="n">sentence1</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">split</span><span class="p">][</span><span class="n">sent_1</span><span class="p">])</span>
                    <span class="n">sentence2</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">split</span><span class="p">][</span><span class="n">sent_2</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sent_1</span><span class="p">,</span> <span class="n">sent_2</span> <span class="o">=</span> <span class="n">pairs_cols</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">hf_subset</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">eval_langs</span><span class="p">:</span>
                    <span class="n">sentence1</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">hf_subset</span><span class="p">][</span><span class="n">split</span><span class="p">][</span><span class="n">sent_1</span><span class="p">])</span>
                    <span class="n">sentence2</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">hf_subset</span><span class="p">][</span><span class="n">split</span><span class="p">][</span><span class="n">sent_2</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sent_1</span><span class="p">,</span> <span class="n">sent_2</span> <span class="o">=</span> <span class="n">pairs_cols</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">sentence1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">split</span><span class="p">][</span><span class="n">sent_1</span><span class="p">]</span>
            <span class="n">sentence2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">split</span><span class="p">][</span><span class="n">sent_2</span><span class="p">]</span>

        <span class="n">text1_statistics</span> <span class="o">=</span> <span class="n">calculate_text_statistics</span><span class="p">(</span><span class="n">sentence1</span><span class="p">)</span>
        <span class="n">text2_statistics</span> <span class="o">=</span> <span class="n">calculate_text_statistics</span><span class="p">(</span><span class="n">sentence2</span><span class="p">)</span>
        <span class="n">unique_pairs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">sentence1</span><span class="p">,</span> <span class="n">sentence2</span><span class="p">)))</span>

        <span class="k">return</span> <span class="n">BitextDescriptiveStatistics</span><span class="p">(</span>
            <span class="n">num_samples</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">sentence1</span><span class="p">),</span>
            <span class="n">number_of_characters</span><span class="o">=</span><span class="p">(</span>
                <span class="n">text1_statistics</span><span class="p">[</span><span class="s2">&quot;total_text_length&quot;</span><span class="p">]</span>
                <span class="o">+</span> <span class="n">text2_statistics</span><span class="p">[</span><span class="s2">&quot;total_text_length&quot;</span><span class="p">]</span>
            <span class="p">),</span>
            <span class="n">unique_pairs</span><span class="o">=</span><span class="n">unique_pairs</span><span class="p">,</span>
            <span class="n">sentence1_statistics</span><span class="o">=</span><span class="n">text1_statistics</span><span class="p">,</span>
            <span class="n">sentence2_statistics</span><span class="o">=</span><span class="n">text2_statistics</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_push_dataset_to_hub</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">repo_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">num_proc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Dataset is not loaded.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">is_multilingual</span><span class="p">:</span>
            <span class="n">dataset</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">config</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">eval_langs</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Converting </span><span class="si">{</span><span class="n">config</span><span class="si">}</span><span class="s2"> of </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parallel_subsets</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">split</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">:</span>
                        <span class="n">sent_1</span><span class="p">,</span> <span class="n">sent_2</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
                        <span class="n">dataset</span><span class="p">[</span><span class="n">split</span><span class="p">][</span><span class="n">sent_1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">split</span><span class="p">][</span><span class="n">sent_1</span><span class="p">]</span>
                        <span class="n">dataset</span><span class="p">[</span><span class="n">split</span><span class="p">][</span><span class="n">sent_2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">split</span><span class="p">][</span><span class="n">sent_2</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">sent_1</span><span class="p">,</span> <span class="n">sent_2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_pairs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parallel_subsets</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">lang_1</span><span class="p">,</span> <span class="n">lang_2</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">split</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">config</span><span class="p">]:</span>
                        <span class="n">dataset</span><span class="p">[</span><span class="n">split</span><span class="p">][</span><span class="n">lang_1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">config</span><span class="p">][</span><span class="n">split</span><span class="p">][</span><span class="n">sent_1</span><span class="p">]</span>
                        <span class="n">dataset</span><span class="p">[</span><span class="n">split</span><span class="p">][</span><span class="n">lang_2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">config</span><span class="p">][</span><span class="n">split</span><span class="p">][</span><span class="n">sent_2</span><span class="p">]</span>
            <span class="n">dataset_dict</span> <span class="o">=</span> <span class="n">DatasetDict</span><span class="p">(</span>
                <span class="p">{</span><span class="n">split</span><span class="p">:</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">dataset</span><span class="p">[</span><span class="n">split</span><span class="p">])</span> <span class="k">for</span> <span class="n">split</span> <span class="ow">in</span> <span class="n">dataset</span><span class="p">}</span>
            <span class="p">)</span>
            <span class="n">dataset_dict</span><span class="o">.</span><span class="n">push_to_hub</span><span class="p">(</span><span class="n">repo_name</span><span class="p">,</span> <span class="n">num_proc</span><span class="o">=</span><span class="n">num_proc</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sentences</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">split</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">:</span>
                <span class="n">sent_1</span><span class="p">,</span> <span class="n">sent_2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_pairs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parallel_subsets</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">sentences</span><span class="p">[</span><span class="n">split</span><span class="p">]</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;sentence1&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">split</span><span class="p">][</span><span class="n">sent_1</span><span class="p">],</span>
                        <span class="s2">&quot;sentence2&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">split</span><span class="p">][</span><span class="n">sent_2</span><span class="p">],</span>
                    <span class="p">}</span>
                <span class="p">)</span>
            <span class="n">sentences</span> <span class="o">=</span> <span class="n">DatasetDict</span><span class="p">(</span><span class="n">sentences</span><span class="p">)</span>
            <span class="n">sentences</span><span class="o">.</span><span class="n">push_to_hub</span><span class="p">(</span><span class="n">repo_name</span><span class="p">,</span> <span class="n">num_proc</span><span class="o">=</span><span class="n">num_proc</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="mteb.abstasks.text.bitext_mining.AbsTaskBitextMining.evaluate" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">evaluate</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="n">subsets_to_run</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">encode_kwargs</span><span class="p">,</span> <span class="n">prediction_folder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_proc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

<a href="#mteb.abstasks.text.bitext_mining.AbsTaskBitextMining.evaluate" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Added load for "parallel" datasets</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>mteb/abstasks/text/bitext_mining.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">evaluate</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">model</span><span class="p">:</span> <span class="n">MTEBModels</span><span class="p">,</span>
    <span class="n">split</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;test&quot;</span><span class="p">,</span>
    <span class="n">subsets_to_run</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">HFSubset</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">encode_kwargs</span><span class="p">:</span> <span class="n">EncodeKwargs</span><span class="p">,</span>
    <span class="n">prediction_folder</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">num_proc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">HFSubset</span><span class="p">,</span> <span class="n">ScoresDict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Added load for &quot;parallel&quot; datasets&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">EncoderProtocol</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Expected model to be an instance of EncoderProtocol&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_loaded</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_data</span><span class="p">(</span><span class="n">num_proc</span><span class="o">=</span><span class="n">num_proc</span><span class="p">)</span>

    <span class="n">hf_subsets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hf_subsets</span>

    <span class="c1"># If subsets_to_run is specified, filter the hf_subsets accordingly</span>
    <span class="k">if</span> <span class="n">subsets_to_run</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">hf_subsets</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">hf_subsets</span> <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">subsets_to_run</span><span class="p">]</span>

    <span class="n">encoder_model</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;EncoderProtocol&quot;</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Dataset is not loaded.&quot;</span><span class="p">)</span>

    <span class="n">scores</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">BitextMiningMetrics</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parallel_subsets</span><span class="p">:</span>
        <span class="n">scores</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_subset</span><span class="p">(</span>  <span class="c1"># type: ignore[assignment]</span>
            <span class="n">encoder_model</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">split</span><span class="p">],</span>
            <span class="n">parallel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">hf_split</span><span class="o">=</span><span class="n">split</span><span class="p">,</span>
            <span class="n">hf_subset</span><span class="o">=</span><span class="s2">&quot;parallel&quot;</span><span class="p">,</span>
            <span class="n">encode_kwargs</span><span class="o">=</span><span class="n">encode_kwargs</span><span class="p">,</span>
            <span class="n">prediction_folder</span><span class="o">=</span><span class="n">prediction_folder</span><span class="p">,</span>
            <span class="n">num_proc</span><span class="o">=</span><span class="n">num_proc</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">hf_subset</span> <span class="ow">in</span> <span class="n">hf_subsets</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Task: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, split: </span><span class="si">{</span><span class="n">split</span><span class="si">}</span><span class="s2">, subset: </span><span class="si">{</span><span class="n">hf_subset</span><span class="si">}</span><span class="s2">. Running...&quot;</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">hf_subset</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span> <span class="ow">and</span> <span class="n">hf_subset</span> <span class="o">==</span> <span class="s2">&quot;default&quot;</span><span class="p">:</span>
                <span class="n">data_split</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">split</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">data_split</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">hf_subset</span><span class="p">][</span><span class="n">split</span><span class="p">]</span>
            <span class="n">scores</span><span class="p">[</span><span class="n">hf_subset</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_subset</span><span class="p">(</span>  <span class="c1"># type: ignore[assignment]</span>
                <span class="n">encoder_model</span><span class="p">,</span>
                <span class="n">data_split</span><span class="p">,</span>
                <span class="n">hf_split</span><span class="o">=</span><span class="n">split</span><span class="p">,</span>
                <span class="n">hf_subset</span><span class="o">=</span><span class="n">hf_subset</span><span class="p">,</span>
                <span class="n">encode_kwargs</span><span class="o">=</span><span class="n">encode_kwargs</span><span class="p">,</span>
                <span class="n">prediction_folder</span><span class="o">=</span><span class="n">prediction_folder</span><span class="p">,</span>
                <span class="n">num_proc</span><span class="o">=</span><span class="n">num_proc</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;dict[HFSubset, ScoresDict]&quot;</span><span class="p">,</span> <span class="n">scores</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="mteb.abstasks.pair_classification.AbsTaskPairClassification" class="doc doc-heading">
            <code>mteb.abstasks.pair_classification.AbsTaskPairClassification</code>


<a href="#mteb.abstasks.pair_classification.AbsTaskPairClassification" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="&lt;code&gt;mteb.AbsTask&lt;/code&gt; (&lt;code&gt;mteb.abstasks.abstask.AbsTask&lt;/code&gt;)" href="#mteb.AbsTask">AbsTask</a></code></p>



        <p>Abstract class for PairClassificationTasks</p>
<p>The similarity is computed between pairs and the results are ranked. Average precision
is computed to measure how well the methods can be used for pairwise pair classification.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.pair_classification.AbsTaskPairClassification.dataset">dataset</span></code></td>
            <td>
                  <code><span title="dict">dict</span>[<a class="autorefs autorefs-internal" title="&lt;code class=&quot;highlight language-python&quot;&gt;&lt;span class=&quot;n&quot;&gt;HFSubset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;str&lt;/span&gt;&lt;/code&gt;

  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;mteb.types.HFSubset&lt;/code&gt;)" href="../types/#mteb.types._result.HFSubset">HFSubset</a>, <span title="datasets.DatasetDict">DatasetDict</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A HuggingFace dataset containing the data for the task. Should contain the following columns: sentence1, sentence2, labels.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.pair_classification.AbsTaskPairClassification.input1_column_name">input1_column_name</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the column containing the first sentence in the pair.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.pair_classification.AbsTaskPairClassification.input2_column_name">input2_column_name</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the column containing the second sentence in the pair.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.pair_classification.AbsTaskPairClassification.label_column_name">label_column_name</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the column containing the labels for the pairs. Labels should be 0 or 1.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.pair_classification.AbsTaskPairClassification.abstask_prompt">abstask_prompt</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Prompt to use for the task for instruction model if not prompt is provided in TaskMetadata.prompt.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.pair_classification.AbsTaskPairClassification.input1_prompt_type">input1_prompt_type</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="&lt;code&gt;PromptType&lt;/code&gt; (&lt;code&gt;mteb.types.PromptType&lt;/code&gt;)" href="../types/#mteb.types._encoder_io.PromptType">PromptType</a> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type of prompt of first input. Used for asymmetric tasks.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.pair_classification.AbsTaskPairClassification.input2_prompt_type">input2_prompt_type</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="&lt;code&gt;PromptType&lt;/code&gt; (&lt;code&gt;mteb.types.PromptType&lt;/code&gt;)" href="../types/#mteb.types._encoder_io.PromptType">PromptType</a> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type of prompt of second input. Used for asymmetric tasks.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>mteb/abstasks/pair_classification.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">AbsTaskPairClassification</span><span class="p">(</span><span class="n">AbsTask</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Abstract class for PairClassificationTasks</span>

<span class="sd">    The similarity is computed between pairs and the results are ranked. Average precision</span>
<span class="sd">    is computed to measure how well the methods can be used for pairwise pair classification.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        dataset: A HuggingFace dataset containing the data for the task. Should contain the following columns: sentence1, sentence2, labels.</span>
<span class="sd">        input1_column_name: The name of the column containing the first sentence in the pair.</span>
<span class="sd">        input2_column_name: The name of the column containing the second sentence in the pair.</span>
<span class="sd">        label_column_name: The name of the column containing the labels for the pairs. Labels should be 0 or 1.</span>
<span class="sd">        abstask_prompt: Prompt to use for the task for instruction model if not prompt is provided in TaskMetadata.prompt.</span>
<span class="sd">        input1_prompt_type: Type of prompt of first input. Used for asymmetric tasks.</span>
<span class="sd">        input2_prompt_type: Type of prompt of second input. Used for asymmetric tasks.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">abstask_prompt</span> <span class="o">=</span> <span class="s2">&quot;Retrieve text that are semantically similar to the given text.&quot;</span>
    <span class="n">input1_column_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;sentence1&quot;</span>
    <span class="n">input2_column_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;sentence2&quot;</span>
    <span class="n">label_column_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;labels&quot;</span>
    <span class="n">input1_prompt_type</span><span class="p">:</span> <span class="n">PromptType</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">input2_prompt_type</span><span class="p">:</span> <span class="n">PromptType</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_evaluate_subset</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">MTEBModels</span><span class="p">,</span>
        <span class="n">data_split</span><span class="p">:</span> <span class="n">Dataset</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">hf_split</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">hf_subset</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">encode_kwargs</span><span class="p">:</span> <span class="n">EncodeKwargs</span><span class="p">,</span>
        <span class="n">prediction_folder</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">num_proc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">EncoderProtocol</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Expected model to be an instance of EncoderProtocol&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">modalities</span> <span class="o">==</span> <span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]:</span>
            <span class="c1"># for compatibility with v1 version where datasets were stored in a single row</span>
            <span class="n">data_split</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">Dataset</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">data_split</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_split</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">data_split</span>
            <span class="p">)</span>
        <span class="n">evaluator</span> <span class="o">=</span> <span class="n">PairClassificationEvaluator</span><span class="p">(</span>
            <span class="n">data_split</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input1_column_name</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input2_column_name</span><span class="p">,</span>
            <span class="n">task_metadata</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span>
            <span class="n">hf_split</span><span class="o">=</span><span class="n">hf_split</span><span class="p">,</span>
            <span class="n">hf_subset</span><span class="o">=</span><span class="n">hf_subset</span><span class="p">,</span>
            <span class="n">input1_prompt_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">input1_prompt_type</span><span class="p">,</span>
            <span class="n">input2_prompt_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">input2_prompt_type</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">similarity_scores</span> <span class="o">=</span> <span class="n">evaluator</span><span class="p">(</span>
            <span class="n">model</span><span class="p">,</span>
            <span class="n">encode_kwargs</span><span class="o">=</span><span class="n">encode_kwargs</span><span class="p">,</span>
            <span class="n">num_proc</span><span class="o">=</span><span class="n">num_proc</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">prediction_folder</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_save_task_predictions</span><span class="p">(</span>
                <span class="n">similarity_scores</span><span class="p">,</span>
                <span class="n">model</span><span class="p">,</span>
                <span class="n">prediction_folder</span><span class="p">,</span>
                <span class="n">hf_subset</span><span class="o">=</span><span class="n">hf_subset</span><span class="p">,</span>
                <span class="n">hf_split</span><span class="o">=</span><span class="n">hf_split</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_metrics</span><span class="p">(</span>
            <span class="n">similarity_scores</span><span class="p">,</span> <span class="n">data_split</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">label_column_name</span><span class="p">]</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_compute_metrics</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">similarity_scores</span><span class="p">:</span> <span class="n">PairClassificationDistances</span><span class="p">,</span> <span class="n">labels</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Computing metrics...&quot;</span><span class="p">)</span>
        <span class="n">np_labels</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
        <span class="n">output_scores</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">max_scores</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">short_name</span><span class="p">,</span> <span class="n">scores</span><span class="p">,</span> <span class="n">reverse</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="p">[</span>
                <span class="s2">&quot;similarity&quot;</span><span class="p">,</span>
                <span class="n">similarity_scores</span><span class="p">[</span><span class="s2">&quot;similarity_scores&quot;</span><span class="p">],</span>
                <span class="kc">True</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="p">[</span><span class="n">ScoringFunction</span><span class="o">.</span><span class="n">COSINE</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">similarity_scores</span><span class="p">[</span><span class="s2">&quot;cosine_scores&quot;</span><span class="p">],</span> <span class="kc">True</span><span class="p">],</span>
            <span class="p">[</span>
                <span class="n">ScoringFunction</span><span class="o">.</span><span class="n">MANHATTAN</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                <span class="n">similarity_scores</span><span class="p">[</span><span class="s2">&quot;manhattan_distances&quot;</span><span class="p">],</span>
                <span class="kc">False</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="p">[</span>
                <span class="n">ScoringFunction</span><span class="o">.</span><span class="n">EUCLIDEAN</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                <span class="n">similarity_scores</span><span class="p">[</span><span class="s2">&quot;euclidean_distances&quot;</span><span class="p">],</span>
                <span class="kc">False</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="p">[</span><span class="n">ScoringFunction</span><span class="o">.</span><span class="n">DOT_PRODUCT</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">similarity_scores</span><span class="p">[</span><span class="s2">&quot;dot_scores&quot;</span><span class="p">],</span> <span class="kc">True</span><span class="p">],</span>
        <span class="p">]:</span>
            <span class="n">metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_metrics_values</span><span class="p">(</span><span class="n">scores</span><span class="p">,</span> <span class="n">np_labels</span><span class="p">,</span> <span class="n">reverse</span><span class="p">)</span>  <span class="c1"># type: ignore[arg-type]</span>
            <span class="k">for</span> <span class="n">metric_name</span><span class="p">,</span> <span class="n">metric_value</span> <span class="ow">in</span> <span class="n">metrics</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">output_scores</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">short_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">metric_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">metric_value</span>
                <span class="n">max_scores</span><span class="p">[</span><span class="n">metric_name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">metric_value</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">max_scores</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">metric</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;f1&quot;</span><span class="p">,</span> <span class="s2">&quot;ap&quot;</span><span class="p">,</span> <span class="s2">&quot;precision&quot;</span><span class="p">,</span> <span class="s2">&quot;recall&quot;</span><span class="p">,</span> <span class="s2">&quot;accuracy&quot;</span><span class="p">]:</span>
                <span class="n">output_scores</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;max_</span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_scores</span><span class="p">[</span><span class="n">metric</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">output_scores</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_calculate_descriptive_statistics_from_split</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">split</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">hf_subset</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">compute_overall</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PairClassificationDescriptiveStatistics</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">hf_subset</span><span class="p">:</span>
            <span class="n">dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">hf_subset</span><span class="p">][</span><span class="n">split</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">compute_overall</span><span class="p">:</span>
            <span class="n">dataset</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">hf_subset</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">eval_langs</span><span class="p">:</span>
                <span class="n">cur_dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">hf_subset</span><span class="p">][</span><span class="n">split</span><span class="p">]</span>
                <span class="c1"># for compatibility with v1 version where datasets were stored in a single row</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cur_dataset</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">cur_dataset</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">cur_dataset</span> <span class="o">=</span> <span class="n">cur_dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cur_dataset</span><span class="p">,</span> <span class="n">Dataset</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cur_dataset</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">row</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                            <span class="n">dataset</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">cur_dataset</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="n">dataset</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">split</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">input1</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">dataset</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">input1_column_name</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">input1_column_name</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span>
            <span class="k">else</span> <span class="n">dataset</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">input1_column_name</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">input2</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">dataset</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">input2_column_name</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">input2_column_name</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span>
            <span class="k">else</span> <span class="n">dataset</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">input2_column_name</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">dataset</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">label_column_name</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">label_column_name</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span>
            <span class="k">else</span> <span class="n">dataset</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">label_column_name</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="n">text1_statistics</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">text2_statistics</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">image1_statistics</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">image2_statistics</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">number_of_characters</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">audio1_statistics</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">audio2_statistics</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">unique_pairs</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">modalities</span> <span class="o">==</span> <span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]:</span>
            <span class="n">text1_statistics</span> <span class="o">=</span> <span class="n">calculate_text_statistics</span><span class="p">(</span><span class="n">input1</span><span class="p">)</span>
            <span class="n">text2_statistics</span> <span class="o">=</span> <span class="n">calculate_text_statistics</span><span class="p">(</span><span class="n">input2</span><span class="p">)</span>
            <span class="n">number_of_characters</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">text1_statistics</span><span class="p">[</span><span class="s2">&quot;total_text_length&quot;</span><span class="p">]</span>
                <span class="o">+</span> <span class="n">text2_statistics</span><span class="p">[</span><span class="s2">&quot;total_text_length&quot;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">unique_pairs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">input1</span><span class="p">,</span> <span class="n">input2</span><span class="p">)))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">modalities</span> <span class="o">==</span> <span class="p">[</span><span class="s2">&quot;image&quot;</span><span class="p">]:</span>
            <span class="n">image1_statistics</span> <span class="o">=</span> <span class="n">calculate_image_statistics</span><span class="p">(</span><span class="n">input1</span><span class="p">)</span>
            <span class="n">image2_statistics</span> <span class="o">=</span> <span class="n">calculate_image_statistics</span><span class="p">(</span><span class="n">input2</span><span class="p">)</span>

            <span class="k">def</span><span class="w"> </span><span class="nf">_compute_image_hash</span><span class="p">(</span><span class="n">inputs</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
                <span class="n">hashes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="n">inputs</span><span class="p">:</span>
                    <span class="n">img_bytes</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span>
                    <span class="n">img_hash</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="n">img_bytes</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
                    <span class="n">hashes</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">img_hash</span><span class="p">)</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">hashes</span><span class="p">)</span>

            <span class="n">image_1_hashes</span> <span class="o">=</span> <span class="n">_compute_image_hash</span><span class="p">(</span><span class="n">input1</span><span class="p">)</span>
            <span class="n">image_2_hashes</span> <span class="o">=</span> <span class="n">_compute_image_hash</span><span class="p">(</span><span class="n">input2</span><span class="p">)</span>
            <span class="n">unique_pairs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">image_1_hashes</span><span class="p">,</span> <span class="n">image_2_hashes</span><span class="p">)))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">modalities</span> <span class="o">==</span> <span class="p">[</span><span class="s2">&quot;audio&quot;</span><span class="p">]:</span>
            <span class="n">audio1_statistics</span> <span class="o">=</span> <span class="n">calculate_audio_statistics</span><span class="p">(</span><span class="n">input1</span><span class="p">)</span>
            <span class="n">audio2_statistics</span> <span class="o">=</span> <span class="n">calculate_audio_statistics</span><span class="p">(</span><span class="n">input2</span><span class="p">)</span>

            <span class="k">def</span><span class="w"> </span><span class="nf">_compute_audio_hash</span><span class="p">(</span><span class="n">inputs</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
                <span class="n">hashes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">audio</span> <span class="ow">in</span> <span class="n">inputs</span><span class="p">:</span>
                    <span class="n">array</span> <span class="o">=</span> <span class="n">audio</span><span class="p">[</span><span class="s2">&quot;array&quot;</span><span class="p">]</span>
                    <span class="n">audio_bytes</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span>
                    <span class="n">audio_hash</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="n">audio_bytes</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
                    <span class="n">hashes</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">audio_hash</span><span class="p">)</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">hashes</span><span class="p">)</span>

            <span class="n">audio_1_hashes</span> <span class="o">=</span> <span class="n">_compute_audio_hash</span><span class="p">(</span><span class="n">input1</span><span class="p">)</span>
            <span class="n">audio_2_hashes</span> <span class="o">=</span> <span class="n">_compute_audio_hash</span><span class="p">(</span><span class="n">input2</span><span class="p">)</span>
            <span class="n">unique_pairs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">audio_1_hashes</span><span class="p">,</span> <span class="n">audio_2_hashes</span><span class="p">)))</span>

        <span class="k">return</span> <span class="n">PairClassificationDescriptiveStatistics</span><span class="p">(</span>
            <span class="n">num_samples</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">input1</span><span class="p">),</span>
            <span class="n">unique_pairs</span><span class="o">=</span><span class="n">unique_pairs</span><span class="p">,</span>
            <span class="n">number_of_characters</span><span class="o">=</span><span class="n">number_of_characters</span><span class="p">,</span>
            <span class="n">text1_statistics</span><span class="o">=</span><span class="n">text1_statistics</span><span class="p">,</span>
            <span class="n">image1_statistics</span><span class="o">=</span><span class="n">image1_statistics</span><span class="p">,</span>
            <span class="n">audio1_statistics</span><span class="o">=</span><span class="n">audio1_statistics</span><span class="p">,</span>
            <span class="n">text2_statistics</span><span class="o">=</span><span class="n">text2_statistics</span><span class="p">,</span>
            <span class="n">image2_statistics</span><span class="o">=</span><span class="n">image2_statistics</span><span class="p">,</span>
            <span class="n">audio2_statistics</span><span class="o">=</span><span class="n">audio2_statistics</span><span class="p">,</span>
            <span class="n">labels_statistics</span><span class="o">=</span><span class="n">calculate_label_statistics</span><span class="p">(</span><span class="n">labels</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_push_dataset_to_hub</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">repo_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">num_proc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># previously pair classification datasets were stored in a single row</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># overall this shouldn&#39;t happen as we check for dataset before pushing to hub</span>
            <span class="c1"># added here for type checking purposes</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;Dataset not loaded. To load dataset run `task.load_data()`.&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">is_multilingual</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">subset</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">split</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">subset</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">subset</span><span class="p">][</span><span class="n">split</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">subset</span><span class="p">][</span><span class="n">split</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">subset</span><span class="p">][</span><span class="n">split</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">split</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">split</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">split</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">split</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_upload_dataset_to_hub</span><span class="p">(</span>
            <span class="n">repo_name</span><span class="p">,</span>
            <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">input1_column_name</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">input2_column_name</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">label_column_name</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="n">num_proc</span><span class="o">=</span><span class="n">num_proc</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_compute_metrics_values</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">scores</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
        <span class="n">labels</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">],</span>
        <span class="n">high_score_more_similar</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute the metrics for the given scores and labels.</span>

<span class="sd">        Args:</span>
<span class="sd">            scores: The similarity/dissimilarity scores for the pairs, specified as an array of shape (n_pairs, ).</span>
<span class="sd">            labels: The labels for the pairs, specified as an array of shape (n_pairs, ).</span>
<span class="sd">            high_score_more_similar: If true, then the higher the score, the more similar the pairs are.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The metrics for the given scores and labels.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">acc</span><span class="p">,</span> <span class="n">acc_threshold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_best_acc_and_threshold</span><span class="p">(</span>
            <span class="n">scores</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">high_score_more_similar</span>
        <span class="p">)</span>
        <span class="p">(</span>
            <span class="n">f1</span><span class="p">,</span>
            <span class="n">precision</span><span class="p">,</span>
            <span class="n">recall</span><span class="p">,</span>
            <span class="n">f1_threshold</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_best_f1_and_threshold</span><span class="p">(</span><span class="n">scores</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">high_score_more_similar</span><span class="p">)</span>
        <span class="n">ap</span> <span class="o">=</span> <span class="n">average_precision_score</span><span class="p">(</span>
            <span class="n">labels</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="k">if</span> <span class="n">high_score_more_similar</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">accuracy</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">acc</span><span class="p">),</span>
            <span class="n">f1</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">f1</span><span class="p">),</span>
            <span class="n">precision</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">precision</span><span class="p">),</span>
            <span class="n">recall</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">recall</span><span class="p">),</span>
            <span class="n">ap</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">ap</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_find_best_acc_and_threshold</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">scores</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
        <span class="n">labels</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">],</span>
        <span class="n">high_score_more_similar</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">scores</span><span class="p">,</span> <span class="n">labels</span><span class="p">))</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="n">high_score_more_similar</span><span class="p">)</span>

        <span class="n">max_acc</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">best_threshold</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>
        <span class="n">positive_so_far</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">remaining_negatives</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">labels</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">score</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">rows</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">label</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">positive_so_far</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">remaining_negatives</span> <span class="o">-=</span> <span class="mi">1</span>

            <span class="n">acc</span> <span class="o">=</span> <span class="p">(</span><span class="n">positive_so_far</span> <span class="o">+</span> <span class="n">remaining_negatives</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">acc</span> <span class="o">&gt;</span> <span class="n">max_acc</span><span class="p">:</span>
                <span class="n">max_acc</span> <span class="o">=</span> <span class="n">acc</span>
                <span class="n">best_threshold</span> <span class="o">=</span> <span class="p">(</span><span class="n">rows</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">rows</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="k">return</span> <span class="n">max_acc</span><span class="p">,</span> <span class="n">best_threshold</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_find_best_f1_and_threshold</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">scores</span><span class="p">,</span> <span class="n">labels</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">],</span> <span class="n">high_score_more_similar</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
        <span class="n">scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>

        <span class="n">rows</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">scores</span><span class="p">,</span> <span class="n">labels</span><span class="p">))</span>

        <span class="n">rows</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="n">high_score_more_similar</span><span class="p">)</span>

        <span class="n">best_f1</span> <span class="o">=</span> <span class="n">best_precision</span> <span class="o">=</span> <span class="n">best_recall</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">threshold</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">nextract</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">ncorrect</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">total_num_duplicates</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">score</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">rows</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">nextract</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="k">if</span> <span class="n">label</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">ncorrect</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="k">if</span> <span class="n">ncorrect</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">precision</span> <span class="o">=</span> <span class="n">ncorrect</span> <span class="o">/</span> <span class="n">nextract</span>
                <span class="n">recall</span> <span class="o">=</span> <span class="n">ncorrect</span> <span class="o">/</span> <span class="n">total_num_duplicates</span>
                <span class="n">f1</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">precision</span> <span class="o">*</span> <span class="n">recall</span> <span class="o">/</span> <span class="p">(</span><span class="n">precision</span> <span class="o">+</span> <span class="n">recall</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">f1</span> <span class="o">&gt;</span> <span class="n">best_f1</span><span class="p">:</span>
                    <span class="n">best_f1</span> <span class="o">=</span> <span class="n">f1</span>
                    <span class="n">best_precision</span> <span class="o">=</span> <span class="n">precision</span>
                    <span class="n">best_recall</span> <span class="o">=</span> <span class="n">recall</span>
                    <span class="n">threshold</span> <span class="o">=</span> <span class="p">(</span><span class="n">rows</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">rows</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="k">return</span> <span class="n">best_f1</span><span class="p">,</span> <span class="n">best_precision</span><span class="p">,</span> <span class="n">best_recall</span><span class="p">,</span> <span class="n">threshold</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="mteb.abstasks.text.summarization.AbsTaskSummarization" class="doc doc-heading">
            <code>mteb.abstasks.text.summarization.AbsTaskSummarization</code>


<a href="#mteb.abstasks.text.summarization.AbsTaskSummarization" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="&lt;code&gt;mteb.AbsTask&lt;/code&gt; (&lt;code&gt;mteb.abstasks.abstask.AbsTask&lt;/code&gt;)" href="#mteb.AbsTask">AbsTask</a></code></p>



        <p>Abstract class for summarization experiments.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.text.summarization.AbsTaskSummarization.dataset">dataset</span></code></td>
            <td>
                  <code><span title="dict">dict</span>[<a class="autorefs autorefs-internal" title="&lt;code class=&quot;highlight language-python&quot;&gt;&lt;span class=&quot;n&quot;&gt;HFSubset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;str&lt;/span&gt;&lt;/code&gt;

  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;mteb.types.HFSubset&lt;/code&gt;)" href="../types/#mteb.types._result.HFSubset">HFSubset</a>, <span title="datasets.DatasetDict">DatasetDict</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>HuggingFace dataset containing the data for the task. Should have columns:
- text: The original text to be summarized.
- human_summaries: A list of human-written summaries for the text.
- machine_summaries: A list of machine-generated summaries for the text.
- relevance: A list of relevance scores (integers) corresponding to each machine summary, indicating how relevant each summary is to the original text.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.text.summarization.AbsTaskSummarization.min_score">min_score</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum possible relevance score (inclusive).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.text.summarization.AbsTaskSummarization.max_score">max_score</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum possible relevance score (inclusive).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.text.summarization.AbsTaskSummarization.human_summaries_column_name">human_summaries_column_name</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the column containing human summaries.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.text.summarization.AbsTaskSummarization.machine_summaries_column_name">machine_summaries_column_name</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the column containing machine summaries.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.text.summarization.AbsTaskSummarization.text_column_name">text_column_name</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the column containing the original text.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.text.summarization.AbsTaskSummarization.relevancy_column_name">relevancy_column_name</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the column containing relevance scores.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.text.summarization.AbsTaskSummarization.abstask_prompt">abstask_prompt</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Prompt to use for the task for instruction model if not prompt is provided in TaskMetadata.prompt.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>mteb/abstasks/text/summarization.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">AbsTaskSummarization</span><span class="p">(</span><span class="n">AbsTask</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Abstract class for summarization experiments.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        dataset: HuggingFace dataset containing the data for the task. Should have columns:</span>
<span class="sd">            - text: The original text to be summarized.</span>
<span class="sd">            - human_summaries: A list of human-written summaries for the text.</span>
<span class="sd">            - machine_summaries: A list of machine-generated summaries for the text.</span>
<span class="sd">            - relevance: A list of relevance scores (integers) corresponding to each machine summary, indicating how relevant each summary is to the original text.</span>
<span class="sd">        min_score: Minimum possible relevance score (inclusive).</span>
<span class="sd">        max_score: Maximum possible relevance score (inclusive).</span>
<span class="sd">        human_summaries_column_name: Name of the column containing human summaries.</span>
<span class="sd">        machine_summaries_column_name: Name of the column containing machine summaries.</span>
<span class="sd">        text_column_name: Name of the column containing the original text.</span>
<span class="sd">        relevancy_column_name: Name of the column containing relevance scores.</span>
<span class="sd">        abstask_prompt: Prompt to use for the task for instruction model if not prompt is provided in TaskMetadata.prompt.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">min_score</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">max_score</span><span class="p">:</span> <span class="nb">int</span>

    <span class="n">abstask_prompt</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;Given a news summary, retrieve other semantically similar summaries.&quot;</span>
    <span class="p">)</span>
    <span class="c1"># SummEval has DeprecatedSummarizationEvaluator</span>
    <span class="n">evaluator</span> <span class="o">=</span> <span class="n">SummarizationEvaluator</span>
    <span class="n">text_column_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;text&quot;</span>
    <span class="n">human_summaries_column_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;human_summaries&quot;</span>
    <span class="n">machine_summaries_column_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;machine_summaries&quot;</span>
    <span class="n">relevancy_column_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;relevance&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_evaluate_subset</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">MTEBModels</span><span class="p">,</span>
        <span class="n">data_split</span><span class="p">:</span> <span class="n">Dataset</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">hf_split</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">hf_subset</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">encode_kwargs</span><span class="p">:</span> <span class="n">EncodeKwargs</span><span class="p">,</span>
        <span class="n">prediction_folder</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">num_proc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SummarizationMetrics</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">EncoderProtocol</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Expected model to be an instance of EncoderProtocol&quot;</span><span class="p">)</span>

        <span class="n">normalized_scores</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span>
                <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_score</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_score</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_score</span><span class="p">)</span>
            <span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data_split</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">relevancy_column_name</span><span class="p">]</span>
        <span class="p">]</span>
        <span class="n">evaluator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluator</span><span class="p">(</span>
            <span class="n">machine_summaries</span><span class="o">=</span><span class="n">data_split</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">machine_summaries_column_name</span><span class="p">],</span>
            <span class="n">human_summaries</span><span class="o">=</span><span class="n">data_split</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">human_summaries_column_name</span><span class="p">],</span>
            <span class="n">texts</span><span class="o">=</span><span class="n">data_split</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">text_column_name</span><span class="p">],</span>
            <span class="n">gold_scores</span><span class="o">=</span><span class="n">normalized_scores</span><span class="p">,</span>
            <span class="n">task_metadata</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span>
            <span class="n">hf_split</span><span class="o">=</span><span class="n">hf_split</span><span class="p">,</span>
            <span class="n">hf_subset</span><span class="o">=</span><span class="n">hf_subset</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">scores</span> <span class="o">=</span> <span class="n">evaluator</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">encode_kwargs</span><span class="o">=</span><span class="n">encode_kwargs</span><span class="p">,</span> <span class="n">num_proc</span><span class="o">=</span><span class="n">num_proc</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">prediction_folder</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_save_task_predictions</span><span class="p">(</span>
                <span class="n">scores</span><span class="p">,</span>
                <span class="n">model</span><span class="p">,</span>
                <span class="n">prediction_folder</span><span class="p">,</span>
                <span class="n">hf_subset</span><span class="o">=</span><span class="n">hf_subset</span><span class="p">,</span>
                <span class="n">hf_split</span><span class="o">=</span><span class="n">hf_split</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">evaluator</span><span class="o">.</span><span class="n">_calculate_metrics</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_calculate_descriptive_statistics_from_split</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">split</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">hf_subset</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">compute_overall</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SummarizationDescriptiveStatistics</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">hf_subset</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">hf_subset</span><span class="p">][</span><span class="n">split</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">text_column_name</span><span class="p">]</span>
            <span class="n">human_summaries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">hf_subset</span><span class="p">][</span><span class="n">split</span><span class="p">][</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">human_summaries_column_name</span>
            <span class="p">]</span>
            <span class="n">machine_summaries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">hf_subset</span><span class="p">][</span><span class="n">split</span><span class="p">][</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">machine_summaries_column_name</span>
            <span class="p">]</span>
            <span class="n">relevance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">hf_subset</span><span class="p">][</span><span class="n">split</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">relevancy_column_name</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">compute_overall</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">human_summaries</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">machine_summaries</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">relevance</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">hf_subset</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">eval_langs</span><span class="p">:</span>
                <span class="n">text</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">hf_subset</span><span class="p">][</span><span class="n">split</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">text_column_name</span><span class="p">])</span>
                <span class="n">human_summaries</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">hf_subset</span><span class="p">][</span><span class="n">split</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">human_summaries_column_name</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="n">machine_summaries</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">hf_subset</span><span class="p">][</span><span class="n">split</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">machine_summaries_column_name</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="n">relevance</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">hf_subset</span><span class="p">][</span><span class="n">split</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">relevancy_column_name</span><span class="p">]</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">split</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">text_column_name</span><span class="p">]</span>
            <span class="n">human_summaries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">split</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">human_summaries_column_name</span><span class="p">]</span>
            <span class="n">machine_summaries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">split</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">machine_summaries_column_name</span><span class="p">]</span>
            <span class="n">relevance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">split</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">relevancy_column_name</span><span class="p">]</span>

        <span class="n">all_human_summaries</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">human_summaries</span><span class="p">:</span>
            <span class="n">all_human_summaries</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

        <span class="n">all_machine_summaries</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">machine_summaries</span><span class="p">:</span>
            <span class="n">all_machine_summaries</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

        <span class="n">text_statistics</span> <span class="o">=</span> <span class="n">calculate_text_statistics</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="n">human_summaries_statistics</span> <span class="o">=</span> <span class="n">calculate_text_statistics</span><span class="p">(</span><span class="n">all_human_summaries</span><span class="p">)</span>
        <span class="n">machine_summaries_statistics</span> <span class="o">=</span> <span class="n">calculate_text_statistics</span><span class="p">(</span><span class="n">all_machine_summaries</span><span class="p">)</span>

        <span class="n">relevance</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">relevance</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">SummarizationDescriptiveStatistics</span><span class="p">(</span>
            <span class="n">num_samples</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">),</span>
            <span class="n">number_of_characters</span><span class="o">=</span><span class="p">(</span>
                <span class="n">text_statistics</span><span class="p">[</span><span class="s2">&quot;total_text_length&quot;</span><span class="p">]</span>
                <span class="o">+</span> <span class="n">human_summaries_statistics</span><span class="p">[</span><span class="s2">&quot;total_text_length&quot;</span><span class="p">]</span>
                <span class="o">+</span> <span class="n">machine_summaries_statistics</span><span class="p">[</span><span class="s2">&quot;total_text_length&quot;</span><span class="p">]</span>
            <span class="p">),</span>
            <span class="n">text_statistics</span><span class="o">=</span><span class="n">text_statistics</span><span class="p">,</span>
            <span class="n">human_summaries_statistics</span><span class="o">=</span><span class="n">human_summaries_statistics</span><span class="p">,</span>
            <span class="n">machine_summaries_statistics</span><span class="o">=</span><span class="n">machine_summaries_statistics</span><span class="p">,</span>
            <span class="n">score_statistics</span><span class="o">=</span><span class="n">calculate_score_statistics</span><span class="p">(</span><span class="n">relevance</span><span class="p">),</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="mteb.abstasks.text.reranking.AbsTaskReranking" class="doc doc-heading">
            <code>mteb.abstasks.text.reranking.AbsTaskReranking</code>


<a href="#mteb.abstasks.text.reranking.AbsTaskReranking" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="&lt;code&gt;mteb.abstasks.retrieval.AbsTaskRetrieval&lt;/code&gt;" href="#mteb.abstasks.retrieval.AbsTaskRetrieval">AbsTaskRetrieval</a></code></p>



        <p>Reranking task class.</p>


<details class="warning" open>
  <summary>Deprecated</summary>
  <p>This class is deprecated and will be removed in future versions. Please use the updated retrieval tasks instead.
You can add your task name to mteb.abstasks.text.reranking.OLD_FORMAT_RERANKING_TASKS to load it in new format.
You can reupload it using <code>task.push_dataset_to_hub('your/repository')</code> after loading the data.
For dataformat and other information, see <a class="autorefs autorefs-internal" title="&lt;code&gt;mteb.abstasks.retrieval.AbsTaskRetrieval&lt;/code&gt;" href="#mteb.abstasks.retrieval.AbsTaskRetrieval">AbsTaskRetrieval</a>.</p>
</details>







              <details class="mkdocstrings-source">
                <summary>Source code in <code>mteb/abstasks/text/reranking.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@deprecated</span><span class="p">(</span>
    <span class="s2">&quot;This class is deprecated and will be removed in future versions. Please use the updated retrieval tasks instead. &quot;</span>
    <span class="s2">&quot;You can add your task name to mteb.abstasks.text.reranking.OLD_FORMAT_RERANKING_TASKS to load it in new format. &quot;</span>
    <span class="s2">&quot;You can reupload it using `task.push_dataset_to_hub(&#39;your/repository&#39;)` after loading the data.&quot;</span>
<span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">AbsTaskReranking</span><span class="p">(</span><span class="n">AbsTaskRetrieval</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Reranking task class.</span>

<span class="sd">    Warning: Deprecated</span>
<span class="sd">        This class is deprecated and will be removed in future versions. Please use the updated retrieval tasks instead.</span>
<span class="sd">        You can add your task name to mteb.abstasks.text.reranking.OLD_FORMAT_RERANKING_TASKS to load it in new format.</span>
<span class="sd">        You can reupload it using `task.push_dataset_to_hub(&#39;your/repository&#39;)` after loading the data.</span>
<span class="sd">        For dataformat and other information, see [AbsTaskRetrieval][mteb.abstasks.retrieval.AbsTaskRetrieval].</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">load_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_proc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load the dataset.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_loaded</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">OLD_FORMAT_RERANKING_TASKS</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">transform_old_dataset_format</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># use AbsTaskRetrieval default to load the data</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">load_data</span><span class="p">(</span><span class="n">num_proc</span><span class="o">=</span><span class="n">num_proc</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_process_example</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">example</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">split</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">query_idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Process a single example from the dataset.</span>

<span class="sd">        Args:</span>
<span class="sd">            example: A single example from the dataset containing &#39;query&#39;, &#39;positive&#39;, and &#39;negative&#39; fields.</span>
<span class="sd">            split: The dataset split (e.g., &#39;train&#39;, &#39;validation&#39;, &#39;test&#39;).</span>
<span class="sd">            query_idx: The index of the query in the dataset split.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A dictionary containing the processed example with query_id, query text, document ids, document texts, and relevance scores.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">query</span> <span class="o">=</span> <span class="n">example</span><span class="p">[</span><span class="s2">&quot;query&quot;</span><span class="p">]</span>
        <span class="n">positive_docs</span> <span class="o">=</span> <span class="n">example</span><span class="p">[</span><span class="s2">&quot;positive&quot;</span><span class="p">]</span>
        <span class="n">negative_docs</span> <span class="o">=</span> <span class="n">example</span><span class="p">[</span><span class="s2">&quot;negative&quot;</span><span class="p">]</span>

        <span class="n">query_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">split</span><span class="si">}</span><span class="s2">_query</span><span class="si">{</span><span class="n">query_idx</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="c1"># Initialize the structures for this example</span>
        <span class="n">example_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;query_id&quot;</span><span class="p">:</span> <span class="n">query_id</span><span class="p">,</span>
            <span class="s2">&quot;query&quot;</span><span class="p">:</span> <span class="n">query</span><span class="p">,</span>
            <span class="s2">&quot;doc_ids&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;doc_texts&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;relevance_scores&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">pos_doc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">positive_docs</span><span class="p">):</span>
            <span class="c1"># format i as a five digit number</span>
            <span class="n">formatted_i</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
            <span class="c1"># have &quot;a&quot; in front so that positives are first, then negatives</span>
            <span class="c1">#   this shouldn&#39;t matter except for ties, and the previous reranking results</span>
            <span class="c1">#   had the positives first</span>
            <span class="n">doc_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;apositive_</span><span class="si">{</span><span class="n">query_id</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">formatted_i</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">example_data</span><span class="p">[</span><span class="s2">&quot;doc_ids&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">doc_id</span><span class="p">)</span>
            <span class="n">example_data</span><span class="p">[</span><span class="s2">&quot;doc_texts&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pos_doc</span><span class="p">)</span>
            <span class="n">example_data</span><span class="p">[</span><span class="s2">&quot;relevance_scores&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">neg_doc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">negative_docs</span><span class="p">):</span>
            <span class="n">formatted_i</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
            <span class="n">doc_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;negative_</span><span class="si">{</span><span class="n">query_id</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">formatted_i</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">example_data</span><span class="p">[</span><span class="s2">&quot;doc_ids&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">doc_id</span><span class="p">)</span>
            <span class="n">example_data</span><span class="p">[</span><span class="s2">&quot;doc_texts&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">neg_doc</span><span class="p">)</span>
            <span class="n">example_data</span><span class="p">[</span><span class="s2">&quot;relevance_scores&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">example_data</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">transform_old_dataset_format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">given_dataset</span><span class="p">:</span> <span class="n">Dataset</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Transform the old format to the new format using HF datasets mapping. This is a one-time transformation for datasets which are in the old format.</span>

<span class="sd">        Args:</span>
<span class="sd">            given_dataset (Dataset, optional): The dataset to transform. Defaults to None. This is helpful for some older datasets which are loaded with custom code, but need to be transformed still.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">OLD_FORMAT_RERANKING_TASKS</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Transforming old format to standard format for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

        <span class="n">given_dataset</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">given_dataset</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">RetrievalSplitData</span><span class="p">]]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>  <span class="c1"># type: ignore[arg-type]</span>
        <span class="p">)</span>

        <span class="n">hf_subsets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hf_subsets</span>

        <span class="k">for</span> <span class="n">hf_subset</span> <span class="ow">in</span> <span class="n">hf_subsets</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">given_dataset</span><span class="p">:</span>
                <span class="n">cur_dataset</span> <span class="o">=</span> <span class="n">given_dataset</span>
                <span class="k">if</span> <span class="n">hf_subset</span> <span class="ow">in</span> <span class="n">cur_dataset</span><span class="p">:</span>
                    <span class="n">cur_dataset</span> <span class="o">=</span> <span class="n">cur_dataset</span><span class="p">[</span><span class="n">hf_subset</span><span class="p">]</span>
            <span class="k">elif</span> <span class="s2">&quot;name&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">dataset</span><span class="p">:</span>
                <span class="n">cur_dataset</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">load_dataset</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">dataset</span><span class="p">)</span>
                <span class="k">assert</span> <span class="n">hf_subset</span> <span class="o">==</span> <span class="s2">&quot;default&quot;</span><span class="p">,</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Only default subset is supported for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> since `name` is given in the metadata.&quot;</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cur_dataset</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">load_dataset</span><span class="p">(</span>
                    <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">dataset</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">hf_subset</span>
                <span class="p">)</span>

            <span class="k">for</span> <span class="n">split</span> <span class="ow">in</span> <span class="n">cur_dataset</span><span class="p">:</span>
                <span class="n">corpus</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">queries</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">relevant_docs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
                <span class="n">top_ranked</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

                <span class="c1"># Create an enumerated dataset to pass indices</span>
                <span class="n">enumerated_dataset</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;index&quot;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cur_dataset</span><span class="p">[</span><span class="n">split</span><span class="p">])),</span>
                        <span class="s2">&quot;query&quot;</span><span class="p">:</span> <span class="n">cur_dataset</span><span class="p">[</span><span class="n">split</span><span class="p">][</span><span class="s2">&quot;query&quot;</span><span class="p">],</span>
                        <span class="s2">&quot;positive&quot;</span><span class="p">:</span> <span class="n">cur_dataset</span><span class="p">[</span><span class="n">split</span><span class="p">][</span><span class="s2">&quot;positive&quot;</span><span class="p">],</span>
                        <span class="s2">&quot;negative&quot;</span><span class="p">:</span> <span class="n">cur_dataset</span><span class="p">[</span><span class="n">split</span><span class="p">][</span><span class="s2">&quot;negative&quot;</span><span class="p">],</span>
                    <span class="p">}</span>
                <span class="p">)</span>

                <span class="c1"># first, filter out the ones that have no positive or no negatives</span>
                <span class="n">enumerated_dataset</span> <span class="o">=</span> <span class="n">enumerated_dataset</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">example</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">example</span><span class="p">[</span><span class="s2">&quot;positive&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span>
                    <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">example</span><span class="p">[</span><span class="s2">&quot;negative&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span>
                <span class="p">)</span>

                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Filtered out </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">cur_dataset</span><span class="p">[</span><span class="n">split</span><span class="p">])</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="n">enumerated_dataset</span><span class="p">)</span><span class="si">}</span><span class="s2"> examples with no positive or no negative examples. </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">enumerated_dataset</span><span class="p">)</span><span class="si">}</span><span class="s2"> examples remaining.&quot;</span>
                <span class="p">)</span>

                <span class="c1"># Map the transformation function over the dataset</span>
                <span class="n">processed_dataset</span> <span class="o">=</span> <span class="n">enumerated_dataset</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">example</span><span class="p">,</span> <span class="n">idx</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_example</span><span class="p">(</span><span class="n">example</span><span class="p">,</span> <span class="n">split</span><span class="p">,</span> <span class="n">idx</span><span class="p">),</span>
                    <span class="n">with_indices</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">remove_columns</span><span class="o">=</span><span class="n">enumerated_dataset</span><span class="o">.</span><span class="n">column_names</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="c1"># Populate the data structures</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">processed_dataset</span><span class="p">:</span>
                    <span class="n">query_id</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;query_id&quot;</span><span class="p">]</span>
                    <span class="n">queries</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">query_id</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;query&quot;</span><span class="p">]})</span>

                    <span class="c1"># Add documents and relevance information</span>
                    <span class="k">for</span> <span class="n">doc_id</span><span class="p">,</span> <span class="n">doc_text</span><span class="p">,</span> <span class="n">relevance</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
                        <span class="n">item</span><span class="p">[</span><span class="s2">&quot;doc_ids&quot;</span><span class="p">],</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;doc_texts&quot;</span><span class="p">],</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;relevance_scores&quot;</span><span class="p">]</span>
                    <span class="p">):</span>
                        <span class="n">corpus</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="p">{</span>
                                <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">doc_text</span><span class="p">,</span>
                                <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">doc_id</span><span class="p">,</span>
                            <span class="p">}</span>
                        <span class="p">)</span>
                        <span class="n">top_ranked</span><span class="p">[</span><span class="n">query_id</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">doc_id</span><span class="p">)</span>
                        <span class="n">relevant_docs</span><span class="p">[</span><span class="n">query_id</span><span class="p">][</span><span class="n">doc_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">relevance</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">hf_subset</span><span class="p">][</span><span class="n">split</span><span class="p">]</span> <span class="o">=</span> <span class="n">RetrievalSplitData</span><span class="p">(</span>
                    <span class="n">corpus</span><span class="o">=</span><span class="n">Dataset</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="n">corpus</span><span class="p">),</span>
                    <span class="n">queries</span><span class="o">=</span><span class="n">Dataset</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="n">queries</span><span class="p">),</span>
                    <span class="n">relevant_docs</span><span class="o">=</span><span class="n">relevant_docs</span><span class="p">,</span>
                    <span class="n">top_ranked</span><span class="o">=</span><span class="n">top_ranked</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_loaded</span> <span class="o">=</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="mteb.abstasks.text.reranking.AbsTaskReranking.load_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_data</span><span class="p">(</span><span class="n">num_proc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

<a href="#mteb.abstasks.text.reranking.AbsTaskReranking.load_data" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Load the dataset.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>mteb/abstasks/text/reranking.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">load_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_proc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load the dataset.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_loaded</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">OLD_FORMAT_RERANKING_TASKS</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transform_old_dataset_format</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># use AbsTaskRetrieval default to load the data</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">load_data</span><span class="p">(</span><span class="n">num_proc</span><span class="o">=</span><span class="n">num_proc</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="mteb.abstasks.text.reranking.AbsTaskReranking.transform_old_dataset_format" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">transform_old_dataset_format</span><span class="p">(</span><span class="n">given_dataset</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#mteb.abstasks.text.reranking.AbsTaskReranking.transform_old_dataset_format" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Transform the old format to the new format using HF datasets mapping. This is a one-time transformation for datasets which are in the old format.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>given_dataset</code>
            </td>
            <td>
                  <code><span title="datasets.Dataset">Dataset</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The dataset to transform. Defaults to None. This is helpful for some older datasets which are loaded with custom code, but need to be transformed still.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>mteb/abstasks/text/reranking.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">transform_old_dataset_format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">given_dataset</span><span class="p">:</span> <span class="n">Dataset</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Transform the old format to the new format using HF datasets mapping. This is a one-time transformation for datasets which are in the old format.</span>

<span class="sd">    Args:</span>
<span class="sd">        given_dataset (Dataset, optional): The dataset to transform. Defaults to None. This is helpful for some older datasets which are loaded with custom code, but need to be transformed still.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">OLD_FORMAT_RERANKING_TASKS</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Transforming old format to standard format for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>

    <span class="n">given_dataset</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">given_dataset</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">RetrievalSplitData</span><span class="p">]]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span>
        <span class="k">lambda</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>  <span class="c1"># type: ignore[arg-type]</span>
    <span class="p">)</span>

    <span class="n">hf_subsets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hf_subsets</span>

    <span class="k">for</span> <span class="n">hf_subset</span> <span class="ow">in</span> <span class="n">hf_subsets</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">given_dataset</span><span class="p">:</span>
            <span class="n">cur_dataset</span> <span class="o">=</span> <span class="n">given_dataset</span>
            <span class="k">if</span> <span class="n">hf_subset</span> <span class="ow">in</span> <span class="n">cur_dataset</span><span class="p">:</span>
                <span class="n">cur_dataset</span> <span class="o">=</span> <span class="n">cur_dataset</span><span class="p">[</span><span class="n">hf_subset</span><span class="p">]</span>
        <span class="k">elif</span> <span class="s2">&quot;name&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">dataset</span><span class="p">:</span>
            <span class="n">cur_dataset</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">load_dataset</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">dataset</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">hf_subset</span> <span class="o">==</span> <span class="s2">&quot;default&quot;</span><span class="p">,</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Only default subset is supported for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> since `name` is given in the metadata.&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cur_dataset</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">load_dataset</span><span class="p">(</span>
                <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">dataset</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">hf_subset</span>
            <span class="p">)</span>

        <span class="k">for</span> <span class="n">split</span> <span class="ow">in</span> <span class="n">cur_dataset</span><span class="p">:</span>
            <span class="n">corpus</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">queries</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">relevant_docs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
            <span class="n">top_ranked</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

            <span class="c1"># Create an enumerated dataset to pass indices</span>
            <span class="n">enumerated_dataset</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;index&quot;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cur_dataset</span><span class="p">[</span><span class="n">split</span><span class="p">])),</span>
                    <span class="s2">&quot;query&quot;</span><span class="p">:</span> <span class="n">cur_dataset</span><span class="p">[</span><span class="n">split</span><span class="p">][</span><span class="s2">&quot;query&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;positive&quot;</span><span class="p">:</span> <span class="n">cur_dataset</span><span class="p">[</span><span class="n">split</span><span class="p">][</span><span class="s2">&quot;positive&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;negative&quot;</span><span class="p">:</span> <span class="n">cur_dataset</span><span class="p">[</span><span class="n">split</span><span class="p">][</span><span class="s2">&quot;negative&quot;</span><span class="p">],</span>
                <span class="p">}</span>
            <span class="p">)</span>

            <span class="c1"># first, filter out the ones that have no positive or no negatives</span>
            <span class="n">enumerated_dataset</span> <span class="o">=</span> <span class="n">enumerated_dataset</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">example</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">example</span><span class="p">[</span><span class="s2">&quot;positive&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span>
                <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">example</span><span class="p">[</span><span class="s2">&quot;negative&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span>
            <span class="p">)</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Filtered out </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">cur_dataset</span><span class="p">[</span><span class="n">split</span><span class="p">])</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="n">enumerated_dataset</span><span class="p">)</span><span class="si">}</span><span class="s2"> examples with no positive or no negative examples. </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">enumerated_dataset</span><span class="p">)</span><span class="si">}</span><span class="s2"> examples remaining.&quot;</span>
            <span class="p">)</span>

            <span class="c1"># Map the transformation function over the dataset</span>
            <span class="n">processed_dataset</span> <span class="o">=</span> <span class="n">enumerated_dataset</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">example</span><span class="p">,</span> <span class="n">idx</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_example</span><span class="p">(</span><span class="n">example</span><span class="p">,</span> <span class="n">split</span><span class="p">,</span> <span class="n">idx</span><span class="p">),</span>
                <span class="n">with_indices</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">remove_columns</span><span class="o">=</span><span class="n">enumerated_dataset</span><span class="o">.</span><span class="n">column_names</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># Populate the data structures</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">processed_dataset</span><span class="p">:</span>
                <span class="n">query_id</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;query_id&quot;</span><span class="p">]</span>
                <span class="n">queries</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">query_id</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;query&quot;</span><span class="p">]})</span>

                <span class="c1"># Add documents and relevance information</span>
                <span class="k">for</span> <span class="n">doc_id</span><span class="p">,</span> <span class="n">doc_text</span><span class="p">,</span> <span class="n">relevance</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
                    <span class="n">item</span><span class="p">[</span><span class="s2">&quot;doc_ids&quot;</span><span class="p">],</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;doc_texts&quot;</span><span class="p">],</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;relevance_scores&quot;</span><span class="p">]</span>
                <span class="p">):</span>
                    <span class="n">corpus</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">doc_text</span><span class="p">,</span>
                            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">doc_id</span><span class="p">,</span>
                        <span class="p">}</span>
                    <span class="p">)</span>
                    <span class="n">top_ranked</span><span class="p">[</span><span class="n">query_id</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">doc_id</span><span class="p">)</span>
                    <span class="n">relevant_docs</span><span class="p">[</span><span class="n">query_id</span><span class="p">][</span><span class="n">doc_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">relevance</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">hf_subset</span><span class="p">][</span><span class="n">split</span><span class="p">]</span> <span class="o">=</span> <span class="n">RetrievalSplitData</span><span class="p">(</span>
                <span class="n">corpus</span><span class="o">=</span><span class="n">Dataset</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="n">corpus</span><span class="p">),</span>
                <span class="n">queries</span><span class="o">=</span><span class="n">Dataset</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="n">queries</span><span class="p">),</span>
                <span class="n">relevant_docs</span><span class="o">=</span><span class="n">relevant_docs</span><span class="p">,</span>
                <span class="n">top_ranked</span><span class="o">=</span><span class="n">top_ranked</span><span class="p">,</span>
            <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data_loaded</span> <span class="o">=</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="image-tasks">Image Tasks<a class="headerlink" href="#image-tasks" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-class">



<h3 id="mteb.abstasks.image.image_text_pair_classification.AbsTaskImageTextPairClassification" class="doc doc-heading">
            <code>mteb.abstasks.image.image_text_pair_classification.AbsTaskImageTextPairClassification</code>


<a href="#mteb.abstasks.image.image_text_pair_classification.AbsTaskImageTextPairClassification" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="&lt;code&gt;mteb.AbsTask&lt;/code&gt; (&lt;code&gt;mteb.abstasks.abstask.AbsTask&lt;/code&gt;)" href="#mteb.AbsTask">AbsTask</a></code></p>



        <p>Abstract class for Image Text Pair Classification tasks (Compositionality evaluation).</p>
<p>The similarity is computed between pairs and the results are ranked.
Note that the number of images and the number of captions can be different.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.image.image_text_pair_classification.AbsTaskImageTextPairClassification.dataset">dataset</span></code></td>
            <td>
                  <code><span title="dict">dict</span>[<a class="autorefs autorefs-internal" title="&lt;code class=&quot;highlight language-python&quot;&gt;&lt;span class=&quot;n&quot;&gt;HFSubset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;str&lt;/span&gt;&lt;/code&gt;

  &lt;span class=&quot;doc doc-labels&quot;&gt;
      &lt;small class=&quot;doc doc-label doc-label-module-attribute&quot;&gt;&lt;code&gt;module-attribute&lt;/code&gt;&lt;/small&gt;
  &lt;/span&gt; (&lt;code&gt;mteb.types.HFSubset&lt;/code&gt;)" href="../types/#mteb.types._result.HFSubset">HFSubset</a>, <span title="datasets.DatasetDict">DatasetDict</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A HuggingFace Dataset containing the data for the ImageTextPairClassification task. Should have columns:
- images: List of images.
- captions: List of captions.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.image.image_text_pair_classification.AbsTaskImageTextPairClassification.images_column_names">images_column_names</span></code></td>
            <td>
                  <code><span title="str">str</span> | <span title="collections.abc.Sequence">Sequence</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the column(s) containing the images.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.image.image_text_pair_classification.AbsTaskImageTextPairClassification.texts_column_names">texts_column_names</span></code></td>
            <td>
                  <code><span title="str">str</span> | <span title="collections.abc.Sequence">Sequence</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the column(s) containing the captions.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="mteb.abstasks.image.image_text_pair_classification.AbsTaskImageTextPairClassification.abstask_prompt">abstask_prompt</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Prompt to use for the task for instruction model if not prompt is provided in TaskMetadata.prompt.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>mteb/abstasks/image/image_text_pair_classification.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">AbsTaskImageTextPairClassification</span><span class="p">(</span><span class="n">AbsTask</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Abstract class for Image Text Pair Classification tasks (Compositionality evaluation).</span>

<span class="sd">    The similarity is computed between pairs and the results are ranked.</span>
<span class="sd">    Note that the number of images and the number of captions can be different.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        dataset: A HuggingFace Dataset containing the data for the ImageTextPairClassification task. Should have columns:</span>
<span class="sd">            - images: List of images.</span>
<span class="sd">            - captions: List of captions.</span>
<span class="sd">        images_column_names: Name of the column(s) containing the images.</span>
<span class="sd">        texts_column_names: Name of the column(s) containing the captions.</span>
<span class="sd">        abstask_prompt: Prompt to use for the task for instruction model if not prompt is provided in TaskMetadata.prompt.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># it can be [&quot;image_0&quot;, &quot;image_1&quot;]; [&quot;text_0&quot;, &quot;text_1&quot;] for datasets like WinoGround</span>
    <span class="n">images_column_names</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;image&quot;</span>
    <span class="n">texts_column_names</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;caption&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_calculate_descriptive_statistics_from_split</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">split</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">hf_subset</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">compute_overall</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ImageTextPairClassificationDescriptiveStatistics</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">compute_overall</span><span class="p">:</span>
            <span class="n">dataset</span> <span class="o">=</span> <span class="n">concatenate_datasets</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">hf_subset</span><span class="p">][</span><span class="n">split</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">hf_subset</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">eval_langs</span>
                <span class="p">]</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dataset</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">split</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">hf_subset</span> <span class="ow">is</span> <span class="kc">None</span>
                <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">[</span><span class="n">hf_subset</span><span class="p">][</span><span class="n">split</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="n">num_samples</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>

        <span class="n">images</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">texts</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">images_column_names</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">images</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dataset</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">images_column_names</span><span class="p">])</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">images_column_names</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">):</span>
            <span class="n">images</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">img</span>
                <span class="k">for</span> <span class="n">img_column</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">images_column_names</span>
                <span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="n">dataset</span><span class="p">[</span><span class="n">img_column</span><span class="p">]</span>
            <span class="p">]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">texts_column_names</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">texts</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dataset</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">texts_column_names</span><span class="p">])</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">texts_column_names</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">):</span>
            <span class="n">texts</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">text</span>
                <span class="k">for</span> <span class="n">text_column</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">texts_column_names</span>
                <span class="k">for</span> <span class="n">text</span> <span class="ow">in</span> <span class="n">dataset</span><span class="p">[</span><span class="n">text_column</span><span class="p">]</span>
            <span class="p">]</span>

        <span class="k">return</span> <span class="n">ImageTextPairClassificationDescriptiveStatistics</span><span class="p">(</span>
            <span class="n">num_samples</span><span class="o">=</span><span class="n">num_samples</span><span class="p">,</span>
            <span class="n">text_statistics</span><span class="o">=</span><span class="n">calculate_text_statistics</span><span class="p">(</span><span class="n">texts</span><span class="p">),</span>
            <span class="n">image_statistics</span><span class="o">=</span><span class="n">calculate_image_statistics</span><span class="p">(</span><span class="n">images</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_evaluate_subset</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">MTEBModels</span><span class="p">,</span>
        <span class="n">data_split</span><span class="p">:</span> <span class="n">Dataset</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">encode_kwargs</span><span class="p">:</span> <span class="n">EncodeKwargs</span><span class="p">,</span>
        <span class="n">hf_split</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">hf_subset</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">prediction_folder</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">num_proc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ImageTextPairClassificationMetrics</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">EncoderProtocol</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Expected model to be an instance of EncoderProtocol&quot;</span><span class="p">)</span>
        <span class="n">select_columns</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">columns</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">images_column_names</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">texts_column_names</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">select_columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">select_columns</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span>

        <span class="n">data_split</span> <span class="o">=</span> <span class="n">data_split</span><span class="o">.</span><span class="n">select_columns</span><span class="p">(</span><span class="n">select_columns</span><span class="p">)</span>
        <span class="n">num_images_per_sample</span> <span class="o">=</span> <span class="p">(</span>
            <span class="mi">1</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">images_column_names</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
            <span class="k">else</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">images_column_names</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">num_texts_per_sample</span> <span class="o">=</span> <span class="p">(</span>
            <span class="mi">1</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">texts_column_names</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
            <span class="k">else</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">texts_column_names</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">evaluator</span> <span class="o">=</span> <span class="n">ImageTextPairClassificationEvaluator</span><span class="p">(</span>
            <span class="n">data_split</span><span class="p">,</span>
            <span class="n">images_column_names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">images_column_names</span><span class="p">,</span>
            <span class="n">texts_column_names</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">texts_column_names</span><span class="p">,</span>
            <span class="n">task_metadata</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span>
            <span class="n">num_texts_per_sample</span><span class="o">=</span><span class="n">num_texts_per_sample</span><span class="p">,</span>
            <span class="n">num_images_per_sample</span><span class="o">=</span><span class="n">num_images_per_sample</span><span class="p">,</span>
            <span class="n">hf_split</span><span class="o">=</span><span class="n">hf_split</span><span class="p">,</span>
            <span class="n">hf_subset</span><span class="o">=</span><span class="n">hf_subset</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">scores</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="n">evaluator</span><span class="p">(</span>
            <span class="n">model</span><span class="p">,</span> <span class="n">encode_kwargs</span><span class="o">=</span><span class="n">encode_kwargs</span><span class="p">,</span> <span class="n">num_proc</span><span class="o">=</span><span class="n">num_proc</span>
        <span class="p">)</span>  <span class="c1"># type: ignore[assignment]</span>
        <span class="k">if</span> <span class="n">prediction_folder</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_save_task_predictions</span><span class="p">(</span>
                <span class="p">[</span><span class="n">score</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="k">for</span> <span class="n">score</span> <span class="ow">in</span> <span class="n">scores</span><span class="p">],</span>
                <span class="n">model</span><span class="p">,</span>
                <span class="n">prediction_folder</span><span class="p">,</span>
                <span class="n">hf_subset</span><span class="o">=</span><span class="n">hf_subset</span><span class="p">,</span>
                <span class="n">hf_split</span><span class="o">=</span><span class="n">hf_split</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_metrics</span><span class="p">(</span>
            <span class="n">scores</span><span class="p">,</span>
            <span class="n">num_images_per_sample</span><span class="p">,</span>
            <span class="n">num_texts_per_sample</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_compute_metrics</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">scores</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">],</span>
        <span class="n">num_images_per_sample</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">num_texts_per_sample</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ImageTextPairClassificationMetrics</span><span class="p">:</span>
        <span class="n">image_score</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">text_score</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">all_correct_scores</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">img_ground_truths</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">num_images_per_sample</span><span class="p">)</span>
        <span class="n">caption_ground_truths</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">num_texts_per_sample</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">score</span> <span class="ow">in</span> <span class="n">scores</span><span class="p">:</span>
            <span class="n">image_closest_text</span> <span class="o">=</span> <span class="n">score</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># shape = (num_images_per_sample)</span>
            <span class="n">text_closest_image</span> <span class="o">=</span> <span class="n">score</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># shape = (num_texts_per_sample)</span>
            <span class="n">pred_text_is_correct</span> <span class="o">=</span> <span class="p">(</span>
                <span class="p">(</span><span class="n">image_closest_text</span> <span class="o">==</span> <span class="n">img_ground_truths</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="n">pred_image_is_correct</span> <span class="o">=</span> <span class="p">(</span>
                <span class="p">(</span><span class="n">text_closest_image</span> <span class="o">==</span> <span class="n">caption_ground_truths</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="n">all_correct</span> <span class="o">=</span> <span class="n">pred_text_is_correct</span> <span class="ow">and</span> <span class="n">pred_image_is_correct</span>
            <span class="n">image_score</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pred_image_is_correct</span><span class="p">)</span>
            <span class="n">text_score</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pred_text_is_correct</span><span class="p">)</span>
            <span class="n">all_correct_scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">all_correct</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ImageTextPairClassificationMetrics</span><span class="p">(</span>
            <span class="n">image_acc</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">image_score</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">(),</span>
            <span class="n">text_acc</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">text_score</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">(),</span>
            <span class="n">accuracy</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">all_correct_scores</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">(),</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_push_dataset_to_hub</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">repo_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">num_proc</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">text_columns</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">texts_column_names</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">texts_column_names</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
            <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">texts_column_names</span>
        <span class="p">)</span>
        <span class="n">image_columns</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">images_column_names</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">images_column_names</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
            <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">images_column_names</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_upload_dataset_to_hub</span><span class="p">(</span>
            <span class="n">repo_name</span><span class="p">,</span>
            <span class="p">[</span><span class="o">*</span><span class="n">text_columns</span><span class="p">,</span> <span class="o">*</span><span class="n">image_columns</span><span class="p">],</span>
            <span class="n">num_proc</span><span class="o">=</span><span class="n">num_proc</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">












  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../benchmark/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Benchmark">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Benchmark
              </div>
            </div>
          </a>
        
        
          
          <a href="../model/" class="md-footer__link md-footer__link--next" aria-label="Next: Model">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Model
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      This text is freely available under a Creative Commons Attribution 4.0 license
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/embeddings-benchmark/mteb" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.tracking", "navigation.instant", "navigation.tabs", "navigation.sections", "navigation.top", "search.suggest", "search.highlight", "content.action.edit", "content.action.view", "content.code.copy", "content.code.annotate", "content.code.annotation", "content.tabs.link", "content.tooltips", "navigation.footer", "navigation.indexes", "toc.follow"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>