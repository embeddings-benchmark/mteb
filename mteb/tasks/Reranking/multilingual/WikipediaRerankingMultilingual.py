from __future__ import annotations

from mteb.abstasks.MultilingualTask import MultilingualTask
from mteb.abstasks.TaskMetadata import TaskMetadata

from ....abstasks.AbsTaskReranking import AbsTaskReranking

_EVAL_LANGS = {
    "bg": ["bul-Cyrl"],
    "bn": ["ben-Beng"],
    "cs": ["ces-Latn"],
    "da": ["dan-Latn"],
    "de": ["deu-Latn"],
    "en": ["eng-Latn"],
    "fa": ["fas-Arab"],
    "fi": ["fin-Latn"],
    "hi": ["hin-Deva"],
    "it": ["ita-Latn"],
    "nl": ["nld-Latn"],
    "pt": ["por-Latn"],
    "ro": ["ron-Latn"],
    "sr": ["srp-Cyrl"],
    "no": ["nor-Latn"],
    "sv": ["swe-Latn"],
}


class WikipediaRerankingMultilingual(AbsTaskReranking, MultilingualTask):
    metadata = TaskMetadata(
        name="WikipediaRerankingMultilingual",
        description="The dataset is derived from Cohere's wikipedia-2023-11 dataset and contains synthetically generated queries.",
        reference="https://huggingface.co/datasets/ellamind/wikipedia-2023-11-reranking-multilingual",
        dataset={
            "path": "ellamind/wikipedia-2023-11-reranking-multilingual",
            "revision": "6268b37d6f975f2a134791ba2f250a91d0bdfb4f",
        },
        type="Reranking",
        category="s2p",
        modalities=["text"],
        eval_splits=["test"],
        eval_langs=_EVAL_LANGS,
        main_score="map_at_1000",
        date=("2023-11-01", "2024-05-15"),
        domains=["Encyclopaedic", "Written"],
        task_subtypes=[],
        license="cc-by-sa-3.0",
        annotations_creators="LM-generated and reviewed",
        dialect=[],
        sample_creation="LM-generated and verified",
        bibtex_citation="""@ONLINE{wikidump,
    author = "Wikimedia Foundation",
    title  = "Wikimedia Downloads",
    url    = "https://dumps.wikimedia.org"
}""",
        descriptive_stats={
            "n_samples": {
                "en": 1500,
                "de": 1500,
                "it": 1500,
                "pt": 1500,
                "nl": 1500,
                "cs": 1500,
                "ro": 1500,
                "bg": 1500,
                "sr": 1500,
                "fi": 1500,
                "da": 1500,
                "fa": 1500,
                "hi": 1500,
                "bn": 1500,
                "no": 1500,
                "sv": 1500,
            },
            "test": {
                "average_document_length": 381.70714351851854,
                "average_query_length": 59.091208333333334,
                "num_documents": 216000,
                "num_queries": 24000,
                "average_relevant_docs_per_query": 1.0,
                "average_instruction_length": 0,
                "num_instructions": 0,
                "average_top_ranked_per_query": 9.0,
                "hf_subset_descriptive_stats": {
                    "bg": {
                        "average_document_length": 374.376,
                        "average_query_length": 60.82666666666667,
                        "num_documents": 13500,
                        "num_queries": 1500,
                        "average_relevant_docs_per_query": 1.0,
                        "average_instruction_length": 0,
                        "num_instructions": 0,
                        "average_top_ranked_per_query": 9.0,
                    },
                    "bn": {
                        "average_document_length": 394.05044444444445,
                        "average_query_length": 47.266666666666666,
                        "num_documents": 13500,
                        "num_queries": 1500,
                        "average_relevant_docs_per_query": 1.0,
                        "average_instruction_length": 0,
                        "num_instructions": 0,
                        "average_top_ranked_per_query": 9.0,
                    },
                    "cs": {
                        "average_document_length": 369.9831111111111,
                        "average_query_length": 56.272,
                        "num_documents": 13500,
                        "num_queries": 1500,
                        "average_relevant_docs_per_query": 1.0,
                        "average_instruction_length": 0,
                        "num_instructions": 0,
                        "average_top_ranked_per_query": 9.0,
                    },
                    "da": {
                        "average_document_length": 345.2597037037037,
                        "average_query_length": 56.75066666666667,
                        "num_documents": 13500,
                        "num_queries": 1500,
                        "average_relevant_docs_per_query": 1.0,
                        "average_instruction_length": 0,
                        "num_instructions": 0,
                        "average_top_ranked_per_query": 9.0,
                    },
                    "de": {
                        "average_document_length": 398.4137777777778,
                        "average_query_length": 70.004,
                        "num_documents": 13500,
                        "num_queries": 1500,
                        "average_relevant_docs_per_query": 1.0,
                        "average_instruction_length": 0,
                        "num_instructions": 0,
                        "average_top_ranked_per_query": 9.0,
                    },
                    "en": {
                        "average_document_length": 452.9871111111111,
                        "average_query_length": 68.372,
                        "num_documents": 13500,
                        "num_queries": 1500,
                        "average_relevant_docs_per_query": 1.0,
                        "average_instruction_length": 0,
                        "num_instructions": 0,
                        "average_top_ranked_per_query": 9.0,
                    },
                    "fa": {
                        "average_document_length": 345.1568888888889,
                        "average_query_length": 48.66733333333333,
                        "num_documents": 13500,
                        "num_queries": 1500,
                        "average_relevant_docs_per_query": 1.0,
                        "average_instruction_length": 0,
                        "num_instructions": 0,
                        "average_top_ranked_per_query": 9.0,
                    },
                    "fi": {
                        "average_document_length": 379.71237037037037,
                        "average_query_length": 55.343333333333334,
                        "num_documents": 13500,
                        "num_queries": 1500,
                        "average_relevant_docs_per_query": 1.0,
                        "average_instruction_length": 0,
                        "num_instructions": 0,
                        "average_top_ranked_per_query": 9.0,
                    },
                    "hi": {
                        "average_document_length": 410.72540740740743,
                        "average_query_length": 50.77733333333333,
                        "num_documents": 13500,
                        "num_queries": 1500,
                        "average_relevant_docs_per_query": 1.0,
                        "average_instruction_length": 0,
                        "num_instructions": 0,
                        "average_top_ranked_per_query": 9.0,
                    },
                    "it": {
                        "average_document_length": 393.73437037037036,
                        "average_query_length": 70.05466666666666,
                        "num_documents": 13500,
                        "num_queries": 1500,
                        "average_relevant_docs_per_query": 1.0,
                        "average_instruction_length": 0,
                        "num_instructions": 0,
                        "average_top_ranked_per_query": 9.0,
                    },
                    "nl": {
                        "average_document_length": 375.6695555555556,
                        "average_query_length": 65.34466666666667,
                        "num_documents": 13500,
                        "num_queries": 1500,
                        "average_relevant_docs_per_query": 1.0,
                        "average_instruction_length": 0,
                        "num_instructions": 0,
                        "average_top_ranked_per_query": 9.0,
                    },
                    "pt": {
                        "average_document_length": 398.27237037037037,
                        "average_query_length": 65.11933333333333,
                        "num_documents": 13500,
                        "num_queries": 1500,
                        "average_relevant_docs_per_query": 1.0,
                        "average_instruction_length": 0,
                        "num_instructions": 0,
                        "average_top_ranked_per_query": 9.0,
                    },
                    "ro": {
                        "average_document_length": 348.3817037037037,
                        "average_query_length": 61.973333333333336,
                        "num_documents": 13500,
                        "num_queries": 1500,
                        "average_relevant_docs_per_query": 1.0,
                        "average_instruction_length": 0,
                        "num_instructions": 0,
                        "average_top_ranked_per_query": 9.0,
                    },
                    "sr": {
                        "average_document_length": 384.3131851851852,
                        "average_query_length": 55.669333333333334,
                        "num_documents": 13500,
                        "num_queries": 1500,
                        "average_relevant_docs_per_query": 1.0,
                        "average_instruction_length": 0,
                        "num_instructions": 0,
                        "average_top_ranked_per_query": 9.0,
                    },
                    "no": {
                        "average_document_length": 366.93733333333336,
                        "average_query_length": 55.288,
                        "num_documents": 13500,
                        "num_queries": 1500,
                        "average_relevant_docs_per_query": 1.0,
                        "average_instruction_length": 0,
                        "num_instructions": 0,
                        "average_top_ranked_per_query": 9.0,
                    },
                    "sv": {
                        "average_document_length": 369.340962962963,
                        "average_query_length": 57.73,
                        "num_documents": 13500,
                        "num_queries": 1500,
                        "average_relevant_docs_per_query": 1.0,
                        "average_instruction_length": 0,
                        "num_instructions": 0,
                        "average_top_ranked_per_query": 9.0,
                    },
                },
            },
        },
    )
